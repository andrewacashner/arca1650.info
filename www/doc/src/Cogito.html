<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : Cogito
Description : Process ark input to create music
Copyright   : (c) Andrew A. Cashner 2021
Maintainer  : Andrew Cashner, &lt;andrew.cashner@rochester.edu&gt;
Stability   : Experimental

This module processes data from the ark to convert it into music (/cogito/,
Latin, &quot;I think&quot;).

= Overview

This module receives input from the @Lectio@ module in the form of a single
list of one or more 'LyricSection's, which contain the parsed text to be set
to music and the parameters for setting it.

The module uses Kircher's rules to pull the appropriate data from the Arca
musarithmica, that is, from the 'Arca' built by the @Aedifico@ module.  It
uses the @Fortuna@ module to get lists of random permutation indices.

The main function is 'makeMusicScore', which applies all the necessary rules to
select music data from the ark for each phrase of text, using the random
permutations when a free choice would otherwise be needed. It takes the
numerals and rhythmic symbols from Kircher's /pinakes/ (rods); converts the
numerals to pitches according to the mode, and combines the pitches and
rhythms (accounting for rests as well).

The module creates the 'MusicScore' data structure which contains all the data
for the music in hierarchical sections that the @Scribo@ module will convert
to MEI XML. 

== Text underlay

Pitches and syllables are stored together in the 'Note' type. In Syntagma I
(simple syllabic counterpoint), we store one syllable for each note, skipping
rests. 

In Syntagma II, though, for florid counterpoint, Kircher does not specify how
to underlay the text, and the settings have variable numbers of notes in the
different voices and between different permutations in the same /pinax/. The
underlay must be left to the human performer, then, and so we just lump all
the lyrics for each phrase and put them under the first syllable as a textual
incipit.

== MEI vs. Lilypond output

We previously set up this module to feed data into the @Scribo.Lilypond@
module, using the main function 'getSymphonia'. It treated pitches and lyrics
completely separately, which worked in Syntagma I but not in Syntagma II.
These functions are still here at the bottom of the file. The test module
still uses them, for now.
-}</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cogito</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">transpose</span><span>
</span><a name="line-59"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">findIndex</span><span>
</span><a name="line-60"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.Index</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">I</span><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">indexed</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Vector</span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromList</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-69"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span>
</span><a name="line-71"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="Aedifico.html"><span class="hs-identifier">Aedifico</span></a><span>
</span><a name="line-74"></a><span>    </span><span class="hs-special">(</span><span>
</span><a name="line-75"></a><span>      </span><span class="hs-special">(</span><a href="Aedifico.html#%21%21%3F"><span class="hs-operator hs-var">!!?</span></a><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Accid"><span class="hs-identifier hs-type">Accid</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#AccidType"><span class="hs-identifier hs-type">AccidType</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ModeList"><span class="hs-identifier hs-type">ModeList</span></a><span>
</span><a name="line-83"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span>
</span><a name="line-84"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#MusicMeter"><span class="hs-identifier hs-type">MusicMeter</span></a><span>
</span><a name="line-85"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Octave"><span class="hs-identifier hs-type">Octave</span></a><span>       </span><span class="hs-special">(</span><a href="Aedifico.html#OctNil"><span class="hs-identifier hs-var">OctNil</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#PenultLength"><span class="hs-identifier hs-type">PenultLength</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Pnum"><span class="hs-identifier hs-type">Pnum</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Style"><span class="hs-identifier hs-type">Style</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span>
</span><a name="line-91"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#TextMeter"><span class="hs-identifier hs-type">TextMeter</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#System"><span class="hs-identifier hs-type">System</span></a><span>       </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#PnumAccid"><span class="hs-identifier hs-type">PnumAccid</span></a><span>
</span><a name="line-95"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span>
</span><a name="line-96"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#getVoice"><span class="hs-identifier hs-var">getVoice</span></a><span>
</span><a name="line-97"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#getRperm"><span class="hs-identifier hs-var">getRperm</span></a><span>
</span><a name="line-98"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#proseMeter"><span class="hs-identifier hs-var">proseMeter</span></a><span>
</span><a name="line-99"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#simplePitch"><span class="hs-identifier hs-var">simplePitch</span></a><span>
</span><a name="line-100"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#modeOrModeB"><span class="hs-identifier hs-var">modeOrModeB</span></a><span>
</span><a name="line-101"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span> </span><a href="Fortuna.html"><span class="hs-identifier">Fortuna</span></a><span>
</span><a name="line-105"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-type">Perm</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">voiceIndex</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rhythmIndex</span><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span>
</span><a name="line-107"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Fortuna.html#SentencePerm"><span class="hs-identifier hs-type">SentencePerm</span></a><span>
</span><a name="line-108"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-keyword">import</span><span> </span><a href="Lectio.html"><span class="hs-identifier">Lectio</span></a><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-comment">-- * Pitches and Groups of Them</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-comment">-- | A 'RawPitch' is the same as a 'Pitch' except instead of a 'Pnum' it has</span><span>
</span><a name="line-115"></a><span class="hs-comment">-- an 'Int'. This allows us to add and subtract from pitches and then use</span><span>
</span><a name="line-116"></a><span class="hs-comment">-- 'stdPitch' to normalize them by adjusting the octave and pitch like the two</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- digits of a base-7 number.</span><span>
</span><a name="line-118"></a><span class="hs-keyword">data</span><span> </span><a name="RawPitch"><a href="Cogito.html#RawPitch"><span class="hs-identifier">RawPitch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="RawPitch"><a href="Cogito.html#RawPitch"><span class="hs-identifier">RawPitch</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-119"></a><span>    </span><a name="rawPnum"><a href="Cogito.html#rawPnum"><span class="hs-identifier">rawPnum</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>
</span><a name="line-120"></a><span>    </span><a name="rawOct"><a href="Cogito.html#rawOct"><span class="hs-identifier">rawOct</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>
</span><a name="line-121"></a><span>    </span><a name="rawDur"><a href="Cogito.html#rawDur"><span class="hs-identifier">rawDur</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span class="hs-special">,</span><span>
</span><a name="line-122"></a><span>    </span><a name="rawAccid"><a href="Cogito.html#rawAccid"><span class="hs-identifier">rawAccid</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Accid"><span class="hs-identifier hs-type">Accid</span></a><span class="hs-special">,</span><span>
</span><a name="line-123"></a><span>    </span><a name="rawAccidType"><a href="Cogito.html#rawAccidType"><span class="hs-identifier">rawAccidType</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#AccidType"><span class="hs-identifier hs-type">AccidType</span></a><span>
</span><a name="line-124"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-comment">-- | A 'Voice' is a list of pitches with an identifier for the voice type.</span><span>
</span><a name="line-127"></a><span class="hs-keyword">data</span><span> </span><a name="Voice"><a href="Cogito.html#Voice"><span class="hs-identifier">Voice</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Voice"><a href="Cogito.html#Voice"><span class="hs-identifier">Voice</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-128"></a><span>    </span><a name="voiceID"><a href="Cogito.html#voiceID"><span class="hs-identifier">voiceID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Enum for Soprano, Alto, Tenor or Bass</span><span>
</span><a name="line-129"></a><span>    </span><a name="music"><a href="Cogito.html#music"><span class="hs-identifier">music</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-130"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-comment">-- | Make a list of voices with same 'voiceID' into one 'Voice' (combine the</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- lists of 'Pitch'es into one)</span><span>
</span><a name="line-135"></a><span class="hs-identifier">mergeVoices</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>
</span><a name="line-136"></a><a name="mergeVoices"><a href="Cogito.html#mergeVoices"><span class="hs-identifier">mergeVoices</span></a></a><span> </span><a name="local-6989586621679117542"><a href="#local-6989586621679117542"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-137"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679117543"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679117544"><a href="#local-6989586621679117544"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679117544"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117542"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-138"></a><span>    </span><span class="hs-keyword">then</span><span>
</span><a name="line-139"></a><span>        </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-var">Voice</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-140"></a><span>            </span><span class="hs-identifier">voiceID</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117543"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span>
</span><a name="line-141"></a><span>            </span><span class="hs-identifier">music</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679117545"><a href="#local-6989586621679117545"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679117545"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117542"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-142"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-143"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Voice IDs not equal&quot;</span><span>
</span><a name="line-144"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-145"></a><span>        </span><a name="local-6989586621679117543"><a href="#local-6989586621679117543"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679117542"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-comment">-- | A 'Chorus' is a group (list) of four 'Voice' items</span><span>
</span><a name="line-150"></a><span class="hs-comment">--</span><span>
</span><a name="line-151"></a><span class="hs-comment">-- __TODO__: We don't actually define it as being four items.</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- __TODO__: Do we still need this with new MEI setup?</span><span>
</span><a name="line-153"></a><span class="hs-keyword">type</span><span> </span><a name="Chorus"><a href="Cogito.html#Chorus"><span class="hs-identifier">Chorus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span class="hs-special">]</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-comment">-- * Manipulating the 'Pitch'</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">-- | Create a rest (that is, a 'Pitch' with duration only)</span><span>
</span><a name="line-158"></a><span class="hs-comment">--</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- We make a 'Pitch' but set the 'pnum' to 'Rest'; 'oct' and 'accid' are set</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- to special nil values ('OctNil', 'AccidNil')</span><span>
</span><a name="line-161"></a><span class="hs-comment">--</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- __TODO__: We are setting the octave using @fromEnum OctNil@: Isn't this the</span><span>
</span><a name="line-163"></a><span class="hs-comment">-- same as just setting it to zero? Is there a better way to mark this?</span><span>
</span><a name="line-164"></a><span class="hs-identifier">newRest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span>      </span><span class="hs-comment">-- ^ Rhythmic duration for this note</span><span>
</span><a name="line-165"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-166"></a><a name="newRest"><a href="Cogito.html#newRest"><span class="hs-identifier">newRest</span></a></a><span> </span><a name="local-6989586621679117546"><a href="#local-6989586621679117546"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-167"></a><span>    </span><span class="hs-identifier">pnum</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Rest"><span class="hs-identifier hs-var">Rest</span></a><span class="hs-special">,</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-identifier">dur</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117546"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-identifier">oct</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="Aedifico.html#OctNil"><span class="hs-identifier hs-var">OctNil</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-identifier">accid</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#AccidNil"><span class="hs-identifier hs-var">AccidNil</span></a><span class="hs-special">,</span><span>
</span><a name="line-171"></a><span>    </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#None"><span class="hs-identifier hs-var">None</span></a><span>
</span><a name="line-172"></a><span class="hs-special">}</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-comment">-- | Standardize pitch.</span><span>
</span><a name="line-175"></a><span class="hs-comment">--</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- A 'Pitch' is like a two-digit number in base 7, where the first digit (the</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- &quot;7s&quot;) is the octave. If the second digit (the &quot;1s&quot;) is over 7, we must</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- increment the octave. A &quot;standardized pitch&quot; in our implementation is one</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- that conforms to this requirement, so the 'stdPitch' method takes all the</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- input for a 'Pitch' and does the necessary conversions to set the octave.</span><span>
</span><a name="line-181"></a><span class="hs-comment">--</span><span>
</span><a name="line-182"></a><span class="hs-comment">-- We need this because Kircher's tables include both pitch number 1 and pitch</span><span>
</span><a name="line-183"></a><span class="hs-comment">-- 8. If pitch input is Kircher's pitch 8, then set pitch num to PcC (0) and</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- add one to octave. </span><span>
</span><a name="line-185"></a><span class="hs-comment">--</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- __TODO__: We don't check for values out of range because we know what input we</span><span>
</span><a name="line-187"></a><span class="hs-comment">-- are getting from the ark. Is this okay?</span><span>
</span><a name="line-188"></a><span class="hs-identifier">stdPitch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#RawPitch"><span class="hs-identifier hs-type">RawPitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-189"></a><a name="stdPitch"><a href="Cogito.html#stdPitch"><span class="hs-identifier">stdPitch</span></a></a><span> </span><a name="local-6989586621679117547"><a href="#local-6989586621679117547"><span class="hs-identifier">pitch1</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-190"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679117571"><a href="#local-6989586621679117571"><span class="hs-identifier">oldPnum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rawPnum</span><span> </span><a href="#local-6989586621679117547"><span class="hs-identifier hs-var">pitch1</span></a><span>
</span><a name="line-191"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-192"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679117571"><span class="hs-identifier hs-var">oldPnum</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679117571"><span class="hs-identifier hs-var">oldPnum</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-193"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-194"></a><span>            </span><span class="hs-identifier">pnum</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">rawPnum</span><span> </span><a href="#local-6989586621679117547"><span class="hs-identifier hs-var">pitch1</span></a><span class="hs-special">,</span><span>
</span><a name="line-195"></a><span>            </span><span class="hs-identifier">oct</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rawOct</span><span> </span><a href="#local-6989586621679117547"><span class="hs-identifier hs-var">pitch1</span></a><span class="hs-special">,</span><span>
</span><a name="line-196"></a><span>            </span><span class="hs-identifier">dur</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117550"><span class="hs-identifier hs-var">oldDur</span></a><span class="hs-special">,</span><span>
</span><a name="line-197"></a><span>            </span><span class="hs-identifier">accid</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117551"><span class="hs-identifier hs-var">oldAccid</span></a><span class="hs-special">,</span><span>
</span><a name="line-198"></a><span>            </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117552"><span class="hs-identifier hs-var">oldAccidType</span></a><span>
</span><a name="line-199"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-200"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-201"></a><span>            </span><span class="hs-identifier">pnum</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679117553"><span class="hs-identifier hs-var">newPnum</span></a><span class="hs-special">,</span><span>
</span><a name="line-202"></a><span>            </span><span class="hs-identifier">oct</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117554"><span class="hs-identifier hs-var">newOct</span></a><span class="hs-special">,</span><span>
</span><a name="line-203"></a><span>            </span><span class="hs-identifier">dur</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117550"><span class="hs-identifier hs-var">oldDur</span></a><span class="hs-special">,</span><span>
</span><a name="line-204"></a><span>            </span><span class="hs-identifier">accid</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117551"><span class="hs-identifier hs-var">oldAccid</span></a><span class="hs-special">,</span><span>
</span><a name="line-205"></a><span>            </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117552"><span class="hs-identifier hs-var">oldAccidType</span></a><span>
</span><a name="line-206"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-207"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-208"></a><span>            </span><a name="local-6989586621679117548"><a href="#local-6989586621679117548"><span class="hs-identifier">oldPnum</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rawPnum</span><span> </span><a href="#local-6989586621679117547"><span class="hs-identifier hs-var">pitch1</span></a><span>
</span><a name="line-209"></a><span>            </span><a name="local-6989586621679117549"><a href="#local-6989586621679117549"><span class="hs-identifier">oldOct</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rawOct</span><span> </span><a href="#local-6989586621679117547"><span class="hs-identifier hs-var">pitch1</span></a><span>
</span><a name="line-210"></a><span>            </span><a name="local-6989586621679117550"><a href="#local-6989586621679117550"><span class="hs-identifier">oldDur</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rawDur</span><span> </span><a href="#local-6989586621679117547"><span class="hs-identifier hs-var">pitch1</span></a><span>
</span><a name="line-211"></a><span>            </span><a name="local-6989586621679117551"><a href="#local-6989586621679117551"><span class="hs-identifier">oldAccid</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rawAccid</span><span> </span><a href="#local-6989586621679117547"><span class="hs-identifier hs-var">pitch1</span></a><span>
</span><a name="line-212"></a><span>            </span><a name="local-6989586621679117552"><a href="#local-6989586621679117552"><span class="hs-identifier">oldAccidType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">rawAccidType</span><span> </span><a href="#local-6989586621679117547"><span class="hs-identifier hs-var">pitch1</span></a><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span>            </span><a name="local-6989586621679117553"><a href="#local-6989586621679117553"><span class="hs-identifier">newPnum</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679117555"><span class="hs-identifier hs-var">pitchDivide</span></a><span>
</span><a name="line-215"></a><span>            </span><a name="local-6989586621679117554"><a href="#local-6989586621679117554"><span class="hs-identifier">newOct</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117549"><span class="hs-identifier hs-var">oldOct</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679117555"><span class="hs-identifier hs-var">pitchDivide</span></a><span>
</span><a name="line-216"></a><span>            </span><a name="local-6989586621679117555"><a href="#local-6989586621679117555"><span class="hs-identifier">pitchDivide</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117548"><span class="hs-identifier hs-var">oldPnum</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divMod</span><span class="hs-special">`</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-comment">-- | Increment a pitch by increasing its 'Pnum' pitch number and its octave if</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- necessary (using 'Pitch' structure like a base-7 number). Create a new</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- 'Pitch' with incremented 'Pnum' and then standardize it with 'stdPitch' to</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- get correct octave and pitch number.</span><span>
</span><a name="line-222"></a><span class="hs-identifier">incPitch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-223"></a><a name="incPitch"><a href="Cogito.html#incPitch"><span class="hs-identifier">incPitch</span></a></a><span> </span><a name="local-6989586621679117572"><a href="#local-6989586621679117572"><span class="hs-identifier">pitch1</span></a></a><span> </span><a name="local-6989586621679117573"><a href="#local-6989586621679117573"><span class="hs-identifier">newPnum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#stdPitch"><span class="hs-identifier hs-var">stdPitch</span></a><span> </span><a href="Cogito.html#RawPitch"><span class="hs-identifier hs-var">RawPitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-224"></a><span>    </span><span class="hs-identifier">rawPnum</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679117572"><span class="hs-identifier hs-var">pitch1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679117573"><span class="hs-identifier hs-var">newPnum</span></a><span class="hs-special">,</span><span>
</span><a name="line-225"></a><span>    </span><span class="hs-identifier">rawOct</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679117572"><span class="hs-identifier hs-var">pitch1</span></a><span class="hs-special">,</span><span>
</span><a name="line-226"></a><span>    </span><span class="hs-identifier">rawDur</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dur</span><span> </span><a href="#local-6989586621679117572"><span class="hs-identifier hs-var">pitch1</span></a><span class="hs-special">,</span><span>
</span><a name="line-227"></a><span>    </span><span class="hs-identifier">rawAccid</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679117572"><span class="hs-identifier hs-var">pitch1</span></a><span class="hs-special">,</span><span>
</span><a name="line-228"></a><span>    </span><span class="hs-identifier">rawAccidType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accidType</span><span> </span><a href="#local-6989586621679117572"><span class="hs-identifier hs-var">pitch1</span></a><span>
</span><a name="line-229"></a><span class="hs-special">}</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-comment">-- ** Adjust pitch for mode</span><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-comment">-- | Is a mode in /cantus mollis/? Should there be a flat in the key</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- signature?</span><span>
</span><a name="line-235"></a><span class="hs-identifier">modeMollis</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-236"></a><a name="modeMollis"><a href="Cogito.html#modeMollis"><span class="hs-identifier">modeMollis</span></a></a><span> </span><a name="local-6989586621679117574"><a href="#local-6989586621679117574"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621679117575"><a href="#local-6989586621679117575"><span class="hs-identifier">systems</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-237"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679117576"><a href="#local-6989586621679117576"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;modeMollis:systems&quot;</span><span> </span><a href="#local-6989586621679117575"><span class="hs-identifier hs-var">systems</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679117574"><span class="hs-identifier hs-var">mode</span></a><span>
</span><a name="line-238"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679117576"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-239"></a><span>        </span><a href="Aedifico.html#Durus"><span class="hs-identifier hs-var">Durus</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-240"></a><span>        </span><a href="Aedifico.html#Mollis"><span class="hs-identifier hs-var">Mollis</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span class="hs-comment">-- | Adjust a pitch to be in a given mode. </span><span>
</span><a name="line-243"></a><span class="hs-identifier">pnumAccidInMode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeList"><span class="hs-identifier hs-type">ModeList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#PnumAccid"><span class="hs-identifier hs-type">PnumAccid</span></a><span>
</span><a name="line-244"></a><a name="pnumAccidInMode"><a href="Cogito.html#pnumAccidInMode"><span class="hs-identifier">pnumAccidInMode</span></a></a><span> </span><a name="local-6989586621679117577"><a href="#local-6989586621679117577"><span class="hs-identifier">rawPnum</span></a></a><span> </span><a name="local-6989586621679117578"><a href="#local-6989586621679117578"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621679117579"><a href="#local-6989586621679117579"><span class="hs-identifier">modeList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117580"><span class="hs-identifier hs-var">pnum</span></a><span>
</span><a name="line-245"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-246"></a><span>        </span><a name="local-6989586621679117580"><a href="#local-6989586621679117580"><span class="hs-identifier">pnum</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;pnumAccidInMode:pnum&quot;</span><span> </span><a href="#local-6989586621679117581"><span class="hs-identifier hs-var">modeScale</span></a><span> </span><a href="#local-6989586621679117577"><span class="hs-identifier hs-var">rawPnum</span></a><span>
</span><a name="line-247"></a><span>        </span><a name="local-6989586621679117581"><a href="#local-6989586621679117581"><span class="hs-identifier">modeScale</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;pnumAccidInMode:modeScale&quot;</span><span> </span><a href="#local-6989586621679117579"><span class="hs-identifier hs-var">modeList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679117578"><span class="hs-identifier hs-var">mode</span></a><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span class="hs-comment">-- | Get the modal final within range for this voice.</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- What pitch = 0 in this mode?</span><span>
</span><a name="line-251"></a><span class="hs-comment">-- What is the lowest octave of that pitch permissible in the range for that</span><span>
</span><a name="line-252"></a><span class="hs-comment">-- voice?</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- Set all the other pitches with reference to that, within the octave between</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- 0--7</span><span>
</span><a name="line-255"></a><span class="hs-identifier">modalFinalInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeList"><span class="hs-identifier hs-type">ModeList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-256"></a><a name="modalFinalInRange"><a href="Cogito.html#modalFinalInRange"><span class="hs-identifier">modalFinalInRange</span></a></a><span> </span><a name="local-6989586621679117582"><a href="#local-6989586621679117582"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621679117583"><a href="#local-6989586621679117583"><span class="hs-identifier">modeList</span></a></a><span> </span><a name="local-6989586621679117584"><a href="#local-6989586621679117584"><span class="hs-identifier">voiceName</span></a></a><span> </span><a name="local-6989586621679117585"><a href="#local-6989586621679117585"><span class="hs-identifier">ranges</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-257"></a><span>    </span><a href="Cogito.html#adjustPitchInRange"><span class="hs-identifier hs-var">adjustPitchInRange</span></a><span> </span><a href="#local-6989586621679117586"><span class="hs-identifier hs-var">basePitch</span></a><span> </span><a href="#local-6989586621679117584"><span class="hs-identifier hs-var">voiceName</span></a><span> </span><a href="#local-6989586621679117585"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-258"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-259"></a><span>        </span><a name="local-6989586621679117586"><a href="#local-6989586621679117586"><span class="hs-identifier">basePitch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#simplePitch"><span class="hs-identifier hs-var">simplePitch</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117587"><span class="hs-identifier hs-var">pnum</span></a><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>        </span><a name="local-6989586621679117587"><a href="#local-6989586621679117587"><span class="hs-identifier">pnum</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679117588"><span class="hs-identifier hs-var">finalPair</span></a><span>
</span><a name="line-261"></a><span>        </span><a name="local-6989586621679117588"><a href="#local-6989586621679117588"><span class="hs-identifier">finalPair</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;modalFinalInRange:finalPair&quot;</span><span> </span><a href="#local-6989586621679117589"><span class="hs-identifier hs-var">modeScale</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-262"></a><span>        </span><a name="local-6989586621679117589"><a href="#local-6989586621679117589"><span class="hs-identifier">modeScale</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;modalFinalInRange:modeScale&quot;</span><span> </span><a href="#local-6989586621679117583"><span class="hs-identifier hs-var">modeList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679117582"><span class="hs-identifier hs-var">mode</span></a><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span class="hs-comment">-- | What octave is the modal final in for this voice's range?</span><span>
</span><a name="line-265"></a><span class="hs-identifier">modalOctaveBase</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeList"><span class="hs-identifier hs-type">ModeList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-266"></a><a name="modalOctaveBase"><a href="Cogito.html#modalOctaveBase"><span class="hs-identifier">modalOctaveBase</span></a></a><span> </span><a name="local-6989586621679117590"><a href="#local-6989586621679117590"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621679117591"><a href="#local-6989586621679117591"><span class="hs-identifier">modeList</span></a></a><span> </span><a name="local-6989586621679117592"><a href="#local-6989586621679117592"><span class="hs-identifier">voiceName</span></a></a><span> </span><a name="local-6989586621679117593"><a href="#local-6989586621679117593"><span class="hs-identifier">ranges</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-267"></a><span>    </span><span class="hs-identifier">oct</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.html#modalFinalInRange"><span class="hs-identifier hs-var">modalFinalInRange</span></a><span> </span><a href="#local-6989586621679117590"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679117591"><span class="hs-identifier hs-var">modeList</span></a><span> </span><a href="#local-6989586621679117592"><span class="hs-identifier hs-var">voiceName</span></a><span> </span><a href="#local-6989586621679117593"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-comment">-- | Adjust the accidental either toward flats or toward sharps, within the</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- 'Accid' enum. If the accidental is unset we just return the original pitch.</span><span>
</span><a name="line-271"></a><span class="hs-identifier">accidentalShift</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-272"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Accid"><span class="hs-identifier hs-type">Accid</span></a><span>
</span><a name="line-273"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-274"></a><a name="accidentalShift"><a href="Cogito.html#accidentalShift"><span class="hs-identifier">accidentalShift</span></a></a><span> </span><a name="local-6989586621679117594"><a href="#local-6989586621679117594"><span class="hs-identifier">pitch</span></a></a><span> </span><a name="local-6989586621679117595"><a href="#local-6989586621679117595"><span class="hs-identifier">direction</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-275"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679117594"><span class="hs-identifier hs-var">pitch</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#AccidNil"><span class="hs-identifier hs-var">AccidNil</span></a><span>
</span><a name="line-276"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679117594"><span class="hs-identifier hs-var">pitch</span></a><span>
</span><a name="line-277"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679117596"><span class="hs-identifier hs-var">newAccidNum</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="Aedifico.html#FlFl"><span class="hs-identifier hs-var">FlFl</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679117596"><span class="hs-identifier hs-var">newAccidNum</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="Aedifico.html#ShSh"><span class="hs-identifier hs-var">ShSh</span></a><span>
</span><a name="line-278"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Cannot adjust accidental further&quot;</span><span>
</span><a name="line-279"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-280"></a><span>        </span><span class="hs-identifier">pnum</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679117594"><span class="hs-identifier hs-var">pitch</span></a><span class="hs-special">,</span><span>
</span><a name="line-281"></a><span>        </span><span class="hs-identifier">oct</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679117594"><span class="hs-identifier hs-var">pitch</span></a><span class="hs-special">,</span><span>
</span><a name="line-282"></a><span>        </span><span class="hs-identifier">dur</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dur</span><span> </span><a href="#local-6989586621679117594"><span class="hs-identifier hs-var">pitch</span></a><span class="hs-special">,</span><span>
</span><a name="line-283"></a><span>        </span><span class="hs-identifier">accid</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><a href="#local-6989586621679117596"><span class="hs-identifier hs-var">newAccidNum</span></a><span class="hs-special">,</span><span>
</span><a name="line-284"></a><span>        </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accidType</span><span> </span><a href="#local-6989586621679117594"><span class="hs-identifier hs-var">pitch</span></a><span> </span><span class="hs-comment">-- __TODO__ should this change?</span><span>
</span><a name="line-285"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-286"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-287"></a><span>        </span><a name="local-6989586621679117596"><a href="#local-6989586621679117596"><span class="hs-identifier">newAccidNum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117597"><span class="hs-identifier hs-var">operation</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679117594"><span class="hs-identifier hs-var">pitch</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-288"></a><span>        </span><a name="local-6989586621679117597"><a href="#local-6989586621679117597"><span class="hs-identifier">operation</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679117595"><span class="hs-identifier hs-var">direction</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-289"></a><span>            </span><a href="Aedifico.html#Fl"><span class="hs-identifier hs-var">Fl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>            </span><a href="Aedifico.html#Sh"><span class="hs-identifier hs-var">Sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-comment">-- | Lower a pitch a semitone, but not past 'FlFl'</span><span>
</span><a name="line-293"></a><span class="hs-identifier">flatten</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-294"></a><a name="flatten"><a href="Cogito.html#flatten"><span class="hs-identifier">flatten</span></a></a><span> </span><a name="local-6989586621679117598"><a href="#local-6989586621679117598"><span class="hs-identifier">pitch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#accidentalShift"><span class="hs-identifier hs-var">accidentalShift</span></a><span> </span><a href="#local-6989586621679117598"><span class="hs-identifier hs-var">pitch</span></a><span> </span><a href="Aedifico.html#Fl"><span class="hs-identifier hs-var">Fl</span></a><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span class="hs-comment">-- | Raise a pitch a semitone, but not past 'ShSh'</span><span>
</span><a name="line-297"></a><span class="hs-identifier">sharpen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-298"></a><a name="sharpen"><a href="Cogito.html#sharpen"><span class="hs-identifier">sharpen</span></a></a><span> </span><a name="local-6989586621679117599"><a href="#local-6989586621679117599"><span class="hs-identifier">pitch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#accidentalShift"><span class="hs-identifier hs-var">accidentalShift</span></a><span> </span><a href="#local-6989586621679117599"><span class="hs-identifier hs-var">pitch</span></a><span> </span><a href="Aedifico.html#Sh"><span class="hs-identifier hs-var">Sh</span></a><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span class="hs-comment">-- ** Measure distances between notes and correct bad intervals</span><span>
</span><a name="line-301"></a><span class="hs-comment">-- *** Convert between diatonic and chromatic pitches to calculate intervals</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- | Convert 'Pitch' to absolute pitch number</span><span>
</span><a name="line-303"></a><span class="hs-identifier">absPitch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-304"></a><a name="absPitch"><a href="Cogito.html#absPitch"><span class="hs-identifier">absPitch</span></a></a><span> </span><a name="local-6989586621679117600"><a href="#local-6989586621679117600"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-305"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679117600"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Can\'t convert Rest to absolute pitch&quot;</span><span>
</span><a name="line-306"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117601"><span class="hs-identifier hs-var">oct12</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679117602"><span class="hs-identifier hs-var">pnum12</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679117603"><span class="hs-identifier hs-var">accid12</span></a><span>
</span><a name="line-307"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-308"></a><span>        </span><a name="local-6989586621679117601"><a href="#local-6989586621679117601"><span class="hs-identifier">oct12</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679117600"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">12</span><span>
</span><a name="line-309"></a><span>        </span><a name="local-6989586621679117602"><a href="#local-6989586621679117602"><span class="hs-identifier">pnum12</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#dia2chrom"><span class="hs-identifier hs-var">dia2chrom</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679117600"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-310"></a><span>        </span><a name="local-6989586621679117603"><a href="#local-6989586621679117603"><span class="hs-identifier">accid12</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679117600"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span class="hs-comment">-- | Get chromatic offset from C for diatonic pitch classes</span><span>
</span><a name="line-313"></a><span class="hs-identifier">dia2chrom</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pnum"><span class="hs-identifier hs-type">Pnum</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-314"></a><a name="dia2chrom"><a href="Cogito.html#dia2chrom"><span class="hs-identifier">dia2chrom</span></a></a><span> </span><a name="local-6989586621679117604"><a href="#local-6989586621679117604"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679117604"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-315"></a><span>    </span><a href="Aedifico.html#PCc"><span class="hs-identifier hs-var">PCc</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-316"></a><span>    </span><a href="Aedifico.html#PCd"><span class="hs-identifier hs-var">PCd</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-317"></a><span>    </span><a href="Aedifico.html#PCe"><span class="hs-identifier hs-var">PCe</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-318"></a><span>    </span><a href="Aedifico.html#PCf"><span class="hs-identifier hs-var">PCf</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-319"></a><span>    </span><a href="Aedifico.html#PCg"><span class="hs-identifier hs-var">PCg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-320"></a><span>    </span><a href="Aedifico.html#PCa"><span class="hs-identifier hs-var">PCa</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">9</span><span>
</span><a name="line-321"></a><span>    </span><a href="Aedifico.html#PCb"><span class="hs-identifier hs-var">PCb</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">11</span><span>
</span><a name="line-322"></a><span>    </span><a href="Aedifico.html#PCc8"><span class="hs-identifier hs-var">PCc8</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">12</span><span>
</span><a name="line-323"></a><span>    </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Unknown pitch class&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679117604"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span class="hs-comment">-- | Are two 'Pitch'es the same chromatic pitch, enharmonically equivalent?</span><span>
</span><a name="line-326"></a><span class="hs-identifier">pEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-327"></a><a name="pEq"><a href="Cogito.html#pEq"><span class="hs-identifier">pEq</span></a></a><span> </span><a name="local-6989586621679117605"><a href="#local-6989586621679117605"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679117606"><a href="#local-6989586621679117606"><span class="hs-identifier">p2</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117605"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117606"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span class="hs-comment">-- | Pitch greater than?</span><span>
</span><a name="line-330"></a><a name="pGt"><a href="Cogito.html#pGt"><span class="hs-identifier">pGt</span></a></a><span> </span><a name="local-6989586621679117607"><a href="#local-6989586621679117607"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679117608"><a href="#local-6989586621679117608"><span class="hs-identifier">p2</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117607"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span>  </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117608"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-comment">-- | Pitch less than?</span><span>
</span><a name="line-333"></a><a name="pLt"><a href="Cogito.html#pLt"><span class="hs-identifier">pLt</span></a></a><span> </span><a name="local-6989586621679117609"><a href="#local-6989586621679117609"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679117610"><a href="#local-6989586621679117610"><span class="hs-identifier">p2</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117609"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span>  </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117610"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-comment">-- | Pitch greater than or equal?</span><span>
</span><a name="line-336"></a><a name="pGtEq"><a href="Cogito.html#pGtEq"><span class="hs-identifier">pGtEq</span></a></a><span> </span><a name="local-6989586621679117611"><a href="#local-6989586621679117611"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679117612"><a href="#local-6989586621679117612"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117611"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117612"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-comment">-- | Pitch less than or equal?</span><span>
</span><a name="line-339"></a><a name="pLtEq"><a href="Cogito.html#pLtEq"><span class="hs-identifier">pLtEq</span></a></a><span> </span><a name="local-6989586621679117613"><a href="#local-6989586621679117613"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679117614"><a href="#local-6989586621679117614"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117613"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117614"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span class="hs-comment">-- | Absolute diatonic pitch (octave + pitch)</span><span>
</span><a name="line-342"></a><span class="hs-identifier">absPitch7</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-343"></a><a name="absPitch7"><a href="Cogito.html#absPitch7"><span class="hs-identifier">absPitch7</span></a></a><span> </span><a name="local-6989586621679117615"><a href="#local-6989586621679117615"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679117615"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">7</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679117615"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-comment">-- | Difference between pitches, diatonic interval</span><span>
</span><a name="line-346"></a><span class="hs-identifier">p7diff</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-347"></a><a name="p7diff"><a href="Cogito.html#p7diff"><span class="hs-identifier">p7diff</span></a></a><span> </span><a name="local-6989586621679117616"><a href="#local-6989586621679117616"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679117617"><a href="#local-6989586621679117617"><span class="hs-identifier">p2</span></a></a><span>
</span><a name="line-348"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679117616"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679117617"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-349"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-350"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-351"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#absPitch7"><span class="hs-identifier hs-var">absPitch7</span></a><span> </span><a href="#local-6989586621679117616"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="Cogito.html#absPitch7"><span class="hs-identifier hs-var">absPitch7</span></a><span> </span><a href="#local-6989586621679117617"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-comment">-- | Copy a 'Pitch' (unchanged if 'Rest'), with given function applied to the</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- octave member</span><span>
</span><a name="line-355"></a><span class="hs-identifier">octaveAdjust</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-356"></a><a name="octaveAdjust"><a href="Cogito.html#octaveAdjust"><span class="hs-identifier">octaveAdjust</span></a></a><span> </span><a name="local-6989586621679117618"><a href="#local-6989586621679117618"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679117619"><a href="#local-6989586621679117619"><span class="hs-identifier">fn</span></a></a><span>
</span><a name="line-357"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679117618"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117618"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-358"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-359"></a><span>        </span><span class="hs-identifier">pnum</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679117618"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-360"></a><span>        </span><span class="hs-identifier">oct</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117619"><span class="hs-identifier hs-var">fn</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679117618"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-361"></a><span>        </span><span class="hs-identifier">accid</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679117618"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-362"></a><span>        </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accidType</span><span> </span><a href="#local-6989586621679117618"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-363"></a><span>        </span><span class="hs-identifier">dur</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dur</span><span> </span><a href="#local-6989586621679117618"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-364"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-comment">-- | Raise the octave by 1</span><span>
</span><a name="line-367"></a><span class="hs-identifier">octaveUp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-368"></a><a name="octaveUp"><a href="Cogito.html#octaveUp"><span class="hs-identifier">octaveUp</span></a></a><span> </span><a name="local-6989586621679117620"><a href="#local-6989586621679117620"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#octaveAdjust"><span class="hs-identifier hs-var">octaveAdjust</span></a><span> </span><a href="#local-6989586621679117620"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679117621"><a href="#local-6989586621679117621"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679117621"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span class="hs-comment">-- | Lower the octave by 1</span><span>
</span><a name="line-371"></a><span class="hs-identifier">octaveDown</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-372"></a><a name="octaveDown"><a href="Cogito.html#octaveDown"><span class="hs-identifier">octaveDown</span></a></a><span> </span><a name="local-6989586621679117622"><a href="#local-6989586621679117622"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#octaveAdjust"><span class="hs-identifier hs-var">octaveAdjust</span></a><span> </span><a href="#local-6989586621679117622"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679117623"><a href="#local-6989586621679117623"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679117623"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><span class="hs-comment">-- * Match pitches and rhythms </span><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span class="hs-comment">-- ** Get music data for a single voice</span><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-comment">-- | Check to see if a rhythmic duration is a rest type (the rest enums begin</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- with 'LgR' so we compare with that)</span><span>
</span><a name="line-380"></a><span class="hs-identifier">isRest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-381"></a><a name="isRest"><a href="Cogito.html#isRest"><span class="hs-identifier">isRest</span></a></a><span> </span><a name="local-6989586621679117624"><a href="#local-6989586621679117624"><span class="hs-identifier">dur</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117624"><span class="hs-identifier hs-var">dur</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="Aedifico.html#LgR"><span class="hs-identifier hs-var">LgR</span></a><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-comment">-- | Is the 'Pitch' a rest?</span><span>
</span><a name="line-384"></a><span class="hs-identifier">isPitchRest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-385"></a><a name="isPitchRest"><a href="Cogito.html#isPitchRest"><span class="hs-identifier">isPitchRest</span></a></a><span> </span><a name="local-6989586621679117625"><a href="#local-6989586621679117625"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679117625"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#Rest"><span class="hs-identifier hs-var">Rest</span></a><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span class="hs-comment">-- | Take two lists and zip them together, that is, make a new list of ordered</span><span>
</span><a name="line-388"></a><span class="hs-comment">-- pairs constructed from sequential items of the two lists, BUT:</span><span>
</span><a name="line-389"></a><span class="hs-comment">-- if an element in the first list satisfies a given @test@, make a pair of that</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- element and a sustitute element (@sub@) instead of the corresponding</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- element from the second list.</span><span>
</span><a name="line-392"></a><span class="hs-identifier">zipFill</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679117540"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- ^ list 1</span><span>
</span><a name="line-393"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679117541"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- ^ list 2</span><span>
</span><a name="line-394"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117540"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ test</span><span>
</span><a name="line-395"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679117541"><span class="hs-identifier hs-type">b</span></a><span>            </span><span class="hs-comment">-- ^ substitute element to use instead of list 2 item,</span><span>
</span><a name="line-396"></a><span>                        </span><span class="hs-comment">--    if list 1 item meets test </span><span>
</span><a name="line-397"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679117540"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679117541"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- ^ return list of pairs made of list 1 and 2, in</span><span>
</span><a name="line-398"></a><span>                        </span><span class="hs-comment">--    item order </span><span>
</span><a name="line-399"></a><a name="zipFill"><a href="Cogito.html#zipFill"><span class="hs-identifier">zipFill</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679117626"><a href="#local-6989586621679117626"><span class="hs-identifier">test</span></a></a><span> </span><a name="local-6989586621679117627"><a href="#local-6989586621679117627"><span class="hs-identifier">sub</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-400"></a><span>    </span><span class="hs-comment">-- stop when the first list is done</span><span>
</span><a name="line-401"></a><span class="hs-identifier">zipFill</span><span> </span><a name="local-6989586621679117628"><a href="#local-6989586621679117628"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679117629"><a href="#local-6989586621679117629"><span class="hs-identifier">test</span></a></a><span> </span><a name="local-6989586621679117630"><a href="#local-6989586621679117630"><span class="hs-identifier">sub</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#zipFill"><span class="hs-identifier hs-var">zipFill</span></a><span> </span><a href="#local-6989586621679117628"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679117630"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679117629"><span class="hs-identifier hs-var">test</span></a><span> </span><a href="#local-6989586621679117630"><span class="hs-identifier hs-var">sub</span></a><span>
</span><a name="line-402"></a><span>    </span><span class="hs-comment">-- when the second list is done, use @sub@ as placeholder for remaining</span><span>
</span><a name="line-403"></a><span>    </span><span class="hs-comment">-- items in first list</span><span>
</span><a name="line-404"></a><span class="hs-identifier">zipFill</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679117631"><a href="#local-6989586621679117631"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679117633"><a href="#local-6989586621679117633"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679117634"><a href="#local-6989586621679117634"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679117635"><a href="#local-6989586621679117635"><span class="hs-identifier">test</span></a></a><span> </span><a name="local-6989586621679117636"><a href="#local-6989586621679117636"><span class="hs-identifier">sub</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-405"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679117635"><span class="hs-identifier hs-var">test</span></a><span> </span><a href="#local-6989586621679117631"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-406"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117631"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679117636"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="Cogito.html#zipFill"><span class="hs-identifier hs-var">zipFill</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117633"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117634"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117635"><span class="hs-identifier hs-var">test</span></a><span> </span><a href="#local-6989586621679117636"><span class="hs-identifier hs-var">sub</span></a><span>
</span><a name="line-407"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117631"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679117633"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="Cogito.html#zipFill"><span class="hs-identifier hs-var">zipFill</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621679117634"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621679117635"><span class="hs-identifier hs-var">test</span></a><span> </span><a href="#local-6989586621679117636"><span class="hs-identifier hs-var">sub</span></a><span>
</span><a name="line-408"></a><span>    </span><span class="hs-comment">-- build a list of pairs of either the heads of both lists or the head</span><span>
</span><a name="line-409"></a><span>    </span><span class="hs-comment">-- of the first list and the @sub@ value</span><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span class="hs-comment">-- | Make a pitch from duration and pitch number, getting octave based on voice</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- name using 'voice2octave'. If the duration input is a rest type (e.g.,</span><span>
</span><a name="line-413"></a><span class="hs-comment">-- 'BrR'), then make a 'newRest'; otherwise a 'stdPitch'.</span><span>
</span><a name="line-414"></a><span class="hs-comment">--</span><span>
</span><a name="line-415"></a><span class="hs-comment">-- Adjust the pitch for mode (and thereby standardize it) ('pnumAccidInMode').</span><span>
</span><a name="line-416"></a><span class="hs-comment">-- Adjust the octave to put the pitch in the right range for the voice</span><span>
</span><a name="line-417"></a><span class="hs-comment">-- ('adjustPitchInRange').</span><span>
</span><a name="line-418"></a><span class="hs-comment">--</span><span>
</span><a name="line-419"></a><span class="hs-comment">-- __TODO__: This could also be generalized; we are not checking inputs</span><span>
</span><a name="line-420"></a><span class="hs-comment">-- because we control data input.</span><span>
</span><a name="line-421"></a><span class="hs-identifier">pair2Pitch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>
</span><a name="line-422"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span>
</span><a name="line-423"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span>
</span><a name="line-424"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeList"><span class="hs-identifier hs-type">ModeList</span></a><span>
</span><a name="line-425"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span>
</span><a name="line-426"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ duration and pitch number 0-7</span><span>
</span><a name="line-427"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-428"></a><a name="pair2Pitch"><a href="Cogito.html#pair2Pitch"><span class="hs-identifier">pair2Pitch</span></a></a><span> </span><a name="local-6989586621679117637"><a href="#local-6989586621679117637"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679117638"><a href="#local-6989586621679117638"><span class="hs-identifier">ranges</span></a></a><span> </span><a name="local-6989586621679117639"><a href="#local-6989586621679117639"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621679117640"><a href="#local-6989586621679117640"><span class="hs-identifier">modeList</span></a></a><span> </span><a name="local-6989586621679117641"><a href="#local-6989586621679117641"><span class="hs-identifier">systems</span></a></a><span> </span><a name="local-6989586621679117642"><a href="#local-6989586621679117642"><span class="hs-identifier">pair</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-429"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="Cogito.html#isRest"><span class="hs-identifier hs-var">isRest</span></a><span> </span><a href="#local-6989586621679117645"><span class="hs-identifier hs-var">thisDur</span></a><span>
</span><a name="line-430"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="Cogito.html#newRest"><span class="hs-identifier hs-var">newRest</span></a><span> </span><a href="#local-6989586621679117645"><span class="hs-identifier hs-var">thisDur</span></a><span>
</span><a name="line-431"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="Cogito.html#adjustPitchInRange"><span class="hs-identifier hs-var">adjustPitchInRange</span></a><span> </span><a href="#local-6989586621679117643"><span class="hs-identifier hs-var">pitch</span></a><span> </span><a href="#local-6989586621679117637"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117638"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-432"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-433"></a><span>            </span><a name="local-6989586621679117643"><a href="#local-6989586621679117643"><span class="hs-identifier">pitch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#stdPitch"><span class="hs-identifier hs-var">stdPitch</span></a><span> </span><a href="Cogito.html#RawPitch"><span class="hs-identifier hs-var">RawPitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-434"></a><span>                </span><span class="hs-identifier">rawPnum</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679117646"><span class="hs-identifier hs-var">thisPnumInMode</span></a><span class="hs-special">,</span><span>
</span><a name="line-435"></a><span>                </span><span class="hs-identifier">rawAccid</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117647"><span class="hs-identifier hs-var">thisAccid</span></a><span class="hs-special">,</span><span>
</span><a name="line-436"></a><span>                </span><span class="hs-identifier">rawAccidType</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117649"><span class="hs-identifier hs-var">thisAccidType</span></a><span class="hs-special">,</span><span>
</span><a name="line-437"></a><span>                </span><span class="hs-identifier">rawOct</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">oct</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679117650"><span class="hs-identifier hs-var">pitchOffsetFromFinal</span></a><span class="hs-special">,</span><span>
</span><a name="line-438"></a><span>                </span><span class="hs-identifier">rawDur</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117645"><span class="hs-identifier hs-var">thisDur</span></a><span>
</span><a name="line-439"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-440"></a><span>
</span><a name="line-441"></a><span>            </span><a name="local-6989586621679117644"><a href="#local-6989586621679117644"><span class="hs-identifier">thisPnum</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679117642"><span class="hs-identifier hs-var">pair</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-comment">-- adjust to 0 index</span><span>
</span><a name="line-442"></a><span>            </span><a name="local-6989586621679117645"><a href="#local-6989586621679117645"><span class="hs-identifier">thisDur</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679117642"><span class="hs-identifier hs-var">pair</span></a><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span>            </span><a name="local-6989586621679117646"><a href="#local-6989586621679117646"><span class="hs-identifier">thisPnumInMode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679117648"><span class="hs-identifier hs-var">modePitch</span></a><span>
</span><a name="line-445"></a><span>            </span><a name="local-6989586621679117647"><a href="#local-6989586621679117647"><span class="hs-identifier">thisAccid</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679117648"><span class="hs-identifier hs-var">modePitch</span></a><span>
</span><a name="line-446"></a><span>            </span><a name="local-6989586621679117648"><a href="#local-6989586621679117648"><span class="hs-identifier">modePitch</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#pnumAccidInMode"><span class="hs-identifier hs-var">pnumAccidInMode</span></a><span> </span><a href="#local-6989586621679117644"><span class="hs-identifier hs-var">thisPnum</span></a><span> </span><a href="#local-6989586621679117639"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679117640"><span class="hs-identifier hs-var">modeList</span></a><span>
</span><a name="line-447"></a><span>
</span><a name="line-448"></a><span>            </span><a name="local-6989586621679117649"><a href="#local-6989586621679117649"><span class="hs-identifier">thisAccidType</span></a></a><span>
</span><a name="line-449"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679117647"><span class="hs-identifier hs-var">thisAccid</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#Na"><span class="hs-identifier hs-var">Na</span></a><span>
</span><a name="line-450"></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Implicit"><span class="hs-identifier hs-var">Implicit</span></a><span>
</span><a name="line-451"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679117647"><span class="hs-identifier hs-var">thisAccid</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#FlFl"><span class="hs-identifier hs-var">FlFl</span></a><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Sh"><span class="hs-identifier hs-var">Sh</span></a><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ShSh"><span class="hs-identifier hs-var">ShSh</span></a><span class="hs-special">]</span><span>
</span><a name="line-452"></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Suggested"><span class="hs-identifier hs-var">Suggested</span></a><span>
</span><a name="line-453"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679117647"><span class="hs-identifier hs-var">thisAccid</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#Fl"><span class="hs-identifier hs-var">Fl</span></a><span>
</span><a name="line-454"></a><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Cogito.html#isBflatInSignature"><span class="hs-identifier hs-var">isBflatInSignature</span></a><span> </span><a href="#local-6989586621679117646"><span class="hs-identifier hs-var">thisPnumInMode</span></a><span> </span><a href="#local-6989586621679117647"><span class="hs-identifier hs-var">thisAccid</span></a><span> </span><a href="#local-6989586621679117639"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679117641"><span class="hs-identifier hs-var">systems</span></a><span>
</span><a name="line-455"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><a href="Aedifico.html#Implicit"><span class="hs-identifier hs-var">Implicit</span></a><span>
</span><a name="line-456"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><a href="Aedifico.html#Suggested"><span class="hs-identifier hs-var">Suggested</span></a><span>
</span><a name="line-457"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-458"></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#None"><span class="hs-identifier hs-var">None</span></a><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span>            </span><a name="local-6989586621679117650"><a href="#local-6989586621679117650"><span class="hs-identifier">pitchOffsetFromFinal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117651"><span class="hs-identifier hs-var">final</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.html#incPitch"><span class="hs-identifier hs-var">incPitch</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679117644"><span class="hs-identifier hs-var">thisPnum</span></a><span>
</span><a name="line-461"></a><span>            </span><a name="local-6989586621679117651"><a href="#local-6989586621679117651"><span class="hs-identifier">final</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#modalFinalInRange"><span class="hs-identifier hs-var">modalFinalInRange</span></a><span> </span><a href="#local-6989586621679117639"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679117640"><span class="hs-identifier hs-var">modeList</span></a><span> </span><a href="#local-6989586621679117637"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117638"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-462"></a><span>
</span><a name="line-463"></a><span class="hs-comment">-- | Is this note a B flat, and if so, is the flat already in the key</span><span>
</span><a name="line-464"></a><span class="hs-comment">-- signature?</span><span>
</span><a name="line-465"></a><span class="hs-identifier">isBflatInSignature</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pnum"><span class="hs-identifier hs-type">Pnum</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Accid"><span class="hs-identifier hs-type">Accid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-466"></a><a name="isBflatInSignature"><a href="Cogito.html#isBflatInSignature"><span class="hs-identifier">isBflatInSignature</span></a></a><span> </span><a name="local-6989586621679117652"><a href="#local-6989586621679117652"><span class="hs-identifier">pnum</span></a></a><span> </span><a name="local-6989586621679117653"><a href="#local-6989586621679117653"><span class="hs-identifier">accid</span></a></a><span> </span><a name="local-6989586621679117654"><a href="#local-6989586621679117654"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621679117655"><a href="#local-6989586621679117655"><span class="hs-identifier">systems</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-467"></a><span>    </span><a href="#local-6989586621679117652"><span class="hs-identifier hs-var">pnum</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#PCb"><span class="hs-identifier hs-var">PCb</span></a><span>
</span><a name="line-468"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679117653"><span class="hs-identifier hs-var">accid</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#Fl"><span class="hs-identifier hs-var">Fl</span></a><span>
</span><a name="line-469"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Cogito.html#modeMollis"><span class="hs-identifier hs-var">modeMollis</span></a><span> </span><a href="#local-6989586621679117654"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679117655"><span class="hs-identifier hs-var">systems</span></a><span>
</span><a name="line-470"></a><span>
</span><a name="line-471"></a><span class="hs-comment">-- | Get the right starting octave range for each voice type voice2octave :: VoiceName -&gt; Int</span><span>
</span><a name="line-472"></a><a name="voice2octave"><a href="Cogito.html#voice2octave"><span class="hs-identifier">voice2octave</span></a></a><span> </span><a name="local-6989586621679117656"><a href="#local-6989586621679117656"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679117656"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-473"></a><span>    </span><a href="Aedifico.html#Soprano"><span class="hs-identifier hs-var">Soprano</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-474"></a><span>    </span><a href="Aedifico.html#Alto"><span class="hs-identifier hs-var">Alto</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-475"></a><span>    </span><a href="Aedifico.html#Tenor"><span class="hs-identifier hs-var">Tenor</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-476"></a><span>    </span><a href="Aedifico.html#Bass"><span class="hs-identifier hs-var">Bass</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span class="hs-comment">-- | Is the pitch below the bottom limit of the voice range?</span><span>
</span><a name="line-479"></a><span class="hs-identifier">pitchTooLow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-480"></a><a name="pitchTooLow"><a href="Cogito.html#pitchTooLow"><span class="hs-identifier">pitchTooLow</span></a></a><span> </span><a name="local-6989586621679117657"><a href="#local-6989586621679117657"><span class="hs-identifier">pitch</span></a></a><span> </span><a name="local-6989586621679117658"><a href="#local-6989586621679117658"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679117659"><a href="#local-6989586621679117659"><span class="hs-identifier">ranges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117657"><span class="hs-identifier hs-var">pitch</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.html#pLt"><span class="hs-identifier hs-var">pLt</span></a><span class="hs-special">`</span><span> </span><a href="Cogito.html#lowRange"><span class="hs-identifier hs-var">lowRange</span></a><span> </span><a href="#local-6989586621679117658"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117659"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-481"></a><span>
</span><a name="line-482"></a><span class="hs-comment">-- | Is the pitch above the upper limit of the voice range?</span><span>
</span><a name="line-483"></a><span class="hs-identifier">pitchTooHigh</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-484"></a><a name="pitchTooHigh"><a href="Cogito.html#pitchTooHigh"><span class="hs-identifier">pitchTooHigh</span></a></a><span> </span><a name="local-6989586621679117660"><a href="#local-6989586621679117660"><span class="hs-identifier">pitch</span></a></a><span> </span><a name="local-6989586621679117661"><a href="#local-6989586621679117661"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679117662"><a href="#local-6989586621679117662"><span class="hs-identifier">ranges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117660"><span class="hs-identifier hs-var">pitch</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.html#pGt"><span class="hs-identifier hs-var">pGt</span></a><span class="hs-special">`</span><span> </span><a href="Cogito.html#highRange"><span class="hs-identifier hs-var">highRange</span></a><span> </span><a href="#local-6989586621679117661"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117662"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-485"></a><span>
</span><a name="line-486"></a><span class="hs-comment">-- | Get the bottom limit of the voice range</span><span>
</span><a name="line-487"></a><span class="hs-identifier">lowRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-488"></a><a name="lowRange"><a href="Cogito.html#lowRange"><span class="hs-identifier">lowRange</span></a></a><span> </span><a name="local-6989586621679117663"><a href="#local-6989586621679117663"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679117664"><a href="#local-6989586621679117664"><span class="hs-identifier">ranges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679117664"><span class="hs-identifier hs-var">ranges</span></a><span> </span><a href="Aedifico.html#%21%21%3F"><span class="hs-operator hs-var">!!?</span></a><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679117663"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span class="hs-comment">-- | Get the top limit of the voice range</span><span>
</span><a name="line-491"></a><span class="hs-identifier">highRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-492"></a><a name="highRange"><a href="Cogito.html#highRange"><span class="hs-identifier">highRange</span></a></a><span> </span><a name="local-6989586621679117665"><a href="#local-6989586621679117665"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679117666"><a href="#local-6989586621679117666"><span class="hs-identifier">ranges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679117666"><span class="hs-identifier hs-var">ranges</span></a><span> </span><a href="Aedifico.html#%21%21%3F"><span class="hs-operator hs-var">!!?</span></a><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679117665"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-493"></a><span>
</span><a name="line-494"></a><span class="hs-comment">-- | Adjust a pitch to be in the correct voice range (using @Aedifico.vocalRanges@).</span><span>
</span><a name="line-495"></a><span class="hs-comment">-- If it's in the right range for the voice, leave it alone; if it's too low</span><span>
</span><a name="line-496"></a><span class="hs-comment">-- raise it by an octave, or vice versa if it's too high; keep shifting</span><span>
</span><a name="line-497"></a><span class="hs-comment">-- octaves till it's in range.</span><span>
</span><a name="line-498"></a><span class="hs-identifier">adjustPitchInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-499"></a><a name="adjustPitchInRange"><a href="Cogito.html#adjustPitchInRange"><span class="hs-identifier">adjustPitchInRange</span></a></a><span> </span><a name="local-6989586621679117667"><a href="#local-6989586621679117667"><span class="hs-identifier">pitch</span></a></a><span> </span><a name="local-6989586621679117668"><a href="#local-6989586621679117668"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679117669"><a href="#local-6989586621679117669"><span class="hs-identifier">ranges</span></a></a><span>
</span><a name="line-500"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679117667"><span class="hs-identifier hs-var">pitch</span></a><span>
</span><a name="line-501"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117667"><span class="hs-identifier hs-var">pitch</span></a><span>
</span><a name="line-502"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.html#pitchTooLow"><span class="hs-identifier hs-var">pitchTooLow</span></a><span> </span><a href="#local-6989586621679117667"><span class="hs-identifier hs-var">pitch</span></a><span> </span><a href="#local-6989586621679117668"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117669"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-503"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#adjustPitchInRange"><span class="hs-identifier hs-var">adjustPitchInRange</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.html#octaveUp"><span class="hs-identifier hs-var">octaveUp</span></a><span> </span><a href="#local-6989586621679117667"><span class="hs-identifier hs-var">pitch</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117668"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117669"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-504"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.html#pitchTooHigh"><span class="hs-identifier hs-var">pitchTooHigh</span></a><span> </span><a href="#local-6989586621679117667"><span class="hs-identifier hs-var">pitch</span></a><span> </span><a href="#local-6989586621679117668"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117669"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-505"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#adjustPitchInRange"><span class="hs-identifier hs-var">adjustPitchInRange</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.html#octaveDown"><span class="hs-identifier hs-var">octaveDown</span></a><span> </span><a href="#local-6989586621679117667"><span class="hs-identifier hs-var">pitch</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117668"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117669"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-506"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117667"><span class="hs-identifier hs-var">pitch</span></a><span>
</span><a name="line-507"></a><span>
</span><a name="line-508"></a><span class="hs-comment">-- | Is the 'Pitch' within the proper range for its voice?</span><span>
</span><a name="line-509"></a><span class="hs-identifier">isPitchInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-510"></a><a name="isPitchInRange"><a href="Cogito.html#isPitchInRange"><span class="hs-identifier">isPitchInRange</span></a></a><span> </span><a name="local-6989586621679117670"><a href="#local-6989586621679117670"><span class="hs-identifier">pitch</span></a></a><span> </span><a name="local-6989586621679117671"><a href="#local-6989586621679117671"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679117672"><a href="#local-6989586621679117672"><span class="hs-identifier">ranges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679117670"><span class="hs-identifier hs-var">pitch</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-511"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.html#pitchTooLow"><span class="hs-identifier hs-var">pitchTooLow</span></a><span> </span><a href="#local-6989586621679117670"><span class="hs-identifier hs-var">pitch</span></a><span> </span><a href="#local-6989586621679117671"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117672"><span class="hs-identifier hs-var">ranges</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-512"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.html#pitchTooHigh"><span class="hs-identifier hs-var">pitchTooHigh</span></a><span> </span><a href="#local-6989586621679117670"><span class="hs-identifier hs-var">pitch</span></a><span> </span><a href="#local-6989586621679117671"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117672"><span class="hs-identifier hs-var">ranges</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span class="hs-comment">-- ** Adjust list of pitches to avoid bad intervals</span><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span class="hs-comment">-- | Go through list of pitches and reduce intervals that are more than a seventh</span><span>
</span><a name="line-517"></a><span class="hs-identifier">stepwiseInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-518"></a><a name="stepwiseInRange"><a href="Cogito.html#stepwiseInRange"><span class="hs-identifier">stepwiseInRange</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-519"></a><span class="hs-identifier">stepwiseInRange</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679117673"><a href="#local-6989586621679117673"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679117673"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-520"></a><span class="hs-identifier">stepwiseInRange</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679117674"><a href="#local-6989586621679117674"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679117675"><a href="#local-6989586621679117675"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679117674"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Cogito.html#unleap"><span class="hs-identifier hs-var">unleap</span></a><span> </span><a href="#local-6989586621679117674"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679117675"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-521"></a><span class="hs-identifier">stepwiseInRange</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679117676"><a href="#local-6989586621679117676"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679117677"><a href="#local-6989586621679117677"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679117678"><a href="#local-6989586621679117678"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679117679"><a href="#local-6989586621679117679"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679117680"><a href="#local-6989586621679117680"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679117681"><a href="#local-6989586621679117681"><span class="hs-identifier">ranges</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-522"></a><span>    </span><span class="hs-comment">-- If b is a rest, calculate interval between a and b, adjust the next item</span><span>
</span><a name="line-523"></a><span>    </span><span class="hs-comment">-- c as though it was preceded by a</span><span>
</span><a name="line-524"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679117677"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-525"></a><span>    </span><span class="hs-keyword">then</span><span>
</span><a name="line-526"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679117682"><a href="#local-6989586621679117682"><span class="hs-identifier">c2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#unleap"><span class="hs-identifier hs-var">unleap</span></a><span> </span><a href="#local-6989586621679117676"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679117678"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-527"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117676"><span class="hs-identifier hs-var">a</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117677"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><span class="hs-special">(</span><a href="Cogito.html#stepwiseInRange"><span class="hs-identifier hs-var">stepwiseInRange</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117682"><span class="hs-identifier hs-var">c2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117679"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117680"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117681"><span class="hs-identifier hs-var">ranges</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-528"></a><span>    </span><span class="hs-keyword">else</span><span>
</span><a name="line-529"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679117683"><a href="#local-6989586621679117683"><span class="hs-identifier">b2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#unleap"><span class="hs-identifier hs-var">unleap</span></a><span> </span><a href="#local-6989586621679117676"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679117677"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-530"></a><span>        </span><span class="hs-keyword">in</span><span>
</span><a name="line-531"></a><span>            </span><span class="hs-comment">-- If the adjusted second pitch b2 is out of range, then we need</span><span>
</span><a name="line-532"></a><span>            </span><span class="hs-comment">-- to adjust the octave of a accordingly and start over;</span><span>
</span><a name="line-533"></a><span>            </span><span class="hs-comment">-- If not, continue with a, b2, rest of list</span><span>
</span><a name="line-534"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="Cogito.html#pitchTooLow"><span class="hs-identifier hs-var">pitchTooLow</span></a><span> </span><a href="#local-6989586621679117683"><span class="hs-identifier hs-var">b2</span></a><span> </span><a href="#local-6989586621679117680"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117681"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-535"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="Cogito.html#stepwiseInRange"><span class="hs-identifier hs-var">stepwiseInRange</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Cogito.html#octaveUp"><span class="hs-identifier hs-var">octaveUp</span></a><span> </span><a href="#local-6989586621679117676"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679117677"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117678"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117679"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117680"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117681"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-536"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Cogito.html#pitchTooHigh"><span class="hs-identifier hs-var">pitchTooHigh</span></a><span> </span><a href="#local-6989586621679117683"><span class="hs-identifier hs-var">b2</span></a><span> </span><a href="#local-6989586621679117680"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117681"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-537"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="Cogito.html#stepwiseInRange"><span class="hs-identifier hs-var">stepwiseInRange</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Cogito.html#octaveDown"><span class="hs-identifier hs-var">octaveDown</span></a><span> </span><a href="#local-6989586621679117676"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679117677"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117678"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117679"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117680"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117681"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-538"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679117676"><span class="hs-identifier hs-var">a</span></a><span class="hs-glyph">:</span><span class="hs-special">(</span><a href="Cogito.html#stepwiseInRange"><span class="hs-identifier hs-var">stepwiseInRange</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117683"><span class="hs-identifier hs-var">b2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117678"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117679"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117680"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117681"><span class="hs-identifier hs-var">ranges</span></a><span class="hs-special">)</span><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span class="hs-comment">-- | Adjust a whole 'Voice' stepwise</span><span>
</span><a name="line-541"></a><span class="hs-identifier">stepwiseVoiceInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>
</span><a name="line-542"></a><a name="stepwiseVoiceInRange"><a href="Cogito.html#stepwiseVoiceInRange"><span class="hs-identifier">stepwiseVoiceInRange</span></a></a><span> </span><a name="local-6989586621679117684"><a href="#local-6989586621679117684"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679117685"><a href="#local-6989586621679117685"><span class="hs-identifier">ranges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-var">Voice</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-543"></a><span>    </span><span class="hs-identifier">voiceID</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679117684"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span>
</span><a name="line-544"></a><span>    </span><span class="hs-identifier">music</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#stepwiseInRange"><span class="hs-identifier hs-var">stepwiseInRange</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679117684"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679117684"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117685"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-545"></a><span class="hs-special">}</span><span>
</span><a name="line-546"></a><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span class="hs-comment">-- | Go through list of pitches and reduce intervals that are more than a seventh</span><span>
</span><a name="line-549"></a><span class="hs-identifier">stepwise</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-550"></a><a name="stepwise"><a href="Cogito.html#stepwise"><span class="hs-identifier">stepwise</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-551"></a><span class="hs-identifier">stepwise</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679117686"><a href="#local-6989586621679117686"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679117686"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-552"></a><span class="hs-identifier">stepwise</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679117687"><a href="#local-6989586621679117687"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679117688"><a href="#local-6989586621679117688"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679117687"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Cogito.html#unleap"><span class="hs-identifier hs-var">unleap</span></a><span> </span><a href="#local-6989586621679117687"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679117688"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-553"></a><span class="hs-identifier">stepwise</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679117689"><a href="#local-6989586621679117689"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679117690"><a href="#local-6989586621679117690"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679117691"><a href="#local-6989586621679117691"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679117692"><a href="#local-6989586621679117692"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-554"></a><span>    </span><span class="hs-comment">-- If b is a rest, calculate interval between a and b, adjust the next item</span><span>
</span><a name="line-555"></a><span>    </span><span class="hs-comment">-- c as though it was preceded by a</span><span>
</span><a name="line-556"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679117690"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-557"></a><span>    </span><span class="hs-keyword">then</span><span>
</span><a name="line-558"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679117693"><a href="#local-6989586621679117693"><span class="hs-identifier">c2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#unleap"><span class="hs-identifier hs-var">unleap</span></a><span> </span><a href="#local-6989586621679117689"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679117691"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-559"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117689"><span class="hs-identifier hs-var">a</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117690"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><span class="hs-special">(</span><a href="Cogito.html#stepwise"><span class="hs-identifier hs-var">stepwise</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117693"><span class="hs-identifier hs-var">c2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117692"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-560"></a><span>    </span><span class="hs-keyword">else</span><span>
</span><a name="line-561"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679117694"><a href="#local-6989586621679117694"><span class="hs-identifier">b2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#unleap"><span class="hs-identifier hs-var">unleap</span></a><span> </span><a href="#local-6989586621679117689"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679117690"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-562"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679117689"><span class="hs-identifier hs-var">a</span></a><span class="hs-glyph">:</span><span class="hs-special">(</span><a href="Cogito.html#stepwise"><span class="hs-identifier hs-var">stepwise</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117694"><span class="hs-identifier hs-var">b2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117691"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679117692"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-563"></a><span>
</span><a name="line-564"></a><span class="hs-comment">-- | Adjust a whole 'Voice' stepwise</span><span>
</span><a name="line-565"></a><span class="hs-identifier">stepwiseVoice</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>
</span><a name="line-566"></a><a name="stepwiseVoice"><a href="Cogito.html#stepwiseVoice"><span class="hs-identifier">stepwiseVoice</span></a></a><span> </span><a name="local-6989586621679117695"><a href="#local-6989586621679117695"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-var">Voice</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-567"></a><span>    </span><span class="hs-identifier">voiceID</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679117695"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span>
</span><a name="line-568"></a><span>    </span><span class="hs-identifier">music</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#stepwise"><span class="hs-identifier hs-var">stepwise</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679117695"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-569"></a><span class="hs-special">}</span><span>
</span><a name="line-570"></a><span>
</span><a name="line-571"></a><span class="hs-comment">-- | Reduce leap of more than a seventh by shifting octave of second note up</span><span>
</span><a name="line-572"></a><span class="hs-comment">-- or down until the interval is within range</span><span>
</span><a name="line-573"></a><span class="hs-comment">--</span><span>
</span><a name="line-574"></a><span class="hs-comment">-- __TODO__ : </span><span>
</span><a name="line-575"></a><span class="hs-comment">--    - but what if after adjusting for leaps, a note is out of range?</span><span>
</span><a name="line-576"></a><span class="hs-comment">--    - and what if there is a descending scale that goes out of range and the</span><span>
</span><a name="line-577"></a><span class="hs-comment">--    only way to adjust it is to make a seventh? need to adjust a whole</span><span>
</span><a name="line-578"></a><span class="hs-comment">--    phrase</span><span>
</span><a name="line-579"></a><span class="hs-identifier">unleap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-580"></a><a name="unleap"><a href="Cogito.html#unleap"><span class="hs-identifier">unleap</span></a></a><span> </span><a name="local-6989586621679117696"><a href="#local-6989586621679117696"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679117697"><a href="#local-6989586621679117697"><span class="hs-identifier">p2</span></a></a><span>
</span><a name="line-581"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.html#p7diff"><span class="hs-identifier hs-var">p7diff</span></a><span> </span><a href="#local-6989586621679117696"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679117697"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-582"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#unleap"><span class="hs-identifier hs-var">unleap</span></a><span> </span><a href="#local-6989586621679117696"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.html#octaveUp"><span class="hs-identifier hs-var">octaveUp</span></a><span> </span><a href="#local-6989586621679117697"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-583"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.html#p7diff"><span class="hs-identifier hs-var">p7diff</span></a><span> </span><a href="#local-6989586621679117696"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679117697"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">6</span><span>
</span><a name="line-584"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#unleap"><span class="hs-identifier hs-var">unleap</span></a><span> </span><a href="#local-6989586621679117696"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.html#octaveDown"><span class="hs-identifier hs-var">octaveDown</span></a><span> </span><a href="#local-6989586621679117697"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-585"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-586"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117697"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-587"></a><span>
</span><a name="line-588"></a><span class="hs-comment">-- | Return the highest pitch in a list of pitches.</span><span>
</span><a name="line-589"></a><span class="hs-identifier">pitchMax</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-590"></a><a name="pitchMax"><a href="Cogito.html#pitchMax"><span class="hs-identifier">pitchMax</span></a></a><span> </span><a name="local-6989586621679117698"><a href="#local-6989586621679117698"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117698"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="Aedifico.html#%21%21%3F"><span class="hs-operator hs-var">!!?</span></a><span> </span><a href="#local-6989586621679117699"><span class="hs-identifier hs-var">maxIndex</span></a><span>
</span><a name="line-591"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-592"></a><span>        </span><a name="local-6989586621679117699"><a href="#local-6989586621679117699"><span class="hs-identifier">maxIndex</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">findIndex</span><span>
</span><a name="line-593"></a><span>                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679117702"><a href="#local-6989586621679117702"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117702"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117702"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679117700"><span class="hs-identifier hs-var">maxInt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117698"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-594"></a><span>        </span><a name="local-6989586621679117700"><a href="#local-6989586621679117700"><span class="hs-identifier">maxInt</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maximum</span><span> </span><a href="#local-6989586621679117701"><span class="hs-identifier hs-var">pitchInts</span></a><span>
</span><a name="line-595"></a><span>        </span><a name="local-6989586621679117701"><a href="#local-6989586621679117701"><span class="hs-identifier">pitchInts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117698"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-596"></a><span>
</span><a name="line-597"></a><span class="hs-comment">-- | Return the lowest pitch in a list of pitches.</span><span>
</span><a name="line-598"></a><span class="hs-identifier">pitchMin</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-599"></a><a name="pitchMin"><a href="Cogito.html#pitchMin"><span class="hs-identifier">pitchMin</span></a></a><span> </span><a name="local-6989586621679117703"><a href="#local-6989586621679117703"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117703"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="Aedifico.html#%21%21%3F"><span class="hs-operator hs-var">!!?</span></a><span> </span><a href="#local-6989586621679117704"><span class="hs-identifier hs-var">minIndex</span></a><span>
</span><a name="line-600"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-601"></a><span>        </span><a name="local-6989586621679117704"><a href="#local-6989586621679117704"><span class="hs-identifier">minIndex</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">findIndex</span><span>
</span><a name="line-602"></a><span>                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679117707"><a href="#local-6989586621679117707"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117707"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><a href="#local-6989586621679117707"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679117705"><span class="hs-identifier hs-var">minInt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117703"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-603"></a><span>        </span><a name="local-6989586621679117705"><a href="#local-6989586621679117705"><span class="hs-identifier">minInt</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">minimum</span><span> </span><a href="#local-6989586621679117706"><span class="hs-identifier hs-var">pitchInts</span></a><span>
</span><a name="line-604"></a><span>        </span><a name="local-6989586621679117706"><a href="#local-6989586621679117706"><span class="hs-identifier">pitchInts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Cogito.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117703"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-605"></a><span class="hs-comment">-- | TODO write your own max/min functions for pitches that ignore Rests</span><span>
</span><a name="line-606"></a><span>
</span><a name="line-607"></a><span class="hs-comment">-- | Adjust a whole 'Voice' to be in range: check the highest and lowest notes</span><span>
</span><a name="line-608"></a><span class="hs-comment">-- in the list, compare to the range for the voice, and shift the whole thing</span><span>
</span><a name="line-609"></a><span class="hs-comment">-- by octave until all are in range; return error if it can't be done</span><span>
</span><a name="line-610"></a><span class="hs-identifier">voiceInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>
</span><a name="line-611"></a><a name="voiceInRange"><a href="Cogito.html#voiceInRange"><span class="hs-identifier">voiceInRange</span></a></a><span> </span><a name="local-6989586621679117708"><a href="#local-6989586621679117708"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679117709"><a href="#local-6989586621679117709"><span class="hs-identifier">ranges</span></a></a><span>
</span><a name="line-612"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679117718"><a href="#local-6989586621679117718"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#isPitchInRange"><span class="hs-identifier hs-var">isPitchInRange</span></a><span> </span><a href="#local-6989586621679117718"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679117711"><span class="hs-identifier hs-var">voiceName</span></a><span> </span><a href="#local-6989586621679117709"><span class="hs-identifier hs-var">ranges</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117710"><span class="hs-identifier hs-var">notes</span></a><span>
</span><a name="line-613"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117708"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-614"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117715"><span class="hs-identifier hs-var">tooLow</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679117716"><span class="hs-identifier hs-var">tooHighAfterAdjust</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117714"><span class="hs-identifier hs-var">tooHigh</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679117717"><span class="hs-identifier hs-var">tooLowAfterAdjust</span></a><span class="hs-special">)</span><span>
</span><a name="line-615"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117708"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-616"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679117715"><span class="hs-identifier hs-var">tooLow</span></a><span>
</span><a name="line-617"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#voiceInRange"><span class="hs-identifier hs-var">voiceInRange</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.html#Voice"><span class="hs-identifier hs-var">Voice</span></a><span> </span><a href="#local-6989586621679117711"><span class="hs-identifier hs-var">voiceName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Cogito.html#octaveUp"><span class="hs-identifier hs-var">octaveUp</span></a><span> </span><a href="#local-6989586621679117710"><span class="hs-identifier hs-var">notes</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117709"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-618"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679117714"><span class="hs-identifier hs-var">tooHigh</span></a><span>
</span><a name="line-619"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#voiceInRange"><span class="hs-identifier hs-var">voiceInRange</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.html#Voice"><span class="hs-identifier hs-var">Voice</span></a><span> </span><a href="#local-6989586621679117711"><span class="hs-identifier hs-var">voiceName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Cogito.html#octaveDown"><span class="hs-identifier hs-var">octaveDown</span></a><span> </span><a href="#local-6989586621679117710"><span class="hs-identifier hs-var">notes</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117709"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-620"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-621"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117708"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-622"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-623"></a><span>        </span><a name="local-6989586621679117710"><a href="#local-6989586621679117710"><span class="hs-identifier">notes</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679117708"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-624"></a><span>        </span><a name="local-6989586621679117711"><a href="#local-6989586621679117711"><span class="hs-identifier">voiceName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679117708"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-625"></a><span>        </span><a name="local-6989586621679117712"><a href="#local-6989586621679117712"><span class="hs-identifier">max</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.html#pitchMax"><span class="hs-identifier hs-var">pitchMax</span></a><span> </span><a href="#local-6989586621679117710"><span class="hs-identifier hs-var">notes</span></a><span>
</span><a name="line-626"></a><span>        </span><a name="local-6989586621679117713"><a href="#local-6989586621679117713"><span class="hs-identifier">min</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.html#pitchMin"><span class="hs-identifier hs-var">pitchMin</span></a><span> </span><a href="#local-6989586621679117710"><span class="hs-identifier hs-var">notes</span></a><span>
</span><a name="line-627"></a><span>        </span><a name="local-6989586621679117714"><a href="#local-6989586621679117714"><span class="hs-identifier">tooHigh</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#pitchTooHigh"><span class="hs-identifier hs-var">pitchTooHigh</span></a><span> </span><a href="#local-6989586621679117712"><span class="hs-identifier hs-var">max</span></a><span> </span><a href="#local-6989586621679117711"><span class="hs-identifier hs-var">voiceName</span></a><span> </span><a href="#local-6989586621679117709"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-628"></a><span>        </span><a name="local-6989586621679117715"><a href="#local-6989586621679117715"><span class="hs-identifier">tooLow</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#pitchTooLow"><span class="hs-identifier hs-var">pitchTooLow</span></a><span> </span><a href="#local-6989586621679117713"><span class="hs-identifier hs-var">min</span></a><span> </span><a href="#local-6989586621679117711"><span class="hs-identifier hs-var">voiceName</span></a><span> </span><a href="#local-6989586621679117709"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-629"></a><span>        </span><a name="local-6989586621679117716"><a href="#local-6989586621679117716"><span class="hs-identifier">tooHighAfterAdjust</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#pitchTooHigh"><span class="hs-identifier hs-var">pitchTooHigh</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.html#octaveUp"><span class="hs-identifier hs-var">octaveUp</span></a><span> </span><a href="#local-6989586621679117712"><span class="hs-identifier hs-var">max</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117711"><span class="hs-identifier hs-var">voiceName</span></a><span> </span><a href="#local-6989586621679117709"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-630"></a><span>        </span><a name="local-6989586621679117717"><a href="#local-6989586621679117717"><span class="hs-identifier">tooLowAfterAdjust</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#pitchTooLow"><span class="hs-identifier hs-var">pitchTooLow</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.html#octaveDown"><span class="hs-identifier hs-var">octaveDown</span></a><span> </span><a href="#local-6989586621679117713"><span class="hs-identifier hs-var">min</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117711"><span class="hs-identifier hs-var">voiceName</span></a><span> </span><a href="#local-6989586621679117709"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span>
</span><a name="line-633"></a><span>
</span><a name="line-634"></a><span class="hs-comment">-- * All together: From input parameters to music</span><span>
</span><a name="line-635"></a><span>
</span><a name="line-636"></a><span class="hs-comment">-- | Central functions of the ark: given all parameters required by Kircher</span><span>
</span><a name="line-637"></a><span class="hs-comment">-- (style, meter, syllable count, penultimate syllable length), select a voice</span><span>
</span><a name="line-638"></a><span class="hs-comment">-- permutation (Kircher's number tables) from the appropriate part of the ark</span><span>
</span><a name="line-639"></a><span class="hs-comment">-- and match it to a rhythm permutation (his tables of note values).</span><span>
</span><a name="line-640"></a><span class="hs-comment">--</span><span>
</span><a name="line-641"></a><span class="hs-comment">-- Return a 'Voice' with the pitches for a single voice part.</span><span>
</span><a name="line-642"></a><span class="hs-comment">--</span><span>
</span><a name="line-643"></a><span class="hs-comment">-- We use 'getVoice' and 'getRperm' from the @Aedifico@ module.</span><span>
</span><a name="line-644"></a><span class="hs-comment">--</span><span>
</span><a name="line-645"></a><span class="hs-comment">-- Because the rhythms can include rest, we have to match up pitches and</span><span>
</span><a name="line-646"></a><span class="hs-comment">-- rhythms accordingly using 'zipFill' with the test 'isRest'.</span><span>
</span><a name="line-647"></a><span class="hs-identifier">ark2voice</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>       </span><span class="hs-comment">-- ^ ark data structure</span><span>
</span><a name="line-648"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>    </span><span class="hs-comment">-- ^ we pass this along to 'getVoice' and 'getRperm';</span><span>
</span><a name="line-649"></a><span>                        </span><span class="hs-comment">--      we use the 'Mode' for 'pair2Pitch'</span><span>
</span><a name="line-650"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#PenultLength"><span class="hs-identifier hs-type">PenultLength</span></a><span> </span><span class="hs-comment">-- ^ penultimate syllable length</span><span>
</span><a name="line-651"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>          </span><span class="hs-comment">-- ^ syllable count</span><span>
</span><a name="line-652"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>          </span><span class="hs-comment">-- ^ line count</span><span>
</span><a name="line-653"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>    </span><span class="hs-comment">-- ^ voice name enum</span><span>
</span><a name="line-654"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-type">Perm</span></a><span>         </span><span class="hs-comment">-- ^ contains random index for voice and rhythm</span><span>
</span><a name="line-655"></a><span>                        </span><span class="hs-comment">--      permutation</span><span>
</span><a name="line-656"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>
</span><a name="line-657"></a><a name="ark2voice"><a href="Cogito.html#ark2voice"><span class="hs-identifier">ark2voice</span></a></a><span> </span><a name="local-6989586621679117719"><a href="#local-6989586621679117719"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679117720"><a href="#local-6989586621679117720"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679117721"><a href="#local-6989586621679117721"><span class="hs-identifier">penult</span></a></a><span> </span><a name="local-6989586621679117722"><a href="#local-6989586621679117722"><span class="hs-identifier">sylCount</span></a></a><span> </span><a name="local-6989586621679117723"><a href="#local-6989586621679117723"><span class="hs-identifier">lineCount</span></a></a><span> </span><a name="local-6989586621679117724"><a href="#local-6989586621679117724"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679117725"><a href="#local-6989586621679117725"><span class="hs-identifier">perm</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-658"></a><span>    </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-var">Voice</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-659"></a><span>        </span><span class="hs-identifier">voiceID</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117724"><span class="hs-identifier hs-var">voice</span></a><span class="hs-special">,</span><span>
</span><a name="line-660"></a><span>        </span><span class="hs-identifier">music</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117726"><span class="hs-identifier hs-var">newMusic</span></a><span>
</span><a name="line-661"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-662"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-663"></a><span>        </span><a name="local-6989586621679117726"><a href="#local-6989586621679117726"><span class="hs-identifier">newMusic</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Cogito.html#pair2Pitch"><span class="hs-identifier hs-var">pair2Pitch</span></a><span> </span><a href="#local-6989586621679117724"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117727"><span class="hs-identifier hs-var">vocalRanges</span></a><span> </span><a href="#local-6989586621679117730"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679117728"><span class="hs-identifier hs-var">modeList</span></a><span> </span><a href="#local-6989586621679117729"><span class="hs-identifier hs-var">modeSystems</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117733"><span class="hs-identifier hs-var">pairs</span></a><span>
</span><a name="line-664"></a><span>        </span><a name="local-6989586621679117727"><a href="#local-6989586621679117727"><span class="hs-identifier">vocalRanges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ranges</span><span> </span><a href="#local-6989586621679117719"><span class="hs-identifier hs-var">arca</span></a><span>
</span><a name="line-665"></a><span>        </span><a name="local-6989586621679117728"><a href="#local-6989586621679117728"><span class="hs-identifier">modeList</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">modes</span><span> </span><a href="#local-6989586621679117719"><span class="hs-identifier hs-var">arca</span></a><span>
</span><a name="line-666"></a><span>        </span><a name="local-6989586621679117729"><a href="#local-6989586621679117729"><span class="hs-identifier">modeSystems</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">systems</span><span> </span><a href="#local-6989586621679117719"><span class="hs-identifier hs-var">arca</span></a><span>
</span><a name="line-667"></a><span>        </span><a name="local-6989586621679117730"><a href="#local-6989586621679117730"><span class="hs-identifier">mode</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#modeOrModeB"><span class="hs-identifier hs-var">modeOrModeB</span></a><span> </span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679117723"><span class="hs-identifier hs-var">lineCount</span></a><span>
</span><a name="line-668"></a><span>        </span><a name="local-6989586621679117731"><a href="#local-6989586621679117731"><span class="hs-identifier">style</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkStyle</span><span> </span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-669"></a><span>        </span><a name="local-6989586621679117732"><a href="#local-6989586621679117732"><span class="hs-identifier">meter</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkTextMeter</span><span> </span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-670"></a><span>
</span><a name="line-671"></a><span>        </span><a name="local-6989586621679117733"><a href="#local-6989586621679117733"><span class="hs-identifier">pairs</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#zipFill"><span class="hs-identifier hs-var">zipFill</span></a><span> </span><a href="#local-6989586621679117734"><span class="hs-identifier hs-var">rperm</span></a><span> </span><a href="#local-6989586621679117735"><span class="hs-identifier hs-var">vpermVoice</span></a><span> </span><a href="Cogito.html#isRest"><span class="hs-identifier hs-var">isRest</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="Aedifico.html#Rest"><span class="hs-identifier hs-var">Rest</span></a><span>
</span><a name="line-672"></a><span>
</span><a name="line-673"></a><span>        </span><span class="hs-comment">-- In syntagma 1 there is only one rperm for all four vperm voices;</span><span>
</span><a name="line-674"></a><span>        </span><span class="hs-comment">-- in syntagma 2 we match the four rperms to the four vperm voices.</span><span>
</span><a name="line-675"></a><span>        </span><a name="local-6989586621679117734"><a href="#local-6989586621679117734"><span class="hs-identifier">rperm</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679117731"><span class="hs-identifier hs-var">style</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-676"></a><span>                         </span><a href="Aedifico.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;ark2voice:rpermChoir&quot;</span><span> </span><a href="#local-6989586621679117736"><span class="hs-identifier hs-var">rpermChoir</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-677"></a><span>                         </span><a href="Aedifico.html#Florid"><span class="hs-identifier hs-var">Florid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;ark2voice:rpermChoir&quot;</span><span> </span><a href="#local-6989586621679117736"><span class="hs-identifier hs-var">rpermChoir</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679117724"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-678"></a><span>
</span><a name="line-679"></a><span>        </span><a name="local-6989586621679117735"><a href="#local-6989586621679117735"><span class="hs-identifier">vpermVoice</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVoice"><span class="hs-identifier hs-var">getVoice</span></a><span> </span><a href="#local-6989586621679117719"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679117737"><span class="hs-identifier hs-var">newConfig</span></a><span> </span><a href="#local-6989586621679117722"><span class="hs-identifier hs-var">sylCount</span></a><span> </span><a href="#local-6989586621679117723"><span class="hs-identifier hs-var">lineCount</span></a><span> </span><a href="#local-6989586621679117724"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679117740"><span class="hs-identifier hs-var">vpermNum</span></a><span>
</span><a name="line-680"></a><span>        </span><a name="local-6989586621679117736"><a href="#local-6989586621679117736"><span class="hs-identifier">rpermChoir</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getRperm"><span class="hs-identifier hs-var">getRperm</span></a><span> </span><a href="#local-6989586621679117719"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679117737"><span class="hs-identifier hs-var">newConfig</span></a><span> </span><a href="#local-6989586621679117722"><span class="hs-identifier hs-var">sylCount</span></a><span> </span><a href="#local-6989586621679117723"><span class="hs-identifier hs-var">lineCount</span></a><span> </span><a href="#local-6989586621679117741"><span class="hs-identifier hs-var">rpermNum</span></a><span>
</span><a name="line-681"></a><span>
</span><a name="line-682"></a><span>        </span><a name="local-6989586621679117737"><a href="#local-6989586621679117737"><span class="hs-identifier">newConfig</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-var">ArkConfig</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-683"></a><span>            </span><span class="hs-identifier">arkStyle</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117731"><span class="hs-identifier hs-var">style</span></a><span class="hs-special">,</span><span>
</span><a name="line-684"></a><span>            </span><span class="hs-identifier">arkMode</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkMode</span><span> </span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">,</span><span>
</span><a name="line-685"></a><span>            </span><span class="hs-identifier">arkModeB</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkModeB</span><span> </span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">,</span><span>
</span><a name="line-686"></a><span>            </span><span class="hs-identifier">arkMusicMeter</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkMusicMeter</span><span> </span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">,</span><span>
</span><a name="line-687"></a><span>            </span><span class="hs-identifier">arkTextMeter</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117739"><span class="hs-identifier hs-var">newTextMeter</span></a><span>
</span><a name="line-688"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-689"></a><span>        </span><a name="local-6989586621679117738"><a href="#local-6989586621679117738"><span class="hs-identifier">oldTextMeter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkTextMeter</span><span> </span><a href="#local-6989586621679117720"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-690"></a><span>        </span><a name="local-6989586621679117739"><a href="#local-6989586621679117739"><span class="hs-identifier">newTextMeter</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679117738"><span class="hs-identifier hs-var">oldTextMeter</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#Prose"><span class="hs-identifier hs-var">Prose</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#proseMeter"><span class="hs-identifier hs-var">proseMeter</span></a><span> </span><a href="#local-6989586621679117721"><span class="hs-identifier hs-var">penult</span></a><span>
</span><a name="line-691"></a><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117738"><span class="hs-identifier hs-var">oldTextMeter</span></a><span>
</span><a name="line-692"></a><span>
</span><a name="line-693"></a><span>        </span><a name="local-6989586621679117740"><a href="#local-6989586621679117740"><span class="hs-identifier">vpermNum</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">voiceIndex</span><span> </span><a href="#local-6989586621679117725"><span class="hs-identifier hs-var">perm</span></a><span>
</span><a name="line-694"></a><span>        </span><a name="local-6989586621679117741"><a href="#local-6989586621679117741"><span class="hs-identifier">rpermNum</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679117731"><span class="hs-identifier hs-var">style</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-695"></a><span>                         </span><a href="Aedifico.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">rhythmIndex</span><span> </span><a href="#local-6989586621679117725"><span class="hs-identifier hs-var">perm</span></a><span>
</span><a name="line-696"></a><span>                         </span><a href="Aedifico.html#Florid"><span class="hs-identifier hs-var">Florid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679117740"><span class="hs-identifier hs-var">vpermNum</span></a><span>
</span><a name="line-697"></a><span>
</span><a name="line-698"></a><span>
</span><a name="line-699"></a><span class="hs-comment">-- * Data structures to store music composed by the ark</span><span>
</span><a name="line-700"></a><span>
</span><a name="line-701"></a><span class="hs-comment">-- | A 'Note' contains a pitch and a syllable, equivalent to MEI @note@</span><span>
</span><a name="line-702"></a><span class="hs-keyword">data</span><span> </span><a name="Note"><a href="Cogito.html#Note"><span class="hs-identifier">Note</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Note"><a href="Cogito.html#Note"><span class="hs-identifier">Note</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-703"></a><span>    </span><a name="notePitch"><a href="Cogito.html#notePitch"><span class="hs-identifier">notePitch</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">,</span><span>
</span><a name="line-704"></a><span>    </span><a name="noteSyllable"><a href="Cogito.html#noteSyllable"><span class="hs-identifier">noteSyllable</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Syllable"><span class="hs-identifier hs-type">Syllable</span></a><span>
</span><a name="line-705"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-706"></a><span>
</span><a name="line-707"></a><span class="hs-comment">-- | A 'Syllable' is a single syllable to be paired with a 'Pitch', including</span><span>
</span><a name="line-708"></a><span class="hs-comment">-- its position in the word.</span><span>
</span><a name="line-709"></a><span class="hs-keyword">data</span><span> </span><a name="Syllable"><a href="Cogito.html#Syllable"><span class="hs-identifier">Syllable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Syllable"><a href="Cogito.html#Syllable"><span class="hs-identifier">Syllable</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-710"></a><span>    </span><a name="sylText"><a href="Cogito.html#sylText"><span class="hs-identifier">sylText</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span>
</span><a name="line-711"></a><span>    </span><a name="sylPosition"><a href="Cogito.html#sylPosition"><span class="hs-identifier">sylPosition</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#SyllablePosition"><span class="hs-identifier hs-type">SyllablePosition</span></a><span>
</span><a name="line-712"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-713"></a><span>
</span><a name="line-714"></a><span class="hs-comment">-- | What is the position of the syllable relative to the word? Beginning,</span><span>
</span><a name="line-715"></a><span class="hs-comment">-- middle, or end? This determines hyphenation.</span><span>
</span><a name="line-716"></a><span class="hs-keyword">data</span><span> </span><a name="SyllablePosition"><a href="Cogito.html#SyllablePosition"><span class="hs-identifier">SyllablePosition</span></a></a><span> </span><span class="hs-glyph">=</span><span>   </span><a name="First"><a href="Cogito.html#First"><span class="hs-identifier">First</span></a></a><span>
</span><a name="line-717"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Middle"><a href="Cogito.html#Middle"><span class="hs-identifier">Middle</span></a></a><span>
</span><a name="line-718"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Last"><a href="Cogito.html#Last"><span class="hs-identifier">Last</span></a></a><span>
</span><a name="line-719"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Only"><a href="Cogito.html#Only"><span class="hs-identifier">Only</span></a></a><span>
</span><a name="line-720"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Tacet"><a href="Cogito.html#Tacet"><span class="hs-identifier">Tacet</span></a></a><span> </span><span class="hs-comment">-- ^ no syllable</span><span>
</span><a name="line-721"></a><span>                        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-722"></a><span>
</span><a name="line-723"></a><span class="hs-comment">-- | A 'MusicPhrase' contains all the notes set using one permutation drawn</span><span>
</span><a name="line-724"></a><span class="hs-comment">-- from the ark, for a single voice.</span><span>
</span><a name="line-725"></a><span class="hs-keyword">data</span><span> </span><a name="MusicPhrase"><a href="Cogito.html#MusicPhrase"><span class="hs-identifier">MusicPhrase</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MusicPhrase"><a href="Cogito.html#MusicPhrase"><span class="hs-identifier">MusicPhrase</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-726"></a><span>    </span><a name="phraseVoiceID"><a href="Cogito.html#phraseVoiceID"><span class="hs-identifier">phraseVoiceID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span class="hs-special">,</span><span>
</span><a name="line-727"></a><span>    </span><a name="notes"><a href="Cogito.html#notes"><span class="hs-identifier">notes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Cogito.html#Note"><span class="hs-identifier hs-type">Note</span></a><span class="hs-special">]</span><span>
</span><a name="line-728"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-729"></a><span>
</span><a name="line-730"></a><span class="hs-comment">-- | A list of 'MusicPhrase' items</span><span>
</span><a name="line-731"></a><span class="hs-keyword">type</span><span> </span><a name="MusicSentence"><a href="Cogito.html#MusicSentence"><span class="hs-identifier">MusicSentence</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Cogito.html#MusicPhrase"><span class="hs-identifier hs-type">MusicPhrase</span></a><span class="hs-special">]</span><span>
</span><a name="line-732"></a><span>
</span><a name="line-733"></a><span class="hs-comment">-- | A 'MusicSection' contains all the music for one section in the input XML</span><span>
</span><a name="line-734"></a><span class="hs-comment">-- document, for a single voice, together with the parameters set in the input</span><span>
</span><a name="line-735"></a><span class="hs-comment">-- file.</span><span>
</span><a name="line-736"></a><span class="hs-keyword">data</span><span> </span><a name="MusicSection"><a href="Cogito.html#MusicSection"><span class="hs-identifier">MusicSection</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MusicSection"><a href="Cogito.html#MusicSection"><span class="hs-identifier">MusicSection</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-737"></a><span>    </span><a name="secVoiceID"><a href="Cogito.html#secVoiceID"><span class="hs-identifier">secVoiceID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span class="hs-special">,</span><span>
</span><a name="line-738"></a><span>    </span><a name="secConfig"><a href="Cogito.html#secConfig"><span class="hs-identifier">secConfig</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span class="hs-special">,</span><span>
</span><a name="line-739"></a><span>    </span><a name="secSentences"><a href="Cogito.html#secSentences"><span class="hs-identifier">secSentences</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Cogito.html#MusicSentence"><span class="hs-identifier hs-type">MusicSentence</span></a><span class="hs-special">]</span><span>
</span><a name="line-740"></a><span class="hs-special">}</span><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span class="hs-comment">-- | A 'MusicChorus' is a four-voice SATB structure of 'MusicSection' data.</span><span>
</span><a name="line-743"></a><span class="hs-comment">-- __TODO__ do we really need it to be structured this way?</span><span>
</span><a name="line-744"></a><span class="hs-keyword">data</span><span> </span><a name="MusicChorus"><a href="Cogito.html#MusicChorus"><span class="hs-identifier">MusicChorus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MusicChorus"><a href="Cogito.html#MusicChorus"><span class="hs-identifier">MusicChorus</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-745"></a><span>    </span><a name="soprano"><a href="Cogito.html#soprano"><span class="hs-identifier">soprano</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span class="hs-special">,</span><span>
</span><a name="line-746"></a><span>    </span><a name="alto"><a href="Cogito.html#alto"><span class="hs-identifier">alto</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span class="hs-special">,</span><span>
</span><a name="line-747"></a><span>    </span><a name="tenor"><a href="Cogito.html#tenor"><span class="hs-identifier">tenor</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span class="hs-special">,</span><span>
</span><a name="line-748"></a><span>    </span><a name="bass"><a href="Cogito.html#bass"><span class="hs-identifier">bass</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span>
</span><a name="line-749"></a><span class="hs-special">}</span><span>
</span><a name="line-750"></a><span>
</span><a name="line-751"></a><span class="hs-comment">-- | The full 'MusicScore' is a list of SATB 'MusicChorus' structures.</span><span>
</span><a name="line-752"></a><span class="hs-keyword">type</span><span> </span><a name="MusicScore"><a href="Cogito.html#MusicScore"><span class="hs-identifier">MusicScore</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Cogito.html#MusicChorus"><span class="hs-identifier hs-type">MusicChorus</span></a><span class="hs-special">]</span><span>
</span><a name="line-753"></a><span>
</span><a name="line-754"></a><span>
</span><a name="line-755"></a><span class="hs-comment">-- * Methods to create and populate these data structures</span><span>
</span><a name="line-756"></a><span>
</span><a name="line-757"></a><span class="hs-comment">-- | Take a 'Verbum' read from the input file and turn it into a list of 'Syllable's for storage in 'Note's. Record the syllable's position within the word.</span><span>
</span><a name="line-758"></a><span class="hs-identifier">makeSyllables</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lectio.html#Verbum"><span class="hs-identifier hs-type">Verbum</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Cogito.html#Syllable"><span class="hs-identifier hs-type">Syllable</span></a><span class="hs-special">]</span><span>
</span><a name="line-759"></a><a name="makeSyllables"><a href="Cogito.html#makeSyllables"><span class="hs-identifier">makeSyllables</span></a></a><span> </span><a name="local-6989586621679117742"><a href="#local-6989586621679117742"><span class="hs-identifier">word</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679117745"><a href="#local-6989586621679117745"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679117746"><a href="#local-6989586621679117746"><span class="hs-identifier">syl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Syllable"><span class="hs-identifier hs-var">Syllable</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-760"></a><span>        </span><span class="hs-identifier">sylText</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117746"><span class="hs-identifier hs-var">syl</span></a><span class="hs-special">,</span><span>
</span><a name="line-761"></a><span>        </span><span class="hs-identifier">sylPosition</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117743"><span class="hs-identifier hs-var">position</span></a><span> </span><a href="#local-6989586621679117745"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-762"></a><span>    </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">I.indexed</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">verbumSyl</span><span> </span><a href="#local-6989586621679117742"><span class="hs-identifier hs-var">word</span></a><span>
</span><a name="line-763"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-764"></a><span>        </span><span class="hs-identifier">position</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#SyllablePosition"><span class="hs-identifier hs-type">SyllablePosition</span></a><span>
</span><a name="line-765"></a><span>        </span><a name="local-6989586621679117743"><a href="#local-6989586621679117743"><span class="hs-identifier">position</span></a></a><span> </span><a name="local-6989586621679117744"><a href="#local-6989586621679117744"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">sylCount</span><span> </span><a href="#local-6989586621679117742"><span class="hs-identifier hs-var">word</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#Only"><span class="hs-identifier hs-var">Only</span></a><span>
</span><a name="line-766"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679117744"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#First"><span class="hs-identifier hs-var">First</span></a><span>
</span><a name="line-767"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679117744"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sylCount</span><span> </span><a href="#local-6989586621679117742"><span class="hs-identifier hs-var">word</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#Last"><span class="hs-identifier hs-var">Last</span></a><span>
</span><a name="line-768"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#Middle"><span class="hs-identifier hs-var">Middle</span></a><span>
</span><a name="line-769"></a><span>
</span><a name="line-770"></a><span class="hs-comment">-- | Just a blank syllable for filler when needed</span><span>
</span><a name="line-771"></a><span class="hs-identifier">blankSyllable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Syllable"><span class="hs-identifier hs-type">Syllable</span></a><span>
</span><a name="line-772"></a><a name="blankSyllable"><a href="Cogito.html#blankSyllable"><span class="hs-identifier">blankSyllable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#Syllable"><span class="hs-identifier hs-var">Syllable</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="Cogito.html#Tacet"><span class="hs-identifier hs-var">Tacet</span></a><span>
</span><a name="line-773"></a><span>
</span><a name="line-774"></a><span class="hs-comment">-- | Compose the music for a whole 'LyricPhrase' with one permutation from the</span><span>
</span><a name="line-775"></a><span class="hs-comment">-- ark, and package it into a 'MusicPhrase'. Note that this is for a single</span><span>
</span><a name="line-776"></a><span class="hs-comment">-- voice only, not the four SATB voices. </span><span>
</span><a name="line-777"></a><span class="hs-comment">-- Line up pitches and syllables, skipping rests. In Syntagma I, line up text</span><span>
</span><a name="line-778"></a><span class="hs-comment">-- and notes syllabically (one syllable per note); in syntagma II (florid),</span><span>
</span><a name="line-779"></a><span class="hs-comment">-- lump the text into a single syllable and put it as an incipit text at the</span><span>
</span><a name="line-780"></a><span class="hs-comment">-- beginning of the phrase. (See module description for why Kircher's</span><span>
</span><a name="line-781"></a><span class="hs-comment">-- specification makes this is necessary.)</span><span>
</span><a name="line-782"></a><span class="hs-identifier">makeMusicPhrase</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>
</span><a name="line-783"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>
</span><a name="line-784"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>
</span><a name="line-785"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricPhrase"><span class="hs-identifier hs-type">LyricPhrase</span></a><span>
</span><a name="line-786"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-type">Perm</span></a><span>
</span><a name="line-787"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#MusicPhrase"><span class="hs-identifier hs-type">MusicPhrase</span></a><span>
</span><a name="line-788"></a><a name="makeMusicPhrase"><a href="Cogito.html#makeMusicPhrase"><span class="hs-identifier">makeMusicPhrase</span></a></a><span> </span><a name="local-6989586621679117747"><a href="#local-6989586621679117747"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679117748"><a href="#local-6989586621679117748"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679117749"><a href="#local-6989586621679117749"><span class="hs-identifier">voiceID</span></a></a><span> </span><a name="local-6989586621679117750"><a href="#local-6989586621679117750"><span class="hs-identifier">phrase</span></a></a><span> </span><a name="local-6989586621679117751"><a href="#local-6989586621679117751"><span class="hs-identifier">perm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#MusicPhrase"><span class="hs-identifier hs-var">MusicPhrase</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-789"></a><span>        </span><span class="hs-identifier">phraseVoiceID</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117749"><span class="hs-identifier hs-var">voiceID</span></a><span class="hs-special">,</span><span>
</span><a name="line-790"></a><span>        </span><span class="hs-identifier">notes</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117752"><span class="hs-identifier hs-var">theseNotes</span></a><span>
</span><a name="line-791"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-792"></a><span>
</span><a name="line-793"></a><span>        </span><span class="hs-comment">-- Match up pitches and syllables, skipping rests</span><span>
</span><a name="line-794"></a><span>        </span><a name="local-6989586621679117752"><a href="#local-6989586621679117752"><span class="hs-identifier">theseNotes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679117761"><a href="#local-6989586621679117761"><span class="hs-identifier">pitch</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679117762"><a href="#local-6989586621679117762"><span class="hs-identifier">syllable</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Note"><span class="hs-identifier hs-var">Note</span></a><span> </span><a href="#local-6989586621679117761"><span class="hs-identifier hs-var">pitch</span></a><span> </span><a href="#local-6989586621679117762"><span class="hs-identifier hs-var">syllable</span></a><span class="hs-special">)</span><span>
</span><a name="line-795"></a><span>            </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.html#zipFill"><span class="hs-identifier hs-var">zipFill</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679117753"><span class="hs-identifier hs-var">voice</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117760"><span class="hs-identifier hs-var">syllables</span></a><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="Cogito.html#blankSyllable"><span class="hs-identifier hs-var">blankSyllable</span></a><span>
</span><a name="line-796"></a><span>
</span><a name="line-797"></a><span>        </span><a name="local-6989586621679117753"><a href="#local-6989586621679117753"><span class="hs-identifier">voice</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#stepwiseVoiceInRange"><span class="hs-identifier hs-var">stepwiseVoiceInRange</span></a><span> </span><a href="#local-6989586621679117754"><span class="hs-identifier hs-var">voiceRaw</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ranges</span><span> </span><a href="#local-6989586621679117747"><span class="hs-identifier hs-var">arca</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>
</span><a name="line-798"></a><span>        </span><a name="local-6989586621679117754"><a href="#local-6989586621679117754"><span class="hs-identifier">voiceRaw</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#ark2voice"><span class="hs-identifier hs-var">ark2voice</span></a><span> </span><a href="#local-6989586621679117747"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679117748"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679117756"><span class="hs-identifier hs-var">penult</span></a><span> </span><a href="#local-6989586621679117757"><span class="hs-identifier hs-var">sylCount</span></a><span> </span><a href="#local-6989586621679117758"><span class="hs-identifier hs-var">lineCount</span></a><span> </span><a href="#local-6989586621679117749"><span class="hs-identifier hs-var">voiceID</span></a><span> </span><a href="#local-6989586621679117751"><span class="hs-identifier hs-var">perm</span></a><span>
</span><a name="line-799"></a><span>
</span><a name="line-800"></a><span>        </span><a name="local-6989586621679117755"><a href="#local-6989586621679117755"><span class="hs-identifier">range</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ranges</span><span> </span><a href="#local-6989586621679117747"><span class="hs-identifier hs-var">arca</span></a><span>
</span><a name="line-801"></a><span>        </span><a name="local-6989586621679117756"><a href="#local-6989586621679117756"><span class="hs-identifier">penult</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">phrasePenultLength</span><span> </span><a href="#local-6989586621679117750"><span class="hs-identifier hs-var">phrase</span></a><span>
</span><a name="line-802"></a><span>        </span><a name="local-6989586621679117757"><a href="#local-6989586621679117757"><span class="hs-identifier">sylCount</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">phraseSylCount</span><span> </span><a href="#local-6989586621679117750"><span class="hs-identifier hs-var">phrase</span></a><span>
</span><a name="line-803"></a><span>        </span><a name="local-6989586621679117758"><a href="#local-6989586621679117758"><span class="hs-identifier">lineCount</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">phrasePosition</span><span> </span><a href="#local-6989586621679117750"><span class="hs-identifier hs-var">phrase</span></a><span>
</span><a name="line-804"></a><span>
</span><a name="line-805"></a><span>        </span><a name="local-6989586621679117759"><a href="#local-6989586621679117759"><span class="hs-identifier">words</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">phraseText</span><span> </span><a href="#local-6989586621679117750"><span class="hs-identifier hs-var">phrase</span></a><span>
</span><a name="line-806"></a><span>
</span><a name="line-807"></a><span>        </span><span class="hs-comment">-- In Syntagma II, put the whole phrase of lyrics as a single</span><span>
</span><a name="line-808"></a><span>        </span><span class="hs-comment">-- syllable under the first note</span><span>
</span><a name="line-809"></a><span>        </span><a name="local-6989586621679117760"><a href="#local-6989586621679117760"><span class="hs-identifier">syllables</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">arkStyle</span><span> </span><a href="#local-6989586621679117748"><span class="hs-identifier hs-var">config</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-810"></a><span>            </span><a href="Aedifico.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Cogito.html#makeSyllables"><span class="hs-identifier hs-var">makeSyllables</span></a><span> </span><a href="#local-6989586621679117759"><span class="hs-identifier hs-var">words</span></a><span>
</span><a name="line-811"></a><span>            </span><a href="Aedifico.html#Florid"><span class="hs-identifier hs-var">Florid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Cogito.html#Syllable"><span class="hs-identifier hs-var">Syllable</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-812"></a><span>                        </span><span class="hs-identifier">sylText</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">verbumText</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">phraseText</span><span> </span><a href="#local-6989586621679117750"><span class="hs-identifier hs-var">phrase</span></a><span class="hs-special">,</span><span>
</span><a name="line-813"></a><span>                        </span><span class="hs-identifier">sylPosition</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#Only"><span class="hs-identifier hs-var">Only</span></a><span>
</span><a name="line-814"></a><span>                       </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-815"></a><span>
</span><a name="line-816"></a><span class="hs-comment">-- | Compose music for a 'LyricSentence' for a single voice.</span><span>
</span><a name="line-817"></a><span class="hs-identifier">makeMusicSentence</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>
</span><a name="line-818"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>
</span><a name="line-819"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>
</span><a name="line-820"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricSentence"><span class="hs-identifier hs-type">LyricSentence</span></a><span>
</span><a name="line-821"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#SentencePerm"><span class="hs-identifier hs-type">SentencePerm</span></a><span>
</span><a name="line-822"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#MusicSentence"><span class="hs-identifier hs-type">MusicSentence</span></a><span>
</span><a name="line-823"></a><a name="makeMusicSentence"><a href="Cogito.html#makeMusicSentence"><span class="hs-identifier">makeMusicSentence</span></a></a><span> </span><a name="local-6989586621679117763"><a href="#local-6989586621679117763"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679117764"><a href="#local-6989586621679117764"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679117765"><a href="#local-6989586621679117765"><span class="hs-identifier">voiceID</span></a></a><span> </span><a name="local-6989586621679117766"><a href="#local-6989586621679117766"><span class="hs-identifier">sentence</span></a></a><span> </span><a name="local-6989586621679117767"><a href="#local-6989586621679117767"><span class="hs-identifier">sentencePerms</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-824"></a><span>    </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><a href="Cogito.html#makeMusicPhrase"><span class="hs-identifier hs-var">makeMusicPhrase</span></a><span> </span><a href="#local-6989586621679117763"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679117764"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679117765"><span class="hs-identifier hs-var">voiceID</span></a><span class="hs-special">)</span><span>
</span><a name="line-825"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">phrases</span><span> </span><a href="#local-6989586621679117766"><span class="hs-identifier hs-var">sentence</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117767"><span class="hs-identifier hs-var">sentencePerms</span></a><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span class="hs-comment">-- | Compose music for all four SATB voices for one 'LyricSection'.</span><span>
</span><a name="line-828"></a><span class="hs-identifier">makeMusicChorus</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>
</span><a name="line-829"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span>
</span><a name="line-830"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span>
</span><a name="line-831"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#MusicChorus"><span class="hs-identifier hs-type">MusicChorus</span></a><span>
</span><a name="line-832"></a><a name="makeMusicChorus"><a href="Cogito.html#makeMusicChorus"><span class="hs-identifier">makeMusicChorus</span></a></a><span> </span><a name="local-6989586621679117768"><a href="#local-6989586621679117768"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679117769"><a href="#local-6989586621679117769"><span class="hs-identifier">section</span></a></a><span> </span><a name="local-6989586621679117770"><a href="#local-6989586621679117770"><span class="hs-identifier">perm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#MusicChorus"><span class="hs-identifier hs-var">MusicChorus</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-833"></a><span>        </span><span class="hs-identifier">soprano</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117771"><span class="hs-identifier hs-var">makesec</span></a><span> </span><a href="Aedifico.html#Soprano"><span class="hs-identifier hs-var">Soprano</span></a><span class="hs-special">,</span><span>
</span><a name="line-834"></a><span>        </span><span class="hs-identifier">alto</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117771"><span class="hs-identifier hs-var">makesec</span></a><span> </span><a href="Aedifico.html#Alto"><span class="hs-identifier hs-var">Alto</span></a><span class="hs-special">,</span><span>
</span><a name="line-835"></a><span>        </span><span class="hs-identifier">tenor</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117771"><span class="hs-identifier hs-var">makesec</span></a><span> </span><a href="Aedifico.html#Tenor"><span class="hs-identifier hs-var">Tenor</span></a><span class="hs-special">,</span><span>
</span><a name="line-836"></a><span>        </span><span class="hs-identifier">bass</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117771"><span class="hs-identifier hs-var">makesec</span></a><span> </span><a href="Aedifico.html#Bass"><span class="hs-identifier hs-var">Bass</span></a><span>
</span><a name="line-837"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-838"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679117771"><a href="#local-6989586621679117771"><span class="hs-identifier">makesec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#makeMusicSection"><span class="hs-identifier hs-var">makeMusicSection</span></a><span> </span><a href="#local-6989586621679117768"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679117769"><span class="hs-identifier hs-var">section</span></a><span> </span><a href="#local-6989586621679117770"><span class="hs-identifier hs-var">perm</span></a><span>
</span><a name="line-839"></a><span>
</span><a name="line-840"></a><span class="hs-comment">-- | Put together all the music information for one 'LyricSection', for a</span><span>
</span><a name="line-841"></a><span class="hs-comment">-- single voice.</span><span>
</span><a name="line-842"></a><span class="hs-comment">--</span><span>
</span><a name="line-843"></a><span class="hs-comment">-- * For a single voice:</span><span>
</span><a name="line-844"></a><span class="hs-comment">--</span><span>
</span><a name="line-845"></a><span class="hs-comment">--      * extract ArkConfig for whole section</span><span>
</span><a name="line-846"></a><span class="hs-comment">--</span><span>
</span><a name="line-847"></a><span class="hs-comment">--      * for each sentence in section:</span><span>
</span><a name="line-848"></a><span class="hs-comment">--</span><span>
</span><a name="line-849"></a><span class="hs-comment">--          * extract list of perms, one per phrase</span><span>
</span><a name="line-850"></a><span class="hs-comment">--          * extract list of lyric phrases</span><span>
</span><a name="line-851"></a><span class="hs-comment">--          * apply same ArkConfig</span><span>
</span><a name="line-852"></a><span class="hs-comment">--</span><span>
</span><a name="line-853"></a><span class="hs-comment">--      * for each phrase in sentence:</span><span>
</span><a name="line-854"></a><span class="hs-comment">--</span><span>
</span><a name="line-855"></a><span class="hs-comment">--          * look up vperm according to config and perm</span><span>
</span><a name="line-856"></a><span class="hs-comment">--</span><span>
</span><a name="line-857"></a><span class="hs-comment">--              * (for some pinakes, choose column by stanza = section num)</span><span>
</span><a name="line-858"></a><span class="hs-comment">--          </span><span>
</span><a name="line-859"></a><span class="hs-comment">--          * look up rperm according to config and perm</span><span>
</span><a name="line-860"></a><span class="hs-comment">--              </span><span>
</span><a name="line-861"></a><span class="hs-comment">--              * (for syntagma II, use same perm)</span><span>
</span><a name="line-862"></a><span class="hs-comment">--      </span><span>
</span><a name="line-863"></a><span class="hs-comment">--          * convert vperm nums to pitch names</span><span>
</span><a name="line-864"></a><span class="hs-comment">--          * (adjust pitches)</span><span>
</span><a name="line-865"></a><span class="hs-comment">--          * make Pitches: match pitches and rhythms, accounting for rests</span><span>
</span><a name="line-866"></a><span class="hs-comment">--          </span><span>
</span><a name="line-867"></a><span class="hs-comment">--          * match Notes: match each Pitch with Phrase/Verbum/Syllable</span><span>
</span><a name="line-868"></a><span class="hs-comment">--                          according to syntagma</span><span>
</span><a name="line-869"></a><span class="hs-comment">--          </span><span>
</span><a name="line-870"></a><span class="hs-comment">--          * return a MusicPhrase</span><span>
</span><a name="line-871"></a><span class="hs-comment">--</span><span>
</span><a name="line-872"></a><span class="hs-comment">--      * inside a MusicSentence</span><span>
</span><a name="line-873"></a><span class="hs-comment">--</span><span>
</span><a name="line-874"></a><span class="hs-comment">--  * inside a MusicSection</span><span>
</span><a name="line-875"></a><span class="hs-identifier">makeMusicSection</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>
</span><a name="line-876"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span>
</span><a name="line-877"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span>
</span><a name="line-878"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>
</span><a name="line-879"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span>
</span><a name="line-880"></a><a name="makeMusicSection"><a href="Cogito.html#makeMusicSection"><span class="hs-identifier">makeMusicSection</span></a></a><span> </span><a name="local-6989586621679117772"><a href="#local-6989586621679117772"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679117773"><a href="#local-6989586621679117773"><span class="hs-identifier">section</span></a></a><span> </span><a name="local-6989586621679117774"><a href="#local-6989586621679117774"><span class="hs-identifier">sectionPerms</span></a></a><span> </span><a name="local-6989586621679117775"><a href="#local-6989586621679117775"><span class="hs-identifier">voiceID</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#MusicSection"><span class="hs-identifier hs-var">MusicSection</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-881"></a><span>        </span><span class="hs-identifier">secVoiceID</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117775"><span class="hs-identifier hs-var">voiceID</span></a><span class="hs-special">,</span><span>
</span><a name="line-882"></a><span>        </span><span class="hs-identifier">secConfig</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sectionConfig</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679117773"><span class="hs-identifier hs-var">section</span></a><span class="hs-special">,</span><span>
</span><a name="line-883"></a><span>        </span><span class="hs-identifier">secSentences</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117776"><span class="hs-identifier hs-var">sentenceList</span></a><span>
</span><a name="line-884"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-885"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-886"></a><span>        </span><a name="local-6989586621679117776"><a href="#local-6989586621679117776"><span class="hs-identifier">sentenceList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><a href="Cogito.html#makeMusicSentence"><span class="hs-identifier hs-var">makeMusicSentence</span></a><span> </span><a href="#local-6989586621679117772"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679117777"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679117775"><span class="hs-identifier hs-var">voiceID</span></a><span class="hs-special">)</span><span>
</span><a name="line-887"></a><span>                        </span><span class="hs-special">(</span><span class="hs-identifier">sentences</span><span> </span><a href="#local-6989586621679117773"><span class="hs-identifier hs-var">section</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117774"><span class="hs-identifier hs-var">sectionPerms</span></a><span>
</span><a name="line-888"></a><span>        </span><a name="local-6989586621679117777"><a href="#local-6989586621679117777"><span class="hs-identifier">config</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sectionConfig</span><span> </span><a href="#local-6989586621679117773"><span class="hs-identifier hs-var">section</span></a><span>
</span><a name="line-889"></a><span>
</span><a name="line-890"></a><span class="hs-comment">-- | Compose the music for the whole document as a 'MusicScore', pulling the</span><span>
</span><a name="line-891"></a><span class="hs-comment">-- data from the 'Arca'.</span><span>
</span><a name="line-892"></a><span class="hs-identifier">makeMusicScore</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>
</span><a name="line-893"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span class="hs-special">]</span><span>
</span><a name="line-894"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span class="hs-special">]</span><span>
</span><a name="line-895"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#MusicScore"><span class="hs-identifier hs-type">MusicScore</span></a><span>
</span><a name="line-896"></a><a name="makeMusicScore"><a href="Cogito.html#makeMusicScore"><span class="hs-identifier">makeMusicScore</span></a></a><span> </span><a name="local-6989586621679117778"><a href="#local-6989586621679117778"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679117779"><a href="#local-6989586621679117779"><span class="hs-identifier">lyricSections</span></a></a><span> </span><a name="local-6989586621679117780"><a href="#local-6989586621679117780"><span class="hs-identifier">sectionPerms</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-897"></a><span>    </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><a href="Cogito.html#makeMusicChorus"><span class="hs-identifier hs-var">makeMusicChorus</span></a><span> </span><a href="#local-6989586621679117778"><span class="hs-identifier hs-var">arca</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117779"><span class="hs-identifier hs-var">lyricSections</span></a><span> </span><a href="#local-6989586621679117780"><span class="hs-identifier hs-var">sectionPerms</span></a><span>
</span><a name="line-898"></a><span>
</span><a name="line-899"></a><span>
</span><a name="line-900"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-901"></a><span class="hs-comment">-- DEPRECATED</span><span>
</span><a name="line-902"></a><span class="hs-comment">-- Main functions for earlier version, targeting Scribo.Lilypond output </span><span>
</span><a name="line-903"></a><span>
</span><a name="line-904"></a><span class="hs-comment">-- | Get music data for all four voices and pack them into a 'Chorus'.</span><span>
</span><a name="line-905"></a><span class="hs-comment">--</span><span>
</span><a name="line-906"></a><span class="hs-comment">-- __TODO__: Why do we use a @Fortuna@ 'Perm' here but just two integers in</span><span>
</span><a name="line-907"></a><span class="hs-comment">-- the preceding function? Do we need to have all these parameters for both of</span><span>
</span><a name="line-908"></a><span class="hs-comment">-- these functions?</span><span>
</span><a name="line-909"></a><span class="hs-comment">--</span><span>
</span><a name="line-910"></a><span class="hs-comment">-- We should be getting a new 'Perm' for each Chorus.</span><span>
</span><a name="line-911"></a><span class="hs-identifier">getChorus</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>       </span><span class="hs-comment">-- ^ ark data structure</span><span>
</span><a name="line-912"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>    </span><span class="hs-comment">-- ^ we pass this along to 'ark2voice'</span><span>
</span><a name="line-913"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricPhrase"><span class="hs-identifier hs-type">LyricPhrase</span></a><span>       </span><span class="hs-comment">-- ^ input text processed by @Lectio@</span><span>
</span><a name="line-914"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-type">Perm</span></a><span>         </span><span class="hs-comment">-- ^ 'Perm' (from @Fortuna@, includes index for voice</span><span>
</span><a name="line-915"></a><span>                        </span><span class="hs-comment">--       and rhythm)</span><span>
</span><a name="line-916"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Chorus"><span class="hs-identifier hs-type">Chorus</span></a><span>
</span><a name="line-917"></a><a name="getChorus"><a href="Cogito.html#getChorus"><span class="hs-identifier">getChorus</span></a></a><span> </span><a name="local-6989586621679117781"><a href="#local-6989586621679117781"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679117782"><a href="#local-6989586621679117782"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679117783"><a href="#local-6989586621679117783"><span class="hs-identifier">phrase</span></a></a><span> </span><a name="local-6989586621679117784"><a href="#local-6989586621679117784"><span class="hs-identifier">perm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117785"><span class="hs-identifier hs-var">voices</span></a><span>
</span><a name="line-918"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-919"></a><span class="hs-comment">--        voicesInRange      = map (\v -&gt; voiceInRange v range) voices</span><span>
</span><a name="line-920"></a><span class="hs-comment">--        voicesStepwise     = map stepwiseVoice voicesInitialRange</span><span>
</span><a name="line-921"></a><span> </span><span class="hs-comment">--       voicesInitialRange = map (\v -&gt; setVoiceInitialRange v range) voices</span><span>
</span><a name="line-922"></a><span>        </span><a name="local-6989586621679117785"><a href="#local-6989586621679117785"><span class="hs-identifier">voices</span></a></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679117790"><a href="#local-6989586621679117790"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#ark2voice"><span class="hs-identifier hs-var">ark2voice</span></a><span> </span><a href="#local-6989586621679117781"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679117782"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679117787"><span class="hs-identifier hs-var">penult</span></a><span> </span><a href="#local-6989586621679117788"><span class="hs-identifier hs-var">sylCount</span></a><span> </span><a href="#local-6989586621679117789"><span class="hs-identifier hs-var">lineCount</span></a><span> </span><a href="#local-6989586621679117790"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679117784"><span class="hs-identifier hs-var">perm</span></a><span class="hs-special">)</span><span>
</span><a name="line-923"></a><span>                                </span><span class="hs-special">[</span><a href="Aedifico.html#Soprano"><span class="hs-identifier hs-var">Soprano</span></a><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Alto"><span class="hs-identifier hs-var">Alto</span></a><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Tenor"><span class="hs-identifier hs-var">Tenor</span></a><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Bass"><span class="hs-identifier hs-var">Bass</span></a><span class="hs-special">]</span><span>
</span><a name="line-924"></a><span>
</span><a name="line-925"></a><span>        </span><a name="local-6989586621679117786"><a href="#local-6989586621679117786"><span class="hs-identifier">range</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ranges</span><span> </span><a href="#local-6989586621679117781"><span class="hs-identifier hs-var">arca</span></a><span>
</span><a name="line-926"></a><span>        </span><a name="local-6989586621679117787"><a href="#local-6989586621679117787"><span class="hs-identifier">penult</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">phrasePenultLength</span><span> </span><a href="#local-6989586621679117783"><span class="hs-identifier hs-var">phrase</span></a><span>
</span><a name="line-927"></a><span>        </span><a name="local-6989586621679117788"><a href="#local-6989586621679117788"><span class="hs-identifier">sylCount</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">phraseSylCount</span><span> </span><a href="#local-6989586621679117783"><span class="hs-identifier hs-var">phrase</span></a><span>
</span><a name="line-928"></a><span>        </span><a name="local-6989586621679117789"><a href="#local-6989586621679117789"><span class="hs-identifier">lineCount</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">phrasePosition</span><span> </span><a href="#local-6989586621679117783"><span class="hs-identifier hs-var">phrase</span></a><span>
</span><a name="line-929"></a><span>
</span><a name="line-930"></a><span class="hs-comment">-- | Set the starting note of a voice to be within the proper range</span><span>
</span><a name="line-931"></a><span class="hs-identifier">setVoiceInitialRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>
</span><a name="line-932"></a><a name="setVoiceInitialRange"><a href="Cogito.html#setVoiceInitialRange"><span class="hs-identifier">setVoiceInitialRange</span></a></a><span> </span><a name="local-6989586621679117791"><a href="#local-6989586621679117791"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679117792"><a href="#local-6989586621679117792"><span class="hs-identifier">ranges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-var">Voice</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-933"></a><span>    </span><span class="hs-identifier">voiceID</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679117791"><span class="hs-identifier hs-var">voice</span></a><span class="hs-special">,</span><span>
</span><a name="line-934"></a><span>    </span><span class="hs-identifier">music</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117793"><span class="hs-identifier hs-var">adjustFirstPitch</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679117791"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-935"></a><span class="hs-special">}</span><span>
</span><a name="line-936"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-937"></a><span>        </span><span class="hs-identifier">adjustFirstPitch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-938"></a><span>        </span><a name="local-6989586621679117793"><a href="#local-6989586621679117793"><span class="hs-identifier">adjustFirstPitch</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679117794"><a href="#local-6989586621679117794"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679117795"><a href="#local-6989586621679117795"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-939"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679117794"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-940"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679117794"><span class="hs-identifier hs-var">p</span></a><span class="hs-glyph">:</span><span class="hs-special">(</span><a href="#local-6989586621679117793"><span class="hs-identifier hs-var">adjustFirstPitch</span></a><span> </span><a href="#local-6989586621679117795"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-941"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-942"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Cogito.html#adjustPitchInRange"><span class="hs-identifier hs-var">adjustPitchInRange</span></a><span> </span><a href="#local-6989586621679117794"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679117791"><span class="hs-identifier hs-var">voice</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117792"><span class="hs-identifier hs-var">ranges</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679117795"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-943"></a><span>
</span><a name="line-944"></a><span class="hs-comment">-- | A 'Symphonia' is the amalgamation of a list of 'Chorus'es into one</span><span>
</span><a name="line-945"></a><span class="hs-comment">-- 'Chorus'</span><span>
</span><a name="line-946"></a><span class="hs-keyword">data</span><span> </span><a name="Symphonia"><a href="Cogito.html#Symphonia"><span class="hs-identifier">Symphonia</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Symphonia"><a href="Cogito.html#Symphonia"><span class="hs-identifier">Symphonia</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-947"></a><span>    </span><a name="chorus"><a href="Cogito.html#chorus"><span class="hs-identifier">chorus</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Chorus"><span class="hs-identifier hs-type">Chorus</span></a><span class="hs-special">,</span><span>
</span><a name="line-948"></a><span>    </span><a name="lyricSection"><a href="Cogito.html#lyricSection"><span class="hs-identifier">lyricSection</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span>
</span><a name="line-949"></a><span class="hs-special">}</span><span>
</span><a name="line-950"></a><span>
</span><a name="line-951"></a><span class="hs-comment">-- | Turn @[[S, A, T, B], [S1, A1, T1, B1]]@ into </span><span>
</span><a name="line-952"></a><span class="hs-comment">-- @[[S, S1], [A, A1], [T, T1], [B, B1]]@</span><span>
</span><a name="line-953"></a><span class="hs-identifier">mergeChoruses</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Cogito.html#Chorus"><span class="hs-identifier hs-type">Chorus</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Chorus"><span class="hs-identifier hs-type">Chorus</span></a><span>
</span><a name="line-954"></a><a name="mergeChoruses"><a href="Cogito.html#mergeChoruses"><span class="hs-identifier">mergeChoruses</span></a></a><span> </span><a name="local-6989586621679117796"><a href="#local-6989586621679117796"><span class="hs-identifier">cs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679117797"><a href="#local-6989586621679117797"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#mergeVoices"><span class="hs-identifier hs-var">mergeVoices</span></a><span> </span><a href="#local-6989586621679117797"><span class="hs-identifier hs-var">vs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">transpose</span><span> </span><a href="#local-6989586621679117796"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-955"></a><span>
</span><a name="line-956"></a><span class="hs-comment">-- | To make a 'Symphonia' we take a 'LyricSentence' and list of 'Perm's, use</span><span>
</span><a name="line-957"></a><span class="hs-comment">-- 'getChorus' to get the ark data for each 'LyricPhrase' in the sentence, each</span><span>
</span><a name="line-958"></a><span class="hs-comment">-- using its own 'Perm'; then we use 'transpose' to reorder the lists. </span><span>
</span><a name="line-959"></a><span class="hs-comment">--</span><span>
</span><a name="line-960"></a><span class="hs-comment">-- Where we had @[[S1, A1, T1, B1], [S2, A2, T2, B2], [S3, A3, T3, B3]]@</span><span>
</span><a name="line-961"></a><span class="hs-comment">-- we end with @[[S1, S2, S3], [A1, A2, A3], [T1, T2, T3], [B1, B2, B3]]@.</span><span>
</span><a name="line-962"></a><span class="hs-comment">-- A list of four voices becomes four lists of voices.</span><span>
</span><a name="line-963"></a><span class="hs-comment">-- We need to combine each of those voices into a single voice to have a list</span><span>
</span><a name="line-964"></a><span class="hs-comment">-- of four (longer) voices.</span><span>
</span><a name="line-965"></a><span class="hs-comment">--</span><span>
</span><a name="line-966"></a><span class="hs-comment">-- Adjust music of merged voices to avoid bad intervals ('stepwise').</span><span>
</span><a name="line-967"></a><span class="hs-comment">--</span><span>
</span><a name="line-968"></a><span class="hs-comment">-- The @Scribo@ module calls this function to get all the ark data needed to</span><span>
</span><a name="line-969"></a><span class="hs-comment">-- set a whole 'LyricSentence', in the central function of our implementation,</span><span>
</span><a name="line-970"></a><span class="hs-comment">-- @Scribo.compose@.</span><span>
</span><a name="line-971"></a><span class="hs-identifier">getSymphonia</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Symphonia"><span class="hs-identifier hs-type">Symphonia</span></a><span>
</span><a name="line-972"></a><a name="getSymphonia"><a href="Cogito.html#getSymphonia"><span class="hs-identifier">getSymphonia</span></a></a><span> </span><a name="local-6989586621679117798"><a href="#local-6989586621679117798"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679117799"><a href="#local-6989586621679117799"><span class="hs-identifier">section</span></a></a><span> </span><a name="local-6989586621679117800"><a href="#local-6989586621679117800"><span class="hs-identifier">sectionPerms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#Symphonia"><span class="hs-identifier hs-var">Symphonia</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-973"></a><span>        </span><span class="hs-identifier">chorus</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#mergeChoruses"><span class="hs-identifier hs-var">mergeChoruses</span></a><span> </span><a href="#local-6989586621679117801"><span class="hs-identifier hs-var">subSymphoniae</span></a><span class="hs-special">,</span><span>
</span><a name="line-974"></a><span>        </span><span class="hs-identifier">lyricSection</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117799"><span class="hs-identifier hs-var">section</span></a><span>
</span><a name="line-975"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-976"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-977"></a><span>        </span><a name="local-6989586621679117801"><a href="#local-6989586621679117801"><span class="hs-identifier">subSymphoniae</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679117804"><a href="#local-6989586621679117804"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><a name="local-6989586621679117805"><a href="#local-6989586621679117805"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679117803"><span class="hs-identifier hs-var">innerGetSymphonia</span></a><span> </span><a href="#local-6989586621679117798"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679117802"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679117804"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679117805"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-978"></a><span>                            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sentences</span><span> </span><a href="#local-6989586621679117799"><span class="hs-identifier hs-var">section</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117800"><span class="hs-identifier hs-var">sectionPerms</span></a><span>
</span><a name="line-979"></a><span>        </span><a name="local-6989586621679117802"><a href="#local-6989586621679117802"><span class="hs-identifier">config</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sectionConfig</span><span> </span><a href="#local-6989586621679117799"><span class="hs-identifier hs-var">section</span></a><span>
</span><a name="line-980"></a><span>
</span><a name="line-981"></a><span>        </span><span class="hs-identifier">innerGetSymphonia</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricSentence"><span class="hs-identifier hs-type">LyricSentence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#SentencePerm"><span class="hs-identifier hs-type">SentencePerm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Chorus"><span class="hs-identifier hs-type">Chorus</span></a><span>
</span><a name="line-982"></a><span>        </span><a name="local-6989586621679117803"><a href="#local-6989586621679117803"><span class="hs-identifier">innerGetSymphonia</span></a></a><span> </span><a name="local-6989586621679117806"><a href="#local-6989586621679117806"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679117807"><a href="#local-6989586621679117807"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679117808"><a href="#local-6989586621679117808"><span class="hs-identifier">sentence</span></a></a><span> </span><a name="local-6989586621679117809"><a href="#local-6989586621679117809"><span class="hs-identifier">perms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679117810"><span class="hs-identifier hs-var">symphonia</span></a><span>
</span><a name="line-983"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-984"></a><span>                </span><a name="local-6989586621679117810"><a href="#local-6989586621679117810"><span class="hs-identifier">symphonia</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679117814"><a href="#local-6989586621679117814"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#stepwiseVoiceInRange"><span class="hs-identifier hs-var">stepwiseVoiceInRange</span></a><span> </span><a href="#local-6989586621679117814"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">ranges</span><span> </span><a href="#local-6989586621679117806"><span class="hs-identifier hs-var">arca</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117811"><span class="hs-identifier hs-var">merged</span></a><span>
</span><a name="line-985"></a><span>                </span><a name="local-6989586621679117811"><a href="#local-6989586621679117811"><span class="hs-identifier">merged</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#mergeChoruses"><span class="hs-identifier hs-var">mergeChoruses</span></a><span> </span><a href="#local-6989586621679117812"><span class="hs-identifier hs-var">choruses</span></a><span>
</span><a name="line-986"></a><span>                </span><a name="local-6989586621679117812"><a href="#local-6989586621679117812"><span class="hs-identifier">choruses</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679117815"><a href="#local-6989586621679117815"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a name="local-6989586621679117816"><a href="#local-6989586621679117816"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#getChorus"><span class="hs-identifier hs-var">getChorus</span></a><span> </span><a href="#local-6989586621679117806"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679117807"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679117815"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679117816"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117813"><span class="hs-identifier hs-var">permPhrases</span></a><span>
</span><a name="line-987"></a><span>                </span><a name="local-6989586621679117813"><a href="#local-6989586621679117813"><span class="hs-identifier">permPhrases</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">phrases</span><span> </span><a href="#local-6989586621679117808"><span class="hs-identifier hs-var">sentence</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679117809"><span class="hs-identifier hs-var">perms</span></a><span>
</span><a name="line-988"></a><span>
</span><a name="line-989"></a><span class="hs-comment">-- | Get all the music for the sections from input</span><span>
</span><a name="line-990"></a><span class="hs-identifier">getMasterMusic</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Cogito.html#Symphonia"><span class="hs-identifier hs-type">Symphonia</span></a><span class="hs-special">]</span><span>
</span><a name="line-991"></a><a name="getMasterMusic"><a href="Cogito.html#getMasterMusic"><span class="hs-identifier">getMasterMusic</span></a></a><span> </span><a name="local-6989586621679117817"><a href="#local-6989586621679117817"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679117818"><a href="#local-6989586621679117818"><span class="hs-identifier">sections</span></a></a><span> </span><a name="local-6989586621679117819"><a href="#local-6989586621679117819"><span class="hs-identifier">perms</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-992"></a><span>    </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679117820"><a href="#local-6989586621679117820"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><a name="local-6989586621679117821"><a href="#local-6989586621679117821"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#getSymphonia"><span class="hs-identifier hs-var">getSymphonia</span></a><span> </span><a href="#local-6989586621679117817"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679117820"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679117821"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621679117818"><span class="hs-identifier hs-var">sections</span></a><span> </span><a href="#local-6989586621679117819"><span class="hs-identifier hs-var">perms</span></a><span>
</span><a name="line-993"></a><span>
</span><a name="line-994"></a><span class="hs-comment">-- End Lilypond section ------------------------------------------------</span><span>
</span><a name="line-995"></a><span>
</span><a name="line-996"></a><span>
</span><a name="line-997"></a></pre></body></html>