<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : Cogito
Description : Process ark input to create music
Copyright   : (c) Andrew A. Cashner 2021
Maintainer  : Andrew Cashner, &lt;andrew.cashner@rochester.edu&gt;
Stability   : Experimental

This module processes data from the ark to convert it into music (/cogito/,
Latin, &quot;I think&quot;).

= Overview

This module receives input from the @Lectio@ module in the form of a single
list of one or more 'LyricSection's, which contain the parsed text to be set
to music and the parameters for setting it.

The module uses Kircher's rules to pull the appropriate data from the Arca
musarithmica, that is, from the 'Arca' built by the @Aedifico@ module.  It
uses the @Fortuna@ module to get lists of random permutation indices.

The main function is 'makeMusicScore', which applies all the necessary rules to
select music data from the ark for each phrase of text, using the random
permutations when a free choice would otherwise be needed. It takes the
numerals and rhythmic symbols from Kircher's /pinakes/ (rods); converts the
numerals to pitches according to the mode, and combines the pitches and
rhythms (accounting for rests as well).

The module creates the 'MusicScore' data structure which contains all the data
for the music in hierarchical sections that the @Scribo@ module will convert
to MEI XML. 

== Text underlay

Pitches and syllables are stored together in the 'Note' type. In Syntagma I
(simple syllabic counterpoint), we store one syllable for each note, skipping
rests. 

In Syntagma II, though, for florid counterpoint, Kircher does not specify how
to underlay the text, and the settings have variable numbers of notes in the
different voices and between different permutations in the same /pinax/. The
underlay must be left to the human performer, then, and so we just lump all
the lyrics for each phrase and put them under the first syllable as a textual
incipit.

== MEI vs. Lilypond output

We previously set up this module to feed data into the @Scribo.Lilypond@
module, using the main function @getSymphonia@. It treated pitches and lyrics
completely separately, which worked in Syntagma I but not in Syntagma II.
These functions are archived in the @test/@ directory. 
-}</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cogito</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.Index</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">I</span><span>
</span><a name="line-57"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">indexed</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="Aedifico.html"><span class="hs-identifier">Aedifico</span></a><span>
</span><a name="line-60"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Aedifico.html#Accid"><span class="hs-identifier hs-type">Accid</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#AccidType"><span class="hs-identifier hs-type">AccidType</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ModeList"><span class="hs-identifier hs-type">ModeList</span></a><span>     </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span>   </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#PenultLength"><span class="hs-identifier hs-type">PenultLength</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Pnum"><span class="hs-identifier hs-type">Pnum</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Style"><span class="hs-identifier hs-type">Style</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#TextMeter"><span class="hs-identifier hs-type">TextMeter</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span>
</span><a name="line-76"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#getVoice"><span class="hs-identifier hs-var">getVoice</span></a><span>
</span><a name="line-77"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#getRperm"><span class="hs-identifier hs-var">getRperm</span></a><span>
</span><a name="line-78"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#proseMeter"><span class="hs-identifier hs-var">proseMeter</span></a><span>
</span><a name="line-79"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#modeOrModeB"><span class="hs-identifier hs-var">modeOrModeB</span></a><span>
</span><a name="line-80"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><a href="Cogito.Musarithmetic.html"><span class="hs-identifier">Cogito.Musarithmetic</span></a><span>
</span><a name="line-83"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Cogito.Musarithmetic.html#MusicScore"><span class="hs-identifier hs-type">MusicScore</span></a><span>
</span><a name="line-84"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSentence"><span class="hs-identifier hs-type">MusicSentence</span></a><span>
</span><a name="line-85"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#MusicChorus"><span class="hs-identifier hs-type">MusicChorus</span></a><span>       </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span>      </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#MusicPhrase"><span class="hs-identifier hs-type">MusicPhrase</span></a><span>       </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#Note"><span class="hs-identifier hs-type">Note</span></a><span>              </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier hs-type">Syllable</span></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#SyllablePosition"><span class="hs-identifier hs-type">SyllablePosition</span></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>             </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#isRest"><span class="hs-identifier hs-var">isRest</span></a><span>
</span><a name="line-93"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span>
</span><a name="line-94"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#modeMollis"><span class="hs-identifier hs-var">modeMollis</span></a><span>
</span><a name="line-95"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#modalFinal"><span class="hs-identifier hs-var">modalFinal</span></a><span>
</span><a name="line-96"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#newRest"><span class="hs-identifier hs-var">newRest</span></a><span>
</span><a name="line-97"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#p7inc"><span class="hs-identifier hs-var">p7inc</span></a><span>
</span><a name="line-98"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#pnumAccidInMode"><span class="hs-identifier hs-var">pnumAccidInMode</span></a><span>
</span><a name="line-99"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#stepwiseVoiceInRange"><span class="hs-identifier hs-var">stepwiseVoiceInRange</span></a><span>
</span><a name="line-100"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><a href="Cogito.Ficta.html"><span class="hs-identifier">Cogito.Ficta</span></a><span>
</span><a name="line-103"></a><span>    </span><span class="hs-special">(</span><a href="Cogito.Ficta.html#adjustFictaChorus"><span class="hs-identifier hs-var">adjustFictaChorus</span></a><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-keyword">import</span><span> </span><a href="Fortuna.html"><span class="hs-identifier">Fortuna</span></a><span>
</span><a name="line-106"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-type">Perm</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">voiceIndex</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rhythmIndex</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span>
</span><a name="line-108"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Fortuna.html#SentencePerm"><span class="hs-identifier hs-type">SentencePerm</span></a><span>
</span><a name="line-109"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><a href="Lectio.html"><span class="hs-identifier">Lectio</span></a><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-comment">-- * Match pitches and rhythms </span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">-- ** Get music data for a single voice</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-comment">-- | Take two lists and zip them together, that is, make a new list of ordered</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- pairs constructed from sequential items of the two lists, BUT:</span><span>
</span><a name="line-119"></a><span class="hs-comment">-- if an element in the first list satisfies a given @test@, make a pair of that</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- element and a sustitute element (@sub@) instead of the corresponding</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- element from the second list.</span><span>
</span><a name="line-122"></a><span class="hs-identifier">zipFill</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679122518"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- ^ list 1</span><span>
</span><a name="line-123"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679122519"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- ^ list 2</span><span>
</span><a name="line-124"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679122518"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ test</span><span>
</span><a name="line-125"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679122519"><span class="hs-identifier hs-type">b</span></a><span>            </span><span class="hs-comment">-- ^ substitute element to use instead of list 2 item,</span><span>
</span><a name="line-126"></a><span>                        </span><span class="hs-comment">--    if list 1 item meets test </span><span>
</span><a name="line-127"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679122518"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679122519"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- ^ return list of pairs made of list 1 and 2, in</span><span>
</span><a name="line-128"></a><span>                        </span><span class="hs-comment">--    item order </span><span>
</span><a name="line-129"></a><a name="zipFill"><a href="Cogito.html#zipFill"><span class="hs-identifier">zipFill</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679122520"><a href="#local-6989586621679122520"><span class="hs-identifier">test</span></a></a><span> </span><a name="local-6989586621679122521"><a href="#local-6989586621679122521"><span class="hs-identifier">sub</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-130"></a><span>    </span><span class="hs-comment">-- stop when the first list is done</span><span>
</span><a name="line-131"></a><span class="hs-identifier">zipFill</span><span> </span><a name="local-6989586621679122522"><a href="#local-6989586621679122522"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679122523"><a href="#local-6989586621679122523"><span class="hs-identifier">test</span></a></a><span> </span><a name="local-6989586621679122524"><a href="#local-6989586621679122524"><span class="hs-identifier">sub</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#zipFill"><span class="hs-identifier hs-var">zipFill</span></a><span> </span><a href="#local-6989586621679122522"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679122524"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679122523"><span class="hs-identifier hs-var">test</span></a><span> </span><a href="#local-6989586621679122524"><span class="hs-identifier hs-var">sub</span></a><span>
</span><a name="line-132"></a><span>    </span><span class="hs-comment">-- when the second list is done, use @sub@ as placeholder for remaining</span><span>
</span><a name="line-133"></a><span>    </span><span class="hs-comment">-- items in first list</span><span>
</span><a name="line-134"></a><span class="hs-identifier">zipFill</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679122525"><a href="#local-6989586621679122525"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679122527"><a href="#local-6989586621679122527"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679122528"><a href="#local-6989586621679122528"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679122529"><a href="#local-6989586621679122529"><span class="hs-identifier">test</span></a></a><span> </span><a name="local-6989586621679122530"><a href="#local-6989586621679122530"><span class="hs-identifier">sub</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-135"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679122529"><span class="hs-identifier hs-var">test</span></a><span> </span><a href="#local-6989586621679122525"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-136"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679122525"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679122530"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="Cogito.html#zipFill"><span class="hs-identifier hs-var">zipFill</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679122527"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679122528"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679122529"><span class="hs-identifier hs-var">test</span></a><span> </span><a href="#local-6989586621679122530"><span class="hs-identifier hs-var">sub</span></a><span>
</span><a name="line-137"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679122525"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679122527"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="Cogito.html#zipFill"><span class="hs-identifier hs-var">zipFill</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621679122528"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621679122529"><span class="hs-identifier hs-var">test</span></a><span> </span><a href="#local-6989586621679122530"><span class="hs-identifier hs-var">sub</span></a><span>
</span><a name="line-138"></a><span>    </span><span class="hs-comment">-- build a list of pairs of either the heads of both lists or the head</span><span>
</span><a name="line-139"></a><span>    </span><span class="hs-comment">-- of the first list and the @sub@ value</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-comment">-- | Make a pitch from duration and pitch number. Start with zero octave;</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- we'll set it later using 'stepwiseVoiceInRange'.</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- Adjust the pitch for mode ('pnumAccidInMode').</span><span>
</span><a name="line-144"></a><span class="hs-comment">--</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- __TODO__: This could also be generalized; we are not checking inputs</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- because we control data input.</span><span>
</span><a name="line-147"></a><span class="hs-identifier">pair2Pitch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#ModeList"><span class="hs-identifier hs-type">ModeList</span></a><span>
</span><a name="line-148"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span>
</span><a name="line-149"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span>
</span><a name="line-150"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ duration and pitch number 0-7</span><span>
</span><a name="line-151"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-152"></a><a name="pair2Pitch"><a href="Cogito.html#pair2Pitch"><span class="hs-identifier">pair2Pitch</span></a></a><span> </span><a name="local-6989586621679122531"><a href="#local-6989586621679122531"><span class="hs-identifier">modeList</span></a></a><span> </span><a name="local-6989586621679122532"><a href="#local-6989586621679122532"><span class="hs-identifier">systems</span></a></a><span> </span><a name="local-6989586621679122533"><a href="#local-6989586621679122533"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621679122534"><a href="#local-6989586621679122534"><span class="hs-identifier">pair</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#isRest"><span class="hs-identifier hs-var">isRest</span></a><span> </span><a href="#local-6989586621679122537"><span class="hs-identifier hs-var">thisDur</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#newRest"><span class="hs-identifier hs-var">newRest</span></a><span> </span><a href="#local-6989586621679122537"><span class="hs-identifier hs-var">thisDur</span></a><span>
</span><a name="line-153"></a><span>                                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122535"><span class="hs-identifier hs-var">newPitch</span></a><span>
</span><a name="line-154"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-155"></a><span>        </span><a name="local-6989586621679122535"><a href="#local-6989586621679122535"><span class="hs-identifier">newPitch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-156"></a><span>            </span><span class="hs-identifier">pnum</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122538"><span class="hs-identifier hs-var">thisPnumInMode</span></a><span class="hs-special">,</span><span>
</span><a name="line-157"></a><span>            </span><span class="hs-identifier">accid</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122539"><span class="hs-identifier hs-var">thisAccid</span></a><span class="hs-special">,</span><span>
</span><a name="line-158"></a><span>            </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122541"><span class="hs-identifier hs-var">thisAccidType</span></a><span class="hs-special">,</span><span>
</span><a name="line-159"></a><span>            </span><span class="hs-identifier">oct</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- dummy value, will be adjusted</span><span>
</span><a name="line-160"></a><span>            </span><span class="hs-identifier">dur</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122537"><span class="hs-identifier hs-var">thisDur</span></a><span>
</span><a name="line-161"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-162"></a><span>        </span><a name="local-6989586621679122536"><a href="#local-6989586621679122536"><span class="hs-identifier">thisPnum</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679122534"><span class="hs-identifier hs-var">pair</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-comment">-- adjust to 0 index</span><span>
</span><a name="line-163"></a><span>        </span><a name="local-6989586621679122537"><a href="#local-6989586621679122537"><span class="hs-identifier">thisDur</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679122534"><span class="hs-identifier hs-var">pair</span></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span>        </span><a name="local-6989586621679122538"><a href="#local-6989586621679122538"><span class="hs-identifier">thisPnumInMode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679122540"><span class="hs-identifier hs-var">modePitch</span></a><span>
</span><a name="line-166"></a><span>        </span><a name="local-6989586621679122539"><a href="#local-6989586621679122539"><span class="hs-identifier">thisAccid</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679122540"><span class="hs-identifier hs-var">modePitch</span></a><span>
</span><a name="line-167"></a><span>        </span><a name="local-6989586621679122540"><a href="#local-6989586621679122540"><span class="hs-identifier">modePitch</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pnumAccidInMode"><span class="hs-identifier hs-var">pnumAccidInMode</span></a><span> </span><a href="#local-6989586621679122536"><span class="hs-identifier hs-var">thisPnum</span></a><span> </span><a href="#local-6989586621679122531"><span class="hs-identifier hs-var">modeList</span></a><span> </span><a href="#local-6989586621679122533"><span class="hs-identifier hs-var">mode</span></a><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>        </span><a name="local-6989586621679122541"><a href="#local-6989586621679122541"><span class="hs-identifier">thisAccidType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679122539"><span class="hs-identifier hs-var">thisAccid</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-170"></a><span>            </span><a href="Aedifico.html#Na"><span class="hs-identifier hs-var">Na</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Implicit"><span class="hs-identifier hs-var">Implicit</span></a><span>
</span><a name="line-171"></a><span>            </span><a href="Aedifico.html#Sh"><span class="hs-identifier hs-var">Sh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Suggested"><span class="hs-identifier hs-var">Suggested</span></a><span>
</span><a name="line-172"></a><span>            </span><a href="Aedifico.html#Fl"><span class="hs-identifier hs-var">Fl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Cogito.html#isBflatInSignature"><span class="hs-identifier hs-var">isBflatInSignature</span></a><span> </span><a href="#local-6989586621679122538"><span class="hs-identifier hs-var">thisPnumInMode</span></a><span> </span><a href="#local-6989586621679122539"><span class="hs-identifier hs-var">thisAccid</span></a><span> </span><a href="#local-6989586621679122533"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679122532"><span class="hs-identifier hs-var">systems</span></a><span>
</span><a name="line-173"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><a href="Aedifico.html#Implicit"><span class="hs-identifier hs-var">Implicit</span></a><span>
</span><a name="line-174"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><a href="Aedifico.html#Suggested"><span class="hs-identifier hs-var">Suggested</span></a><span>
</span><a name="line-175"></a><span>            </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#None"><span class="hs-identifier hs-var">None</span></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>        </span><a name="local-6989586621679122542"><a href="#local-6989586621679122542"><span class="hs-identifier">pitchOffsetFromFinal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122543"><span class="hs-identifier hs-var">final</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#p7inc"><span class="hs-identifier hs-var">p7inc</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679122536"><span class="hs-identifier hs-var">thisPnum</span></a><span>
</span><a name="line-178"></a><span>        </span><a name="local-6989586621679122543"><a href="#local-6989586621679122543"><span class="hs-identifier">final</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#modalFinal"><span class="hs-identifier hs-var">modalFinal</span></a><span> </span><a href="#local-6989586621679122531"><span class="hs-identifier hs-var">modeList</span></a><span> </span><a href="#local-6989586621679122533"><span class="hs-identifier hs-var">mode</span></a><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-comment">-- | Is this note a B flat, and if so, is the flat already in the key</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- signature?</span><span>
</span><a name="line-182"></a><span class="hs-identifier">isBflatInSignature</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pnum"><span class="hs-identifier hs-type">Pnum</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Accid"><span class="hs-identifier hs-type">Accid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-183"></a><a name="isBflatInSignature"><a href="Cogito.html#isBflatInSignature"><span class="hs-identifier">isBflatInSignature</span></a></a><span> </span><a name="local-6989586621679122544"><a href="#local-6989586621679122544"><span class="hs-identifier">pnum</span></a></a><span> </span><a name="local-6989586621679122545"><a href="#local-6989586621679122545"><span class="hs-identifier">accid</span></a></a><span> </span><a name="local-6989586621679122546"><a href="#local-6989586621679122546"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621679122547"><a href="#local-6989586621679122547"><span class="hs-identifier">systems</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-184"></a><span>    </span><a href="#local-6989586621679122544"><span class="hs-identifier hs-var">pnum</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#PCb"><span class="hs-identifier hs-var">PCb</span></a><span>
</span><a name="line-185"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679122545"><span class="hs-identifier hs-var">accid</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#Fl"><span class="hs-identifier hs-var">Fl</span></a><span>
</span><a name="line-186"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Cogito.Musarithmetic.html#modeMollis"><span class="hs-identifier hs-var">modeMollis</span></a><span> </span><a href="#local-6989586621679122546"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679122547"><span class="hs-identifier hs-var">systems</span></a><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-comment">-- | Get the right starting octave range for each voice type voice2octave :: VoiceName -&gt; Int</span><span>
</span><a name="line-189"></a><a name="voice2octave"><a href="Cogito.html#voice2octave"><span class="hs-identifier">voice2octave</span></a></a><span> </span><a name="local-6989586621679122548"><a href="#local-6989586621679122548"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679122548"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-190"></a><span>    </span><a href="Aedifico.html#Soprano"><span class="hs-identifier hs-var">Soprano</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-191"></a><span>    </span><a href="Aedifico.html#Alto"><span class="hs-identifier hs-var">Alto</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-192"></a><span>    </span><a href="Aedifico.html#Tenor"><span class="hs-identifier hs-var">Tenor</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-193"></a><span>    </span><a href="Aedifico.html#Bass"><span class="hs-identifier hs-var">Bass</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-comment">-- * From input parameters to music</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">-- | Central functions of the ark: given all parameters required by Kircher</span><span>
</span><a name="line-199"></a><span class="hs-comment">-- (style, meter, syllable count, penultimate syllable length), select a voice</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- permutation (Kircher's number tables) from the appropriate part of the ark</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- and match it to a rhythm permutation (his tables of note values).</span><span>
</span><a name="line-202"></a><span class="hs-comment">--</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- Return a 'Voice' with the pitches for a single voice part.</span><span>
</span><a name="line-204"></a><span class="hs-comment">--</span><span>
</span><a name="line-205"></a><span class="hs-comment">-- We use 'getVoice' and 'getRperm' from the @Aedifico@ module.</span><span>
</span><a name="line-206"></a><span class="hs-comment">--</span><span>
</span><a name="line-207"></a><span class="hs-comment">-- Because the rhythms can include rest, we have to match up pitches and</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- rhythms accordingly using 'zipFill' with the test 'isRest'.</span><span>
</span><a name="line-209"></a><span class="hs-identifier">ark2voice</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>       </span><span class="hs-comment">-- ^ ark data structure</span><span>
</span><a name="line-210"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>    </span><span class="hs-comment">-- ^ we pass this along to 'getVoice' and 'getRperm';</span><span>
</span><a name="line-211"></a><span>                        </span><span class="hs-comment">--      we use the 'Mode' for 'pair2Pitch'</span><span>
</span><a name="line-212"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#PenultLength"><span class="hs-identifier hs-type">PenultLength</span></a><span> </span><span class="hs-comment">-- ^ penultimate syllable length</span><span>
</span><a name="line-213"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>          </span><span class="hs-comment">-- ^ syllable count</span><span>
</span><a name="line-214"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>          </span><span class="hs-comment">-- ^ line count</span><span>
</span><a name="line-215"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>    </span><span class="hs-comment">-- ^ voice name enum</span><span>
</span><a name="line-216"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-type">Perm</span></a><span>         </span><span class="hs-comment">-- ^ contains random index for voice and rhythm</span><span>
</span><a name="line-217"></a><span>                        </span><span class="hs-comment">--      permutation</span><span>
</span><a name="line-218"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>
</span><a name="line-219"></a><a name="ark2voice"><a href="Cogito.html#ark2voice"><span class="hs-identifier">ark2voice</span></a></a><span> </span><a name="local-6989586621679122549"><a href="#local-6989586621679122549"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679122550"><a href="#local-6989586621679122550"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679122551"><a href="#local-6989586621679122551"><span class="hs-identifier">penult</span></a></a><span> </span><a name="local-6989586621679122552"><a href="#local-6989586621679122552"><span class="hs-identifier">sylCount</span></a></a><span> </span><a name="local-6989586621679122553"><a href="#local-6989586621679122553"><span class="hs-identifier">lineCount</span></a></a><span> </span><a name="local-6989586621679122554"><a href="#local-6989586621679122554"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679122555"><a href="#local-6989586621679122555"><span class="hs-identifier">perm</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-220"></a><span>    </span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-var">Voice</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-221"></a><span>        </span><span class="hs-identifier">voiceID</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122554"><span class="hs-identifier hs-var">voice</span></a><span class="hs-special">,</span><span>
</span><a name="line-222"></a><span>        </span><span class="hs-identifier">music</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122556"><span class="hs-identifier hs-var">newMusic</span></a><span>
</span><a name="line-223"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-224"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-225"></a><span>        </span><a name="local-6989586621679122556"><a href="#local-6989586621679122556"><span class="hs-identifier">newMusic</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Cogito.html#pair2Pitch"><span class="hs-identifier hs-var">pair2Pitch</span></a><span> </span><a href="#local-6989586621679122558"><span class="hs-identifier hs-var">modeList</span></a><span> </span><a href="#local-6989586621679122559"><span class="hs-identifier hs-var">modeSystems</span></a><span> </span><a href="#local-6989586621679122560"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679122563"><span class="hs-identifier hs-var">pairs</span></a><span>
</span><a name="line-226"></a><span>        </span><a name="local-6989586621679122557"><a href="#local-6989586621679122557"><span class="hs-identifier">vocalRanges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ranges</span><span> </span><a href="#local-6989586621679122549"><span class="hs-identifier hs-var">arca</span></a><span>
</span><a name="line-227"></a><span>        </span><a name="local-6989586621679122558"><a href="#local-6989586621679122558"><span class="hs-identifier">modeList</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">modes</span><span> </span><a href="#local-6989586621679122549"><span class="hs-identifier hs-var">arca</span></a><span>
</span><a name="line-228"></a><span>        </span><a name="local-6989586621679122559"><a href="#local-6989586621679122559"><span class="hs-identifier">modeSystems</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">systems</span><span> </span><a href="#local-6989586621679122549"><span class="hs-identifier hs-var">arca</span></a><span>
</span><a name="line-229"></a><span>        </span><a name="local-6989586621679122560"><a href="#local-6989586621679122560"><span class="hs-identifier">mode</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#modeOrModeB"><span class="hs-identifier hs-var">modeOrModeB</span></a><span> </span><a href="#local-6989586621679122550"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679122553"><span class="hs-identifier hs-var">lineCount</span></a><span>
</span><a name="line-230"></a><span>        </span><a name="local-6989586621679122561"><a href="#local-6989586621679122561"><span class="hs-identifier">style</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkStyle</span><span> </span><a href="#local-6989586621679122550"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-231"></a><span>        </span><a name="local-6989586621679122562"><a href="#local-6989586621679122562"><span class="hs-identifier">meter</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkTextMeter</span><span> </span><a href="#local-6989586621679122550"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span>        </span><a name="local-6989586621679122563"><a href="#local-6989586621679122563"><span class="hs-identifier">pairs</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#zipFill"><span class="hs-identifier hs-var">zipFill</span></a><span> </span><a href="#local-6989586621679122564"><span class="hs-identifier hs-var">rperm</span></a><span> </span><a href="#local-6989586621679122565"><span class="hs-identifier hs-var">vpermVoice</span></a><span> </span><a href="Cogito.Musarithmetic.html#isRest"><span class="hs-identifier hs-var">isRest</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="Aedifico.html#Rest"><span class="hs-identifier hs-var">Rest</span></a><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span>        </span><span class="hs-comment">-- In syntagma 1 there is only one rperm for all four vperm voices;</span><span>
</span><a name="line-236"></a><span>        </span><span class="hs-comment">-- in syntagma 2 we match the four rperms to the four vperm voices.</span><span>
</span><a name="line-237"></a><span>        </span><a name="local-6989586621679122564"><a href="#local-6989586621679122564"><span class="hs-identifier">rperm</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679122561"><span class="hs-identifier hs-var">style</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-238"></a><span>                         </span><a href="Aedifico.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;ark2voice:rpermChoir&quot;</span><span> </span><a href="#local-6989586621679122566"><span class="hs-identifier hs-var">rpermChoir</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-239"></a><span>                         </span><a href="Aedifico.html#Florid"><span class="hs-identifier hs-var">Florid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;ark2voice:rpermChoir&quot;</span><span> </span><a href="#local-6989586621679122566"><span class="hs-identifier hs-var">rpermChoir</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679122554"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span>        </span><a name="local-6989586621679122565"><a href="#local-6989586621679122565"><span class="hs-identifier">vpermVoice</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVoice"><span class="hs-identifier hs-var">getVoice</span></a><span> </span><a href="#local-6989586621679122549"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679122567"><span class="hs-identifier hs-var">newConfig</span></a><span> </span><a href="#local-6989586621679122552"><span class="hs-identifier hs-var">sylCount</span></a><span> </span><a href="#local-6989586621679122553"><span class="hs-identifier hs-var">lineCount</span></a><span> </span><a href="#local-6989586621679122554"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679122570"><span class="hs-identifier hs-var">vpermNum</span></a><span>
</span><a name="line-242"></a><span>        </span><a name="local-6989586621679122566"><a href="#local-6989586621679122566"><span class="hs-identifier">rpermChoir</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getRperm"><span class="hs-identifier hs-var">getRperm</span></a><span> </span><a href="#local-6989586621679122549"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679122567"><span class="hs-identifier hs-var">newConfig</span></a><span> </span><a href="#local-6989586621679122552"><span class="hs-identifier hs-var">sylCount</span></a><span> </span><a href="#local-6989586621679122553"><span class="hs-identifier hs-var">lineCount</span></a><span> </span><a href="#local-6989586621679122571"><span class="hs-identifier hs-var">rpermNum</span></a><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span>        </span><a name="local-6989586621679122567"><a href="#local-6989586621679122567"><span class="hs-identifier">newConfig</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-var">ArkConfig</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-245"></a><span>            </span><span class="hs-identifier">arkStyle</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122561"><span class="hs-identifier hs-var">style</span></a><span class="hs-special">,</span><span>
</span><a name="line-246"></a><span>            </span><span class="hs-identifier">arkMode</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkMode</span><span> </span><a href="#local-6989586621679122550"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">,</span><span>
</span><a name="line-247"></a><span>            </span><span class="hs-identifier">arkModeB</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkModeB</span><span> </span><a href="#local-6989586621679122550"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">,</span><span>
</span><a name="line-248"></a><span>            </span><span class="hs-identifier">arkMusicMeter</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkMusicMeter</span><span> </span><a href="#local-6989586621679122550"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">,</span><span>
</span><a name="line-249"></a><span>            </span><span class="hs-identifier">arkTextMeter</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122569"><span class="hs-identifier hs-var">newTextMeter</span></a><span>
</span><a name="line-250"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-251"></a><span>        </span><a name="local-6989586621679122568"><a href="#local-6989586621679122568"><span class="hs-identifier">oldTextMeter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkTextMeter</span><span> </span><a href="#local-6989586621679122550"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-252"></a><span>        </span><a name="local-6989586621679122569"><a href="#local-6989586621679122569"><span class="hs-identifier">newTextMeter</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679122568"><span class="hs-identifier hs-var">oldTextMeter</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#Prose"><span class="hs-identifier hs-var">Prose</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#proseMeter"><span class="hs-identifier hs-var">proseMeter</span></a><span> </span><a href="#local-6989586621679122551"><span class="hs-identifier hs-var">penult</span></a><span>
</span><a name="line-253"></a><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122568"><span class="hs-identifier hs-var">oldTextMeter</span></a><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span>        </span><a name="local-6989586621679122570"><a href="#local-6989586621679122570"><span class="hs-identifier">vpermNum</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">voiceIndex</span><span> </span><a href="#local-6989586621679122555"><span class="hs-identifier hs-var">perm</span></a><span>
</span><a name="line-256"></a><span>        </span><a name="local-6989586621679122571"><a href="#local-6989586621679122571"><span class="hs-identifier">rpermNum</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679122561"><span class="hs-identifier hs-var">style</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-257"></a><span>                         </span><a href="Aedifico.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">rhythmIndex</span><span> </span><a href="#local-6989586621679122555"><span class="hs-identifier hs-var">perm</span></a><span>
</span><a name="line-258"></a><span>                         </span><a href="Aedifico.html#Florid"><span class="hs-identifier hs-var">Florid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679122570"><span class="hs-identifier hs-var">vpermNum</span></a><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-comment">-- * Methods to create and populate data structures for music composed by the</span><span>
</span><a name="line-262"></a><span class="hs-comment">-- ark</span><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span class="hs-comment">-- | Take a 'Verbum' read from the input file and turn it into a list of</span><span>
</span><a name="line-265"></a><span class="hs-comment">-- 'Syllable's for storage in 'Note's. Record the syllable's position within</span><span>
</span><a name="line-266"></a><span class="hs-comment">-- the word.</span><span>
</span><a name="line-267"></a><span class="hs-identifier">makeSyllables</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lectio.html#Verbum"><span class="hs-identifier hs-type">Verbum</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier hs-type">Syllable</span></a><span class="hs-special">]</span><span>
</span><a name="line-268"></a><a name="makeSyllables"><a href="Cogito.html#makeSyllables"><span class="hs-identifier">makeSyllables</span></a></a><span> </span><a name="local-6989586621679122572"><a href="#local-6989586621679122572"><span class="hs-identifier">word</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679122575"><a href="#local-6989586621679122575"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679122576"><a href="#local-6989586621679122576"><span class="hs-identifier">syl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier hs-var">Syllable</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-269"></a><span>        </span><span class="hs-identifier">sylText</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122576"><span class="hs-identifier hs-var">syl</span></a><span class="hs-special">,</span><span>
</span><a name="line-270"></a><span>        </span><span class="hs-identifier">sylPosition</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122573"><span class="hs-identifier hs-var">position</span></a><span> </span><a href="#local-6989586621679122575"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-271"></a><span>    </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">I.indexed</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">verbumSyl</span><span> </span><a href="#local-6989586621679122572"><span class="hs-identifier hs-var">word</span></a><span>
</span><a name="line-272"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-273"></a><span>        </span><span class="hs-identifier">position</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#SyllablePosition"><span class="hs-identifier hs-type">SyllablePosition</span></a><span>
</span><a name="line-274"></a><span>        </span><a name="local-6989586621679122573"><a href="#local-6989586621679122573"><span class="hs-identifier">position</span></a></a><span> </span><a name="local-6989586621679122574"><a href="#local-6989586621679122574"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">sylCount</span><span> </span><a href="#local-6989586621679122572"><span class="hs-identifier hs-var">word</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Only"><span class="hs-identifier hs-var">Only</span></a><span>
</span><a name="line-275"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679122574"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#First"><span class="hs-identifier hs-var">First</span></a><span>
</span><a name="line-276"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679122574"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sylCount</span><span> </span><a href="#local-6989586621679122572"><span class="hs-identifier hs-var">word</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Last"><span class="hs-identifier hs-var">Last</span></a><span>
</span><a name="line-277"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Middle"><span class="hs-identifier hs-var">Middle</span></a><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-comment">-- | Just a blank syllable for filler when needed</span><span>
</span><a name="line-280"></a><span class="hs-identifier">blankSyllable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier hs-type">Syllable</span></a><span>
</span><a name="line-281"></a><a name="blankSyllable"><a href="Cogito.html#blankSyllable"><span class="hs-identifier">blankSyllable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier hs-var">Syllable</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="Cogito.Musarithmetic.html#Tacet"><span class="hs-identifier hs-var">Tacet</span></a><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-comment">-- | Compose the music for a whole 'LyricPhrase' with one permutation from the</span><span>
</span><a name="line-284"></a><span class="hs-comment">-- ark, and package it into a 'MusicPhrase'. Note that this is for a single</span><span>
</span><a name="line-285"></a><span class="hs-comment">-- voice only, not the four SATB voices. </span><span>
</span><a name="line-286"></a><span class="hs-comment">--</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- Line up pitches and syllables, skipping rests. In Syntagma I, line up text</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- and notes syllabically (one syllable per note); in syntagma II (florid),</span><span>
</span><a name="line-289"></a><span class="hs-comment">-- lump the text into a single syllable and put it as an incipit text at the</span><span>
</span><a name="line-290"></a><span class="hs-comment">-- beginning of the phrase. (See module description for why Kircher's</span><span>
</span><a name="line-291"></a><span class="hs-comment">-- specification makes this is necessary.)</span><span>
</span><a name="line-292"></a><span class="hs-identifier">makeMusicPhrase</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>
</span><a name="line-293"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>
</span><a name="line-294"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>
</span><a name="line-295"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricPhrase"><span class="hs-identifier hs-type">LyricPhrase</span></a><span>
</span><a name="line-296"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-type">Perm</span></a><span>
</span><a name="line-297"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#MusicPhrase"><span class="hs-identifier hs-type">MusicPhrase</span></a><span>
</span><a name="line-298"></a><a name="makeMusicPhrase"><a href="Cogito.html#makeMusicPhrase"><span class="hs-identifier">makeMusicPhrase</span></a></a><span> </span><a name="local-6989586621679122577"><a href="#local-6989586621679122577"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679122578"><a href="#local-6989586621679122578"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679122579"><a href="#local-6989586621679122579"><span class="hs-identifier">voiceID</span></a></a><span> </span><a name="local-6989586621679122580"><a href="#local-6989586621679122580"><span class="hs-identifier">phrase</span></a></a><span> </span><a name="local-6989586621679122581"><a href="#local-6989586621679122581"><span class="hs-identifier">perm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#MusicPhrase"><span class="hs-identifier hs-var">MusicPhrase</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-299"></a><span>        </span><span class="hs-identifier">phraseVoiceID</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122579"><span class="hs-identifier hs-var">voiceID</span></a><span class="hs-special">,</span><span>
</span><a name="line-300"></a><span>        </span><span class="hs-identifier">notes</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122582"><span class="hs-identifier hs-var">theseNotes</span></a><span>
</span><a name="line-301"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span>        </span><span class="hs-comment">-- Match up pitches and syllables, skipping rests</span><span>
</span><a name="line-304"></a><span>        </span><a name="local-6989586621679122582"><a href="#local-6989586621679122582"><span class="hs-identifier">theseNotes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679122591"><a href="#local-6989586621679122591"><span class="hs-identifier">pitch</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679122592"><a href="#local-6989586621679122592"><span class="hs-identifier">syllable</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Note"><span class="hs-identifier hs-var">Note</span></a><span> </span><a href="#local-6989586621679122591"><span class="hs-identifier hs-var">pitch</span></a><span> </span><a href="#local-6989586621679122592"><span class="hs-identifier hs-var">syllable</span></a><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span>            </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.html#zipFill"><span class="hs-identifier hs-var">zipFill</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679122583"><span class="hs-identifier hs-var">voice</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679122590"><span class="hs-identifier hs-var">syllables</span></a><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="Cogito.html#blankSyllable"><span class="hs-identifier hs-var">blankSyllable</span></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span>        </span><a name="local-6989586621679122583"><a href="#local-6989586621679122583"><span class="hs-identifier">voice</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#stepwiseVoiceInRange"><span class="hs-identifier hs-var">stepwiseVoiceInRange</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ranges</span><span> </span><a href="#local-6989586621679122577"><span class="hs-identifier hs-var">arca</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679122584"><span class="hs-identifier hs-var">voiceRaw</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>
</span><a name="line-308"></a><span>        </span><a name="local-6989586621679122584"><a href="#local-6989586621679122584"><span class="hs-identifier">voiceRaw</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#ark2voice"><span class="hs-identifier hs-var">ark2voice</span></a><span> </span><a href="#local-6989586621679122577"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679122578"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679122586"><span class="hs-identifier hs-var">penult</span></a><span> </span><a href="#local-6989586621679122587"><span class="hs-identifier hs-var">sylCount</span></a><span> </span><a href="#local-6989586621679122588"><span class="hs-identifier hs-var">lineCount</span></a><span> </span><a href="#local-6989586621679122579"><span class="hs-identifier hs-var">voiceID</span></a><span> </span><a href="#local-6989586621679122581"><span class="hs-identifier hs-var">perm</span></a><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span>        </span><a name="local-6989586621679122585"><a href="#local-6989586621679122585"><span class="hs-identifier">range</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ranges</span><span> </span><a href="#local-6989586621679122577"><span class="hs-identifier hs-var">arca</span></a><span>
</span><a name="line-311"></a><span>        </span><a name="local-6989586621679122586"><a href="#local-6989586621679122586"><span class="hs-identifier">penult</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">phrasePenultLength</span><span> </span><a href="#local-6989586621679122580"><span class="hs-identifier hs-var">phrase</span></a><span>
</span><a name="line-312"></a><span>        </span><a name="local-6989586621679122587"><a href="#local-6989586621679122587"><span class="hs-identifier">sylCount</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">phraseSylCount</span><span> </span><a href="#local-6989586621679122580"><span class="hs-identifier hs-var">phrase</span></a><span>
</span><a name="line-313"></a><span>        </span><a name="local-6989586621679122588"><a href="#local-6989586621679122588"><span class="hs-identifier">lineCount</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">phrasePosition</span><span> </span><a href="#local-6989586621679122580"><span class="hs-identifier hs-var">phrase</span></a><span>
</span><a name="line-314"></a><span>
</span><a name="line-315"></a><span>        </span><a name="local-6989586621679122589"><a href="#local-6989586621679122589"><span class="hs-identifier">words</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">phraseText</span><span> </span><a href="#local-6989586621679122580"><span class="hs-identifier hs-var">phrase</span></a><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span>        </span><span class="hs-comment">-- In Syntagma II, put the whole phrase of lyrics as a single</span><span>
</span><a name="line-318"></a><span>        </span><span class="hs-comment">-- syllable under the first note</span><span>
</span><a name="line-319"></a><span>        </span><a name="local-6989586621679122590"><a href="#local-6989586621679122590"><span class="hs-identifier">syllables</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">arkStyle</span><span> </span><a href="#local-6989586621679122578"><span class="hs-identifier hs-var">config</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-320"></a><span>            </span><a href="Aedifico.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Cogito.html#makeSyllables"><span class="hs-identifier hs-var">makeSyllables</span></a><span> </span><a href="#local-6989586621679122589"><span class="hs-identifier hs-var">words</span></a><span>
</span><a name="line-321"></a><span>            </span><a href="Aedifico.html#Florid"><span class="hs-identifier hs-var">Florid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier hs-var">Syllable</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-322"></a><span>                        </span><span class="hs-identifier">sylText</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">verbumText</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">phraseText</span><span> </span><a href="#local-6989586621679122580"><span class="hs-identifier hs-var">phrase</span></a><span class="hs-special">,</span><span>
</span><a name="line-323"></a><span>                        </span><span class="hs-identifier">sylPosition</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Only"><span class="hs-identifier hs-var">Only</span></a><span>
</span><a name="line-324"></a><span>                       </span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-comment">-- | Compose music for a 'LyricSentence' for a single voice.</span><span>
</span><a name="line-327"></a><span class="hs-identifier">makeMusicSentence</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>
</span><a name="line-328"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>
</span><a name="line-329"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>
</span><a name="line-330"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricSentence"><span class="hs-identifier hs-type">LyricSentence</span></a><span>
</span><a name="line-331"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#SentencePerm"><span class="hs-identifier hs-type">SentencePerm</span></a><span>
</span><a name="line-332"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSentence"><span class="hs-identifier hs-type">MusicSentence</span></a><span>
</span><a name="line-333"></a><a name="makeMusicSentence"><a href="Cogito.html#makeMusicSentence"><span class="hs-identifier">makeMusicSentence</span></a></a><span> </span><a name="local-6989586621679122593"><a href="#local-6989586621679122593"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679122594"><a href="#local-6989586621679122594"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679122595"><a href="#local-6989586621679122595"><span class="hs-identifier">voiceID</span></a></a><span> </span><a name="local-6989586621679122596"><a href="#local-6989586621679122596"><span class="hs-identifier">sentence</span></a></a><span> </span><a name="local-6989586621679122597"><a href="#local-6989586621679122597"><span class="hs-identifier">sentencePerms</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-334"></a><span>    </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><a href="Cogito.html#makeMusicPhrase"><span class="hs-identifier hs-var">makeMusicPhrase</span></a><span> </span><a href="#local-6989586621679122593"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679122594"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679122595"><span class="hs-identifier hs-var">voiceID</span></a><span class="hs-special">)</span><span>
</span><a name="line-335"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">phrases</span><span> </span><a href="#local-6989586621679122596"><span class="hs-identifier hs-var">sentence</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679122597"><span class="hs-identifier hs-var">sentencePerms</span></a><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span class="hs-comment">-- | Put together all the music information for one 'LyricSection', for a</span><span>
</span><a name="line-338"></a><span class="hs-comment">-- single voice.</span><span>
</span><a name="line-339"></a><span class="hs-comment">--</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- * For a single voice:</span><span>
</span><a name="line-341"></a><span class="hs-comment">--</span><span>
</span><a name="line-342"></a><span class="hs-comment">--      * extract ArkConfig for whole section</span><span>
</span><a name="line-343"></a><span class="hs-comment">--</span><span>
</span><a name="line-344"></a><span class="hs-comment">--      * for each sentence in section:</span><span>
</span><a name="line-345"></a><span class="hs-comment">--</span><span>
</span><a name="line-346"></a><span class="hs-comment">--          * extract list of perms, one per phrase</span><span>
</span><a name="line-347"></a><span class="hs-comment">--          * extract list of lyric phrases</span><span>
</span><a name="line-348"></a><span class="hs-comment">--          * apply same ArkConfig</span><span>
</span><a name="line-349"></a><span class="hs-comment">--</span><span>
</span><a name="line-350"></a><span class="hs-comment">--      * for each phrase in sentence:</span><span>
</span><a name="line-351"></a><span class="hs-comment">--</span><span>
</span><a name="line-352"></a><span class="hs-comment">--          * look up vperm according to config and perm</span><span>
</span><a name="line-353"></a><span class="hs-comment">--</span><span>
</span><a name="line-354"></a><span class="hs-comment">--              * (for some pinakes, choose column by stanza = section num)</span><span>
</span><a name="line-355"></a><span class="hs-comment">--          </span><span>
</span><a name="line-356"></a><span class="hs-comment">--          * look up rperm according to config and perm</span><span>
</span><a name="line-357"></a><span class="hs-comment">--              </span><span>
</span><a name="line-358"></a><span class="hs-comment">--              * (for syntagma II, use same perm)</span><span>
</span><a name="line-359"></a><span class="hs-comment">--      </span><span>
</span><a name="line-360"></a><span class="hs-comment">--          * convert vperm nums to pitch names</span><span>
</span><a name="line-361"></a><span class="hs-comment">--          * (adjust pitches)</span><span>
</span><a name="line-362"></a><span class="hs-comment">--          * make Pitches: match pitches and rhythms, accounting for rests</span><span>
</span><a name="line-363"></a><span class="hs-comment">--          </span><span>
</span><a name="line-364"></a><span class="hs-comment">--          * match Notes: match each Pitch with Phrase/Verbum/Syllable</span><span>
</span><a name="line-365"></a><span class="hs-comment">--                          according to syntagma</span><span>
</span><a name="line-366"></a><span class="hs-comment">--          </span><span>
</span><a name="line-367"></a><span class="hs-comment">--          * return a MusicPhrase</span><span>
</span><a name="line-368"></a><span class="hs-comment">--</span><span>
</span><a name="line-369"></a><span class="hs-comment">--      * inside a MusicSentence</span><span>
</span><a name="line-370"></a><span class="hs-comment">--</span><span>
</span><a name="line-371"></a><span class="hs-comment">--  * inside a MusicSection</span><span>
</span><a name="line-372"></a><span class="hs-identifier">makeMusicSection</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>
</span><a name="line-373"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span>
</span><a name="line-374"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span>
</span><a name="line-375"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>
</span><a name="line-376"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span>
</span><a name="line-377"></a><a name="makeMusicSection"><a href="Cogito.html#makeMusicSection"><span class="hs-identifier">makeMusicSection</span></a></a><span> </span><a name="local-6989586621679122598"><a href="#local-6989586621679122598"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679122599"><a href="#local-6989586621679122599"><span class="hs-identifier">section</span></a></a><span> </span><a name="local-6989586621679122600"><a href="#local-6989586621679122600"><span class="hs-identifier">sectionPerms</span></a></a><span> </span><a name="local-6989586621679122601"><a href="#local-6989586621679122601"><span class="hs-identifier">voiceID</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier hs-var">MusicSection</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-378"></a><span>        </span><span class="hs-identifier">secVoiceID</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122601"><span class="hs-identifier hs-var">voiceID</span></a><span class="hs-special">,</span><span>
</span><a name="line-379"></a><span>        </span><span class="hs-identifier">secConfig</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sectionConfig</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679122599"><span class="hs-identifier hs-var">section</span></a><span class="hs-special">,</span><span>
</span><a name="line-380"></a><span>        </span><span class="hs-identifier">secSentences</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122602"><span class="hs-identifier hs-var">sentenceList</span></a><span>
</span><a name="line-381"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-382"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-383"></a><span>        </span><a name="local-6989586621679122602"><a href="#local-6989586621679122602"><span class="hs-identifier">sentenceList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><a href="Cogito.html#makeMusicSentence"><span class="hs-identifier hs-var">makeMusicSentence</span></a><span> </span><a href="#local-6989586621679122598"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679122603"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679122601"><span class="hs-identifier hs-var">voiceID</span></a><span class="hs-special">)</span><span>
</span><a name="line-384"></a><span>                        </span><span class="hs-special">(</span><span class="hs-identifier">sentences</span><span> </span><a href="#local-6989586621679122599"><span class="hs-identifier hs-var">section</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679122600"><span class="hs-identifier hs-var">sectionPerms</span></a><span>
</span><a name="line-385"></a><span>        </span><a name="local-6989586621679122603"><a href="#local-6989586621679122603"><span class="hs-identifier">config</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sectionConfig</span><span> </span><a href="#local-6989586621679122599"><span class="hs-identifier hs-var">section</span></a><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span class="hs-comment">-- | Compose music for all four SATB voices for one 'LyricSection'.</span><span>
</span><a name="line-388"></a><span class="hs-comment">-- TODO experimental: also adjust for musica ficta</span><span>
</span><a name="line-389"></a><span class="hs-identifier">makeMusicChorus</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>
</span><a name="line-390"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span>
</span><a name="line-391"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span>
</span><a name="line-392"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#MusicChorus"><span class="hs-identifier hs-type">MusicChorus</span></a><span>
</span><a name="line-393"></a><a name="makeMusicChorus"><a href="Cogito.html#makeMusicChorus"><span class="hs-identifier">makeMusicChorus</span></a></a><span> </span><a name="local-6989586621679122604"><a href="#local-6989586621679122604"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679122605"><a href="#local-6989586621679122605"><span class="hs-identifier">section</span></a></a><span> </span><a name="local-6989586621679122606"><a href="#local-6989586621679122606"><span class="hs-identifier">perm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122607"><span class="hs-identifier hs-var">adjustFicta</span></a><span> </span><span class="hs-comment">-- rawChorus </span><span>
</span><a name="line-394"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-395"></a><span>        </span><a name="local-6989586621679122607"><a href="#local-6989586621679122607"><span class="hs-identifier">adjustFicta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Ficta.html#adjustFictaChorus"><span class="hs-identifier hs-var">adjustFictaChorus</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">systems</span><span> </span><a href="#local-6989586621679122604"><span class="hs-identifier hs-var">arca</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">modes</span><span> </span><a href="#local-6989586621679122604"><span class="hs-identifier hs-var">arca</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679122608"><span class="hs-identifier hs-var">rawChorus</span></a><span>
</span><a name="line-396"></a><span>        </span><a name="local-6989586621679122608"><a href="#local-6989586621679122608"><span class="hs-identifier">rawChorus</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#MusicChorus"><span class="hs-identifier hs-var">MusicChorus</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-397"></a><span>            </span><span class="hs-identifier">soprano</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122609"><span class="hs-identifier hs-var">makesec</span></a><span> </span><a href="Aedifico.html#Soprano"><span class="hs-identifier hs-var">Soprano</span></a><span class="hs-special">,</span><span>
</span><a name="line-398"></a><span>            </span><span class="hs-identifier">alto</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122609"><span class="hs-identifier hs-var">makesec</span></a><span> </span><a href="Aedifico.html#Alto"><span class="hs-identifier hs-var">Alto</span></a><span class="hs-special">,</span><span>
</span><a name="line-399"></a><span>            </span><span class="hs-identifier">tenor</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122609"><span class="hs-identifier hs-var">makesec</span></a><span> </span><a href="Aedifico.html#Tenor"><span class="hs-identifier hs-var">Tenor</span></a><span class="hs-special">,</span><span>
</span><a name="line-400"></a><span>            </span><span class="hs-identifier">bass</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679122609"><span class="hs-identifier hs-var">makesec</span></a><span> </span><a href="Aedifico.html#Bass"><span class="hs-identifier hs-var">Bass</span></a><span>
</span><a name="line-401"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-402"></a><span>        </span><a name="local-6989586621679122609"><a href="#local-6989586621679122609"><span class="hs-identifier">makesec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#makeMusicSection"><span class="hs-identifier hs-var">makeMusicSection</span></a><span> </span><a href="#local-6989586621679122604"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679122605"><span class="hs-identifier hs-var">section</span></a><span> </span><a href="#local-6989586621679122606"><span class="hs-identifier hs-var">perm</span></a><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span class="hs-comment">-- | Compose the music for the whole document as a 'MusicScore', pulling the</span><span>
</span><a name="line-405"></a><span class="hs-comment">-- data from the 'Arca'.</span><span>
</span><a name="line-406"></a><span class="hs-identifier">makeMusicScore</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>
</span><a name="line-407"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span class="hs-special">]</span><span>
</span><a name="line-408"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span class="hs-special">]</span><span>
</span><a name="line-409"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#MusicScore"><span class="hs-identifier hs-type">MusicScore</span></a><span>
</span><a name="line-410"></a><a name="makeMusicScore"><a href="Cogito.html#makeMusicScore"><span class="hs-identifier">makeMusicScore</span></a></a><span> </span><a name="local-6989586621679122610"><a href="#local-6989586621679122610"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679122611"><a href="#local-6989586621679122611"><span class="hs-identifier">lyricSections</span></a></a><span> </span><a name="local-6989586621679122612"><a href="#local-6989586621679122612"><span class="hs-identifier">sectionPerms</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-411"></a><span>    </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><a href="Cogito.html#makeMusicChorus"><span class="hs-identifier hs-var">makeMusicChorus</span></a><span> </span><a href="#local-6989586621679122610"><span class="hs-identifier hs-var">arca</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679122611"><span class="hs-identifier hs-var">lyricSections</span></a><span> </span><a href="#local-6989586621679122612"><span class="hs-identifier hs-var">sectionPerms</span></a><span>
</span><a name="line-412"></a><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a></pre></body></html>