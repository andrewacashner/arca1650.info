<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : Scribo.Lilypond
Description : Write output of the ark to Lilypond music-notation language
Copyright   : (c) Andrew A. Cashner 2020
Maintainer  : Andrew Cashner, &lt;andrew.cashner@rochester.edu&gt;
Stability   : Experimental

This module is our implementation of Kircher's /palimpsest phonotacticum/, his
system for writing out the music created using the ark.  Certain elements that
Kircher used notation to calculate (like determining vocal ranges by clef
combinations and the size of the staff) we actually do in the @Cogito@ module.
This module is purely focused on output of complete music information to a
music-notation language.

This module outputs to Lilypond, which could then be processed by that program
to PDF, MIDI, or other formats. 

This module also contains the central 'compose' function that takes in a text
processed by the @Lectio@ module, and does the rest of the work of getting
data from the ark, adjusting and translating that data into music (using
@Cogito@), and then writing it.

-}</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Scribo.Lilypond</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>
</span><a name="line-29"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span>
</span><a name="line-30"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">transpose</span><span>
</span><a name="line-31"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="Aedifico.html"><span class="hs-identifier">Aedifico</span></a><span>
</span><a name="line-34"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Aedifico.html#Pnum"><span class="hs-identifier hs-type">Pnum</span></a><span>       </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Accid"><span class="hs-identifier hs-type">Accid</span></a><span>      </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#MusicMeter"><span class="hs-identifier hs-type">MusicMeter</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Style"><span class="hs-identifier hs-type">Style</span></a><span>      </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ModeList"><span class="hs-identifier hs-type">ModeList</span></a><span>
</span><a name="line-42"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span>
</span><a name="line-43"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>       </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>     </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="Cogito.html"><span class="hs-identifier">Cogito</span></a><span>
</span><a name="line-48"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">voiceID</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">music</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.html#Chorus"><span class="hs-identifier hs-type">Chorus</span></a><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.html#Symphonia"><span class="hs-identifier hs-type">Symphonia</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.html#isRest"><span class="hs-identifier hs-var">isRest</span></a><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span>
</span><a name="line-53"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.html#modeMollis"><span class="hs-identifier hs-var">modeMollis</span></a><span>
</span><a name="line-54"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Cogito.html#getMasterMusic"><span class="hs-identifier hs-var">getMasterMusic</span></a><span>
</span><a name="line-55"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Fortuna.html"><span class="hs-identifier">Fortuna</span></a><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-type">Perm</span></a><span>
</span><a name="line-59"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span>
</span><a name="line-60"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="Lectio.html"><span class="hs-identifier">Lectio</span></a><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Lectio.html#LyricSentence"><span class="hs-identifier hs-type">LyricSentence</span></a><span>   </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Lectio.html#ArkMetadata"><span class="hs-identifier hs-type">ArkMetadata</span></a><span>     </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Lectio.html#LyricPhrase"><span class="hs-identifier hs-type">LyricPhrase</span></a><span>     </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Lectio.html#Verbum"><span class="hs-identifier hs-type">Verbum</span></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-comment">-- * Write individual data types to Lilypond strings</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">-- | Write pitch as Lilypond music note.</span><span>
</span><a name="line-73"></a><span class="hs-comment">-- Look up needed string values for letter name, accidental, octave tick marks,</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- and duration in lists based on data in given 'Pitch'.</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- If it is a 'Aedifico.Pnum.Rest', just print the rest rhythm string.</span><span>
</span><a name="line-76"></a><span class="hs-comment">--</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- Most of these just require using an enum value as index to a list of</span><span>
</span><a name="line-78"></a><span class="hs-comment">-- strings or characters. The octave requires us to calculate the number of</span><span>
</span><a name="line-79"></a><span class="hs-comment">-- commas or apostrophes to add (relative to Helmholtz octave 3 = @c@).</span><span>
</span><a name="line-80"></a><span class="hs-identifier">pitch2ly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-81"></a><a name="pitch2ly"><a href="Scribo.Lilypond.html#pitch2ly"><span class="hs-identifier">pitch2ly</span></a></a><span> </span><a name="local-6989586621679123104"><a href="#local-6989586621679123104"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-82"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="Cogito.html#isRest"><span class="hs-identifier hs-var">isRest</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">dur</span><span> </span><a href="#local-6989586621679123104"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-83"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679123105"><span class="hs-identifier hs-var">duration</span></a><span>
</span><a name="line-84"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679123104"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="Aedifico.html#Na"><span class="hs-identifier hs-var">Na</span></a><span>
</span><a name="line-85"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;\\ficta &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123106"><span class="hs-identifier hs-var">pitchLetter</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123107"><span class="hs-identifier hs-var">accidental</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123108"><span class="hs-identifier hs-var">octaveTicks</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123105"><span class="hs-identifier hs-var">duration</span></a><span>
</span><a name="line-86"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679123106"><span class="hs-identifier hs-var">pitchLetter</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123108"><span class="hs-identifier hs-var">octaveTicks</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123105"><span class="hs-identifier hs-var">duration</span></a><span>
</span><a name="line-87"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-88"></a><span>        </span><a name="local-6989586621679123105"><a href="#local-6989586621679123105"><span class="hs-identifier">duration</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dur</span><span> </span><a href="#local-6989586621679123104"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-89"></a><span>            </span><a href="Aedifico.html#Br"><span class="hs-identifier hs-var">Br</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\\breve&quot;</span><span>
</span><a name="line-90"></a><span>            </span><a href="Aedifico.html#Sb"><span class="hs-identifier hs-var">Sb</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;1&quot;</span><span>
</span><a name="line-91"></a><span>            </span><a href="Aedifico.html#Mn"><span class="hs-identifier hs-var">Mn</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;2&quot;</span><span>
</span><a name="line-92"></a><span>            </span><a href="Aedifico.html#Sm"><span class="hs-identifier hs-var">Sm</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;4&quot;</span><span>
</span><a name="line-93"></a><span>            </span><a href="Aedifico.html#Fs"><span class="hs-identifier hs-var">Fs</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;8&quot;</span><span>
</span><a name="line-94"></a><span>            </span><a href="Aedifico.html#BrD"><span class="hs-identifier hs-var">BrD</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\\breve.&quot;</span><span>
</span><a name="line-95"></a><span>            </span><a href="Aedifico.html#SbD"><span class="hs-identifier hs-var">SbD</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;1.&quot;</span><span>
</span><a name="line-96"></a><span>            </span><a href="Aedifico.html#MnD"><span class="hs-identifier hs-var">MnD</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;2.&quot;</span><span>
</span><a name="line-97"></a><span>            </span><a href="Aedifico.html#SmD"><span class="hs-identifier hs-var">SmD</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;4.&quot;</span><span>
</span><a name="line-98"></a><span>            </span><a href="Aedifico.html#FsD"><span class="hs-identifier hs-var">FsD</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;8.&quot;</span><span>
</span><a name="line-99"></a><span>            </span><a href="Aedifico.html#LgR"><span class="hs-identifier hs-var">LgR</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;r\\longa&quot;</span><span>
</span><a name="line-100"></a><span>            </span><a href="Aedifico.html#BrR"><span class="hs-identifier hs-var">BrR</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;r\\breve&quot;</span><span>
</span><a name="line-101"></a><span>            </span><a href="Aedifico.html#SbR"><span class="hs-identifier hs-var">SbR</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;r1&quot;</span><span>
</span><a name="line-102"></a><span>            </span><a href="Aedifico.html#MnR"><span class="hs-identifier hs-var">MnR</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;r2&quot;</span><span>
</span><a name="line-103"></a><span>            </span><a href="Aedifico.html#SmR"><span class="hs-identifier hs-var">SmR</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;r4&quot;</span><span>
</span><a name="line-104"></a><span>            </span><a href="Aedifico.html#FsR"><span class="hs-identifier hs-var">FsR</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;r8&quot;</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span>        </span><a name="local-6989586621679123106"><a href="#local-6989586621679123106"><span class="hs-identifier">pitchLetter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679123104"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-107"></a><span>            </span><a href="Aedifico.html#PCc"><span class="hs-identifier hs-var">PCc</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;c&quot;</span><span>
</span><a name="line-108"></a><span>            </span><a href="Aedifico.html#PCd"><span class="hs-identifier hs-var">PCd</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;d&quot;</span><span>
</span><a name="line-109"></a><span>            </span><a href="Aedifico.html#PCe"><span class="hs-identifier hs-var">PCe</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;e&quot;</span><span>
</span><a name="line-110"></a><span>            </span><a href="Aedifico.html#PCf"><span class="hs-identifier hs-var">PCf</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;f&quot;</span><span>
</span><a name="line-111"></a><span>            </span><a href="Aedifico.html#PCg"><span class="hs-identifier hs-var">PCg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;g&quot;</span><span>
</span><a name="line-112"></a><span>            </span><a href="Aedifico.html#PCa"><span class="hs-identifier hs-var">PCa</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;a&quot;</span><span>
</span><a name="line-113"></a><span>            </span><a href="Aedifico.html#PCb"><span class="hs-identifier hs-var">PCb</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;b&quot;</span><span>
</span><a name="line-114"></a><span>            </span><a href="Aedifico.html#PCc8"><span class="hs-identifier hs-var">PCc8</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;c&quot;</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span>        </span><a name="local-6989586621679123107"><a href="#local-6989586621679123107"><span class="hs-identifier">accidental</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679123104"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-117"></a><span>            </span><a href="Aedifico.html#Fl"><span class="hs-identifier hs-var">Fl</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;es&quot;</span><span>
</span><a name="line-118"></a><span>            </span><a href="Aedifico.html#Na"><span class="hs-identifier hs-var">Na</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-119"></a><span>            </span><a href="Aedifico.html#Sh"><span class="hs-identifier hs-var">Sh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;is&quot;</span><span>
</span><a name="line-120"></a><span>            </span><a href="Aedifico.html#AccidNil"><span class="hs-identifier hs-var">AccidNil</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>        </span><a name="local-6989586621679123108"><a href="#local-6989586621679123108"><span class="hs-identifier">octaveTicks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679123109"><span class="hs-identifier hs-var">oct2str</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679123104"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span>        </span><span class="hs-identifier">oct2str</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-125"></a><span>        </span><a name="local-6989586621679123109"><a href="#local-6989586621679123109"><span class="hs-identifier">oct2str</span></a></a><span> </span><a name="local-6989586621679123110"><a href="#local-6989586621679123110"><span class="hs-identifier">oct</span></a></a><span>
</span><a name="line-126"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679123110"><span class="hs-identifier hs-var">oct</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">3</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679123113"><span class="hs-identifier hs-var">degree</span></a><span> </span><a href="#local-6989586621679123111"><span class="hs-identifier hs-var">low</span></a><span>
</span><a name="line-127"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679123110"><span class="hs-identifier hs-var">oct</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">3</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679123113"><span class="hs-identifier hs-var">degree</span></a><span> </span><a href="#local-6989586621679123112"><span class="hs-identifier hs-var">high</span></a><span>
</span><a name="line-128"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-129"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-130"></a><span>                </span><a name="local-6989586621679123111"><a href="#local-6989586621679123111"><span class="hs-identifier">low</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-char">','</span><span>
</span><a name="line-131"></a><span>                </span><a name="local-6989586621679123112"><a href="#local-6989586621679123112"><span class="hs-identifier">high</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-char">'\''</span><span>
</span><a name="line-132"></a><span>                </span><a name="local-6989586621679123113"><a href="#local-6989586621679123113"><span class="hs-identifier">degree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">abs</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679123110"><span class="hs-identifier hs-var">oct</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-comment">-- * Write larger structures of music data to Lilypond, with necessary framing</span><span>
</span><a name="line-136"></a><span class="hs-comment">-- inside @\score@, @\Staff@, and so on.</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- | Put things inside enclosing parens, brackets, etc.</span><span>
</span><a name="line-139"></a><span class="hs-identifier">enbrace</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ string to put between enclosures</span><span>
</span><a name="line-140"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ opening enclosure text (e.g., @{@)</span><span>
</span><a name="line-141"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ closing text (e.g., @}@)</span><span>
</span><a name="line-142"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-143"></a><a name="enbrace"><a href="Scribo.Lilypond.html#enbrace"><span class="hs-identifier">enbrace</span></a></a><span> </span><a name="local-6989586621679123114"><a href="#local-6989586621679123114"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621679123115"><a href="#local-6989586621679123115"><span class="hs-identifier">open</span></a></a><span> </span><a name="local-6989586621679123116"><a href="#local-6989586621679123116"><span class="hs-identifier">close</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679123115"><span class="hs-identifier hs-var">open</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123114"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123116"><span class="hs-identifier hs-var">close</span></a><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-comment">-- | Group string in curly braces @{string}@ with added newlines</span><span>
</span><a name="line-146"></a><span class="hs-identifier">lyMusicGroup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-147"></a><a name="lyMusicGroup"><a href="Scribo.Lilypond.html#lyMusicGroup"><span class="hs-identifier">lyMusicGroup</span></a></a><span> </span><a name="local-6989586621679123117"><a href="#local-6989586621679123117"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Scribo.Lilypond.html#enbrace"><span class="hs-identifier hs-var">enbrace</span></a><span> </span><a href="#local-6989586621679123117"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-string">&quot;{\n&quot;</span><span> </span><span class="hs-string">&quot;\n}\n&quot;</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-comment">-- | Group string in double angle brackets @\&lt;\&lt;string\&gt;\&gt;@ with added newlines</span><span>
</span><a name="line-150"></a><span class="hs-identifier">lySimultaneousGroup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-151"></a><a name="lySimultaneousGroup"><a href="Scribo.Lilypond.html#lySimultaneousGroup"><span class="hs-identifier">lySimultaneousGroup</span></a></a><span> </span><a name="local-6989586621679123118"><a href="#local-6989586621679123118"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Scribo.Lilypond.html#enbrace"><span class="hs-identifier hs-var">enbrace</span></a><span> </span><a href="#local-6989586621679123118"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-string">&quot;&lt;&lt;\n&quot;</span><span> </span><span class="hs-string">&quot;\n&gt;&gt;\n&quot;</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-comment">-- | Write a 'Voice' to a Lilypond music group:</span><span>
</span><a name="line-154"></a><span class="hs-comment">--</span><span>
</span><a name="line-155"></a><span class="hs-comment">--      @\\new Staff\&lt;\&lt; \\new Voice { ... } \&gt;\&gt;@</span><span>
</span><a name="line-156"></a><span class="hs-comment">--</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- We have to include Lilypond @midiInstrument@ here.</span><span>
</span><a name="line-158"></a><span class="hs-identifier">voice2ly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-159"></a><a name="voice2ly"><a href="Scribo.Lilypond.html#voice2ly"><span class="hs-identifier">voice2ly</span></a></a><span> </span><a name="local-6989586621679123119"><a href="#local-6989586621679123119"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679123120"><a href="#local-6989586621679123120"><span class="hs-identifier">modeSystem</span></a></a><span> </span><a name="local-6989586621679123121"><a href="#local-6989586621679123121"><span class="hs-identifier">section</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679123127"><span class="hs-identifier hs-var">lyMusicMeter</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123129"><span class="hs-identifier hs-var">lyKey</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123122"><span class="hs-identifier hs-var">notes</span></a><span>
</span><a name="line-160"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-161"></a><span>        </span><a name="local-6989586621679123122"><a href="#local-6989586621679123122"><span class="hs-identifier">notes</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Scribo.Lilypond.html#pitch2ly"><span class="hs-identifier hs-var">pitch2ly</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679123119"><span class="hs-identifier hs-var">voice</span></a><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span>        </span><a name="local-6989586621679123123"><a href="#local-6989586621679123123"><span class="hs-identifier">id</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679123119"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-164"></a><span>        </span><a name="local-6989586621679123124"><a href="#local-6989586621679123124"><span class="hs-identifier">meter</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkMusicMeter</span><span> </span><a href="#local-6989586621679123126"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-165"></a><span>        </span><a name="local-6989586621679123125"><a href="#local-6989586621679123125"><span class="hs-identifier">mode</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arkMode</span><span> </span><a href="#local-6989586621679123126"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-166"></a><span>        </span><a name="local-6989586621679123126"><a href="#local-6989586621679123126"><span class="hs-identifier">config</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sectionConfig</span><span> </span><a href="#local-6989586621679123121"><span class="hs-identifier hs-var">section</span></a><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span>        </span><a name="local-6989586621679123127"><a href="#local-6989586621679123127"><span class="hs-identifier">lyMusicMeter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Scribo.Lilypond.html#enbrace"><span class="hs-identifier hs-var">enbrace</span></a><span> </span><a href="#local-6989586621679123128"><span class="hs-identifier hs-var">meterName</span></a><span> </span><span class="hs-string">&quot;\\time &quot;</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span>
</span><a name="line-169"></a><span>        </span><a name="local-6989586621679123128"><a href="#local-6989586621679123128"><span class="hs-identifier">meterName</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679123124"><span class="hs-identifier hs-var">meter</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-170"></a><span>            </span><a href="Aedifico.html#Duple"><span class="hs-identifier hs-var">Duple</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;2/2&quot;</span><span>
</span><a name="line-171"></a><span>            </span><a href="Aedifico.html#TripleMajor"><span class="hs-identifier hs-var">TripleMajor</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;3/1&quot;</span><span>
</span><a name="line-172"></a><span>            </span><a href="Aedifico.html#TripleMinor"><span class="hs-identifier hs-var">TripleMinor</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;3/2&quot;</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span>        </span><a name="local-6989586621679123129"><a href="#local-6989586621679123129"><span class="hs-identifier">lyKey</span></a></a><span>
</span><a name="line-175"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.html#modeMollis"><span class="hs-identifier hs-var">modeMollis</span></a><span> </span><a href="#local-6989586621679123125"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679123120"><span class="hs-identifier hs-var">modeSystem</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\\key f\\major\n&quot;</span><span>
</span><a name="line-176"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-comment">-- | Write a 'LyricSection' to a Lilypond @\new Lyrics { }@ statement for a</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- particular voice (@VoiceName@). Separate -- syllables with @ -- @.</span><span>
</span><a name="line-180"></a><span class="hs-identifier">lyrics2ly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-181"></a><a name="lyrics2ly"><a href="Scribo.Lilypond.html#lyrics2ly"><span class="hs-identifier">lyrics2ly</span></a></a><span> </span><a name="local-6989586621679123130"><a href="#local-6989586621679123130"><span class="hs-identifier">section</span></a></a><span> </span><a name="local-6989586621679123131"><a href="#local-6989586621679123131"><span class="hs-identifier">voice</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-182"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">arkStyle</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">sectionConfig</span><span> </span><a href="#local-6989586621679123130"><span class="hs-identifier hs-var">section</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-183"></a><span>        </span><a href="Aedifico.html#Simple"><span class="hs-identifier hs-var">Simple</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679123132"><span class="hs-identifier hs-var">syllableString</span></a><span>
</span><a name="line-184"></a><span>        </span><a href="Aedifico.html#Florid"><span class="hs-identifier hs-var">Florid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679123136"><span class="hs-identifier hs-var">wordString</span></a><span>
</span><a name="line-185"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-186"></a><span>        </span><span class="hs-comment">-- In Syntagma I we line up one syllable per note and insert &quot;--&quot; to</span><span>
</span><a name="line-187"></a><span>        </span><span class="hs-comment">-- get hyphens between syllables in words</span><span>
</span><a name="line-188"></a><span>        </span><a name="local-6989586621679123132"><a href="#local-6989586621679123132"><span class="hs-identifier">syllableString</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679123140"><a href="#local-6989586621679123140"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span> </span><span class="hs-string">&quot; -- &quot;</span><span> </span><a href="#local-6989586621679123140"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679123133"><span class="hs-identifier hs-var">lsSyllables</span></a><span>
</span><a name="line-189"></a><span>        </span><a name="local-6989586621679123133"><a href="#local-6989586621679123133"><span class="hs-identifier">lsSyllables</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">verbumSyl</span><span> </span><a href="#local-6989586621679123134"><span class="hs-identifier hs-var">lsVerba</span></a><span>
</span><a name="line-190"></a><span>        </span><a name="local-6989586621679123134"><a href="#local-6989586621679123134"><span class="hs-identifier">lsVerba</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">phraseText</span><span> </span><a href="#local-6989586621679123135"><span class="hs-identifier hs-var">lsPhrases</span></a><span>
</span><a name="line-191"></a><span>        </span><a name="local-6989586621679123135"><a href="#local-6989586621679123135"><span class="hs-identifier">lsPhrases</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">phrases</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">sentences</span><span> </span><a href="#local-6989586621679123130"><span class="hs-identifier hs-var">section</span></a><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span>        </span><span class="hs-comment">-- In Syntagma II the florid voices screw up syllabification and</span><span>
</span><a name="line-194"></a><span>        </span><span class="hs-comment">-- Kircher does not specify an algorithm for text underlay.</span><span>
</span><a name="line-195"></a><span>        </span><span class="hs-comment">-- __ TODO __ </span><span>
</span><a name="line-196"></a><span>        </span><span class="hs-comment">-- Fixing this will require you to change Symphonia to include a list</span><span>
</span><a name="line-197"></a><span>        </span><span class="hs-comment">-- of Choruses instead of a single Chorus so that it matches up with</span><span>
</span><a name="line-198"></a><span>        </span><span class="hs-comment">-- the structure of the lyric text in LyricSentences; </span><span>
</span><a name="line-199"></a><span>        </span><span class="hs-comment">-- you will need to process music and lyrics for each phrase and THEN</span><span>
</span><a name="line-200"></a><span>        </span><span class="hs-comment">-- adjust the music (stepwise, etc.) and combine</span><span>
</span><a name="line-201"></a><span>        </span><a name="local-6989586621679123136"><a href="#local-6989586621679123136"><span class="hs-identifier">wordString</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679123131"><span class="hs-identifier hs-var">voice</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#Bass"><span class="hs-identifier hs-var">Bass</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679123138"><span class="hs-identifier hs-var">lyricIncipits</span></a><span> </span><a href="#local-6989586621679123131"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679123130"><span class="hs-identifier hs-var">section</span></a><span>
</span><a name="line-202"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679123137"><span class="hs-identifier hs-var">blankLyrics</span></a><span> </span><a href="#local-6989586621679123131"><span class="hs-identifier hs-var">voice</span></a><span> </span><a href="#local-6989586621679123130"><span class="hs-identifier hs-var">section</span></a><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span>        </span><span class="hs-comment">-- | Put a filler lyric (&quot;_&quot;) under each note that is not a rest.</span><span>
</span><a name="line-205"></a><span>        </span><span class="hs-identifier">blankLyrics</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-206"></a><span>        </span><a name="local-6989586621679123137"><a href="#local-6989586621679123137"><span class="hs-identifier">blankLyrics</span></a></a><span> </span><a name="local-6989586621679123141"><a href="#local-6989586621679123141"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679123142"><a href="#local-6989586621679123142"><span class="hs-identifier">section</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679123143"><span class="hs-identifier hs-var">sylCount</span></a><span> </span><span class="hs-string">&quot;_&quot;</span><span>
</span><a name="line-207"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-208"></a><span>                </span><a name="local-6989586621679123143"><a href="#local-6989586621679123143"><span class="hs-identifier">sylCount</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679123144"><span class="hs-identifier hs-var">pitchesNotRests</span></a><span>
</span><a name="line-209"></a><span>                </span><a name="local-6989586621679123144"><a href="#local-6989586621679123144"><span class="hs-identifier">pitchesNotRests</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679123141"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span>        </span><span class="hs-comment">-- | Make each phrase of lyrics into a single-word string, put them</span><span>
</span><a name="line-212"></a><span>        </span><span class="hs-comment">-- all in a row at the beginning of the section, and fill the rest</span><span>
</span><a name="line-213"></a><span>        </span><span class="hs-comment">-- with blanks.</span><span>
</span><a name="line-214"></a><span>        </span><span class="hs-comment">-- __ TODO __ this is a placeholder: we need to align each string with</span><span>
</span><a name="line-215"></a><span>        </span><span class="hs-comment">-- the start of a music perm.</span><span>
</span><a name="line-216"></a><span>        </span><span class="hs-identifier">lyricIncipits</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-217"></a><span>        </span><a name="local-6989586621679123138"><a href="#local-6989586621679123138"><span class="hs-identifier">lyricIncipits</span></a></a><span> </span><a name="local-6989586621679123145"><a href="#local-6989586621679123145"><span class="hs-identifier">voice</span></a></a><span> </span><a name="local-6989586621679123146"><a href="#local-6989586621679123146"><span class="hs-identifier">section</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679123150"><span class="hs-identifier hs-var">incipits</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679123147"><span class="hs-identifier hs-var">blanks</span></a><span class="hs-special">]</span><span>
</span><a name="line-218"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-219"></a><span>                </span><a name="local-6989586621679123147"><a href="#local-6989586621679123147"><span class="hs-identifier">blanks</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679123148"><span class="hs-identifier hs-var">sylCount</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><a href="#local-6989586621679123151"><span class="hs-identifier hs-var">lengths</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;_&quot;</span><span>
</span><a name="line-220"></a><span>                </span><a name="local-6989586621679123148"><a href="#local-6989586621679123148"><span class="hs-identifier">sylCount</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679123149"><span class="hs-identifier hs-var">pitchesNotRests</span></a><span>
</span><a name="line-221"></a><span>                </span><a name="local-6989586621679123149"><a href="#local-6989586621679123149"><span class="hs-identifier">pitchesNotRests</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679123145"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-222"></a><span>                </span><a name="local-6989586621679123150"><a href="#local-6989586621679123150"><span class="hs-identifier">incipits</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679123139"><span class="hs-identifier hs-var">lumpWords</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">phrases</span><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>                                    </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">sentences</span><span> </span><a href="#local-6989586621679123146"><span class="hs-identifier hs-var">section</span></a><span>
</span><a name="line-224"></a><span>                </span><a name="local-6989586621679123151"><a href="#local-6989586621679123151"><span class="hs-identifier">lengths</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">sentenceLength</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">sentences</span><span> </span><a href="#local-6989586621679123146"><span class="hs-identifier hs-var">section</span></a><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span>        </span><span class="hs-comment">-- | Combine lyrics for a phrase into a single word with &quot;_&quot; elisions</span><span>
</span><a name="line-227"></a><span>        </span><span class="hs-comment">-- between words, for use as a lyrical incipit</span><span>
</span><a name="line-228"></a><span>        </span><span class="hs-identifier">lumpWords</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lectio.html#LyricPhrase"><span class="hs-identifier hs-type">LyricPhrase</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-229"></a><span>        </span><a name="local-6989586621679123139"><a href="#local-6989586621679123139"><span class="hs-identifier">lumpWords</span></a></a><span> </span><a name="local-6989586621679123152"><a href="#local-6989586621679123152"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span> </span><span class="hs-string">&quot;_&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">verbumText</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">phraseText</span><span> </span><a href="#local-6989586621679123152"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-comment">-- | The opening string per voice</span><span>
</span><a name="line-232"></a><span class="hs-identifier">voice2lyOpening</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-233"></a><a name="voice2lyOpening"><a href="Scribo.Lilypond.html#voice2lyOpening"><span class="hs-identifier">voice2lyOpening</span></a></a><span> </span><a name="local-6989586621679123153"><a href="#local-6989586621679123153"><span class="hs-identifier">voice</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span>
</span><a name="line-234"></a><span>    </span><span class="hs-special">[</span><span class="hs-string">&quot;\\new Staff \\with { midiInstrument = \&quot;choir aahs\&quot; }\n &quot;</span><span class="hs-special">,</span><span>
</span><a name="line-235"></a><span>     </span><span class="hs-string">&quot;&lt;&lt;\n\\new Voice = \&quot;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679123154"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\&quot; {\n&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-236"></a><span>     </span><a href="#local-6989586621679123155"><span class="hs-identifier hs-var">lyClef</span></a><span class="hs-special">]</span><span>
</span><a name="line-237"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-238"></a><span>        </span><a name="local-6989586621679123154"><a href="#local-6989586621679123154"><span class="hs-identifier">id</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679123153"><span class="hs-identifier hs-var">voice</span></a><span>
</span><a name="line-239"></a><span>        </span><a name="local-6989586621679123155"><a href="#local-6989586621679123155"><span class="hs-identifier">lyClef</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Scribo.Lilypond.html#enbrace"><span class="hs-identifier hs-var">enbrace</span></a><span> </span><a href="#local-6989586621679123156"><span class="hs-identifier hs-var">clefName</span></a><span> </span><span class="hs-string">&quot;\\clef \&quot;&quot;</span><span> </span><span class="hs-string">&quot;\&quot;\n&quot;</span><span>
</span><a name="line-240"></a><span>        </span><a name="local-6989586621679123156"><a href="#local-6989586621679123156"><span class="hs-identifier">clefName</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679123154"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-241"></a><span>            </span><a href="Aedifico.html#Soprano"><span class="hs-identifier hs-var">Soprano</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;treble&quot;</span><span>
</span><a name="line-242"></a><span>            </span><a href="Aedifico.html#Alto"><span class="hs-identifier hs-var">Alto</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;treble&quot;</span><span>
</span><a name="line-243"></a><span>            </span><a href="Aedifico.html#Tenor"><span class="hs-identifier hs-var">Tenor</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;treble_8&quot;</span><span>
</span><a name="line-244"></a><span>            </span><a href="Aedifico.html#Bass"><span class="hs-identifier hs-var">Bass</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;bass&quot;</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-comment">-- | The end of the music part of the voice and beginning of the lyrics</span><span>
</span><a name="line-247"></a><span class="hs-identifier">voice2lyClosing</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-248"></a><a name="voice2lyClosing"><a href="Scribo.Lilypond.html#voice2lyClosing"><span class="hs-identifier">voice2lyClosing</span></a></a><span> </span><a name="local-6989586621679123157"><a href="#local-6989586621679123157"><span class="hs-identifier">voice</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\\FinalBar\n}\n&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\\new Lyrics \\lyricsto \&quot;&quot;</span><span>
</span><a name="line-249"></a><span>        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679123157"><span class="hs-identifier hs-var">voice</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\&quot; {\n\\lyricmode {\n&quot;</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-comment">-- | The end of the voice and its lyrics (discards input)</span><span>
</span><a name="line-252"></a><span class="hs-identifier">voiceClosing</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-253"></a><a name="voiceClosing"><a href="Scribo.Lilypond.html#voiceClosing"><span class="hs-identifier">voiceClosing</span></a></a><span> </span><a name="local-6989586621679123158"><a href="#local-6989586621679123158"><span class="hs-identifier">voice</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;}\n}\n&gt;&gt;\n&quot;</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-comment">-- | Convert all the music derived from input into notation output</span><span>
</span><a name="line-257"></a><span class="hs-identifier">masterMusic2ly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Cogito.html#Symphonia"><span class="hs-identifier hs-type">Symphonia</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-258"></a><a name="masterMusic2ly"><a href="Scribo.Lilypond.html#masterMusic2ly"><span class="hs-identifier">masterMusic2ly</span></a></a><span> </span><a name="local-6989586621679123159"><a href="#local-6989586621679123159"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679123160"><a href="#local-6989586621679123160"><span class="hs-identifier">symphoniae</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Scribo.Lilypond.html#lySimultaneousGroup"><span class="hs-identifier hs-var">lySimultaneousGroup</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679123161"><span class="hs-identifier hs-var">notes</span></a><span>
</span><a name="line-259"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-260"></a><span>        </span><a name="local-6989586621679123161"><a href="#local-6989586621679123161"><span class="hs-identifier">notes</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span>
</span><a name="line-261"></a><span>                    </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">transpose</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679123163"><span class="hs-identifier hs-var">starts</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679123166"><span class="hs-identifier hs-var">middles</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679123164"><span class="hs-identifier hs-var">ends</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679123167"><span class="hs-identifier hs-var">lyrics</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679123165"><span class="hs-identifier hs-var">close</span></a><span class="hs-special">]</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span>        </span><a name="local-6989586621679123162"><a href="#local-6989586621679123162"><span class="hs-identifier">firstChorus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">chorus</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679123160"><span class="hs-identifier hs-var">symphoniae</span></a><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span>        </span><span class="hs-comment">-- one of these per voice (list of four)</span><span>
</span><a name="line-266"></a><span>        </span><a name="local-6989586621679123163"><a href="#local-6989586621679123163"><span class="hs-identifier">starts</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Scribo.Lilypond.html#voice2lyOpening"><span class="hs-identifier hs-var">voice2lyOpening</span></a><span> </span><a href="#local-6989586621679123162"><span class="hs-identifier hs-var">firstChorus</span></a><span>
</span><a name="line-267"></a><span>        </span><a name="local-6989586621679123164"><a href="#local-6989586621679123164"><span class="hs-identifier">ends</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Scribo.Lilypond.html#voice2lyClosing"><span class="hs-identifier hs-var">voice2lyClosing</span></a><span> </span><a href="#local-6989586621679123162"><span class="hs-identifier hs-var">firstChorus</span></a><span>
</span><a name="line-268"></a><span>        </span><a name="local-6989586621679123165"><a href="#local-6989586621679123165"><span class="hs-identifier">close</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Scribo.Lilypond.html#voiceClosing"><span class="hs-identifier hs-var">voiceClosing</span></a><span> </span><a href="#local-6989586621679123162"><span class="hs-identifier hs-var">firstChorus</span></a><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span>        </span><span class="hs-comment">-- get the music for each section, then combine the music for each</span><span>
</span><a name="line-271"></a><span>        </span><span class="hs-comment">-- voice to end up with a list of four voices</span><span>
</span><a name="line-272"></a><span>        </span><a name="local-6989586621679123166"><a href="#local-6989586621679123166"><span class="hs-identifier">middles</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679123168"><span class="hs-identifier hs-var">sectionString</span></a><span>
</span><a name="line-273"></a><span>            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679123171"><a href="#local-6989586621679123171"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679123169"><span class="hs-identifier hs-var">voice2lySection</span></a><span> </span><a href="#local-6989586621679123171"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">systems</span><span> </span><a href="#local-6989586621679123159"><span class="hs-identifier hs-var">arca</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679123160"><span class="hs-identifier hs-var">symphoniae</span></a><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span>        </span><span class="hs-comment">-- likewise but for lyrics</span><span>
</span><a name="line-276"></a><span>        </span><a name="local-6989586621679123167"><a href="#local-6989586621679123167"><span class="hs-identifier">lyrics</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679123168"><span class="hs-identifier hs-var">sectionString</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679123170"><span class="hs-identifier hs-var">lyrics2lySection</span></a><span> </span><a href="#local-6989586621679123160"><span class="hs-identifier hs-var">symphoniae</span></a><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span>        </span><span class="hs-identifier">sectionString</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-279"></a><span>        </span><a name="local-6989586621679123168"><a href="#local-6989586621679123168"><span class="hs-identifier">sectionString</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">unwords</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">transpose</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span>        </span><span class="hs-identifier">voice2lySection</span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Symphonia"><span class="hs-identifier hs-type">Symphonia</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-282"></a><span>        </span><a name="local-6989586621679123169"><a href="#local-6989586621679123169"><span class="hs-identifier">voice2lySection</span></a></a><span> </span><a name="local-6989586621679123172"><a href="#local-6989586621679123172"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679123173"><a href="#local-6989586621679123173"><span class="hs-identifier">modes</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-283"></a><span>            </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679123174"><a href="#local-6989586621679123174"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Scribo.Lilypond.html#voice2ly"><span class="hs-identifier hs-var">voice2ly</span></a><span> </span><a href="#local-6989586621679123174"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679123173"><span class="hs-identifier hs-var">modes</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">lyricSection</span><span> </span><a href="#local-6989586621679123172"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">chorus</span><span> </span><a href="#local-6989586621679123172"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span>        </span><span class="hs-identifier">lyrics2lySection</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.html#Symphonia"><span class="hs-identifier hs-type">Symphonia</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-286"></a><span>        </span><a name="local-6989586621679123170"><a href="#local-6989586621679123170"><span class="hs-identifier">lyrics2lySection</span></a></a><span> </span><a name="local-6989586621679123175"><a href="#local-6989586621679123175"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-287"></a><span>            </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679123176"><a href="#local-6989586621679123176"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Scribo.Lilypond.html#lyrics2ly"><span class="hs-identifier hs-var">lyrics2ly</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">lyricSection</span><span> </span><a href="#local-6989586621679123175"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679123176"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">chorus</span><span> </span><a href="#local-6989586621679123175"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span class="hs-comment">-- | Make Lilypond preamble of include commands</span><span>
</span><a name="line-292"></a><span class="hs-identifier">makePreamble</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-293"></a><a name="makePreamble"><a href="Scribo.Lilypond.html#makePreamble"><span class="hs-identifier">makePreamble</span></a></a><span> </span><a name="local-6989586621679123177"><a href="#local-6989586621679123177"><span class="hs-identifier">includes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679123178"><a href="#local-6989586621679123178"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\\include \&quot;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123178"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\&quot;\n&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679123177"><span class="hs-identifier hs-var">includes</span></a><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-comment">-- | Make Lilypond header with the Arca as the author</span><span>
</span><a name="line-296"></a><span class="hs-identifier">makeHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lectio.html#ArkMetadata"><span class="hs-identifier hs-type">ArkMetadata</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-297"></a><a name="makeHeader"><a href="Scribo.Lilypond.html#makeHeader"><span class="hs-identifier">makeHeader</span></a></a><span> </span><a name="local-6989586621679123179"><a href="#local-6989586621679123179"><span class="hs-identifier">metadata</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\\header {\ntitle = \&quot;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">arkTitle</span><span> </span><a href="#local-6989586621679123179"><span class="hs-identifier hs-var">metadata</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-298"></a><span>    </span><span class="hs-string">&quot;\&quot;\npoet = \&quot;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">arkWordsAuthor</span><span> </span><a href="#local-6989586621679123179"><span class="hs-identifier hs-var">metadata</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-299"></a><span>    </span><span class="hs-string">&quot;\&quot;\ncomposer = \\markup{\n&quot;</span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-300"></a><span>    </span><span class="hs-string">&quot;\\column{&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-301"></a><span>    </span><span class="hs-string">&quot;\\line {\&quot;Arca musarithmica Athanasii Kircheri\&quot;}\n&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-302"></a><span>    </span><span class="hs-string">&quot;\\line {\&quot;Societatis Iesu MMXX\&quot;}\n&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-303"></a><span>    </span><span class="hs-string">&quot;}\n}\ntagline = ##f\n}&quot;</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-comment">-- * All together now</span><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-comment">-- | Set a prepared 'LyricSentence' to music in one go. Return the text of a</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- complete Lilypond file as a string. Write version number and preamble, and</span><span>
</span><a name="line-309"></a><span class="hs-comment">-- put music into @score@ and @StaffGroup@ (needed because we are doing</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- /Mensurstriche/).</span><span>
</span><a name="line-311"></a><span class="hs-comment">--</span><span>
</span><a name="line-312"></a><span class="hs-identifier">compose</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>
</span><a name="line-313"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lectio.html#ArkMetadata"><span class="hs-identifier hs-type">ArkMetadata</span></a><span>
</span><a name="line-314"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Lectio.html#LyricSection"><span class="hs-identifier hs-type">LyricSection</span></a><span class="hs-special">]</span><span>
</span><a name="line-315"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span class="hs-special">]</span><span>
</span><a name="line-316"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-317"></a><a name="compose"><a href="Scribo.Lilypond.html#compose"><span class="hs-identifier">compose</span></a></a><span> </span><a name="local-6989586621679123180"><a href="#local-6989586621679123180"><span class="hs-identifier">arca</span></a></a><span> </span><a name="local-6989586621679123181"><a href="#local-6989586621679123181"><span class="hs-identifier">metadata</span></a></a><span> </span><a name="local-6989586621679123182"><a href="#local-6989586621679123182"><span class="hs-identifier">sections</span></a></a><span> </span><a name="local-6989586621679123183"><a href="#local-6989586621679123183"><span class="hs-identifier">perms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679123184"><span class="hs-identifier hs-var">lyCmd</span></a><span>
</span><a name="line-318"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-319"></a><span>        </span><a name="local-6989586621679123184"><a href="#local-6989586621679123184"><span class="hs-identifier">lyCmd</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679123185"><span class="hs-identifier hs-var">lyVersion</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123187"><span class="hs-identifier hs-var">lyPreamble</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123188"><span class="hs-identifier hs-var">lyHeader</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123189"><span class="hs-identifier hs-var">lyScore</span></a><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span>        </span><a name="local-6989586621679123185"><a href="#local-6989586621679123185"><span class="hs-identifier">lyVersion</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Scribo.Lilypond.html#enbrace"><span class="hs-identifier hs-var">enbrace</span></a><span> </span><a href="#local-6989586621679123186"><span class="hs-identifier hs-var">lyVersionString</span></a><span> </span><span class="hs-string">&quot;\\version \&quot;&quot;</span><span> </span><span class="hs-string">&quot;\&quot;\n&quot;</span><span>
</span><a name="line-322"></a><span>        </span><a name="local-6989586621679123186"><a href="#local-6989586621679123186"><span class="hs-identifier">lyVersionString</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;2.23&quot;</span><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span>        </span><a name="local-6989586621679123187"><a href="#local-6989586621679123187"><span class="hs-identifier">lyPreamble</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Scribo.Lilypond.html#makePreamble"><span class="hs-identifier hs-var">makePreamble</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;early-music.ly&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;mensurstriche.ly&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span>        </span><a name="local-6989586621679123188"><a href="#local-6989586621679123188"><span class="hs-identifier">lyHeader</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Scribo.Lilypond.html#makeHeader"><span class="hs-identifier hs-var">makeHeader</span></a><span> </span><a href="#local-6989586621679123181"><span class="hs-identifier hs-var">metadata</span></a><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span>        </span><a name="local-6989586621679123189"><a href="#local-6989586621679123189"><span class="hs-identifier">lyScore</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Scribo.Lilypond.html#enbrace"><span class="hs-identifier hs-var">enbrace</span></a><span> </span><a href="#local-6989586621679123191"><span class="hs-identifier hs-var">lyStaves</span></a><span> </span><span class="hs-string">&quot;\\score {\n&lt;&lt;\n&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;&gt;&gt;\n&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679123190"><span class="hs-identifier hs-var">lyMidi</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;}\n&quot;</span><span>
</span><a name="line-329"></a><span>        </span><a name="local-6989586621679123190"><a href="#local-6989586621679123190"><span class="hs-identifier">lyMidi</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\\layout{}\n\\midi{\\tempo 2 = 120}\n&quot;</span><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span>        </span><a name="local-6989586621679123191"><a href="#local-6989586621679123191"><span class="hs-identifier">lyStaves</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Scribo.Lilypond.html#enbrace"><span class="hs-identifier hs-var">enbrace</span></a><span> </span><a href="#local-6989586621679123192"><span class="hs-identifier hs-var">lyChorus</span></a><span> </span><span class="hs-string">&quot;\\new StaffGroup\n&quot;</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span>        </span><a name="local-6989586621679123192"><a href="#local-6989586621679123192"><span class="hs-identifier">lyChorus</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Scribo.Lilypond.html#masterMusic2ly"><span class="hs-identifier hs-var">masterMusic2ly</span></a><span> </span><a href="#local-6989586621679123180"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679123193"><span class="hs-identifier hs-var">symphoniae</span></a><span>
</span><a name="line-334"></a><span>        </span><a name="local-6989586621679123193"><a href="#local-6989586621679123193"><span class="hs-identifier">symphoniae</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.html#getMasterMusic"><span class="hs-identifier hs-var">getMasterMusic</span></a><span> </span><a href="#local-6989586621679123180"><span class="hs-identifier hs-var">arca</span></a><span> </span><a href="#local-6989586621679123182"><span class="hs-identifier hs-var">sections</span></a><span> </span><a href="#local-6989586621679123183"><span class="hs-identifier hs-var">perms</span></a><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span>
</span><a name="line-340"></a></pre></body></html>