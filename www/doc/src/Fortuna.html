<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : Fortuna
Description : (Theologically) dangerous chance operations: generate random indices
Copyright   : (c) 2022 Andrew A. Cashner
Stability   : Experimental

Kircher's ark does require a small amount of free choice on the part of the
user, in selecting which voice permutation and rhythm permutation to use from
each column.  We take the (for Kircher) theologically dangerous route of
chance operations and generate a random number for the index of the voice and
rhythm permutations.
-}</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Fortuna</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Random</span><span>
</span><a name="line-17"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">getStdRandom</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">randomR</span><span>
</span><a name="line-19"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-22"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">replicateM</span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="Lectio.html"><span class="hs-identifier">Lectio</span></a><span>
</span><a name="line-25"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Lectio.html#PhrasesInLyricSentence"><span class="hs-identifier hs-type">PhrasesInLyricSentence</span></a><span>
</span><a name="line-26"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Lectio.html#PhrasesInLyricSection"><span class="hs-identifier hs-type">PhrasesInLyricSection</span></a><span>
</span><a name="line-27"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-comment">-- | A @Perm@ stores the random number choices used to select voice and rhythm</span><span>
</span><a name="line-30"></a><span class="hs-comment">-- permutations.</span><span>
</span><a name="line-31"></a><span class="hs-keyword">data</span><span> </span><a name="Perm"><a href="Fortuna.html#Perm"><span class="hs-identifier">Perm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Perm"><a href="Fortuna.html#Perm"><span class="hs-identifier">Perm</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-32"></a><span>    </span><a name="voiceIndex"><a href="Fortuna.html#voiceIndex"><span class="hs-identifier">voiceIndex</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>    </span><a name="rhythmIndex"><a href="Fortuna.html#rhythmIndex"><span class="hs-identifier">rhythmIndex</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-34"></a><span class="hs-special">}</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-type">Perm</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-37"></a><span>    </span><a name="local-8214565720323790323"><span class="hs-identifier">show</span></a><span> </span><a name="local-6989586621679119495"><a href="#local-6989586621679119495"><span class="hs-identifier">perm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;v&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679119496"><span class="hs-identifier hs-var">vperm</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;/r&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679119497"><span class="hs-identifier hs-var">rperm</span></a><span>
</span><a name="line-38"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-39"></a><span>            </span><a name="local-6989586621679119496"><a href="#local-6989586621679119496"><span class="hs-identifier">vperm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">voiceIndex</span><span> </span><a href="#local-6989586621679119495"><span class="hs-identifier hs-var">perm</span></a><span>
</span><a name="line-40"></a><span>            </span><a name="local-6989586621679119497"><a href="#local-6989586621679119497"><span class="hs-identifier">rperm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">rhythmIndex</span><span> </span><a href="#local-6989586621679119495"><span class="hs-identifier hs-var">perm</span></a><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">-- | Make a pair of random numbers to select vperm and rperm:</span><span>
</span><a name="line-43"></a><span class="hs-comment">--</span><span>
</span><a name="line-44"></a><span class="hs-comment">--   - vperm is always one of 10 vperms per column</span><span>
</span><a name="line-45"></a><span class="hs-comment">--   - rperm lists are variable in length, so we choose a larger number and</span><span>
</span><a name="line-46"></a><span class="hs-comment">--   then take the modulo of the length of the list once it's selected (in @Aedifico@)</span><span>
</span><a name="line-47"></a><span class="hs-identifier">choosePerms</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-type">Perm</span></a><span>
</span><a name="line-48"></a><a name="choosePerms"><a href="Fortuna.html#choosePerms"><span class="hs-identifier">choosePerms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-49"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-50"></a><span>        </span><a name="local-6989586621679119498"><a href="#local-6989586621679119498"><span class="hs-identifier">vpermBounds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">99</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>        </span><a name="local-6989586621679119499"><a href="#local-6989586621679119499"><span class="hs-identifier">rpermBounds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">99</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>    </span><a name="local-6989586621679119500"><a href="#local-6989586621679119500"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getStdRandom</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">randomR</span><span> </span><a href="#local-6989586621679119498"><span class="hs-identifier hs-var">vpermBounds</span></a><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span>    </span><a name="local-6989586621679119501"><a href="#local-6989586621679119501"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getStdRandom</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">randomR</span><span> </span><a href="#local-6989586621679119499"><span class="hs-identifier hs-var">rpermBounds</span></a><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679119502"><a href="#local-6989586621679119502"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-var">Perm</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">voiceIndex</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679119500"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rhythmIndex</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679119501"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679119502"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-comment">-- | Each sentence needs a list of perms, one per phrase</span><span>
</span><a name="line-59"></a><span class="hs-keyword">type</span><span> </span><a name="SentencePerm"><a href="Fortuna.html#SentencePerm"><span class="hs-identifier">SentencePerm</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Fortuna.html#Perm"><span class="hs-identifier hs-type">Perm</span></a><span class="hs-special">]</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- | A list of perms for each sentence in the section</span><span>
</span><a name="line-62"></a><span class="hs-keyword">type</span><span> </span><a name="SectionPerm"><a href="Fortuna.html#SectionPerm"><span class="hs-identifier">SectionPerm</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Fortuna.html#SentencePerm"><span class="hs-identifier hs-type">SentencePerm</span></a><span class="hs-special">]</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-comment">-- | Generate a list of 'Perm's of a given length to match a @Sentence@</span><span>
</span><a name="line-65"></a><span class="hs-identifier">sentencePerms</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lectio.html#PhrasesInLyricSentence"><span class="hs-identifier hs-type">PhrasesInLyricSentence</span></a><span> </span><span class="hs-comment">-- ^ number of permutations</span><span>
</span><a name="line-66"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Fortuna.html#SentencePerm"><span class="hs-identifier hs-type">SentencePerm</span></a><span>
</span><a name="line-67"></a><a name="sentencePerms"><a href="Fortuna.html#sentencePerms"><span class="hs-identifier">sentencePerms</span></a></a><span> </span><a name="local-6989586621679119503"><a href="#local-6989586621679119503"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">replicateM</span><span> </span><a href="#local-6989586621679119503"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Fortuna.html#choosePerms"><span class="hs-identifier hs-var">choosePerms</span></a><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">-- | Generate perms for a whole section</span><span>
</span><a name="line-70"></a><span class="hs-identifier">sectionPerms</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lectio.html#PhrasesInLyricSection"><span class="hs-identifier hs-type">PhrasesInLyricSection</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Fortuna.html#SectionPerm"><span class="hs-identifier hs-type">SectionPerm</span></a><span>
</span><a name="line-71"></a><a name="sectionPerms"><a href="Fortuna.html#sectionPerms"><span class="hs-identifier">sectionPerms</span></a></a><span> </span><a name="local-6989586621679119504"><a href="#local-6989586621679119504"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679119913"><a href="#local-6989586621679119913"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#sentencePerms"><span class="hs-identifier hs-var">sentencePerms</span></a><span> </span><a href="#local-6989586621679119913"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679119504"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- | Generate perms for the whole input structure</span><span>
</span><a name="line-74"></a><span class="hs-identifier">inputPerms</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Lectio.html#PhrasesInLyricSection"><span class="hs-identifier hs-type">PhrasesInLyricSection</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Fortuna.html#SentencePerm"><span class="hs-identifier hs-type">SentencePerm</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-75"></a><a name="inputPerms"><a href="Fortuna.html#inputPerms"><span class="hs-identifier">inputPerms</span></a></a><span> </span><a name="local-6989586621679119914"><a href="#local-6989586621679119914"><span class="hs-identifier">ss</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679119915"><a href="#local-6989586621679119915"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Fortuna.html#sectionPerms"><span class="hs-identifier hs-var">sectionPerms</span></a><span> </span><a href="#local-6989586621679119915"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679119914"><span class="hs-identifier hs-var">ss</span></a><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a></pre></body></html>