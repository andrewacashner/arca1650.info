<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : Cogito.Musarithmetic
Description : Data structures and functions to adjust and store the ark's music output
Copyright   : (c) 2022 Andrew A. Cashner
Stability   : Experimental

This module provides the tools used in the main @Cogito@ module to adjust
music created by the ark and to store it in internal structures that will then
be used by the @Scribo@ modules.

The `stepwiseVoiceInRange` function tests all the possible permutations of
octaves for the pitches in a phrase and finds the best path, with the minimum
of large leaps and notes out of range.

Kircher's specification for how to put voices in range is incomplete, and his
own implementation is inconsistent, as demonstrated by his examples.  He says
to find the next closest pitch &quot;within the octave&quot; among the notes on the
staff (i.e., the notes within range), but he doesn't define &quot;within the
octave.&quot; Sometimes he leaps a fifth instead of a fourth, which would break
that rule.

Sometimes a gesture requires the voice to go out of range. Kircher says in
that case you can switch clefs. But that doesn't change the notes a singer can
sing. If he means to change to transposing clefs, that might work, but no one
ever changed to transposing clefs for only a single phrase and then went back. 

Instead, this module provides an algorithm that works every time to produce an
optimal melody with a small ambitus, minimum number of notes outside of range,
and small leaps. This seems very close to what Kircher probably thought
musicians would do intuitively, but did not fully specify programmatically.
-}</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cogito.Musarithmetic</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>
</span><a name="line-36"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">minimumBy</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-39"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span>
</span><a name="line-41"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">maybe</span><span>
</span><a name="line-42"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Function</span><span>
</span><a name="line-45"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">on</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="Aedifico.html"><span class="hs-identifier">Aedifico</span></a><span>
</span><a name="line-48"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Aedifico.html#Accid"><span class="hs-identifier hs-type">Accid</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#AccidType"><span class="hs-identifier hs-type">AccidType</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Tone"><span class="hs-identifier hs-type">Tone</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ToneList"><span class="hs-identifier hs-type">ToneList</span></a><span>
</span><a name="line-55"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ToneSystem"><span class="hs-identifier hs-type">ToneSystem</span></a><span>
</span><a name="line-56"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Octave"><span class="hs-identifier hs-type">Octave</span></a><span>       </span><span class="hs-special">(</span><a href="Aedifico.html#OctNil"><span class="hs-identifier hs-var">OctNil</span></a><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Pnum"><span class="hs-identifier hs-type">Pnum</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#System"><span class="hs-identifier hs-type">System</span></a><span>       </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span>   </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#TextMeter"><span class="hs-identifier hs-type">TextMeter</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#PnumAccid"><span class="hs-identifier hs-type">PnumAccid</span></a><span>
</span><a name="line-65"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#getRange"><span class="hs-identifier hs-var">getRange</span></a><span>
</span><a name="line-66"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span>
</span><a name="line-67"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#simplePitch"><span class="hs-identifier hs-var">simplePitch</span></a><span>
</span><a name="line-68"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#toneOrToneB"><span class="hs-identifier hs-var">toneOrToneB</span></a><span>
</span><a name="line-69"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-comment">-- * Data structures</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- ** For storing and adjusting pitches and rhythms, not including the sung text</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-comment">-- | A 'Voice' is a list of pitches with an identifier for the voice type.</span><span>
</span><a name="line-76"></a><span class="hs-keyword">data</span><span> </span><a name="Voice"><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier">Voice</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Voice"><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier">Voice</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-77"></a><span>    </span><a name="voiceID"><a href="Cogito.Musarithmetic.html#voiceID"><span class="hs-identifier">voiceID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Enum for Cantus, Alto, Tenor or Bass</span><span>
</span><a name="line-78"></a><span>    </span><a name="music"><a href="Cogito.Musarithmetic.html#music"><span class="hs-identifier">music</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-79"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-comment">-- | A 'Chorus' is a group (list) of four 'Voice' items</span><span>
</span><a name="line-82"></a><span class="hs-comment">--</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- __TODO__: We don't actually define it as being four items.</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- __TODO__: Do we still need this with new MEI setup?</span><span>
</span><a name="line-85"></a><span class="hs-keyword">type</span><span> </span><a name="Chorus"><a href="Cogito.Musarithmetic.html#Chorus"><span class="hs-identifier">Chorus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span class="hs-special">]</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-comment">-- ** For storing music including the sung text</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-comment">-- | A 'Note' contains a pitch and a syllable, equivalent to MEI @note@</span><span>
</span><a name="line-90"></a><span class="hs-keyword">data</span><span> </span><a name="Note"><a href="Cogito.Musarithmetic.html#Note"><span class="hs-identifier">Note</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Note"><a href="Cogito.Musarithmetic.html#Note"><span class="hs-identifier">Note</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-91"></a><span>    </span><a name="notePitch"><a href="Cogito.Musarithmetic.html#notePitch"><span class="hs-identifier">notePitch</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">,</span><span>
</span><a name="line-92"></a><span>    </span><a name="noteSyllable"><a href="Cogito.Musarithmetic.html#noteSyllable"><span class="hs-identifier">noteSyllable</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier hs-type">Syllable</span></a><span>
</span><a name="line-93"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | A 'Syllable' is a single syllable to be paired with a 'Pitch', including</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- its position in the word.</span><span>
</span><a name="line-97"></a><span class="hs-keyword">data</span><span> </span><a name="Syllable"><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier">Syllable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Syllable"><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier">Syllable</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-98"></a><span>    </span><a name="sylText"><a href="Cogito.Musarithmetic.html#sylText"><span class="hs-identifier">sylText</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>    </span><a name="sylPosition"><a href="Cogito.Musarithmetic.html#sylPosition"><span class="hs-identifier">sylPosition</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#SyllablePosition"><span class="hs-identifier hs-type">SyllablePosition</span></a><span>
</span><a name="line-100"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-comment">-- | What is the position of the syllable relative to the word? Beginning,</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- middle, or end? This determines hyphenation.</span><span>
</span><a name="line-104"></a><span class="hs-keyword">data</span><span> </span><a name="SyllablePosition"><a href="Cogito.Musarithmetic.html#SyllablePosition"><span class="hs-identifier">SyllablePosition</span></a></a><span> </span><span class="hs-glyph">=</span><span>   </span><a name="First"><a href="Cogito.Musarithmetic.html#First"><span class="hs-identifier">First</span></a></a><span>
</span><a name="line-105"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Middle"><a href="Cogito.Musarithmetic.html#Middle"><span class="hs-identifier">Middle</span></a></a><span>
</span><a name="line-106"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Last"><a href="Cogito.Musarithmetic.html#Last"><span class="hs-identifier">Last</span></a></a><span>
</span><a name="line-107"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Only"><a href="Cogito.Musarithmetic.html#Only"><span class="hs-identifier">Only</span></a></a><span>
</span><a name="line-108"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Tacet"><a href="Cogito.Musarithmetic.html#Tacet"><span class="hs-identifier">Tacet</span></a></a><span> </span><span class="hs-comment">-- ^ no syllable</span><span>
</span><a name="line-109"></a><span>                        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">-- | A 'MusicPhrase' contains all the notes set using one permutation drawn</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- from the ark, for a single voice.</span><span>
</span><a name="line-113"></a><span class="hs-keyword">data</span><span> </span><a name="MusicPhrase"><a href="Cogito.Musarithmetic.html#MusicPhrase"><span class="hs-identifier">MusicPhrase</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MusicPhrase"><a href="Cogito.Musarithmetic.html#MusicPhrase"><span class="hs-identifier">MusicPhrase</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-114"></a><span>    </span><a name="phraseVoiceID"><a href="Cogito.Musarithmetic.html#phraseVoiceID"><span class="hs-identifier">phraseVoiceID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span class="hs-special">,</span><span>
</span><a name="line-115"></a><span>    </span><a name="notes"><a href="Cogito.Musarithmetic.html#notes"><span class="hs-identifier">notes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#Note"><span class="hs-identifier hs-type">Note</span></a><span class="hs-special">]</span><span>
</span><a name="line-116"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-comment">-- | A list of 'MusicPhrase' items</span><span>
</span><a name="line-119"></a><span class="hs-keyword">type</span><span> </span><a name="MusicSentence"><a href="Cogito.Musarithmetic.html#MusicSentence"><span class="hs-identifier">MusicSentence</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#MusicPhrase"><span class="hs-identifier hs-type">MusicPhrase</span></a><span class="hs-special">]</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">-- | A 'MusicSection' contains all the music for one section in the input XML</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- document, for a single voice, together with the parameters set in the input</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- file.</span><span>
</span><a name="line-124"></a><span class="hs-keyword">data</span><span> </span><a name="MusicSection"><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier">MusicSection</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MusicSection"><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier">MusicSection</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-125"></a><span>    </span><a name="secVoiceID"><a href="Cogito.Musarithmetic.html#secVoiceID"><span class="hs-identifier">secVoiceID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span class="hs-special">,</span><span>
</span><a name="line-126"></a><span>    </span><a name="secConfig"><a href="Cogito.Musarithmetic.html#secConfig"><span class="hs-identifier">secConfig</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span class="hs-special">,</span><span>
</span><a name="line-127"></a><span>    </span><a name="secSentences"><a href="Cogito.Musarithmetic.html#secSentences"><span class="hs-identifier">secSentences</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#MusicSentence"><span class="hs-identifier hs-type">MusicSentence</span></a><span class="hs-special">]</span><span>
</span><a name="line-128"></a><span class="hs-special">}</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-comment">-- | A 'MusicChorus' is a four-voice SATB structure of 'MusicSection' data.</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- __TODO__ do we really need it to be structured this way?</span><span>
</span><a name="line-132"></a><span class="hs-keyword">data</span><span> </span><a name="MusicChorus"><a href="Cogito.Musarithmetic.html#MusicChorus"><span class="hs-identifier">MusicChorus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MusicChorus"><a href="Cogito.Musarithmetic.html#MusicChorus"><span class="hs-identifier">MusicChorus</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-133"></a><span>    </span><a name="cantus"><a href="Cogito.Musarithmetic.html#cantus"><span class="hs-identifier">cantus</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span class="hs-special">,</span><span>
</span><a name="line-134"></a><span>    </span><a name="alto"><a href="Cogito.Musarithmetic.html#alto"><span class="hs-identifier">alto</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span class="hs-special">,</span><span>
</span><a name="line-135"></a><span>    </span><a name="tenor"><a href="Cogito.Musarithmetic.html#tenor"><span class="hs-identifier">tenor</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span class="hs-special">,</span><span>
</span><a name="line-136"></a><span>    </span><a name="bass"><a href="Cogito.Musarithmetic.html#bass"><span class="hs-identifier">bass</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span>
</span><a name="line-137"></a><span class="hs-special">}</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-comment">-- | The full 'MusicScore' is a list of SATB 'MusicChorus' structures.</span><span>
</span><a name="line-140"></a><span class="hs-keyword">type</span><span> </span><a name="MusicScore"><a href="Cogito.Musarithmetic.html#MusicScore"><span class="hs-identifier">MusicScore</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#MusicChorus"><span class="hs-identifier hs-type">MusicChorus</span></a><span class="hs-special">]</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span class="hs-comment">-- * Manipulating the @Pitch@</span><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-comment">-- | Create a rest (that is, a 'Pitch' with duration only)</span><span>
</span><a name="line-146"></a><span class="hs-comment">--</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- We make a 'Pitch' but set the 'pnum' to 'Rest'; 'oct' and 'accid' are set</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- to special nil values ('OctNil', 'AccidNil')</span><span>
</span><a name="line-149"></a><span class="hs-comment">--</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- __TODO__: We are setting the octave using @fromEnum OctNil@: Isn't this the</span><span>
</span><a name="line-151"></a><span class="hs-comment">-- same as just setting it to zero? Is there a better way to mark this?</span><span>
</span><a name="line-152"></a><span class="hs-identifier">newRest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span>      </span><span class="hs-comment">-- ^ Rhythmic duration for this note</span><span>
</span><a name="line-153"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-154"></a><a name="newRest"><a href="Cogito.Musarithmetic.html#newRest"><span class="hs-identifier">newRest</span></a></a><span> </span><a name="local-6989586621679101390"><a href="#local-6989586621679101390"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-155"></a><span>    </span><span class="hs-identifier">pnum</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Rest"><span class="hs-identifier hs-var">Rest</span></a><span class="hs-special">,</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-identifier">dur</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101390"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><span>
</span><a name="line-157"></a><span>    </span><span class="hs-identifier">oct</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="Aedifico.html#OctNil"><span class="hs-identifier hs-var">OctNil</span></a><span class="hs-special">,</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-identifier">accid</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#AccidNil"><span class="hs-identifier hs-var">AccidNil</span></a><span class="hs-special">,</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#None"><span class="hs-identifier hs-var">None</span></a><span>
</span><a name="line-160"></a><span class="hs-special">}</span><span>
</span><a name="line-161"></a><span>
</span><a name="line-162"></a><span class="hs-comment">-- ** Adjust pitch for tone</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- | Is a tone in /cantus mollis/? Should there be a flat in the key</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- signature?</span><span>
</span><a name="line-166"></a><span class="hs-identifier">toneMollis</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Tone"><span class="hs-identifier hs-type">Tone</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ToneSystem"><span class="hs-identifier hs-type">ToneSystem</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-167"></a><a name="toneMollis"><a href="Cogito.Musarithmetic.html#toneMollis"><span class="hs-identifier">toneMollis</span></a></a><span> </span><a name="local-6989586621679101391"><a href="#local-6989586621679101391"><span class="hs-identifier">tone</span></a></a><span> </span><a name="local-6989586621679101392"><a href="#local-6989586621679101392"><span class="hs-identifier">systems</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679101393"><a href="#local-6989586621679101393"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;toneMollis:systems&quot;</span><span> </span><a href="#local-6989586621679101392"><span class="hs-identifier hs-var">systems</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679101391"><span class="hs-identifier hs-var">tone</span></a><span>
</span><a name="line-169"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679101393"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-170"></a><span>        </span><a href="Aedifico.html#Durus"><span class="hs-identifier hs-var">Durus</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-171"></a><span>        </span><a href="Aedifico.html#Mollis"><span class="hs-identifier hs-var">Mollis</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">-- | Adjust a pitch to be in a given tone. </span><span>
</span><a name="line-174"></a><span class="hs-identifier">pnumAccidInTone</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ToneList"><span class="hs-identifier hs-type">ToneList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Tone"><span class="hs-identifier hs-type">Tone</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#PnumAccid"><span class="hs-identifier hs-type">PnumAccid</span></a><span>
</span><a name="line-175"></a><a name="pnumAccidInTone"><a href="Cogito.Musarithmetic.html#pnumAccidInTone"><span class="hs-identifier">pnumAccidInTone</span></a></a><span> </span><a name="local-6989586621679101394"><a href="#local-6989586621679101394"><span class="hs-identifier">rawPnum</span></a></a><span> </span><a name="local-6989586621679101395"><a href="#local-6989586621679101395"><span class="hs-identifier">toneList</span></a></a><span> </span><a name="local-6989586621679101396"><a href="#local-6989586621679101396"><span class="hs-identifier">tone</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101397"><span class="hs-identifier hs-var">pnum</span></a><span>
</span><a name="line-176"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-177"></a><span>        </span><a name="local-6989586621679101397"><a href="#local-6989586621679101397"><span class="hs-identifier">pnum</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;pnumAccidInTone:pnum&quot;</span><span> </span><a href="#local-6989586621679101398"><span class="hs-identifier hs-var">toneScale</span></a><span> </span><a href="#local-6989586621679101394"><span class="hs-identifier hs-var">rawPnum</span></a><span>
</span><a name="line-178"></a><span>        </span><a name="local-6989586621679101398"><a href="#local-6989586621679101398"><span class="hs-identifier">toneScale</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;pnumAccidInTone:toneScale&quot;</span><span> </span><a href="#local-6989586621679101395"><span class="hs-identifier hs-var">toneList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679101396"><span class="hs-identifier hs-var">tone</span></a><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-comment">-- | Get the modal final for this tone. What pitch = 0 in this tone? (In</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- Kircher's 1-indexed vperms, the final is 1 or 8.)</span><span>
</span><a name="line-182"></a><span class="hs-identifier">modalFinal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#ToneList"><span class="hs-identifier hs-type">ToneList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Tone"><span class="hs-identifier hs-type">Tone</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-183"></a><a name="modalFinal"><a href="Cogito.Musarithmetic.html#modalFinal"><span class="hs-identifier">modalFinal</span></a></a><span> </span><a name="local-6989586621679101399"><a href="#local-6989586621679101399"><span class="hs-identifier">toneList</span></a></a><span> </span><a name="local-6989586621679101400"><a href="#local-6989586621679101400"><span class="hs-identifier">tone</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#simplePitch"><span class="hs-identifier hs-var">simplePitch</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679101401"><span class="hs-identifier hs-var">pnum</span></a><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-185"></a><span>        </span><a name="local-6989586621679101401"><a href="#local-6989586621679101401"><span class="hs-identifier">pnum</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679101402"><span class="hs-identifier hs-var">finalPair</span></a><span>
</span><a name="line-186"></a><span>        </span><a name="local-6989586621679101402"><a href="#local-6989586621679101402"><span class="hs-identifier">finalPair</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;modalFinalInRange:finalPair&quot;</span><span> </span><a href="#local-6989586621679101403"><span class="hs-identifier hs-var">toneScale</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-187"></a><span>        </span><a name="local-6989586621679101403"><a href="#local-6989586621679101403"><span class="hs-identifier">toneScale</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;modalFinalInRange:toneScale&quot;</span><span> </span><a href="#local-6989586621679101399"><span class="hs-identifier hs-var">toneList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679101400"><span class="hs-identifier hs-var">tone</span></a><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-comment">-- ** Check for rests</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">-- | Check to see if a rhythmic duration is a rest type (the rest enums begin</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- with 'LgR' so we compare with that)</span><span>
</span><a name="line-194"></a><span class="hs-identifier">isRest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-195"></a><a name="isRest"><a href="Cogito.Musarithmetic.html#isRest"><span class="hs-identifier">isRest</span></a></a><span> </span><a name="local-6989586621679101419"><a href="#local-6989586621679101419"><span class="hs-identifier">dur</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101419"><span class="hs-identifier hs-var">dur</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="Aedifico.html#LgR"><span class="hs-identifier hs-var">LgR</span></a><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-comment">-- | Is the 'Pitch' a rest?</span><span>
</span><a name="line-198"></a><span class="hs-identifier">isPitchRest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-199"></a><a name="isPitchRest"><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier">isPitchRest</span></a></a><span> </span><a name="local-6989586621679101420"><a href="#local-6989586621679101420"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679101420"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#Rest"><span class="hs-identifier hs-var">Rest</span></a><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-comment">-- | Are any of these pitches rests?</span><span>
</span><a name="line-202"></a><span class="hs-identifier">anyRests</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-203"></a><a name="anyRests"><a href="Cogito.Musarithmetic.html#anyRests"><span class="hs-identifier">anyRests</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span class="hs-comment">-- * Measure distances between notes and correct bad intervals</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-comment">-- ** Convert between diatonic and chromatic pitches for calculations</span><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span class="hs-comment">-- | Convert 'Pitch' to absolute pitch number, using chromatic calculations</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- (base 12). Raise an error if it is a rest.</span><span>
</span><a name="line-212"></a><span class="hs-identifier">absPitch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-213"></a><a name="absPitch"><a href="Cogito.Musarithmetic.html#absPitch"><span class="hs-identifier">absPitch</span></a></a><span> </span><a name="local-6989586621679101421"><a href="#local-6989586621679101421"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-214"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679101421"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Can\'t convert Rest to absolute pitch&quot;</span><span>
</span><a name="line-215"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101422"><span class="hs-identifier hs-var">oct12</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679101423"><span class="hs-identifier hs-var">pnum12</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679101424"><span class="hs-identifier hs-var">accid12</span></a><span>
</span><a name="line-216"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-217"></a><span>        </span><a name="local-6989586621679101422"><a href="#local-6989586621679101422"><span class="hs-identifier">oct12</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679101421"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">12</span><span>
</span><a name="line-218"></a><span>        </span><a name="local-6989586621679101423"><a href="#local-6989586621679101423"><span class="hs-identifier">pnum12</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#dia2chrom"><span class="hs-identifier hs-var">dia2chrom</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679101421"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-219"></a><span>        </span><a name="local-6989586621679101424"><a href="#local-6989586621679101424"><span class="hs-identifier">accid12</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679101421"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-comment">-- | Get chromatic offset from C for diatonic pitch classes </span><span>
</span><a name="line-223"></a><span class="hs-comment">-- (@PCc -&gt; 0@, @PCd -&gt; 2@, @PCe -&gt; 4@, etc.)</span><span>
</span><a name="line-224"></a><span class="hs-identifier">dia2chrom</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pnum"><span class="hs-identifier hs-type">Pnum</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-225"></a><a name="dia2chrom"><a href="Cogito.Musarithmetic.html#dia2chrom"><span class="hs-identifier">dia2chrom</span></a></a><span> </span><a name="local-6989586621679101425"><a href="#local-6989586621679101425"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679101425"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-226"></a><span>    </span><a href="Aedifico.html#PCc"><span class="hs-identifier hs-var">PCc</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-227"></a><span>    </span><a href="Aedifico.html#PCd"><span class="hs-identifier hs-var">PCd</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-228"></a><span>    </span><a href="Aedifico.html#PCe"><span class="hs-identifier hs-var">PCe</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-229"></a><span>    </span><a href="Aedifico.html#PCf"><span class="hs-identifier hs-var">PCf</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-230"></a><span>    </span><a href="Aedifico.html#PCg"><span class="hs-identifier hs-var">PCg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-231"></a><span>    </span><a href="Aedifico.html#PCa"><span class="hs-identifier hs-var">PCa</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">9</span><span>
</span><a name="line-232"></a><span>    </span><a href="Aedifico.html#PCb"><span class="hs-identifier hs-var">PCb</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">11</span><span>
</span><a name="line-233"></a><span>    </span><a href="Aedifico.html#PCc8"><span class="hs-identifier hs-var">PCc8</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">12</span><span>
</span><a name="line-234"></a><span>    </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Unknown pitch class&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679101425"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-comment">-- | Absolute diatonic pitch (base 7). Raise an error if it is a rest.</span><span>
</span><a name="line-237"></a><span class="hs-identifier">absPitch7</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-238"></a><a name="absPitch7"><a href="Cogito.Musarithmetic.html#absPitch7"><span class="hs-identifier">absPitch7</span></a></a><span> </span><a name="local-6989586621679101426"><a href="#local-6989586621679101426"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679101426"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;can't take absPitch7 of a rest&quot;</span><span>
</span><a name="line-239"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679101426"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">7</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679101426"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">-- ** \&quot;Musarithmetic\&quot;: Differences, sums, conditionals with @Pitch@ values</span><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span class="hs-comment">-- | Do mathematical operations on pitches (using their chromatic 'absPitch' values)</span><span>
</span><a name="line-244"></a><span class="hs-identifier">pitchMath</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-245"></a><a name="pitchMath"><a href="Cogito.Musarithmetic.html#pitchMath"><span class="hs-identifier">pitchMath</span></a></a><span> </span><a name="local-6989586621679101427"><a href="#local-6989586621679101427"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101427"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><a href="Cogito.Musarithmetic.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-comment">-- | Do mathematical operations on pitches (using their diatonic 'absPitch7' values)</span><span>
</span><a name="line-248"></a><span class="hs-identifier">pitchMath7</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-249"></a><a name="pitchMath7"><a href="Cogito.Musarithmetic.html#pitchMath7"><span class="hs-identifier">pitchMath7</span></a></a><span> </span><a name="local-6989586621679101428"><a href="#local-6989586621679101428"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101428"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><a href="Cogito.Musarithmetic.html#absPitch7"><span class="hs-identifier hs-var">absPitch7</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-comment">-- | Do boolean tests on pitches (using their 'absPitch' values)</span><span>
</span><a name="line-252"></a><span class="hs-identifier">pitchTest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-253"></a><a name="pitchTest"><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier">pitchTest</span></a></a><span> </span><a name="local-6989586621679101429"><a href="#local-6989586621679101429"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101429"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><a href="Cogito.Musarithmetic.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-comment">-- ** Conditional tests</span><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span class="hs-comment">-- | Are two 'Pitch'es the same chromatic pitch, enharmonically equivalent?</span><span>
</span><a name="line-258"></a><span class="hs-identifier">pEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-259"></a><a name="pEq"><a href="Cogito.Musarithmetic.html#pEq"><span class="hs-identifier">pEq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier hs-var">pitchTest</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-comment">-- | Test the pitch label and accidental of a 'Pitch'</span><span>
</span><a name="line-262"></a><span class="hs-identifier">pnumAccidEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pnum"><span class="hs-identifier hs-type">Pnum</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Accid"><span class="hs-identifier hs-type">Accid</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-263"></a><a name="pnumAccidEq"><a href="Cogito.Musarithmetic.html#pnumAccidEq"><span class="hs-identifier">pnumAccidEq</span></a></a><span> </span><a name="local-6989586621679101430"><a href="#local-6989586621679101430"><span class="hs-identifier">thisPnum</span></a></a><span> </span><a name="local-6989586621679101431"><a href="#local-6989586621679101431"><span class="hs-identifier">thisAccid</span></a></a><span> </span><a name="local-6989586621679101432"><a href="#local-6989586621679101432"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679101432"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679101430"><span class="hs-identifier hs-var">thisPnum</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679101432"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679101431"><span class="hs-identifier hs-var">thisAccid</span></a><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span class="hs-comment">-- | Pitch greater than?</span><span>
</span><a name="line-266"></a><span class="hs-identifier">pGt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-267"></a><a name="pGt"><a href="Cogito.Musarithmetic.html#pGt"><span class="hs-identifier">pGt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier hs-var">pitchTest</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-comment">-- | Pitch less than?</span><span>
</span><a name="line-270"></a><span class="hs-identifier">pLt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-271"></a><a name="pLt"><a href="Cogito.Musarithmetic.html#pLt"><span class="hs-identifier">pLt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier hs-var">pitchTest</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span class="hs-comment">-- | Pitch greater than or equal?</span><span>
</span><a name="line-274"></a><a name="pGtEq"><a href="Cogito.Musarithmetic.html#pGtEq"><span class="hs-identifier">pGtEq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier hs-var">pitchTest</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=</span><span class="hs-special">)</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-comment">-- | Pitch less than or equal?</span><span>
</span><a name="line-277"></a><a name="pLtEq"><a href="Cogito.Musarithmetic.html#pLtEq"><span class="hs-identifier">pLtEq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier hs-var">pitchTest</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-comment">-- ** Differences, intervals</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-comment">-- | Difference between pitches, chromatic interval</span><span>
</span><a name="line-282"></a><span class="hs-identifier">p12diff</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-283"></a><a name="p12diff"><a href="Cogito.Musarithmetic.html#p12diff"><span class="hs-identifier">p12diff</span></a></a><span> </span><a name="local-6989586621679101433"><a href="#local-6989586621679101433"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679101434"><a href="#local-6989586621679101434"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#anyRests"><span class="hs-identifier hs-var">anyRests</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101433"><span class="hs-identifier hs-var">p1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679101434"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-284"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchMath"><span class="hs-identifier hs-var">pitchMath</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101433"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679101434"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-comment">-- | Chromatic difference between pitch classes (within one octave); 'p12diff' modulo 12</span><span>
</span><a name="line-287"></a><span class="hs-identifier">p12diffMod</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-288"></a><a name="p12diffMod"><a href="Cogito.Musarithmetic.html#p12diffMod"><span class="hs-identifier">p12diffMod</span></a></a><span> </span><a name="local-6989586621679101435"><a href="#local-6989586621679101435"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679101436"><a href="#local-6989586621679101436"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#p12diff"><span class="hs-identifier hs-var">p12diff</span></a><span> </span><a href="#local-6989586621679101435"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679101436"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">12</span><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span class="hs-comment">-- | Difference between pitches, diatonic interval</span><span>
</span><a name="line-291"></a><span class="hs-comment">-- Unison = 0, therefore results of this function are one less than the verbal</span><span>
</span><a name="line-292"></a><span class="hs-comment">-- names of intervals (@p7diff = 4@ means a fifth)</span><span>
</span><a name="line-293"></a><span class="hs-identifier">p7diff</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-294"></a><a name="p7diff"><a href="Cogito.Musarithmetic.html#p7diff"><span class="hs-identifier">p7diff</span></a></a><span> </span><a name="local-6989586621679101437"><a href="#local-6989586621679101437"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679101438"><a href="#local-6989586621679101438"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#anyRests"><span class="hs-identifier hs-var">anyRests</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101437"><span class="hs-identifier hs-var">p1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679101438"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-295"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchMath7"><span class="hs-identifier hs-var">pitchMath7</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101437"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679101438"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span class="hs-comment">-- | Diatonic difference between pitch classes (= pitch difference as though</span><span>
</span><a name="line-298"></a><span class="hs-comment">-- within a single octave); result is 0-indexed, so the interval of a &quot;third&quot;</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- in speech has a @p7diffMod@ of 2</span><span>
</span><a name="line-300"></a><span class="hs-identifier">p7diffMod</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-301"></a><a name="p7diffMod"><a href="Cogito.Musarithmetic.html#p7diffMod"><span class="hs-identifier">p7diffMod</span></a></a><span> </span><a name="local-6989586621679101439"><a href="#local-6989586621679101439"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679101440"><a href="#local-6989586621679101440"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#p7diff"><span class="hs-identifier hs-var">p7diff</span></a><span> </span><a href="#local-6989586621679101439"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679101440"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-comment">-- | Take the absolute value of an intervals, the difference between pitches.</span><span>
</span><a name="line-304"></a><span class="hs-comment">-- The interval between any note and a rest is zero.</span><span>
</span><a name="line-305"></a><span class="hs-identifier">absInterval</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-306"></a><a name="absInterval"><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier">absInterval</span></a></a><span> </span><a name="local-6989586621679101441"><a href="#local-6989586621679101441"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679101442"><a href="#local-6989586621679101442"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#anyRests"><span class="hs-identifier hs-var">anyRests</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101441"><span class="hs-identifier hs-var">p1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679101442"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-307"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">abs</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#p7diff"><span class="hs-identifier hs-var">p7diff</span></a><span> </span><a href="#local-6989586621679101441"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679101442"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- ** Change a @Pitch@ based on calculation</span><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span class="hs-comment">-- | Change the pitch class and octave of an existing 'Pitch' to that of an</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- absolute diatonic pitch number. Return rests unchanged.</span><span>
</span><a name="line-313"></a><span class="hs-identifier">changePnumOctave</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-314"></a><a name="changePnumOctave"><a href="Cogito.Musarithmetic.html#changePnumOctave"><span class="hs-identifier">changePnumOctave</span></a></a><span> </span><a name="local-6989586621679101443"><a href="#local-6989586621679101443"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679101444"><a href="#local-6989586621679101444"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-315"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679101444"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101444"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-316"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-317"></a><span>        </span><span class="hs-identifier">pnum</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679101443"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">7</span><span class="hs-special">,</span><span>
</span><a name="line-318"></a><span>        </span><span class="hs-identifier">oct</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101443"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">7</span><span class="hs-special">,</span><span>
</span><a name="line-319"></a><span>        </span><span class="hs-identifier">dur</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dur</span><span> </span><a href="#local-6989586621679101444"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-320"></a><span>        </span><span class="hs-identifier">accid</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679101444"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-321"></a><span>        </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accidType</span><span> </span><a href="#local-6989586621679101444"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-322"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span class="hs-comment">-- *** Operate on pitch class and octave</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-comment">-- | Increase a pitch diatonically by a given interval (0-indexed diatonic,</span><span>
</span><a name="line-327"></a><span class="hs-comment">-- e.g., @p7inc p 4@ raises @p@ by a diatonic third). Return rests unchanged.</span><span>
</span><a name="line-328"></a><span class="hs-identifier">p7inc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-329"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ diatonic interval, 0-indexed</span><span>
</span><a name="line-330"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-331"></a><a name="p7inc"><a href="Cogito.Musarithmetic.html#p7inc"><span class="hs-identifier">p7inc</span></a></a><span> </span><a name="local-6989586621679101445"><a href="#local-6989586621679101445"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679101446"><a href="#local-6989586621679101446"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679101445"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101445"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-332"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#changePnumOctave"><span class="hs-identifier hs-var">changePnumOctave</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679101446"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="Cogito.Musarithmetic.html#absPitch7"><span class="hs-identifier hs-var">absPitch7</span></a><span> </span><a href="#local-6989586621679101445"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101445"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-333"></a><span>
</span><a name="line-334"></a><span class="hs-comment">-- *** Operate on octave alone</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-comment">-- | Just change the octave to a given number, no calculation required</span><span>
</span><a name="line-337"></a><span class="hs-identifier">octaveChange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-338"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Helmholtz octave number</span><span>
</span><a name="line-339"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-340"></a><a name="octaveChange"><a href="Cogito.Musarithmetic.html#octaveChange"><span class="hs-identifier">octaveChange</span></a></a><span> </span><a name="local-6989586621679101447"><a href="#local-6989586621679101447"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679101448"><a href="#local-6989586621679101448"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-341"></a><span>    </span><span class="hs-identifier">pnum</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679101447"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-342"></a><span>    </span><span class="hs-identifier">oct</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101448"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span>
</span><a name="line-343"></a><span>    </span><span class="hs-identifier">dur</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dur</span><span> </span><a href="#local-6989586621679101447"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-344"></a><span>    </span><span class="hs-identifier">accid</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679101447"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-345"></a><span>    </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accidType</span><span> </span><a href="#local-6989586621679101447"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-346"></a><span class="hs-special">}</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">-- | Increase the octave number by the given amount</span><span>
</span><a name="line-349"></a><span class="hs-identifier">octaveInc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-350"></a><a name="octaveInc"><a href="Cogito.Musarithmetic.html#octaveInc"><span class="hs-identifier">octaveInc</span></a></a><span> </span><a name="local-6989586621679101449"><a href="#local-6989586621679101449"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679101450"><a href="#local-6989586621679101450"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#octaveChange"><span class="hs-identifier hs-var">octaveChange</span></a><span> </span><a href="#local-6989586621679101449"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679101449"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679101450"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span class="hs-comment">-- | Raise the octave by 1</span><span>
</span><a name="line-353"></a><span class="hs-identifier">octaveUp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-354"></a><a name="octaveUp"><a href="Cogito.Musarithmetic.html#octaveUp"><span class="hs-identifier">octaveUp</span></a></a><span> </span><a name="local-6989586621679101451"><a href="#local-6989586621679101451"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101451"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#octaveInc"><span class="hs-identifier hs-var">octaveInc</span></a><span class="hs-special">`</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-355"></a><span>
</span><a name="line-356"></a><span class="hs-comment">-- | Lower the octave by 1</span><span>
</span><a name="line-357"></a><span class="hs-identifier">octaveDown</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-358"></a><a name="octaveDown"><a href="Cogito.Musarithmetic.html#octaveDown"><span class="hs-identifier">octaveDown</span></a></a><span> </span><a name="local-6989586621679101452"><a href="#local-6989586621679101452"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101452"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#octaveInc"><span class="hs-identifier hs-var">octaveInc</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>
</span><a name="line-360"></a><span class="hs-comment">-- ** Test a @Pitch@ relative to a @VoiceRange@</span><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-comment">-- | Is the pitch below the bottom limit of the voice range?</span><span>
</span><a name="line-363"></a><span class="hs-identifier">pitchTooLow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-364"></a><a name="pitchTooLow"><a href="Cogito.Musarithmetic.html#pitchTooLow"><span class="hs-identifier">pitchTooLow</span></a></a><span> </span><a name="local-6989586621679101453"><a href="#local-6989586621679101453"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101454"><a href="#local-6989586621679101454"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101454"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#pLt"><span class="hs-identifier hs-var">pLt</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">low</span><span> </span><a href="#local-6989586621679101453"><span class="hs-identifier hs-var">range</span></a><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-comment">-- | Is the pitch above the upper limit of the voice range?</span><span>
</span><a name="line-367"></a><span class="hs-identifier">pitchTooHigh</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-368"></a><a name="pitchTooHigh"><a href="Cogito.Musarithmetic.html#pitchTooHigh"><span class="hs-identifier">pitchTooHigh</span></a></a><span> </span><a name="local-6989586621679101455"><a href="#local-6989586621679101455"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101456"><a href="#local-6989586621679101456"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101456"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#pGt"><span class="hs-identifier hs-var">pGt</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">high</span><span> </span><a href="#local-6989586621679101455"><span class="hs-identifier hs-var">range</span></a><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span class="hs-comment">-- | Is the 'Pitch' within the proper range for its voice? Rests automatically</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- count as valid.</span><span>
</span><a name="line-372"></a><span class="hs-identifier">pitchInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-373"></a><a name="pitchInRange"><a href="Cogito.Musarithmetic.html#pitchInRange"><span class="hs-identifier">pitchInRange</span></a></a><span> </span><a name="local-6989586621679101457"><a href="#local-6989586621679101457"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101458"><a href="#local-6989586621679101458"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679101458"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-374"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTooLow"><span class="hs-identifier hs-var">pitchTooLow</span></a><span> </span><a href="#local-6989586621679101457"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101458"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTooHigh"><span class="hs-identifier hs-var">pitchTooHigh</span></a><span> </span><a href="#local-6989586621679101457"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101458"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span class="hs-comment">-- | Is this an acceptable leap? Only intervals up to a sixth, or an octave are</span><span>
</span><a name="line-377"></a><span class="hs-comment">-- okay. If either note is a rest, then that also passes the test.</span><span>
</span><a name="line-378"></a><span class="hs-comment">--</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- TODO: Ignoring rests like this is a bit of a cop-out, but Kircher usually</span><span>
</span><a name="line-380"></a><span class="hs-comment">-- puts rests at the beginning of a phrase, so they affect the interval</span><span>
</span><a name="line-381"></a><span class="hs-comment">-- /between/ phrases, which we are not adjusting anyway. In an ideal scenario,</span><span>
</span><a name="line-382"></a><span class="hs-comment">-- we would.</span><span>
</span><a name="line-383"></a><span class="hs-identifier">legalLeap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-384"></a><a name="legalLeap"><a href="Cogito.Musarithmetic.html#legalLeap"><span class="hs-identifier">legalLeap</span></a></a><span> </span><a name="local-6989586621679101459"><a href="#local-6989586621679101459"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679101460"><a href="#local-6989586621679101460"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#anyRests"><span class="hs-identifier hs-var">anyRests</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101459"><span class="hs-identifier hs-var">p1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679101460"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-385"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101461"><span class="hs-identifier hs-var">diff</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">7</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679101461"><span class="hs-identifier hs-var">diff</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-386"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679101461"><a href="#local-6989586621679101461"><span class="hs-identifier">diff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier hs-var">absInterval</span></a><span> </span><a href="#local-6989586621679101459"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679101460"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span class="hs-comment">-- * Find an optimal version of the melody for a particular voice </span><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-comment">-- ** Make lists of pitches in range</span><span>
</span><a name="line-392"></a><span>
</span><a name="line-393"></a><span class="hs-comment">-- | Find the lowest valid instance of a given 'Pitch' within the</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- 'VoiceRange'. This is used to calculate an optimal path through the</span><span>
</span><a name="line-395"></a><span class="hs-comment">-- possible pitches in a phrase, and means that in most cases the melody will</span><span>
</span><a name="line-396"></a><span class="hs-comment">-- end up in the lower end of the voice's range.</span><span>
</span><a name="line-397"></a><span class="hs-identifier">lowestInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-398"></a><a name="lowestInRange"><a href="Cogito.Musarithmetic.html#lowestInRange"><span class="hs-identifier">lowestInRange</span></a></a><span> </span><a name="local-6989586621679101462"><a href="#local-6989586621679101462"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101463"><a href="#local-6989586621679101463"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-399"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#pitchInRange"><span class="hs-identifier hs-var">pitchInRange</span></a><span> </span><a href="#local-6989586621679101462"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101463"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101463"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-400"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTooLow"><span class="hs-identifier hs-var">pitchTooLow</span></a><span>    </span><a href="#local-6989586621679101462"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101463"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#lowestInRange"><span class="hs-identifier hs-var">lowestInRange</span></a><span> </span><a href="#local-6989586621679101462"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#octaveUp"><span class="hs-identifier hs-var">octaveUp</span></a><span> </span><a href="#local-6989586621679101463"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-401"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#lowestInRange"><span class="hs-identifier hs-var">lowestInRange</span></a><span> </span><a href="#local-6989586621679101462"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#octaveChange"><span class="hs-identifier hs-var">octaveChange</span></a><span> </span><a href="#local-6989586621679101463"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">oct</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">low</span><span> </span><a href="#local-6989586621679101462"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span class="hs-comment">-- | List all the octaves within a voice range.</span><span>
</span><a name="line-404"></a><span class="hs-identifier">octavesInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>
</span><a name="line-405"></a><a name="octavesInRange"><a href="Cogito.Musarithmetic.html#octavesInRange"><span class="hs-identifier">octavesInRange</span></a></a><span> </span><a name="local-6989586621679101464"><a href="#local-6989586621679101464"><span class="hs-identifier">range</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">oct</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">low</span><span> </span><a href="#local-6989586621679101464"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">oct</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">high</span><span> </span><a href="#local-6989586621679101464"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">]</span><span>
</span><a name="line-406"></a><span>
</span><a name="line-407"></a><span class="hs-comment">-- | List all the valid instances of a given pitch within a voice range.</span><span>
</span><a name="line-408"></a><span class="hs-identifier">pitchesInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-409"></a><a name="pitchesInRange"><a href="Cogito.Musarithmetic.html#pitchesInRange"><span class="hs-identifier">pitchesInRange</span></a></a><span> </span><a name="local-6989586621679101465"><a href="#local-6989586621679101465"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101466"><a href="#local-6989586621679101466"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#pitchInRange"><span class="hs-identifier hs-var">pitchInRange</span></a><span> </span><a href="#local-6989586621679101468"><span class="hs-identifier hs-var">expandedRange</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101467"><span class="hs-identifier hs-var">candidates</span></a><span>
</span><a name="line-410"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-411"></a><span>        </span><a name="local-6989586621679101467"><a href="#local-6989586621679101467"><span class="hs-identifier">candidates</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#octaveChange"><span class="hs-identifier hs-var">octaveChange</span></a><span> </span><a href="#local-6989586621679101466"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#octavesInRange"><span class="hs-identifier hs-var">octavesInRange</span></a><span> </span><a href="#local-6989586621679101465"><span class="hs-identifier hs-var">range</span></a><span>
</span><a name="line-412"></a><span>        </span><a name="local-6989586621679101468"><a href="#local-6989586621679101468"><span class="hs-identifier">expandedRange</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-var">VoiceRange</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-413"></a><span>            </span><span class="hs-identifier">low</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">low</span><span> </span><a href="#local-6989586621679101465"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#p7inc"><span class="hs-identifier hs-var">p7inc</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">2</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-414"></a><span>            </span><span class="hs-identifier">high</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">high</span><span> </span><a href="#local-6989586621679101465"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#p7inc"><span class="hs-identifier hs-var">p7inc</span></a><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-415"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-comment">-- | Given a list of pitches (taken from the vperms in the ark), return a list</span><span>
</span><a name="line-418"></a><span class="hs-comment">-- of list of all the valid instances of those pitches within a particular</span><span>
</span><a name="line-419"></a><span class="hs-comment">-- voice range. This determines the candidate pitches that we will test to</span><span>
</span><a name="line-420"></a><span class="hs-comment">-- find the optimal melody.</span><span>
</span><a name="line-421"></a><span class="hs-identifier">pitchCandidates</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-422"></a><a name="pitchCandidates"><a href="Cogito.Musarithmetic.html#pitchCandidates"><span class="hs-identifier">pitchCandidates</span></a></a><span> </span><a name="local-6989586621679101469"><a href="#local-6989586621679101469"><span class="hs-identifier">range</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#pitchesInRange"><span class="hs-identifier hs-var">pitchesInRange</span></a><span> </span><a href="#local-6989586621679101469"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span class="hs-comment">-- ** Decision trees for evaluation ordered permutations of a series. </span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span class="hs-comment">-- | Binary tree. We use a left-child/right-sibling binary tree to evaluate</span><span>
</span><a name="line-427"></a><span class="hs-comment">-- any number of candidates for each element in the series.</span><span>
</span><a name="line-428"></a><span class="hs-keyword">data</span><span> </span><a name="Btree"><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier">Btree</span></a></a><span> </span><a name="local-6989586621679101383"><a href="#local-6989586621679101383"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Empty"><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier">Empty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Node"><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier">Node</span></a></a><span> </span><a href="#local-6989586621679101383"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="#local-6989586621679101383"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="#local-6989586621679101383"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-429"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span class="hs-comment">-- | Build a general tree, implemented as left-child/right-sibling binary tree that</span><span>
</span><a name="line-432"></a><span class="hs-comment">-- can take more than two options at each level</span><span>
</span><a name="line-433"></a><span class="hs-identifier">tree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679101389"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="#local-6989586621679101389"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-434"></a><a name="tree"><a href="Cogito.Musarithmetic.html#tree"><span class="hs-identifier">tree</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-435"></a><span class="hs-identifier">tree</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101470"><a href="#local-6989586621679101470"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101470"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>                </span><span class="hs-comment">-- no children or siblings</span><span>
</span><a name="line-436"></a><span class="hs-identifier">tree</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101471"><a href="#local-6989586621679101471"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101472"><a href="#local-6989586621679101472"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101471"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#tree"><span class="hs-identifier hs-var">tree</span></a><span> </span><a href="#local-6989586621679101472"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>            </span><span class="hs-comment">-- children but no siblings</span><span>
</span><a name="line-437"></a><span class="hs-identifier">tree</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101473"><a href="#local-6989586621679101473"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101474"><a href="#local-6989586621679101474"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101473"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#tree"><span class="hs-identifier hs-var">tree</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101474"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>          </span><span class="hs-comment">-- siblings but no children</span><span>
</span><a name="line-438"></a><span class="hs-identifier">tree</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101475"><a href="#local-6989586621679101475"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101476"><a href="#local-6989586621679101476"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101477"><a href="#local-6989586621679101477"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101475"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#tree"><span class="hs-identifier hs-var">tree</span></a><span> </span><a href="#local-6989586621679101477"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#tree"><span class="hs-identifier hs-var">tree</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679101476"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679101477"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- both </span><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-comment">-- *** Test ordered permutations with a tree</span><span>
</span><a name="line-441"></a><span>
</span><a name="line-442"></a><span class="hs-comment">-- | Build a left-child/right-sibling tree from a list of the options at each</span><span>
</span><a name="line-443"></a><span class="hs-comment">-- level, only including options that pass a test function; the test function</span><span>
</span><a name="line-444"></a><span class="hs-comment">-- compares each parent to its child. If the value of the parent (previous</span><span>
</span><a name="line-445"></a><span class="hs-comment">-- good value) is 'Nothing' then we know it is the beginning of the tree,</span><span>
</span><a name="line-446"></a><span class="hs-comment">-- there is no previous value to compare.</span><span>
</span><a name="line-447"></a><span class="hs-identifier">testTree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679101388"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679101388"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ test to determine if child is valid relative to parent</span><span>
</span><a name="line-448"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679101388"><span class="hs-identifier hs-type">a</span></a><span>          </span><span class="hs-comment">-- ^ previous value to test</span><span>
</span><a name="line-449"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679101388"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>            </span><span class="hs-comment">-- ^ list of permutations at each level</span><span>
</span><a name="line-450"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="#local-6989586621679101388"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-451"></a><span>
</span><a name="line-452"></a><span class="hs-comment">-- End of line.</span><span>
</span><a name="line-453"></a><a name="testTree"><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier">testTree</span></a></a><span> </span><a name="local-6989586621679101478"><a href="#local-6989586621679101478"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-454"></a><span>
</span><a name="line-455"></a><span class="hs-comment">-- No children or siblings: If x is good, make it a final node.</span><span>
</span><a name="line-456"></a><span class="hs-identifier">testTree</span><span> </span><a name="local-6989586621679101479"><a href="#local-6989586621679101479"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679101480"><a href="#local-6989586621679101480"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101481"><a href="#local-6989586621679101481"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-457"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621679101480"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679101479"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><a href="#local-6989586621679101480"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101481"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101481"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-458"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span class="hs-comment">-- Children but no siblings: If x is good, make a node and follow its</span><span>
</span><a name="line-461"></a><span class="hs-comment">-- children, comparing them to x.</span><span>
</span><a name="line-462"></a><span class="hs-identifier">testTree</span><span> </span><a name="local-6989586621679101482"><a href="#local-6989586621679101482"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679101483"><a href="#local-6989586621679101483"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101484"><a href="#local-6989586621679101484"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101485"><a href="#local-6989586621679101485"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-463"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621679101483"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679101482"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><a href="#local-6989586621679101483"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101484"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101484"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679101486"><span class="hs-identifier hs-var">childTree</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-464"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-465"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679101486"><a href="#local-6989586621679101486"><span class="hs-identifier">childTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier hs-var">testTree</span></a><span> </span><a href="#local-6989586621679101482"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679101484"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101485"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-466"></a><span>
</span><a name="line-467"></a><span class="hs-comment">-- Siblings but no children: If x is good, make a node and follow its</span><span>
</span><a name="line-468"></a><span class="hs-comment">-- siblings. Compare its siblings to the parent of x.</span><span>
</span><a name="line-469"></a><span class="hs-identifier">testTree</span><span> </span><a name="local-6989586621679101487"><a href="#local-6989586621679101487"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679101488"><a href="#local-6989586621679101488"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101489"><a href="#local-6989586621679101489"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101490"><a href="#local-6989586621679101490"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-470"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621679101488"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679101487"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><a href="#local-6989586621679101488"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101489"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101489"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><a href="#local-6989586621679101491"><span class="hs-identifier hs-var">siblingTree</span></a><span>
</span><a name="line-471"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101491"><span class="hs-identifier hs-var">siblingTree</span></a><span>
</span><a name="line-472"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679101491"><a href="#local-6989586621679101491"><span class="hs-identifier">siblingTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier hs-var">testTree</span></a><span> </span><a href="#local-6989586621679101487"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679101488"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101490"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">]</span><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span class="hs-comment">-- Both children and siblings: If x is good, make a node and follow both</span><span>
</span><a name="line-475"></a><span class="hs-comment">-- children (compare to x) and siblings. Compare siblings to the parent of x.</span><span>
</span><a name="line-476"></a><span class="hs-identifier">testTree</span><span> </span><a name="local-6989586621679101492"><a href="#local-6989586621679101492"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679101493"><a href="#local-6989586621679101493"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101494"><a href="#local-6989586621679101494"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101495"><a href="#local-6989586621679101495"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101496"><a href="#local-6989586621679101496"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-477"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621679101493"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679101492"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><a href="#local-6989586621679101493"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101494"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101494"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679101497"><span class="hs-identifier hs-var">childTree</span></a><span> </span><a href="#local-6989586621679101498"><span class="hs-identifier hs-var">siblingTree</span></a><span>
</span><a name="line-478"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101498"><span class="hs-identifier hs-var">siblingTree</span></a><span>
</span><a name="line-479"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-480"></a><span>        </span><a name="local-6989586621679101497"><a href="#local-6989586621679101497"><span class="hs-identifier">childTree</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier hs-var">testTree</span></a><span> </span><a href="#local-6989586621679101492"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679101494"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101496"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-481"></a><span>        </span><a name="local-6989586621679101498"><a href="#local-6989586621679101498"><span class="hs-identifier">siblingTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier hs-var">testTree</span></a><span> </span><a href="#local-6989586621679101492"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679101493"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679101495"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679101496"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-482"></a><span>
</span><a name="line-483"></a><span class="hs-comment">-- ** Traversal</span><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-comment">-- | Make a list of all good paths in an LCRS tree. If no good paths are</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- found, the result will be @[]@.</span><span>
</span><a name="line-487"></a><span class="hs-identifier">paths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679101387"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ accumulator list</span><span>
</span><a name="line-488"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="#local-6989586621679101387"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-489"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679101387"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-490"></a><a name="paths"><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier">paths</span></a></a><span> </span><a name="local-6989586621679101499"><a href="#local-6989586621679101499"><span class="hs-identifier">xs</span></a></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679101499"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-491"></a><span class="hs-identifier">paths</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679101500"><a href="#local-6989586621679101500"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679101501"><a href="#local-6989586621679101501"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679101502"><a href="#local-6989586621679101502"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679101500"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679101501"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679101502"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-492"></a><span class="hs-identifier">paths</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101503"><a href="#local-6989586621679101503"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101504"><a href="#local-6989586621679101504"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101505"><a href="#local-6989586621679101505"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679101506"><a href="#local-6989586621679101506"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679101507"><a href="#local-6989586621679101507"><span class="hs-identifier">l</span></a></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679101506"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101503"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101504"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679101505"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101507"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-493"></a><span class="hs-identifier">paths</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101508"><a href="#local-6989586621679101508"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101509"><a href="#local-6989586621679101509"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101510"><a href="#local-6989586621679101510"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679101511"><a href="#local-6989586621679101511"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679101512"><a href="#local-6989586621679101512"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679101513"><a href="#local-6989586621679101513"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679101511"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101508"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101509"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679101510"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101512"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679101508"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101509"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679101510"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101513"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-494"></a><span>
</span><a name="line-495"></a><span class="hs-comment">-- ** Test the paths</span><span>
</span><a name="line-496"></a><span class="hs-comment">-- | Are all the elements of a list the same length?</span><span>
</span><a name="line-497"></a><span class="hs-identifier">sameLengths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679101386"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-498"></a><a name="sameLengths"><a href="Cogito.Musarithmetic.html#sameLengths"><span class="hs-identifier">sameLengths</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-499"></a><span class="hs-identifier">sameLengths</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679101514"><a href="#local-6989586621679101514"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101515"><a href="#local-6989586621679101515"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679101514"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679101515"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-500"></a><span>
</span><a name="line-501"></a><span class="hs-comment">-- | Prune out paths that are shorter than the original list of items. If none</span><span>
</span><a name="line-502"></a><span class="hs-comment">-- are left after pruning (no viable paths), return 'Nothing'.</span><span>
</span><a name="line-503"></a><span class="hs-identifier">fullPaths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101384"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ list of items to permute</span><span>
</span><a name="line-504"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679101385"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ list of permutations</span><span>
</span><a name="line-505"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679101385"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-506"></a><a name="fullPaths"><a href="Cogito.Musarithmetic.html#fullPaths"><span class="hs-identifier">fullPaths</span></a></a><span> </span><a name="local-6989586621679101516"><a href="#local-6989586621679101516"><span class="hs-identifier">items</span></a></a><span> </span><a name="local-6989586621679101517"><a href="#local-6989586621679101517"><span class="hs-identifier">options</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679101518"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-507"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679101518"><span class="hs-identifier hs-var">paths</span></a><span>
</span><a name="line-508"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679101518"><a href="#local-6989586621679101518"><span class="hs-identifier">paths</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679101516"><span class="hs-identifier hs-var">items</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">length</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101517"><span class="hs-identifier hs-var">options</span></a><span>
</span><a name="line-509"></a><span>
</span><a name="line-510"></a><span class="hs-comment">-- ** Score a path for \&quot;badness\&quot; of different kinds</span><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span class="hs-comment">-- | The ambitus is the widest range of pitches used; the difference between</span><span>
</span><a name="line-513"></a><span class="hs-comment">-- the highest and lowest pitches. Ignore rests.</span><span>
</span><a name="line-514"></a><span class="hs-identifier">ambitus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-515"></a><a name="ambitus"><a href="Cogito.Musarithmetic.html#ambitus"><span class="hs-identifier">ambitus</span></a></a><span> </span><a name="local-6989586621679101519"><a href="#local-6989586621679101519"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maximum</span><span> </span><a href="#local-6989586621679101520"><span class="hs-identifier hs-var">aps</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">minimum</span><span> </span><a href="#local-6989586621679101520"><span class="hs-identifier hs-var">aps</span></a><span>
</span><a name="line-516"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679101520"><a href="#local-6989586621679101520"><span class="hs-identifier">aps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Cogito.Musarithmetic.html#absPitch7"><span class="hs-identifier hs-var">absPitch7</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101519"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-517"></a><span>
</span><a name="line-518"></a><span class="hs-comment">-- | Calculate and list intervals between pitches in a list. The list will be</span><span>
</span><a name="line-519"></a><span class="hs-comment">-- one item shorter than the list of inputs.</span><span>
</span><a name="line-520"></a><span class="hs-identifier">intervals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>
</span><a name="line-521"></a><a name="intervals"><a href="Cogito.Musarithmetic.html#intervals"><span class="hs-identifier">intervals</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679101521"><a href="#local-6989586621679101521"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-522"></a><span class="hs-identifier">intervals</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679101522"><a href="#local-6989586621679101522"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101523"><a href="#local-6989586621679101523"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier hs-var">absInterval</span></a><span> </span><a href="#local-6989586621679101522"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679101523"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-523"></a><span class="hs-identifier">intervals</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679101524"><a href="#local-6989586621679101524"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101525"><a href="#local-6989586621679101525"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101526"><a href="#local-6989586621679101526"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier hs-var">absInterval</span></a><span> </span><a href="#local-6989586621679101524"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679101525"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679101525"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101526"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-524"></a><span>
</span><a name="line-525"></a><span class="hs-comment">-- | Add up all the intervals larger than a fourth (where p7diff &gt; 3 with</span><span>
</span><a name="line-526"></a><span class="hs-comment">-- 0-indexed intervals).</span><span>
</span><a name="line-527"></a><span class="hs-identifier">sumBigIntervals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-528"></a><a name="sumBigIntervals"><a href="Cogito.Musarithmetic.html#sumBigIntervals"><span class="hs-identifier">sumBigIntervals</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.Musarithmetic.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span class="hs-comment">-- | Find all the pitches that exceed a given range, and add up the interval</span><span>
</span><a name="line-531"></a><span class="hs-comment">-- by which they go above or below the limits.</span><span>
</span><a name="line-532"></a><span class="hs-identifier">sumBeyondRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-533"></a><a name="sumBeyondRange"><a href="Cogito.Musarithmetic.html#sumBeyondRange"><span class="hs-identifier">sumBeyondRange</span></a></a><span> </span><a name="local-6989586621679101527"><a href="#local-6989586621679101527"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101528"><a href="#local-6989586621679101528"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101532"><span class="hs-identifier hs-var">highDegrees</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679101533"><span class="hs-identifier hs-var">lowDegrees</span></a><span class="hs-special">]</span><span>
</span><a name="line-534"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-535"></a><span>        </span><a name="local-6989586621679101529"><a href="#local-6989586621679101529"><span class="hs-identifier">pitches</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101528"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-536"></a><span>        </span><a name="local-6989586621679101530"><a href="#local-6989586621679101530"><span class="hs-identifier">highs</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#pitchTooHigh"><span class="hs-identifier hs-var">pitchTooHigh</span></a><span> </span><a href="#local-6989586621679101527"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101529"><span class="hs-identifier hs-var">pitches</span></a><span>
</span><a name="line-537"></a><span>        </span><a name="local-6989586621679101531"><a href="#local-6989586621679101531"><span class="hs-identifier">lows</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#pitchTooLow"><span class="hs-identifier hs-var">pitchTooLow</span></a><span> </span><a href="#local-6989586621679101527"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101529"><span class="hs-identifier hs-var">pitches</span></a><span>
</span><a name="line-538"></a><span>        </span><a name="local-6989586621679101532"><a href="#local-6989586621679101532"><span class="hs-identifier">highDegrees</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679101534"><a href="#local-6989586621679101534"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier hs-var">absInterval</span></a><span> </span><a href="#local-6989586621679101534"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">high</span><span> </span><a href="#local-6989586621679101527"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101530"><span class="hs-identifier hs-var">highs</span></a><span>
</span><a name="line-539"></a><span>        </span><a name="local-6989586621679101533"><a href="#local-6989586621679101533"><span class="hs-identifier">lowDegrees</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679101535"><a href="#local-6989586621679101535"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier hs-var">absInterval</span></a><span> </span><a href="#local-6989586621679101535"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">low</span><span> </span><a href="#local-6989586621679101527"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101531"><span class="hs-identifier hs-var">lows</span></a><span>
</span><a name="line-540"></a><span>
</span><a name="line-541"></a><span class="hs-comment">-- | Calculate weighted &quot;badness&quot; score for a list of pitches. Sum of ambitus,</span><span>
</span><a name="line-542"></a><span class="hs-comment">-- sum of large intervals (x 2), sum of degrees of notes out of range (x 10).</span><span>
</span><a name="line-543"></a><span class="hs-identifier">badness</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-544"></a><a name="badness"><a href="Cogito.Musarithmetic.html#badness"><span class="hs-identifier">badness</span></a></a><span> </span><a name="local-6989586621679101536"><a href="#local-6989586621679101536"><span class="hs-identifier">range</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;No paths found to test!&quot;</span><span>
</span><a name="line-545"></a><span class="hs-identifier">badness</span><span> </span><a name="local-6989586621679101537"><a href="#local-6989586621679101537"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101538"><a href="#local-6989586621679101538"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><span> </span><a href="Cogito.Musarithmetic.html#ambitus"><span class="hs-identifier hs-var">ambitus</span></a><span> </span><a href="#local-6989586621679101538"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-546"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#sumBigIntervals"><span class="hs-identifier hs-var">sumBigIntervals</span></a><span> </span><a href="#local-6989586621679101538"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-547"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#sumBeyondRange"><span class="hs-identifier hs-var">sumBeyondRange</span></a><span> </span><a href="#local-6989586621679101537"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101538"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-548"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-549"></a><span>
</span><a name="line-550"></a><span class="hs-comment">-- | Find the best path (first with lowest &quot;badness&quot;), or raise error if none</span><span>
</span><a name="line-551"></a><span class="hs-comment">-- found</span><span>
</span><a name="line-552"></a><span class="hs-identifier">bestPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-553"></a><a name="bestPath"><a href="Cogito.Musarithmetic.html#bestPath"><span class="hs-identifier">bestPath</span></a></a><span> </span><a name="local-6989586621679101539"><a href="#local-6989586621679101539"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101540"><a href="#local-6989586621679101540"><span class="hs-identifier">pnames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;No path found&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-554"></a><span>                              </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#leastBadPath"><span class="hs-identifier hs-var">leastBadPath</span></a><span> </span><a href="#local-6989586621679101539"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.Musarithmetic.html#fullPaths"><span class="hs-identifier hs-var">fullPaths</span></a><span> </span><a href="#local-6989586621679101540"><span class="hs-identifier hs-var">pnames</span></a><span>
</span><a name="line-555"></a><span>
</span><a name="line-556"></a><span class="hs-comment">-- | Choose the path with the lowest &quot;badness&quot;; if there are multiple with the</span><span>
</span><a name="line-557"></a><span class="hs-comment">-- same score, choose the first</span><span>
</span><a name="line-558"></a><span class="hs-identifier">leastBadPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-559"></a><a name="leastBadPath"><a href="Cogito.Musarithmetic.html#leastBadPath"><span class="hs-identifier">leastBadPath</span></a></a><span> </span><a name="local-6989586621679101541"><a href="#local-6989586621679101541"><span class="hs-identifier">range</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">minimumBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#badness"><span class="hs-identifier hs-var">badness</span></a><span> </span><a href="#local-6989586621679101541"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-560"></a><span>
</span><a name="line-561"></a><span class="hs-comment">-- ** Synthetic functions pulling together the above</span><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span class="hs-comment">-- | Build a tree of all pitch sequences with appropriate leaps</span><span>
</span><a name="line-564"></a><span class="hs-identifier">stepwiseTree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-565"></a><a name="stepwiseTree"><a href="Cogito.Musarithmetic.html#stepwiseTree"><span class="hs-identifier">stepwiseTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier hs-var">testTree</span></a><span> </span><a href="Cogito.Musarithmetic.html#legalLeap"><span class="hs-identifier hs-var">legalLeap</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-566"></a><span>
</span><a name="line-567"></a><span class="hs-comment">-- | Find a melody for a voice with an optimal blend of avoiding bad leaps and</span><span>
</span><a name="line-568"></a><span class="hs-comment">-- staying within range. This is the main function used in @Cogito@.</span><span>
</span><a name="line-569"></a><span class="hs-comment">--</span><span>
</span><a name="line-570"></a><span class="hs-comment">-- Avoid large or illegal leaps and stay as much in range</span><span>
</span><a name="line-571"></a><span class="hs-comment">-- as possible. For example,</span><span>
</span><a name="line-572"></a><span class="hs-comment">-- some melodies have long stepwise ascents or descents which, in certain</span><span>
</span><a name="line-573"></a><span class="hs-comment">-- tones, will take the voice out of range, and if we adjust them in the</span><span>
</span><a name="line-574"></a><span class="hs-comment">-- middle, we will get an illegal seventh interval. </span><span>
</span><a name="line-575"></a><span class="hs-comment">--</span><span>
</span><a name="line-576"></a><span class="hs-comment">-- We build a list of candidate pitches within the range, then we build a tree</span><span>
</span><a name="line-577"></a><span class="hs-comment">-- of the ordered permutations of those pitches and test the paths according</span><span>
</span><a name="line-578"></a><span class="hs-comment">-- to a subjective &quot;badness&quot; rating, including the ambitus or total range of</span><span>
</span><a name="line-579"></a><span class="hs-comment">-- highest to lowest notes, the number and size of large intervals, and the</span><span>
</span><a name="line-580"></a><span class="hs-comment">-- number of notes out of range (and how much out of range they are). The</span><span>
</span><a name="line-581"></a><span class="hs-comment">-- first path with the lowest score wins.</span><span>
</span><a name="line-582"></a><span class="hs-identifier">stepwiseVoiceInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>
</span><a name="line-583"></a><a name="stepwiseVoiceInRange"><a href="Cogito.Musarithmetic.html#stepwiseVoiceInRange"><span class="hs-identifier">stepwiseVoiceInRange</span></a></a><span> </span><a name="local-6989586621679101542"><a href="#local-6989586621679101542"><span class="hs-identifier">ranges</span></a></a><span> </span><a name="local-6989586621679101543"><a href="#local-6989586621679101543"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-var">Voice</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-584"></a><span>    </span><span class="hs-identifier">voiceID</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679101543"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span>
</span><a name="line-585"></a><span>    </span><span class="hs-identifier">music</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101548"><span class="hs-identifier hs-var">adjust</span></a><span>
</span><a name="line-586"></a><span class="hs-special">}</span><span>
</span><a name="line-587"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-588"></a><span>        </span><a name="local-6989586621679101544"><a href="#local-6989586621679101544"><span class="hs-identifier">pitches</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679101543"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-589"></a><span>        </span><a name="local-6989586621679101545"><a href="#local-6989586621679101545"><span class="hs-identifier">range</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getRange"><span class="hs-identifier hs-var">getRange</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679101543"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101542"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-590"></a><span>        </span><a name="local-6989586621679101546"><a href="#local-6989586621679101546"><span class="hs-identifier">candidates</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchCandidates"><span class="hs-identifier hs-var">pitchCandidates</span></a><span> </span><a href="#local-6989586621679101545"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101544"><span class="hs-identifier hs-var">pitches</span></a><span>
</span><a name="line-591"></a><span>        </span><a name="local-6989586621679101547"><a href="#local-6989586621679101547"><span class="hs-identifier">options</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#stepwiseTree"><span class="hs-identifier hs-var">stepwiseTree</span></a><span> </span><a href="#local-6989586621679101546"><span class="hs-identifier hs-var">candidates</span></a><span>
</span><a name="line-592"></a><span>        </span><a name="local-6989586621679101548"><a href="#local-6989586621679101548"><span class="hs-identifier">adjust</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#bestPath"><span class="hs-identifier hs-var">bestPath</span></a><span> </span><a href="#local-6989586621679101545"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101544"><span class="hs-identifier hs-var">pitches</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679101547"><span class="hs-identifier hs-var">options</span></a><span>
</span><a name="line-593"></a><span>
</span><a name="line-594"></a><span>
</span><a name="line-595"></a></pre></body></html>