<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : Cogito.Musarithmetic
Description : Data structures and functions to adjust and store the ark's music output
Copyright   : (c) Andrew A. Cashner 2021
Maintainer  : Andrew Cashner, &lt;andrew.cashner@rochester.edu&gt;
Stability   : Experimental

This module provides the tools used in the main @Cogito@ module to adjust
music created by the ark and to store it in internal structures that will then
be used by the @Scribo@ modules.

The `stepwiseVoiceInRange` function tests all the possible permutations of
octaves for the pitches in a phrase and finds the best path, with the minimum
of large leaps and notes out of range.
-}</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cogito.Musarithmetic</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>
</span><a name="line-20"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">minimumBy</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-23"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span>
</span><a name="line-24"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span>
</span><a name="line-25"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">maybe</span><span>
</span><a name="line-26"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Function</span><span>
</span><a name="line-29"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">on</span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="Aedifico.html"><span class="hs-identifier">Aedifico</span></a><span>
</span><a name="line-32"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Aedifico.html#Accid"><span class="hs-identifier hs-type">Accid</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#AccidType"><span class="hs-identifier hs-type">AccidType</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Arca"><span class="hs-identifier hs-type">Arca</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ModeList"><span class="hs-identifier hs-type">ModeList</span></a><span>
</span><a name="line-39"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span>
</span><a name="line-40"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Octave"><span class="hs-identifier hs-type">Octave</span></a><span>       </span><span class="hs-special">(</span><a href="Aedifico.html#OctNil"><span class="hs-identifier hs-var">OctNil</span></a><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Pnum"><span class="hs-identifier hs-type">Pnum</span></a><span>         </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#System"><span class="hs-identifier hs-type">System</span></a><span>       </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span>   </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#TextMeter"><span class="hs-identifier hs-type">TextMeter</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#PnumAccid"><span class="hs-identifier hs-type">PnumAccid</span></a><span>
</span><a name="line-49"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#getRange"><span class="hs-identifier hs-var">getRange</span></a><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#simplePitch"><span class="hs-identifier hs-var">simplePitch</span></a><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Aedifico.html#modeOrModeB"><span class="hs-identifier hs-var">modeOrModeB</span></a><span>
</span><a name="line-53"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-comment">-- * Data structures</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">-- ** For storing and adjusting pitches and rhythms, not including the sung text</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-comment">-- | A 'Voice' is a list of pitches with an identifier for the voice type.</span><span>
</span><a name="line-60"></a><span class="hs-keyword">data</span><span> </span><a name="Voice"><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier">Voice</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Voice"><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier">Voice</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-61"></a><span>    </span><a name="voiceID"><a href="Cogito.Musarithmetic.html#voiceID"><span class="hs-identifier">voiceID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Enum for Soprano, Alto, Tenor or Bass</span><span>
</span><a name="line-62"></a><span>    </span><a name="music"><a href="Cogito.Musarithmetic.html#music"><span class="hs-identifier">music</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-63"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">-- | A 'Chorus' is a group (list) of four 'Voice' items</span><span>
</span><a name="line-66"></a><span class="hs-comment">--</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- __TODO__: We don't actually define it as being four items.</span><span>
</span><a name="line-68"></a><span class="hs-comment">-- __TODO__: Do we still need this with new MEI setup?</span><span>
</span><a name="line-69"></a><span class="hs-keyword">type</span><span> </span><a name="Chorus"><a href="Cogito.Musarithmetic.html#Chorus"><span class="hs-identifier">Chorus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span class="hs-special">]</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-comment">-- ** For storing music including the sung text</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- | A 'Note' contains a pitch and a syllable, equivalent to MEI @note@</span><span>
</span><a name="line-74"></a><span class="hs-keyword">data</span><span> </span><a name="Note"><a href="Cogito.Musarithmetic.html#Note"><span class="hs-identifier">Note</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Note"><a href="Cogito.Musarithmetic.html#Note"><span class="hs-identifier">Note</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-75"></a><span>    </span><a name="notePitch"><a href="Cogito.Musarithmetic.html#notePitch"><span class="hs-identifier">notePitch</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>    </span><a name="noteSyllable"><a href="Cogito.Musarithmetic.html#noteSyllable"><span class="hs-identifier">noteSyllable</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier hs-type">Syllable</span></a><span>
</span><a name="line-77"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">-- | A 'Syllable' is a single syllable to be paired with a 'Pitch', including</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- its position in the word.</span><span>
</span><a name="line-81"></a><span class="hs-keyword">data</span><span> </span><a name="Syllable"><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier">Syllable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Syllable"><a href="Cogito.Musarithmetic.html#Syllable"><span class="hs-identifier">Syllable</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-82"></a><span>    </span><a name="sylText"><a href="Cogito.Musarithmetic.html#sylText"><span class="hs-identifier">sylText</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>    </span><a name="sylPosition"><a href="Cogito.Musarithmetic.html#sylPosition"><span class="hs-identifier">sylPosition</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#SyllablePosition"><span class="hs-identifier hs-type">SyllablePosition</span></a><span>
</span><a name="line-84"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-comment">-- | What is the position of the syllable relative to the word? Beginning,</span><span>
</span><a name="line-87"></a><span class="hs-comment">-- middle, or end? This determines hyphenation.</span><span>
</span><a name="line-88"></a><span class="hs-keyword">data</span><span> </span><a name="SyllablePosition"><a href="Cogito.Musarithmetic.html#SyllablePosition"><span class="hs-identifier">SyllablePosition</span></a></a><span> </span><span class="hs-glyph">=</span><span>   </span><a name="First"><a href="Cogito.Musarithmetic.html#First"><span class="hs-identifier">First</span></a></a><span>
</span><a name="line-89"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Middle"><a href="Cogito.Musarithmetic.html#Middle"><span class="hs-identifier">Middle</span></a></a><span>
</span><a name="line-90"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Last"><a href="Cogito.Musarithmetic.html#Last"><span class="hs-identifier">Last</span></a></a><span>
</span><a name="line-91"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Only"><a href="Cogito.Musarithmetic.html#Only"><span class="hs-identifier">Only</span></a></a><span>
</span><a name="line-92"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><a name="Tacet"><a href="Cogito.Musarithmetic.html#Tacet"><span class="hs-identifier">Tacet</span></a></a><span> </span><span class="hs-comment">-- ^ no syllable</span><span>
</span><a name="line-93"></a><span>                        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | A 'MusicPhrase' contains all the notes set using one permutation drawn</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- from the ark, for a single voice.</span><span>
</span><a name="line-97"></a><span class="hs-keyword">data</span><span> </span><a name="MusicPhrase"><a href="Cogito.Musarithmetic.html#MusicPhrase"><span class="hs-identifier">MusicPhrase</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MusicPhrase"><a href="Cogito.Musarithmetic.html#MusicPhrase"><span class="hs-identifier">MusicPhrase</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-98"></a><span>    </span><a name="phraseVoiceID"><a href="Cogito.Musarithmetic.html#phraseVoiceID"><span class="hs-identifier">phraseVoiceID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>    </span><a name="notes"><a href="Cogito.Musarithmetic.html#notes"><span class="hs-identifier">notes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#Note"><span class="hs-identifier hs-type">Note</span></a><span class="hs-special">]</span><span>
</span><a name="line-100"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-comment">-- | A list of 'MusicPhrase' items</span><span>
</span><a name="line-103"></a><span class="hs-keyword">type</span><span> </span><a name="MusicSentence"><a href="Cogito.Musarithmetic.html#MusicSentence"><span class="hs-identifier">MusicSentence</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#MusicPhrase"><span class="hs-identifier hs-type">MusicPhrase</span></a><span class="hs-special">]</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-comment">-- | A 'MusicSection' contains all the music for one section in the input XML</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- document, for a single voice, together with the parameters set in the input</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- file.</span><span>
</span><a name="line-108"></a><span class="hs-keyword">data</span><span> </span><a name="MusicSection"><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier">MusicSection</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MusicSection"><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier">MusicSection</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-109"></a><span>    </span><a name="secVoiceID"><a href="Cogito.Musarithmetic.html#secVoiceID"><span class="hs-identifier">secVoiceID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceName"><span class="hs-identifier hs-type">VoiceName</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>    </span><a name="secConfig"><a href="Cogito.Musarithmetic.html#secConfig"><span class="hs-identifier">secConfig</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#ArkConfig"><span class="hs-identifier hs-type">ArkConfig</span></a><span class="hs-special">,</span><span>
</span><a name="line-111"></a><span>    </span><a name="secSentences"><a href="Cogito.Musarithmetic.html#secSentences"><span class="hs-identifier">secSentences</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#MusicSentence"><span class="hs-identifier hs-type">MusicSentence</span></a><span class="hs-special">]</span><span>
</span><a name="line-112"></a><span class="hs-special">}</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-comment">-- | A 'MusicChorus' is a four-voice SATB structure of 'MusicSection' data.</span><span>
</span><a name="line-115"></a><span class="hs-comment">-- __TODO__ do we really need it to be structured this way?</span><span>
</span><a name="line-116"></a><span class="hs-keyword">data</span><span> </span><a name="MusicChorus"><a href="Cogito.Musarithmetic.html#MusicChorus"><span class="hs-identifier">MusicChorus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MusicChorus"><a href="Cogito.Musarithmetic.html#MusicChorus"><span class="hs-identifier">MusicChorus</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-117"></a><span>    </span><a name="soprano"><a href="Cogito.Musarithmetic.html#soprano"><span class="hs-identifier">soprano</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span class="hs-special">,</span><span>
</span><a name="line-118"></a><span>    </span><a name="alto"><a href="Cogito.Musarithmetic.html#alto"><span class="hs-identifier">alto</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span class="hs-special">,</span><span>
</span><a name="line-119"></a><span>    </span><a name="tenor"><a href="Cogito.Musarithmetic.html#tenor"><span class="hs-identifier">tenor</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span class="hs-special">,</span><span>
</span><a name="line-120"></a><span>    </span><a name="bass"><a href="Cogito.Musarithmetic.html#bass"><span class="hs-identifier">bass</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Cogito.Musarithmetic.html#MusicSection"><span class="hs-identifier hs-type">MusicSection</span></a><span>
</span><a name="line-121"></a><span class="hs-special">}</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-comment">-- | The full 'MusicScore' is a list of SATB 'MusicChorus' structures.</span><span>
</span><a name="line-124"></a><span class="hs-keyword">type</span><span> </span><a name="MusicScore"><a href="Cogito.Musarithmetic.html#MusicScore"><span class="hs-identifier">MusicScore</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#MusicChorus"><span class="hs-identifier hs-type">MusicChorus</span></a><span class="hs-special">]</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">-- * Manipulating the @Pitch@</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-comment">-- | Create a rest (that is, a 'Pitch' with duration only)</span><span>
</span><a name="line-130"></a><span class="hs-comment">--</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- We make a 'Pitch' but set the 'pnum' to 'Rest'; 'oct' and 'accid' are set</span><span>
</span><a name="line-132"></a><span class="hs-comment">-- to special nil values ('OctNil', 'AccidNil')</span><span>
</span><a name="line-133"></a><span class="hs-comment">--</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- __TODO__: We are setting the octave using @fromEnum OctNil@: Isn't this the</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- same as just setting it to zero? Is there a better way to mark this?</span><span>
</span><a name="line-136"></a><span class="hs-identifier">newRest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span>      </span><span class="hs-comment">-- ^ Rhythmic duration for this note</span><span>
</span><a name="line-137"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-138"></a><a name="newRest"><a href="Cogito.Musarithmetic.html#newRest"><span class="hs-identifier">newRest</span></a></a><span> </span><a name="local-6989586621679100952"><a href="#local-6989586621679100952"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-139"></a><span>    </span><span class="hs-identifier">pnum</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Rest"><span class="hs-identifier hs-var">Rest</span></a><span class="hs-special">,</span><span>
</span><a name="line-140"></a><span>    </span><span class="hs-identifier">dur</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679100952"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><span>
</span><a name="line-141"></a><span>    </span><span class="hs-identifier">oct</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="Aedifico.html#OctNil"><span class="hs-identifier hs-var">OctNil</span></a><span class="hs-special">,</span><span>
</span><a name="line-142"></a><span>    </span><span class="hs-identifier">accid</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#AccidNil"><span class="hs-identifier hs-var">AccidNil</span></a><span class="hs-special">,</span><span>
</span><a name="line-143"></a><span>    </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#None"><span class="hs-identifier hs-var">None</span></a><span>
</span><a name="line-144"></a><span class="hs-special">}</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-comment">-- ** Adjust pitch for mode</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-comment">-- | Is a mode in /cantus mollis/? Should there be a flat in the key</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- signature?</span><span>
</span><a name="line-150"></a><span class="hs-identifier">modeMollis</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeSystem"><span class="hs-identifier hs-type">ModeSystem</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-151"></a><a name="modeMollis"><a href="Cogito.Musarithmetic.html#modeMollis"><span class="hs-identifier">modeMollis</span></a></a><span> </span><a name="local-6989586621679100953"><a href="#local-6989586621679100953"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621679100954"><a href="#local-6989586621679100954"><span class="hs-identifier">systems</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-152"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679100955"><a href="#local-6989586621679100955"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;modeMollis:systems&quot;</span><span> </span><a href="#local-6989586621679100954"><span class="hs-identifier hs-var">systems</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679100953"><span class="hs-identifier hs-var">mode</span></a><span>
</span><a name="line-153"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679100955"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-154"></a><span>        </span><a href="Aedifico.html#Durus"><span class="hs-identifier hs-var">Durus</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-155"></a><span>        </span><a href="Aedifico.html#Mollis"><span class="hs-identifier hs-var">Mollis</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">-- | Adjust a pitch to be in a given mode. </span><span>
</span><a name="line-158"></a><span class="hs-identifier">pnumAccidInMode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#ModeList"><span class="hs-identifier hs-type">ModeList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#PnumAccid"><span class="hs-identifier hs-type">PnumAccid</span></a><span>
</span><a name="line-159"></a><a name="pnumAccidInMode"><a href="Cogito.Musarithmetic.html#pnumAccidInMode"><span class="hs-identifier">pnumAccidInMode</span></a></a><span> </span><a name="local-6989586621679100956"><a href="#local-6989586621679100956"><span class="hs-identifier">rawPnum</span></a></a><span> </span><a name="local-6989586621679100957"><a href="#local-6989586621679100957"><span class="hs-identifier">modeList</span></a></a><span> </span><a name="local-6989586621679100958"><a href="#local-6989586621679100958"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679100959"><span class="hs-identifier hs-var">pnum</span></a><span>
</span><a name="line-160"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-161"></a><span>        </span><a name="local-6989586621679100959"><a href="#local-6989586621679100959"><span class="hs-identifier">pnum</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;pnumAccidInMode:pnum&quot;</span><span> </span><a href="#local-6989586621679100960"><span class="hs-identifier hs-var">modeScale</span></a><span> </span><a href="#local-6989586621679100956"><span class="hs-identifier hs-var">rawPnum</span></a><span>
</span><a name="line-162"></a><span>        </span><a name="local-6989586621679100960"><a href="#local-6989586621679100960"><span class="hs-identifier">modeScale</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;pnumAccidInMode:modeScale&quot;</span><span> </span><a href="#local-6989586621679100957"><span class="hs-identifier hs-var">modeList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679100958"><span class="hs-identifier hs-var">mode</span></a><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- | Get the modal final for this mode. What pitch = 0 in this mode? (In</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- Kircher's 1-indexed vperms, the final is 1 or 8.)</span><span>
</span><a name="line-166"></a><span class="hs-identifier">modalFinal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#ModeList"><span class="hs-identifier hs-type">ModeList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-167"></a><a name="modalFinal"><a href="Cogito.Musarithmetic.html#modalFinal"><span class="hs-identifier">modalFinal</span></a></a><span> </span><a name="local-6989586621679100961"><a href="#local-6989586621679100961"><span class="hs-identifier">modeList</span></a></a><span> </span><a name="local-6989586621679100962"><a href="#local-6989586621679100962"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#simplePitch"><span class="hs-identifier hs-var">simplePitch</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679100963"><span class="hs-identifier hs-var">pnum</span></a><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-169"></a><span>        </span><a name="local-6989586621679100963"><a href="#local-6989586621679100963"><span class="hs-identifier">pnum</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679100964"><span class="hs-identifier hs-var">finalPair</span></a><span>
</span><a name="line-170"></a><span>        </span><a name="local-6989586621679100964"><a href="#local-6989586621679100964"><span class="hs-identifier">finalPair</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;modalFinalInRange:finalPair&quot;</span><span> </span><a href="#local-6989586621679100965"><span class="hs-identifier hs-var">modeScale</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-171"></a><span>        </span><a name="local-6989586621679100965"><a href="#local-6989586621679100965"><span class="hs-identifier">modeScale</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getVectorItem"><span class="hs-identifier hs-var">getVectorItem</span></a><span> </span><span class="hs-string">&quot;modalFinalInRange:modeScale&quot;</span><span> </span><a href="#local-6989586621679100961"><span class="hs-identifier hs-var">modeList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679100962"><span class="hs-identifier hs-var">mode</span></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-comment">-- ** Check for rests</span><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span class="hs-comment">-- | Check to see if a rhythmic duration is a rest type (the rest enums begin</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- with 'LgR' so we compare with that)</span><span>
</span><a name="line-178"></a><span class="hs-identifier">isRest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Dur"><span class="hs-identifier hs-type">Dur</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-179"></a><a name="isRest"><a href="Cogito.Musarithmetic.html#isRest"><span class="hs-identifier">isRest</span></a></a><span> </span><a name="local-6989586621679100981"><a href="#local-6989586621679100981"><span class="hs-identifier">dur</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679100981"><span class="hs-identifier hs-var">dur</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="Aedifico.html#LgR"><span class="hs-identifier hs-var">LgR</span></a><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">-- | Is the 'Pitch' a rest?</span><span>
</span><a name="line-182"></a><span class="hs-identifier">isPitchRest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-183"></a><a name="isPitchRest"><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier">isPitchRest</span></a></a><span> </span><a name="local-6989586621679100982"><a href="#local-6989586621679100982"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679100982"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Aedifico.html#Rest"><span class="hs-identifier hs-var">Rest</span></a><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-comment">-- | Are any of these pitches rests?</span><span>
</span><a name="line-186"></a><span class="hs-identifier">anyRests</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-187"></a><a name="anyRests"><a href="Cogito.Musarithmetic.html#anyRests"><span class="hs-identifier">anyRests</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-comment">-- * Measure distances between notes and correct bad intervals</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">-- ** Convert between diatonic and chromatic pitches for calculations</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-comment">-- | Convert 'Pitch' to absolute pitch number, using chromatic calculations</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- (base 12). Raise an error if it is a rest.</span><span>
</span><a name="line-196"></a><span class="hs-identifier">absPitch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-197"></a><a name="absPitch"><a href="Cogito.Musarithmetic.html#absPitch"><span class="hs-identifier">absPitch</span></a></a><span> </span><a name="local-6989586621679100983"><a href="#local-6989586621679100983"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-198"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679100983"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Can\'t convert Rest to absolute pitch&quot;</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679100984"><span class="hs-identifier hs-var">oct12</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679100985"><span class="hs-identifier hs-var">pnum12</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679100986"><span class="hs-identifier hs-var">accid12</span></a><span>
</span><a name="line-200"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-201"></a><span>        </span><a name="local-6989586621679100984"><a href="#local-6989586621679100984"><span class="hs-identifier">oct12</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679100983"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">12</span><span>
</span><a name="line-202"></a><span>        </span><a name="local-6989586621679100985"><a href="#local-6989586621679100985"><span class="hs-identifier">pnum12</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#dia2chrom"><span class="hs-identifier hs-var">dia2chrom</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679100983"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-203"></a><span>        </span><a name="local-6989586621679100986"><a href="#local-6989586621679100986"><span class="hs-identifier">accid12</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679100983"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span class="hs-comment">-- | Get chromatic offset from C for diatonic pitch classes </span><span>
</span><a name="line-207"></a><span class="hs-comment">-- (@PCc -&gt; 0@, @PCd -&gt; 2@, @PCe -&gt; 4@, etc.)</span><span>
</span><a name="line-208"></a><span class="hs-identifier">dia2chrom</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pnum"><span class="hs-identifier hs-type">Pnum</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-209"></a><a name="dia2chrom"><a href="Cogito.Musarithmetic.html#dia2chrom"><span class="hs-identifier">dia2chrom</span></a></a><span> </span><a name="local-6989586621679100987"><a href="#local-6989586621679100987"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679100987"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-210"></a><span>    </span><a href="Aedifico.html#PCc"><span class="hs-identifier hs-var">PCc</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-211"></a><span>    </span><a href="Aedifico.html#PCd"><span class="hs-identifier hs-var">PCd</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-212"></a><span>    </span><a href="Aedifico.html#PCe"><span class="hs-identifier hs-var">PCe</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-213"></a><span>    </span><a href="Aedifico.html#PCf"><span class="hs-identifier hs-var">PCf</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-214"></a><span>    </span><a href="Aedifico.html#PCg"><span class="hs-identifier hs-var">PCg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-215"></a><span>    </span><a href="Aedifico.html#PCa"><span class="hs-identifier hs-var">PCa</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">9</span><span>
</span><a name="line-216"></a><span>    </span><a href="Aedifico.html#PCb"><span class="hs-identifier hs-var">PCb</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">11</span><span>
</span><a name="line-217"></a><span>    </span><a href="Aedifico.html#PCc8"><span class="hs-identifier hs-var">PCc8</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">12</span><span>
</span><a name="line-218"></a><span>    </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Unknown pitch class&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679100987"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span class="hs-comment">-- | Absolute diatonic pitch (base 7). Raise an error if it is a rest.</span><span>
</span><a name="line-221"></a><span class="hs-identifier">absPitch7</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-222"></a><a name="absPitch7"><a href="Cogito.Musarithmetic.html#absPitch7"><span class="hs-identifier">absPitch7</span></a></a><span> </span><a name="local-6989586621679100988"><a href="#local-6989586621679100988"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679100988"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;can't take absPitch7 of a rest&quot;</span><span>
</span><a name="line-223"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679100988"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">7</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679100988"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-comment">-- ** \&quot;Musarithmetic\&quot;: Differences, sums, conditionals with @Pitch@ values</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-comment">-- | Do mathematical operations on pitches (using their chromatic 'absPitch' values)</span><span>
</span><a name="line-228"></a><span class="hs-identifier">pitchMath</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-229"></a><a name="pitchMath"><a href="Cogito.Musarithmetic.html#pitchMath"><span class="hs-identifier">pitchMath</span></a></a><span> </span><a name="local-6989586621679100989"><a href="#local-6989586621679100989"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679100989"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><a href="Cogito.Musarithmetic.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-comment">-- | Do mathematical operations on pitches (using their diatonic 'absPitch7' values)</span><span>
</span><a name="line-232"></a><span class="hs-identifier">pitchMath7</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-233"></a><a name="pitchMath7"><a href="Cogito.Musarithmetic.html#pitchMath7"><span class="hs-identifier">pitchMath7</span></a></a><span> </span><a name="local-6989586621679100990"><a href="#local-6989586621679100990"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679100990"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><a href="Cogito.Musarithmetic.html#absPitch7"><span class="hs-identifier hs-var">absPitch7</span></a><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-comment">-- | Do boolean tests on pitches (using their 'absPitch values)</span><span>
</span><a name="line-236"></a><span class="hs-identifier">pitchTest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-237"></a><a name="pitchTest"><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier">pitchTest</span></a></a><span> </span><a name="local-6989586621679100991"><a href="#local-6989586621679100991"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679100991"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><a href="Cogito.Musarithmetic.html#absPitch"><span class="hs-identifier hs-var">absPitch</span></a><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-comment">-- ** Conditional tests</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">-- | Are two 'Pitch'es the same chromatic pitch, enharmonically equivalent?</span><span>
</span><a name="line-242"></a><span class="hs-identifier">pEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-243"></a><a name="pEq"><a href="Cogito.Musarithmetic.html#pEq"><span class="hs-identifier">pEq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier hs-var">pitchTest</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-comment">-- | Pitch greater than?</span><span>
</span><a name="line-246"></a><span class="hs-identifier">pGt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-247"></a><a name="pGt"><a href="Cogito.Musarithmetic.html#pGt"><span class="hs-identifier">pGt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier hs-var">pitchTest</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span class="hs-comment">-- | Pitch less than?</span><span>
</span><a name="line-250"></a><span class="hs-identifier">pLt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-251"></a><a name="pLt"><a href="Cogito.Musarithmetic.html#pLt"><span class="hs-identifier">pLt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier hs-var">pitchTest</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span class="hs-special">)</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span class="hs-comment">-- | Pitch greater than or equal?</span><span>
</span><a name="line-254"></a><a name="pGtEq"><a href="Cogito.Musarithmetic.html#pGtEq"><span class="hs-identifier">pGtEq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier hs-var">pitchTest</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=</span><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-comment">-- | Pitch less than or equal?</span><span>
</span><a name="line-257"></a><a name="pLtEq"><a href="Cogito.Musarithmetic.html#pLtEq"><span class="hs-identifier">pLtEq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTest"><span class="hs-identifier hs-var">pitchTest</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-comment">-- ** Differences, intervals</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-comment">-- | Difference between pitches, chromatic interval</span><span>
</span><a name="line-262"></a><span class="hs-identifier">p12diff</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-263"></a><a name="p12diff"><a href="Cogito.Musarithmetic.html#p12diff"><span class="hs-identifier">p12diff</span></a></a><span> </span><a name="local-6989586621679100992"><a href="#local-6989586621679100992"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679100993"><a href="#local-6989586621679100993"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#anyRests"><span class="hs-identifier hs-var">anyRests</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679100992"><span class="hs-identifier hs-var">p1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679100993"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-264"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchMath"><span class="hs-identifier hs-var">pitchMath</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679100992"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679100993"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-comment">-- | Chromatic difference between pitch classes (within one octave); 'p12diff' modulo 12</span><span>
</span><a name="line-267"></a><span class="hs-identifier">p12diffMod</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-268"></a><a name="p12diffMod"><a href="Cogito.Musarithmetic.html#p12diffMod"><span class="hs-identifier">p12diffMod</span></a></a><span> </span><a name="local-6989586621679100994"><a href="#local-6989586621679100994"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679100995"><a href="#local-6989586621679100995"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#p12diff"><span class="hs-identifier hs-var">p12diff</span></a><span> </span><a href="#local-6989586621679100994"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679100995"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">12</span><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span class="hs-comment">-- | Difference between pitches, diatonic interval</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- Unison = 0, therefore results of this function are one less than the verbal</span><span>
</span><a name="line-272"></a><span class="hs-comment">-- names of intervals (@p7diff = 4@ means a fifth)</span><span>
</span><a name="line-273"></a><span class="hs-identifier">p7diff</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-274"></a><a name="p7diff"><a href="Cogito.Musarithmetic.html#p7diff"><span class="hs-identifier">p7diff</span></a></a><span> </span><a name="local-6989586621679100996"><a href="#local-6989586621679100996"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679100997"><a href="#local-6989586621679100997"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#anyRests"><span class="hs-identifier hs-var">anyRests</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679100996"><span class="hs-identifier hs-var">p1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679100997"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-275"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchMath7"><span class="hs-identifier hs-var">pitchMath7</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679100996"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679100997"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span class="hs-comment">-- | Diatonic difference between pitch classes (= pitch difference as though</span><span>
</span><a name="line-278"></a><span class="hs-comment">-- within a single octave); result is 0-indexed, so the interval of a &quot;third&quot;</span><span>
</span><a name="line-279"></a><span class="hs-comment">-- in speech has a @p7diffMod@ of 2</span><span>
</span><a name="line-280"></a><span class="hs-identifier">p7diffMod</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-281"></a><a name="p7diffMod"><a href="Cogito.Musarithmetic.html#p7diffMod"><span class="hs-identifier">p7diffMod</span></a></a><span> </span><a name="local-6989586621679100998"><a href="#local-6989586621679100998"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679100999"><a href="#local-6989586621679100999"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#p7diff"><span class="hs-identifier hs-var">p7diff</span></a><span> </span><a href="#local-6989586621679100998"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679100999"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-comment">-- | Take the absolute value of an intervals, the difference between pitches.</span><span>
</span><a name="line-284"></a><span class="hs-comment">-- The interval between any note and a rest is zero.</span><span>
</span><a name="line-285"></a><span class="hs-identifier">absInterval</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-286"></a><a name="absInterval"><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier">absInterval</span></a></a><span> </span><a name="local-6989586621679101000"><a href="#local-6989586621679101000"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679101001"><a href="#local-6989586621679101001"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#anyRests"><span class="hs-identifier hs-var">anyRests</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101000"><span class="hs-identifier hs-var">p1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679101001"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-287"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">abs</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#p7diff"><span class="hs-identifier hs-var">p7diff</span></a><span> </span><a href="#local-6989586621679101000"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679101001"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span class="hs-comment">-- ** Change a @Pitch@ based on calculation</span><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span class="hs-comment">-- | Change the pitch class and octave of an existing 'Pitch' to that of an</span><span>
</span><a name="line-292"></a><span class="hs-comment">-- absolute diatonic pitch number. Return rests unchanged.</span><span>
</span><a name="line-293"></a><span class="hs-identifier">changePnumOctave</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-294"></a><a name="changePnumOctave"><a href="Cogito.Musarithmetic.html#changePnumOctave"><span class="hs-identifier">changePnumOctave</span></a></a><span> </span><a name="local-6989586621679101002"><a href="#local-6989586621679101002"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679101003"><a href="#local-6989586621679101003"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-295"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679101003"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101003"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-296"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-297"></a><span>        </span><span class="hs-identifier">pnum</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679101002"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">7</span><span class="hs-special">,</span><span>
</span><a name="line-298"></a><span>        </span><span class="hs-identifier">oct</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101002"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">7</span><span class="hs-special">,</span><span>
</span><a name="line-299"></a><span>        </span><span class="hs-identifier">dur</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dur</span><span> </span><a href="#local-6989586621679101003"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-300"></a><span>        </span><span class="hs-identifier">accid</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679101003"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-301"></a><span>        </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accidType</span><span> </span><a href="#local-6989586621679101003"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-302"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">-- *** Operate on pitch class and octave</span><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span class="hs-comment">-- | Increase a pitch diatonically by a given interval (0-indexed diatonic,</span><span>
</span><a name="line-307"></a><span class="hs-comment">-- e.g., @p7inc p 4@ raises @p@ by a diatonic third). Return rests unchanged.</span><span>
</span><a name="line-308"></a><span class="hs-identifier">p7inc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-309"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ diatonic interval, 0-indexed</span><span>
</span><a name="line-310"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-311"></a><a name="p7inc"><a href="Cogito.Musarithmetic.html#p7inc"><span class="hs-identifier">p7inc</span></a></a><span> </span><a name="local-6989586621679101004"><a href="#local-6989586621679101004"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679101005"><a href="#local-6989586621679101005"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679101004"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101004"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-312"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#changePnumOctave"><span class="hs-identifier hs-var">changePnumOctave</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679101005"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="Cogito.Musarithmetic.html#absPitch7"><span class="hs-identifier hs-var">absPitch7</span></a><span> </span><a href="#local-6989586621679101004"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101004"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span class="hs-comment">-- *** Operate on octave alone</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span class="hs-comment">-- | Just change the octave to a given number, no calculation required</span><span>
</span><a name="line-317"></a><span class="hs-identifier">octaveChange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-318"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Helmholtz octave number</span><span>
</span><a name="line-319"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-320"></a><a name="octaveChange"><a href="Cogito.Musarithmetic.html#octaveChange"><span class="hs-identifier">octaveChange</span></a></a><span> </span><a name="local-6989586621679101006"><a href="#local-6989586621679101006"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679101007"><a href="#local-6989586621679101007"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-var">Pitch</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-321"></a><span>    </span><span class="hs-identifier">pnum</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pnum</span><span> </span><a href="#local-6989586621679101006"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-322"></a><span>    </span><span class="hs-identifier">oct</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101007"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span>
</span><a name="line-323"></a><span>    </span><span class="hs-identifier">dur</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dur</span><span> </span><a href="#local-6989586621679101006"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-324"></a><span>    </span><span class="hs-identifier">accid</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accid</span><span> </span><a href="#local-6989586621679101006"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><span>
</span><a name="line-325"></a><span>    </span><span class="hs-identifier">accidType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">accidType</span><span> </span><a href="#local-6989586621679101006"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-326"></a><span class="hs-special">}</span><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span class="hs-comment">-- | Increase the octave number by the given amount</span><span>
</span><a name="line-329"></a><span class="hs-identifier">octaveInc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-330"></a><a name="octaveInc"><a href="Cogito.Musarithmetic.html#octaveInc"><span class="hs-identifier">octaveInc</span></a></a><span> </span><a name="local-6989586621679101008"><a href="#local-6989586621679101008"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679101009"><a href="#local-6989586621679101009"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#octaveChange"><span class="hs-identifier hs-var">octaveChange</span></a><span> </span><a href="#local-6989586621679101008"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">oct</span><span> </span><a href="#local-6989586621679101008"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679101009"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-comment">-- | Raise the octave by 1</span><span>
</span><a name="line-333"></a><span class="hs-identifier">octaveUp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-334"></a><a name="octaveUp"><a href="Cogito.Musarithmetic.html#octaveUp"><span class="hs-identifier">octaveUp</span></a></a><span> </span><a name="local-6989586621679101010"><a href="#local-6989586621679101010"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101010"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#octaveInc"><span class="hs-identifier hs-var">octaveInc</span></a><span class="hs-special">`</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-comment">-- | Lower the octave by 1</span><span>
</span><a name="line-337"></a><span class="hs-identifier">octaveDown</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-338"></a><a name="octaveDown"><a href="Cogito.Musarithmetic.html#octaveDown"><span class="hs-identifier">octaveDown</span></a></a><span> </span><a name="local-6989586621679101011"><a href="#local-6989586621679101011"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101011"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#octaveInc"><span class="hs-identifier hs-var">octaveInc</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>
</span><a name="line-340"></a><span class="hs-comment">-- ** Test a @Pitch@ relative to a @VoiceRange@</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-comment">-- | Is the pitch below the bottom limit of the voice range?</span><span>
</span><a name="line-343"></a><span class="hs-identifier">pitchTooLow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-344"></a><a name="pitchTooLow"><a href="Cogito.Musarithmetic.html#pitchTooLow"><span class="hs-identifier">pitchTooLow</span></a></a><span> </span><a name="local-6989586621679101012"><a href="#local-6989586621679101012"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101013"><a href="#local-6989586621679101013"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101013"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#pLt"><span class="hs-identifier hs-var">pLt</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">low</span><span> </span><a href="#local-6989586621679101012"><span class="hs-identifier hs-var">range</span></a><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span class="hs-comment">-- | Is the pitch above the upper limit of the voice range?</span><span>
</span><a name="line-347"></a><span class="hs-identifier">pitchTooHigh</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-348"></a><a name="pitchTooHigh"><a href="Cogito.Musarithmetic.html#pitchTooHigh"><span class="hs-identifier">pitchTooHigh</span></a></a><span> </span><a name="local-6989586621679101014"><a href="#local-6989586621679101014"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101015"><a href="#local-6989586621679101015"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101015"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#pGt"><span class="hs-identifier hs-var">pGt</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">high</span><span> </span><a href="#local-6989586621679101014"><span class="hs-identifier hs-var">range</span></a><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span class="hs-comment">-- | Is the 'Pitch' within the proper range for its voice? Rests automatically</span><span>
</span><a name="line-351"></a><span class="hs-comment">-- count as valid.</span><span>
</span><a name="line-352"></a><span class="hs-identifier">pitchInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-353"></a><a name="pitchInRange"><a href="Cogito.Musarithmetic.html#pitchInRange"><span class="hs-identifier">pitchInRange</span></a></a><span> </span><a name="local-6989586621679101016"><a href="#local-6989586621679101016"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101017"><a href="#local-6989586621679101017"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span> </span><a href="#local-6989586621679101017"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-354"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTooLow"><span class="hs-identifier hs-var">pitchTooLow</span></a><span> </span><a href="#local-6989586621679101016"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101017"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTooHigh"><span class="hs-identifier hs-var">pitchTooHigh</span></a><span> </span><a href="#local-6989586621679101016"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101017"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-355"></a><span>
</span><a name="line-356"></a><span class="hs-comment">-- | Is this an acceptable leap? Only intervals up to a sixth, or an octave are</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- okay. If either note is a rest, then that also passes the test.</span><span>
</span><a name="line-358"></a><span class="hs-comment">--</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- TODO: Ignoring rests like this is a bit of a cop-out, but Kircher usually</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- puts rests at the beginning of a phrase, so they affect the interval</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- /between/ phrases, which we are not adjusting anyway. In an ideal scenario,</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- we would.</span><span>
</span><a name="line-363"></a><span class="hs-identifier">legalLeap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-364"></a><a name="legalLeap"><a href="Cogito.Musarithmetic.html#legalLeap"><span class="hs-identifier">legalLeap</span></a></a><span> </span><a name="local-6989586621679101018"><a href="#local-6989586621679101018"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621679101019"><a href="#local-6989586621679101019"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#anyRests"><span class="hs-identifier hs-var">anyRests</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101018"><span class="hs-identifier hs-var">p1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679101019"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-365"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101020"><span class="hs-identifier hs-var">diff</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">7</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679101020"><span class="hs-identifier hs-var">diff</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-366"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679101020"><a href="#local-6989586621679101020"><span class="hs-identifier">diff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier hs-var">absInterval</span></a><span> </span><a href="#local-6989586621679101018"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679101019"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-367"></a><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-comment">-- * Find an optimal version of the melody for a particular voice </span><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-comment">-- ** Make lists of pitches in range</span><span>
</span><a name="line-372"></a><span>
</span><a name="line-373"></a><span class="hs-comment">-- | Find the lowest valid instance of a given 'Pitch' within the</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- 'VoiceRange'. This is used to calculate an optimal path through the</span><span>
</span><a name="line-375"></a><span class="hs-comment">-- possible pitches in a phrase, and means that in most cases the melody will</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- end up in the lower end of the voice's range.</span><span>
</span><a name="line-377"></a><span class="hs-identifier">lowestInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-378"></a><a name="lowestInRange"><a href="Cogito.Musarithmetic.html#lowestInRange"><span class="hs-identifier">lowestInRange</span></a></a><span> </span><a name="local-6989586621679101021"><a href="#local-6989586621679101021"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101022"><a href="#local-6989586621679101022"><span class="hs-identifier">p</span></a></a><span>
</span><a name="line-379"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#pitchInRange"><span class="hs-identifier hs-var">pitchInRange</span></a><span> </span><a href="#local-6989586621679101021"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101022"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101022"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-380"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Cogito.Musarithmetic.html#pitchTooLow"><span class="hs-identifier hs-var">pitchTooLow</span></a><span>    </span><a href="#local-6989586621679101021"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101022"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#lowestInRange"><span class="hs-identifier hs-var">lowestInRange</span></a><span> </span><a href="#local-6989586621679101021"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#octaveUp"><span class="hs-identifier hs-var">octaveUp</span></a><span> </span><a href="#local-6989586621679101022"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-381"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#lowestInRange"><span class="hs-identifier hs-var">lowestInRange</span></a><span> </span><a href="#local-6989586621679101021"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#octaveChange"><span class="hs-identifier hs-var">octaveChange</span></a><span> </span><a href="#local-6989586621679101022"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">oct</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">low</span><span> </span><a href="#local-6989586621679101021"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-comment">-- | List all the octaves within a voice range.</span><span>
</span><a name="line-384"></a><span class="hs-identifier">octavesInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>
</span><a name="line-385"></a><a name="octavesInRange"><a href="Cogito.Musarithmetic.html#octavesInRange"><span class="hs-identifier">octavesInRange</span></a></a><span> </span><a name="local-6989586621679101023"><a href="#local-6989586621679101023"><span class="hs-identifier">range</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">oct</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">low</span><span> </span><a href="#local-6989586621679101023"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">oct</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">high</span><span> </span><a href="#local-6989586621679101023"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">]</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span class="hs-comment">-- | List all the valid instances of a given pitch within a voice range.</span><span>
</span><a name="line-388"></a><span class="hs-identifier">pitchesInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-389"></a><a name="pitchesInRange"><a href="Cogito.Musarithmetic.html#pitchesInRange"><span class="hs-identifier">pitchesInRange</span></a></a><span> </span><a name="local-6989586621679101024"><a href="#local-6989586621679101024"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101025"><a href="#local-6989586621679101025"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#pitchInRange"><span class="hs-identifier hs-var">pitchInRange</span></a><span> </span><a href="#local-6989586621679101027"><span class="hs-identifier hs-var">expandedRange</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101026"><span class="hs-identifier hs-var">candidates</span></a><span>
</span><a name="line-390"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-391"></a><span>        </span><a name="local-6989586621679101026"><a href="#local-6989586621679101026"><span class="hs-identifier">candidates</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#octaveChange"><span class="hs-identifier hs-var">octaveChange</span></a><span> </span><a href="#local-6989586621679101025"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#octavesInRange"><span class="hs-identifier hs-var">octavesInRange</span></a><span> </span><a href="#local-6989586621679101024"><span class="hs-identifier hs-var">range</span></a><span>
</span><a name="line-392"></a><span>        </span><a name="local-6989586621679101027"><a href="#local-6989586621679101027"><span class="hs-identifier">expandedRange</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-var">VoiceRange</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-393"></a><span>            </span><span class="hs-identifier">low</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">low</span><span> </span><a href="#local-6989586621679101024"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#p7inc"><span class="hs-identifier hs-var">p7inc</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">2</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-394"></a><span>            </span><span class="hs-identifier">high</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">high</span><span> </span><a href="#local-6989586621679101024"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-special">`</span><a href="Cogito.Musarithmetic.html#p7inc"><span class="hs-identifier hs-var">p7inc</span></a><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-395"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span class="hs-comment">-- | Given a list of pitches (taken from the vperms in the ark), return a list</span><span>
</span><a name="line-398"></a><span class="hs-comment">-- of list of all the valid instances of those pitches within a particular</span><span>
</span><a name="line-399"></a><span class="hs-comment">-- voice range. This determines the candidate pitches that we will test to</span><span>
</span><a name="line-400"></a><span class="hs-comment">-- find the optimal melody.</span><span>
</span><a name="line-401"></a><span class="hs-identifier">pitchCandidates</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-402"></a><a name="pitchCandidates"><a href="Cogito.Musarithmetic.html#pitchCandidates"><span class="hs-identifier">pitchCandidates</span></a></a><span> </span><a name="local-6989586621679101028"><a href="#local-6989586621679101028"><span class="hs-identifier">range</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#pitchesInRange"><span class="hs-identifier hs-var">pitchesInRange</span></a><span> </span><a href="#local-6989586621679101028"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span class="hs-comment">-- ** Decision trees for evaluation ordered permutations of a series. </span><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><span class="hs-comment">-- | Binary tree. We use a left-child/right-sibling binary tree to evaluate</span><span>
</span><a name="line-407"></a><span class="hs-comment">-- any number of candidates for each element in the series.</span><span>
</span><a name="line-408"></a><span class="hs-keyword">data</span><span> </span><a name="Btree"><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier">Btree</span></a></a><span> </span><a name="local-6989586621679100945"><a href="#local-6989586621679100945"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Empty"><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier">Empty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Node"><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier">Node</span></a></a><span> </span><a href="#local-6989586621679100945"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="#local-6989586621679100945"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="#local-6989586621679100945"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-409"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span class="hs-comment">-- | Build a general tree, implemented as left-child/right-sibling binary tree that</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- can take more than two options at each level</span><span>
</span><a name="line-413"></a><span class="hs-identifier">tree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679100951"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="#local-6989586621679100951"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-414"></a><a name="tree"><a href="Cogito.Musarithmetic.html#tree"><span class="hs-identifier">tree</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-415"></a><span class="hs-identifier">tree</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101029"><a href="#local-6989586621679101029"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101029"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>                </span><span class="hs-comment">-- no children or siblings</span><span>
</span><a name="line-416"></a><span class="hs-identifier">tree</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101030"><a href="#local-6989586621679101030"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101031"><a href="#local-6989586621679101031"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101030"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#tree"><span class="hs-identifier hs-var">tree</span></a><span> </span><a href="#local-6989586621679101031"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>            </span><span class="hs-comment">-- children but no siblings</span><span>
</span><a name="line-417"></a><span class="hs-identifier">tree</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101032"><a href="#local-6989586621679101032"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101033"><a href="#local-6989586621679101033"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#tree"><span class="hs-identifier hs-var">tree</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101033"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>          </span><span class="hs-comment">-- siblings but no children</span><span>
</span><a name="line-418"></a><span class="hs-identifier">tree</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101034"><a href="#local-6989586621679101034"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101035"><a href="#local-6989586621679101035"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101036"><a href="#local-6989586621679101036"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101034"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#tree"><span class="hs-identifier hs-var">tree</span></a><span> </span><a href="#local-6989586621679101036"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#tree"><span class="hs-identifier hs-var">tree</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679101035"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679101036"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- both </span><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span class="hs-comment">-- *** Test ordered permutations with a tree</span><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span class="hs-comment">-- | Build a left-child/right-sibling tree from a list of the options at each</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- level, only including options that pass a test function; the test function</span><span>
</span><a name="line-424"></a><span class="hs-comment">-- compares each parent to its child. If the value of the parent (previous</span><span>
</span><a name="line-425"></a><span class="hs-comment">-- good value) is 'Nothing' then we know it is the beginning of the tree,</span><span>
</span><a name="line-426"></a><span class="hs-comment">-- there is no previous value to compare.</span><span>
</span><a name="line-427"></a><span class="hs-identifier">testTree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679100950"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679100950"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ test to determine if child is valid relative to parent</span><span>
</span><a name="line-428"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679100950"><span class="hs-identifier hs-type">a</span></a><span>          </span><span class="hs-comment">-- ^ previous value to test</span><span>
</span><a name="line-429"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679100950"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>            </span><span class="hs-comment">-- ^ list of permutations at each level</span><span>
</span><a name="line-430"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="#local-6989586621679100950"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-comment">-- End of line.</span><span>
</span><a name="line-433"></a><a name="testTree"><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier">testTree</span></a></a><span> </span><a name="local-6989586621679101037"><a href="#local-6989586621679101037"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-434"></a><span>
</span><a name="line-435"></a><span class="hs-comment">-- No children or siblings: If x is good, make it a final node.</span><span>
</span><a name="line-436"></a><span class="hs-identifier">testTree</span><span> </span><a name="local-6989586621679101038"><a href="#local-6989586621679101038"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679101039"><a href="#local-6989586621679101039"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101040"><a href="#local-6989586621679101040"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-437"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621679101039"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679101038"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><a href="#local-6989586621679101039"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101040"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101040"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-438"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-comment">-- Children but no siblings: If x is good, make a node and follow its</span><span>
</span><a name="line-441"></a><span class="hs-comment">-- children, comparing them to x.</span><span>
</span><a name="line-442"></a><span class="hs-identifier">testTree</span><span> </span><a name="local-6989586621679101041"><a href="#local-6989586621679101041"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679101042"><a href="#local-6989586621679101042"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101043"><a href="#local-6989586621679101043"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101044"><a href="#local-6989586621679101044"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-443"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621679101042"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679101041"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><a href="#local-6989586621679101042"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101043"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101043"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679101045"><span class="hs-identifier hs-var">childTree</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-444"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-445"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679101045"><a href="#local-6989586621679101045"><span class="hs-identifier">childTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier hs-var">testTree</span></a><span> </span><a href="#local-6989586621679101041"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679101043"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101044"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span class="hs-comment">-- Siblings but no children: If x is good, make a node and follow its</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- siblings. Compare its siblings to the parent of x.</span><span>
</span><a name="line-449"></a><span class="hs-identifier">testTree</span><span> </span><a name="local-6989586621679101046"><a href="#local-6989586621679101046"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679101047"><a href="#local-6989586621679101047"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101048"><a href="#local-6989586621679101048"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101049"><a href="#local-6989586621679101049"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-450"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621679101047"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679101046"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><a href="#local-6989586621679101047"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101048"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101048"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><a href="#local-6989586621679101050"><span class="hs-identifier hs-var">siblingTree</span></a><span>
</span><a name="line-451"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101050"><span class="hs-identifier hs-var">siblingTree</span></a><span>
</span><a name="line-452"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679101050"><a href="#local-6989586621679101050"><span class="hs-identifier">siblingTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier hs-var">testTree</span></a><span> </span><a href="#local-6989586621679101046"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679101047"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101049"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">]</span><span>
</span><a name="line-453"></a><span>
</span><a name="line-454"></a><span class="hs-comment">-- Both children and siblings: If x is good, make a node and follow both</span><span>
</span><a name="line-455"></a><span class="hs-comment">-- children (compare to x) and siblings. Compare siblings to the parent of x.</span><span>
</span><a name="line-456"></a><span class="hs-identifier">testTree</span><span> </span><a name="local-6989586621679101051"><a href="#local-6989586621679101051"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679101052"><a href="#local-6989586621679101052"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101053"><a href="#local-6989586621679101053"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101054"><a href="#local-6989586621679101054"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101055"><a href="#local-6989586621679101055"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-457"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-6989586621679101052"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679101051"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><a href="#local-6989586621679101052"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101053"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679101053"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679101056"><span class="hs-identifier hs-var">childTree</span></a><span> </span><a href="#local-6989586621679101057"><span class="hs-identifier hs-var">siblingTree</span></a><span>
</span><a name="line-458"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101057"><span class="hs-identifier hs-var">siblingTree</span></a><span>
</span><a name="line-459"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-460"></a><span>        </span><a name="local-6989586621679101056"><a href="#local-6989586621679101056"><span class="hs-identifier">childTree</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier hs-var">testTree</span></a><span> </span><a href="#local-6989586621679101051"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679101053"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101055"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-461"></a><span>        </span><a name="local-6989586621679101057"><a href="#local-6989586621679101057"><span class="hs-identifier">siblingTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier hs-var">testTree</span></a><span> </span><a href="#local-6989586621679101051"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679101052"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679101054"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679101055"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-462"></a><span>
</span><a name="line-463"></a><span class="hs-comment">-- ** Traversal</span><span>
</span><a name="line-464"></a><span>
</span><a name="line-465"></a><span class="hs-comment">-- | Make a list of all good paths in an LCRS tree. If no good paths are</span><span>
</span><a name="line-466"></a><span class="hs-comment">-- found, the result will be @[]@.</span><span>
</span><a name="line-467"></a><span class="hs-identifier">paths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679100949"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ accumulator list</span><span>
</span><a name="line-468"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="#local-6989586621679100949"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-469"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679100949"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-470"></a><a name="paths"><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier">paths</span></a></a><span> </span><a name="local-6989586621679101058"><a href="#local-6989586621679101058"><span class="hs-identifier">xs</span></a></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679101058"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-471"></a><span class="hs-identifier">paths</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679101059"><a href="#local-6989586621679101059"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679101060"><a href="#local-6989586621679101060"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679101061"><a href="#local-6989586621679101061"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679101059"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679101060"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679101061"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-472"></a><span class="hs-identifier">paths</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101062"><a href="#local-6989586621679101062"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101063"><a href="#local-6989586621679101063"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101064"><a href="#local-6989586621679101064"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679101065"><a href="#local-6989586621679101065"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679101066"><a href="#local-6989586621679101066"><span class="hs-identifier">l</span></a></a><span> </span><a href="Cogito.Musarithmetic.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679101065"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101062"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101063"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679101064"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101066"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-473"></a><span class="hs-identifier">paths</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679101067"><a href="#local-6989586621679101067"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101068"><a href="#local-6989586621679101068"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679101069"><a href="#local-6989586621679101069"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679101070"><a href="#local-6989586621679101070"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679101071"><a href="#local-6989586621679101071"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679101072"><a href="#local-6989586621679101072"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679101070"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101067"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101068"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679101069"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101071"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679101067"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101068"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679101069"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101072"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-474"></a><span>
</span><a name="line-475"></a><span class="hs-comment">-- ** Test the paths</span><span>
</span><a name="line-476"></a><span class="hs-comment">-- | Are all the elements of a list the same length?</span><span>
</span><a name="line-477"></a><span class="hs-identifier">sameLengths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679100948"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-478"></a><a name="sameLengths"><a href="Cogito.Musarithmetic.html#sameLengths"><span class="hs-identifier">sameLengths</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-479"></a><span class="hs-identifier">sameLengths</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679101073"><a href="#local-6989586621679101073"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101074"><a href="#local-6989586621679101074"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679101073"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679101074"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-480"></a><span>
</span><a name="line-481"></a><span class="hs-comment">-- | Prune out paths that are shorter than the original list of items. If none</span><span>
</span><a name="line-482"></a><span class="hs-comment">-- are left after pruning (no viable paths), return 'Nothing'.</span><span>
</span><a name="line-483"></a><span class="hs-identifier">fullPaths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679100946"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ list of items to permute</span><span>
</span><a name="line-484"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679100947"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ list of permutations</span><span>
</span><a name="line-485"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679100947"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-486"></a><a name="fullPaths"><a href="Cogito.Musarithmetic.html#fullPaths"><span class="hs-identifier">fullPaths</span></a></a><span> </span><a name="local-6989586621679101075"><a href="#local-6989586621679101075"><span class="hs-identifier">items</span></a></a><span> </span><a name="local-6989586621679101076"><a href="#local-6989586621679101076"><span class="hs-identifier">options</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679101077"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-487"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679101077"><span class="hs-identifier hs-var">paths</span></a><span>
</span><a name="line-488"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679101077"><a href="#local-6989586621679101077"><span class="hs-identifier">paths</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679101075"><span class="hs-identifier hs-var">items</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">length</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101076"><span class="hs-identifier hs-var">options</span></a><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span class="hs-comment">-- ** Score a path for \&quot;badness\&quot; of different kinds</span><span>
</span><a name="line-491"></a><span>
</span><a name="line-492"></a><span class="hs-comment">-- | The ambitus is the widest range of pitches used; the difference between</span><span>
</span><a name="line-493"></a><span class="hs-comment">-- the highest and lowest pitches. Ignore rests.</span><span>
</span><a name="line-494"></a><span class="hs-identifier">ambitus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-495"></a><a name="ambitus"><a href="Cogito.Musarithmetic.html#ambitus"><span class="hs-identifier">ambitus</span></a></a><span> </span><a name="local-6989586621679101078"><a href="#local-6989586621679101078"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maximum</span><span> </span><a href="#local-6989586621679101079"><span class="hs-identifier hs-var">aps</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">minimum</span><span> </span><a href="#local-6989586621679101079"><span class="hs-identifier hs-var">aps</span></a><span>
</span><a name="line-496"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679101079"><a href="#local-6989586621679101079"><span class="hs-identifier">aps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Cogito.Musarithmetic.html#absPitch7"><span class="hs-identifier hs-var">absPitch7</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101078"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-497"></a><span>
</span><a name="line-498"></a><span class="hs-comment">-- | Calculate and list intervals between pitches in a list. The list will be</span><span>
</span><a name="line-499"></a><span class="hs-comment">-- one item shorter than the list of inputs.</span><span>
</span><a name="line-500"></a><span class="hs-identifier">intervals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>
</span><a name="line-501"></a><a name="intervals"><a href="Cogito.Musarithmetic.html#intervals"><span class="hs-identifier">intervals</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679101080"><a href="#local-6989586621679101080"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-502"></a><span class="hs-identifier">intervals</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679101081"><a href="#local-6989586621679101081"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101082"><a href="#local-6989586621679101082"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier hs-var">absInterval</span></a><span> </span><a href="#local-6989586621679101081"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679101082"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-503"></a><span class="hs-identifier">intervals</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679101083"><a href="#local-6989586621679101083"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101084"><a href="#local-6989586621679101084"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679101085"><a href="#local-6989586621679101085"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier hs-var">absInterval</span></a><span> </span><a href="#local-6989586621679101083"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679101084"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679101084"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679101085"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-504"></a><span>
</span><a name="line-505"></a><span class="hs-comment">-- | Add up all the intervals larger than a fourth (where p7diff &gt; 3 with</span><span>
</span><a name="line-506"></a><span class="hs-comment">-- 0-indexed intervals).</span><span>
</span><a name="line-507"></a><span class="hs-identifier">sumBigIntervals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-508"></a><a name="sumBigIntervals"><a href="Cogito.Musarithmetic.html#sumBigIntervals"><span class="hs-identifier">sumBigIntervals</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.Musarithmetic.html#intervals"><span class="hs-identifier hs-var">intervals</span></a><span>
</span><a name="line-509"></a><span>
</span><a name="line-510"></a><span class="hs-comment">-- | Find all the pitches that exceed a given range, and add up the interval</span><span>
</span><a name="line-511"></a><span class="hs-comment">-- by which they go above or below the limits.</span><span>
</span><a name="line-512"></a><span class="hs-identifier">sumBeyondRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-513"></a><a name="sumBeyondRange"><a href="Cogito.Musarithmetic.html#sumBeyondRange"><span class="hs-identifier">sumBeyondRange</span></a></a><span> </span><a name="local-6989586621679101086"><a href="#local-6989586621679101086"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101087"><a href="#local-6989586621679101087"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679101091"><span class="hs-identifier hs-var">highDegrees</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679101092"><span class="hs-identifier hs-var">lowDegrees</span></a><span class="hs-special">]</span><span>
</span><a name="line-514"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-515"></a><span>        </span><a name="local-6989586621679101088"><a href="#local-6989586621679101088"><span class="hs-identifier">pitches</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.Musarithmetic.html#isPitchRest"><span class="hs-identifier hs-var">isPitchRest</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101087"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-516"></a><span>        </span><a name="local-6989586621679101089"><a href="#local-6989586621679101089"><span class="hs-identifier">highs</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#pitchTooHigh"><span class="hs-identifier hs-var">pitchTooHigh</span></a><span> </span><a href="#local-6989586621679101086"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101088"><span class="hs-identifier hs-var">pitches</span></a><span>
</span><a name="line-517"></a><span>        </span><a name="local-6989586621679101090"><a href="#local-6989586621679101090"><span class="hs-identifier">lows</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#pitchTooLow"><span class="hs-identifier hs-var">pitchTooLow</span></a><span> </span><a href="#local-6989586621679101086"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101088"><span class="hs-identifier hs-var">pitches</span></a><span>
</span><a name="line-518"></a><span>        </span><a name="local-6989586621679101091"><a href="#local-6989586621679101091"><span class="hs-identifier">highDegrees</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679101093"><a href="#local-6989586621679101093"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier hs-var">absInterval</span></a><span> </span><a href="#local-6989586621679101093"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">high</span><span> </span><a href="#local-6989586621679101086"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101089"><span class="hs-identifier hs-var">highs</span></a><span>
</span><a name="line-519"></a><span>        </span><a name="local-6989586621679101092"><a href="#local-6989586621679101092"><span class="hs-identifier">lowDegrees</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679101094"><a href="#local-6989586621679101094"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#absInterval"><span class="hs-identifier hs-var">absInterval</span></a><span> </span><a href="#local-6989586621679101094"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">low</span><span> </span><a href="#local-6989586621679101086"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101090"><span class="hs-identifier hs-var">lows</span></a><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-comment">-- | Calculate weighted &quot;badness&quot; score for a list of pitches. Sum of ambitus,</span><span>
</span><a name="line-522"></a><span class="hs-comment">-- sum of large intervals (x 2), sum of degrees of notes out of range (x 10).</span><span>
</span><a name="line-523"></a><span class="hs-identifier">badness</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-524"></a><a name="badness"><a href="Cogito.Musarithmetic.html#badness"><span class="hs-identifier">badness</span></a></a><span> </span><a name="local-6989586621679101095"><a href="#local-6989586621679101095"><span class="hs-identifier">range</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;No paths found to test!&quot;</span><span>
</span><a name="line-525"></a><span class="hs-identifier">badness</span><span> </span><a name="local-6989586621679101096"><a href="#local-6989586621679101096"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101097"><a href="#local-6989586621679101097"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><span> </span><a href="Cogito.Musarithmetic.html#ambitus"><span class="hs-identifier hs-var">ambitus</span></a><span> </span><a href="#local-6989586621679101097"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-526"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#sumBigIntervals"><span class="hs-identifier hs-var">sumBigIntervals</span></a><span> </span><a href="#local-6989586621679101097"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-527"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="Cogito.Musarithmetic.html#sumBeyondRange"><span class="hs-identifier hs-var">sumBeyondRange</span></a><span> </span><a href="#local-6989586621679101096"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101097"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-528"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span class="hs-comment">-- | Find the best path (first with lowest &quot;badness&quot;), or raise error if none</span><span>
</span><a name="line-531"></a><span class="hs-comment">-- found</span><span>
</span><a name="line-532"></a><span class="hs-identifier">bestPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-533"></a><a name="bestPath"><a href="Cogito.Musarithmetic.html#bestPath"><span class="hs-identifier">bestPath</span></a></a><span> </span><a name="local-6989586621679101098"><a href="#local-6989586621679101098"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679101099"><a href="#local-6989586621679101099"><span class="hs-identifier">pnames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;No path found&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-534"></a><span>                              </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#leastBadPath"><span class="hs-identifier hs-var">leastBadPath</span></a><span> </span><a href="#local-6989586621679101098"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cogito.Musarithmetic.html#fullPaths"><span class="hs-identifier hs-var">fullPaths</span></a><span> </span><a href="#local-6989586621679101099"><span class="hs-identifier hs-var">pnames</span></a><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span class="hs-comment">-- | Choose the path with the lowest &quot;badness&quot;; if there are multiple with the</span><span>
</span><a name="line-537"></a><span class="hs-comment">-- same score, choose the first</span><span>
</span><a name="line-538"></a><span class="hs-identifier">leastBadPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRange"><span class="hs-identifier hs-type">VoiceRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span>
</span><a name="line-539"></a><a name="leastBadPath"><a href="Cogito.Musarithmetic.html#leastBadPath"><span class="hs-identifier">leastBadPath</span></a></a><span> </span><a name="local-6989586621679101100"><a href="#local-6989586621679101100"><span class="hs-identifier">range</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">minimumBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Cogito.Musarithmetic.html#badness"><span class="hs-identifier hs-var">badness</span></a><span> </span><a href="#local-6989586621679101100"><span class="hs-identifier hs-var">range</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-540"></a><span>
</span><a name="line-541"></a><span class="hs-comment">-- ** Synthetic functions pulling together the above</span><span>
</span><a name="line-542"></a><span>
</span><a name="line-543"></a><span class="hs-comment">-- | Build a tree of all pitch sequences with appropriate leaps</span><span>
</span><a name="line-544"></a><span class="hs-identifier">stepwiseTree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Btree"><span class="hs-identifier hs-type">Btree</span></a><span> </span><a href="Aedifico.html#Pitch"><span class="hs-identifier hs-type">Pitch</span></a><span>
</span><a name="line-545"></a><a name="stepwiseTree"><a href="Cogito.Musarithmetic.html#stepwiseTree"><span class="hs-identifier">stepwiseTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#testTree"><span class="hs-identifier hs-var">testTree</span></a><span> </span><a href="Cogito.Musarithmetic.html#legalLeap"><span class="hs-identifier hs-var">legalLeap</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-546"></a><span>
</span><a name="line-547"></a><span class="hs-comment">-- | Find a melody for a voice with an optimal blend of avoiding bad leaps and</span><span>
</span><a name="line-548"></a><span class="hs-comment">-- staying within range. This is the main function used in @Cogito@.</span><span>
</span><a name="line-549"></a><span class="hs-comment">--</span><span>
</span><a name="line-550"></a><span class="hs-comment">-- Avoid large or illegal leaps and stay as much in range</span><span>
</span><a name="line-551"></a><span class="hs-comment">-- as possible. For example,</span><span>
</span><a name="line-552"></a><span class="hs-comment">-- some melodies have long stepwise ascents or descents which, in certain</span><span>
</span><a name="line-553"></a><span class="hs-comment">-- modes, will take the voice out of range, and if we adjust them in the</span><span>
</span><a name="line-554"></a><span class="hs-comment">-- middle, we will get an illegal seventh interval. </span><span>
</span><a name="line-555"></a><span class="hs-comment">--</span><span>
</span><a name="line-556"></a><span class="hs-comment">-- We build a list of candidate pitches within the range, then we build a tree</span><span>
</span><a name="line-557"></a><span class="hs-comment">-- of the ordered permutations of those pitches and test the paths according</span><span>
</span><a name="line-558"></a><span class="hs-comment">-- to a subjective &quot;badness&quot; rating, including the ambitus or total range of</span><span>
</span><a name="line-559"></a><span class="hs-comment">-- highest to lowest notes, the number and size of large intervals, and the</span><span>
</span><a name="line-560"></a><span class="hs-comment">-- number of notes out of range (and how much out of range they are). The</span><span>
</span><a name="line-561"></a><span class="hs-comment">-- first path with the lowest score wins.</span><span>
</span><a name="line-562"></a><span class="hs-identifier">stepwiseVoiceInRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Aedifico.html#VoiceRanges"><span class="hs-identifier hs-type">VoiceRanges</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-type">Voice</span></a><span>
</span><a name="line-563"></a><a name="stepwiseVoiceInRange"><a href="Cogito.Musarithmetic.html#stepwiseVoiceInRange"><span class="hs-identifier">stepwiseVoiceInRange</span></a></a><span> </span><a name="local-6989586621679101101"><a href="#local-6989586621679101101"><span class="hs-identifier">ranges</span></a></a><span> </span><a name="local-6989586621679101102"><a href="#local-6989586621679101102"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#Voice"><span class="hs-identifier hs-var">Voice</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-564"></a><span>    </span><span class="hs-identifier">voiceID</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679101102"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span>
</span><a name="line-565"></a><span>    </span><span class="hs-identifier">music</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679101107"><span class="hs-identifier hs-var">adjust</span></a><span>
</span><a name="line-566"></a><span class="hs-special">}</span><span>
</span><a name="line-567"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-568"></a><span>        </span><a name="local-6989586621679101103"><a href="#local-6989586621679101103"><span class="hs-identifier">pitches</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">music</span><span> </span><a href="#local-6989586621679101102"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-569"></a><span>        </span><a name="local-6989586621679101104"><a href="#local-6989586621679101104"><span class="hs-identifier">range</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Aedifico.html#getRange"><span class="hs-identifier hs-var">getRange</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">voiceID</span><span> </span><a href="#local-6989586621679101102"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679101101"><span class="hs-identifier hs-var">ranges</span></a><span>
</span><a name="line-570"></a><span>        </span><a name="local-6989586621679101105"><a href="#local-6989586621679101105"><span class="hs-identifier">candidates</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#pitchCandidates"><span class="hs-identifier hs-var">pitchCandidates</span></a><span> </span><a href="#local-6989586621679101104"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101103"><span class="hs-identifier hs-var">pitches</span></a><span>
</span><a name="line-571"></a><span>        </span><a name="local-6989586621679101106"><a href="#local-6989586621679101106"><span class="hs-identifier">options</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#stepwiseTree"><span class="hs-identifier hs-var">stepwiseTree</span></a><span> </span><a href="#local-6989586621679101105"><span class="hs-identifier hs-var">candidates</span></a><span>
</span><a name="line-572"></a><span>        </span><a name="local-6989586621679101107"><a href="#local-6989586621679101107"><span class="hs-identifier">adjust</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Cogito.Musarithmetic.html#bestPath"><span class="hs-identifier hs-var">bestPath</span></a><span> </span><a href="#local-6989586621679101104"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679101103"><span class="hs-identifier hs-var">pitches</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cogito.Musarithmetic.html#paths"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679101106"><span class="hs-identifier hs-var">options</span></a><span>
</span><a name="line-573"></a><span>
</span><a name="line-574"></a></pre></body></html>