<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="arca.css" />
    <link rel="icon" type="image/png" href="img/panpipe.png" />

    <title>Arca musarithmica</title>
    <meta name="description" 
          content="Description of how to compose using Athanasius
                    Kircher’s 1650 device for automatic music composition
                    implemented in Haskell by Andrew Cashner (2021)" />

    <link rel="stylesheet" href="highlight/styles/default.min.css" />
    <script type="text/javascript" src="highlight/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
  </head>
  <body>
    <header>
      <h1>ARCA MUSARITHMICA</h1>
      <h2>a device for automatic music composition from 1650</h2>
    </header>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="compose.html">Compose</a></li>
        <li><a href="doc/index.html">Code</a></li>
      </ul>
    </nav>
    <main>
      <section>
        <h1>Inside Kircher’s Ark</h1>
        <h2>Contents</h2>
        <ol class="toc">
          <li><a href="#structure">How the ark is structured</a></li>
          <li><a href="#use">How to use the ark</a></li>
          <li><a href="#implementation">Software implementation</a></li>
          <li><a href="#reflections">What does this project tell us about
              computing and composition?</a></li>
          <li><a href="#biblio">Bibliography and related projects</a></li>
        </ol>
      </section>
      <section id="structure">
        <h1>How the ark is structured</h1>

        <p><em>Arca</em> just means <q>box</q>, and as shown in Kircher’s
        overall <a href="index.html#ark-image">illustration</a>, the ark
        contains different kinds of data structures on the outside, on the
        lid, and stored within. After preparing the input text 
        (<a href="#use">see below</a>), the operator uses the
        <em>pinakes</em> (rods) within to extract pre-arranged permutations of
        numbers and rhythmic values. Then they use the table of modes on the
        lid to match the numbers to pitch classes (that is, note names without
        specifying an octave) and accidentals. Finally, the table on the front
        specifies how to inscribe these notes on paper within acceptable
        ranges for the four voices (thereby specifying the initial octave and any
        later adjustments of octaves necessary to keep each voice’s line
        within range. Not included in this illustration are the other elements
        of music notation for which Kircher provides tables in his text,
        including the different possible note values.
        </p>

        <section>
          <h2><em>Syntagmata</em> and <em>pinakes</em> (inside the box)</h2>
          <p>
          The box contains a bevy of <em>pinakes</em> (rods, singular
          <em>pinax</em>), organized into groups called <em>syntagmata</em>
          (singular <em>syntagma</em>).  The design of the rods would seem to
          be inspired by Napier’s bones and other similar calculating devices
          of the time.  Each pinax lists sets of numeric permutations that
          represent four-voice note combinations, and sets of rhythmic
          permutations.
          </p>
          <p>
          The pinakes match up with the metrical structure of
          the poetry being set. Syntagma I, pinax I and II, allow for any
          meter with lines up to six syllables long, as they are just based on
          the length of the penultimate syllable. As a result, these may be
          used to set prose texts as long as they are prepared in appropriate
          groupings of syllables. The remaining pinakes provide for a set of
          Classical Latin poetic meters, from <q>Archilocical Iambic</q> to
          Sapphic meters.
          </p>
          <p>
          There are three syntagmata: the first provides for simple
          note-against-note (homorhythmic) counterpoint, and the second
          provides for florid (melismatic, elaborate) counterpoint including
          imitation and even fugal passages. The third contains a set of
          modifications that can be applied to the previous two syntagmata in
          order to better match prosodic and rhetorical features of the texts.
          Kircher provides the full tables for syntagma I and II, but only an
          outline of syntagma III without enough detail to implement it. (In
          fact he says he has withheld some of the information from the
          general public; though this may have been a bluff.) This software
          fully implements syntagma I and II only, and it is not clear if
          syntagma III could be fully automated based only on Kircher’s
          specification.
          </p>
          <section>
            <h3>Syntagma I: Simple counterpoint</h3>
            <p>
            In syntagma I, there are separate tables of pitch/voice
            permutations (what I call <em>vperms</em>) and rhythm permutations
            (<em>rperms</em>). The user is supposed to choose freely from
            each set and then combine them.
            </p>
            <p>
            This is the rod used to set the hymn <cite>Ave maris stella</cite>
            in simple style: syntagma I, pinax IV, with details showing the
            separate vperms and rperms.
            </p>
            <img id="s1p4"
                 src="img/Kircher-s1p4.png"
                 alt="Image: The original data tables on the rod in syntagma
                       I, pinax IV, containing at the top, columns of numbers
                       in matrixes for four voices (vperms); and at the bottom,
                       columns of musical notes indicating rhythmic values
                       (rperms)"
                 title="Arca musarithmica, syntagma I, pinax IV, in Musurgia
                         universalis (1650), book 2, fol. 83"
                 max-width="400">
            </img>
            <p>
            In many pinakes, the user is supposed to choose from a different
            column based on the order of poetic lines (which Kircher
            confusingly calls <em>strophae</em>, though he means lines not
            stanzas). 
            </p>
            <img id="s1p4-vperm-detail"
                 src="img/Kircher-s1p4-vperm-detail.png"
                 alt="Image: Detail of syntagma I, pinax IV, showing the
                       number tables for voice permutations"
                 title="Detail of syntagma I, pinax IV: numbers for voice
                         permutations"
                 width="400px">
            </img>
            <p>
            The rperms in this syntagma are divided into three sections by
            meter: for duple meter, <q>triple major</q>, and <q>triple
              minor</q>. These correspond to cut C, cut C3 (or cut C 3/2), and
            C3 (or C 3/2) mensurations.
            </p>
            <img id="s1p4-rperm-detail"
                 src="img/Kircher-s1p4-rperm-detail.png"
                 alt="Image: Detail of syntagma I, pinax IV, showing the note
                       tables for rhythm permutations"
                 title="Detail of syntagma I, pinax IV: note values for rhythm
                         permutations"
                 width="400px">
            </img>
            <p>
            Kircher does not distinguish systematically between duple-meter
            permutations with a primary semibreve (whole note) subdivision
            (which would be notated with cut C, <em>alla breve</em> time) and
            those with a primary minim (half note) pulse. Perhaps this was
            meant to increase the variety in duple meter, but it can create
            absurd results when the pulse suddenly shifts. This would not be a
            problem for someone choosing the permutations intelligently, but
            since Kircher does not provide a way to distinguish automatically,
            this implementation of the ark can produce some silly results in
            duple meter.
            </p>
            <p>
            The pinakes also include specifications of which modes are
            acceptable.
            </p>
          </section>
          <section>
            <h3>Syntagma II: Florid counterpoint</h3>
            <p>
            In syntagma II, each <em>vperm</em> is matched with a single
            <em>rperm</em> to allow for more complex contrapuntal textures.
            </p>
            <img id="s2p2a"
                 src="img/Kircher-s2p2a.png"
                 alt="Image: The original data tables for the rod in syntagma
                       II, pinax II, containing columns of matched sets of
                       voice and rhythm permutations"
                 title="Arca musarithmica, syntagma II, pinax II, in Musurgia
                         universalis (1650), book 2, fol. 106"
                 max-width="400px">
            </img>
            <p>
            This is the rod used to set the same hymn in florid style:
            syntagama II, pinax II. The detail shows the pairs of voice and
            rhythm permutations.
            </p>
            <img id="s2p2b-detail"
                 src="img/Kircher-s2p2b-detail.png"
                 alt="Image: Detail of syntagma II, pinax II, showing pairs of
                       voice and rhythm permutations"
                 title="Detail of syntagma II, pinax II: pairs of voice and
                         rhythm permutations"
                 width="500px">
            </img>
          </section>
          <section>
            <h3>Automating permutation selection: A problem of theologically
              dangerous chance operations</h3>
            <p>
            To make the system automated, I generate a list of random numbers
            to select the permutations. Kircher and his Jesuit superiors
            probably would have considered this chance operation to be a
            theologically dangerous act, removing human free will and in a
            way, putting God’s providence to the test. I have separated out
            this part of the implementation in the <code>Fortuna</code>
            module, with the necessary cautions in the documentation, and it
            would be possible for a user to supply their own freely chosen
            list of numbers instead, should they be concerned about an audit
            by the Inquisition.
            </p>
          </section>
        </section>
        <section>
          <h2>Palimpsest phonotacticum (front center)</h2>
          <p>
          In the center, adorned by images of ancient and exotic musical
          instruments, the table on the front face shows the settings for the
          <em>palimpsest phonotacticum</em> or music paper.  This chart gives
          the permissible combinations of clefs that specifies the permissible
          ranges for each voice.
          </p>
          <p>
          It also shows the pitch-class values in both <em>cantus durus</em>
          (all-natural accidental signature) and <em>cantus mollis</em>
          (one-flat accidental signature). These were the only two signatures
          used in conservative music of the mid-seventeenth century.
          </p>
        </section>
        <section>
          <h2>Mensa tonographica (underside of lid)</h2>
          <p>
          Under the lid is the <q>table for writing modes</q>, which allows
          the user to look up the pitch names that correspond to the pitch
          numbers in a given mode.  Kircher lists twelve modes, which he
          usually calls <em>toni</em>.  Each mode includes a name, a
          description of the emotional mood or character associated with that
          mode, whether the mode is in <em>cantus durus</em> or
          <em>mollis</em>, and a list of pitches, some with accidentals.
          Kircher’s system of modes does not line up with the older systems
          that most of us learned even in advanced studies of medieval music,
          because it reflects the rapidly changing, chaotic state of modal
          theory in the seventeenth century.
          </p>

          <section>
            <h3>Kircher’s Concept of Mode or <em>Tonus</em></h3>
            <p>
            Many musicians had used a system of twelve church modes at least
            since the time of the theorists Glareanus and Zarlino a century
            earlier. In that system mode I meant that a plainchant melody ended
            on D (the final) with a range from D to the D an octave higher
            (authentic ambitus). Mode II also specified a D final but a range
            from A to A (plagal ambitus). Modes III and IV had an E final with
            authentic and plagal ranges, respectively; and so on, skipping B.
            That system originally developed as a way of classifying traditional
            monophonic (one note at a time) chant melodies.
            </p>
            <p>
            When that system was applied to <em>polyphonic</em> music, it
            usually referred to the final of the lowest voice and the ambitus
            (range) of the Tenor voice. The rules for counterpoint worked
            against some of the special characteristics of the modes: for
            example, when two notes a sixth apart moved into an octave, one was
            supposed to raise the top note or lower the bottom note of the sixth
            (that is, make it a major sixth), which effectively meant that
            <q>leading tones</q> were sharped in almost all modes. Such
            alterations eroded the distinctions between modes until eventually
            most of them sounded like either major or minor 
            (<a href="#Judd:ReniassanceModalTheory">Judd 2002</a>).
            </p>
            <p>
            In between older modal practice and what would emerge as functional
            tonality with major and minor keys, then, were various systems of
            <q>church keys</q> and <em>tonoi</em>
            (<a href="#Barnett:TonalOrganization17C">Barnett 2002</a>). 
            Most of these described practical ways that keyboardists in
            particular would match improvised polyphonic music to traditional
            psalm tones (linked to the modes but not identical with them).
            Kircher’s list of modes is closer to these church keys.
            </p>
          </section>
          <section>
            <h3>Automating <em>musica ficta</em> accidentals: A problem of
              performance practice</h3>
            <p> 
            In practice, the problem of accidentals is a major detriment to
            making the ark fully automatic. Kircher does not list B flats in
            the scales for modes that are in <em>cantus mollis</em>, because
            these are specified by the signatures in the <em>palimpsest</em>
            table below; the flats and sharps he does list are not meant to be
            applied all the time but only in certain situations according to
            the performance-practice traditions of <em>musica ficta</em>. Thus
            a performer, seeing the gesture D–E–D in certain contexts would
            use the rule <em>una nota super la semper est canendum fa</em> to
            apply a flat to the E. Kircher does not provide enough information
            in his specification to automate this aspect completely.
            </p>
            <p>
            This problem is not necessarily a failing of his design, though,
            since it would have been uncommmon to specify such things in
            writing. His machine is designed for automatic
            <em>composition</em>, not performance, and so it provides as much
            information as competent performers would need to execute the
            music. (In the same way the a document-processing program like
            pdfLaTeX converts a source file into PostScript instructions that
            a printer knows how to interpret in order to render the document
            on paper.) This is why I have chosen to render the accidentals
            from this mode table above the staff as suggested <em>musica
              ficta</em>, and this is why the automated MIDI performances on
            this website sometimes sound awful, because the MIDI player does
            not know anything about seventeenth-century performance practice,
            and teaching it that would be an entirely separate programming
            challenge (one worthy to be taken up, though!). 
            </p>
          </section>
        </section>

      </section>
      <section id="use">
        <h1>How to compose music using the ark</h1>

        <ol>
          <li>Kircher expects you to <strong>prepare a text</strong> in Latin or
            another language, with words divided into syllables, marked long or
            short. You can set texts in several Classical meters (like
            Anacreontic or Sapphic), but you can also set irregular verse and
            prose texts.  <ul>
              <li>In this web app, we provide a set of <strong>pre-marked
                  texts</strong>.</li>
              <li>If you download and install the 
                <a href="https://www.bitbucket.org/andrewacashner/kircher.git">command-line
                  version,</a> 
                you can create your own texts that might even have multiple sections
                in different styles and moods!</li>
            </ul>
          </li> 
          <li>Next, Kircher wants you to choose several aspects of the music
            setting you want the ark to create:
            <ul>
              <li>The <strong>style</strong> and texture of the music:
                <ol>
                  <li>you can opt for simple, note-against-note counterpoint (like a
                    hymn),</li>
                  <li>or florid, melismatic counterpoint (like a motet, anthem, or
                    even fugue).</li>
                </ol>
              </li>
              <li>The <strong>mood</strong> or character of the text and its
                setting, which determines the choice of one of twelve musical
                modes (<em>tonoi</em>).  
                <p>
                Kircher’s <em>modes</em> are more like <q>church keys</q> and
                don’t line up exactly with the older modes most musicians
                learned.
                </p>
              </li>
              <li>The <strong>musical meter</strong> (technically, mensuration)
                of the setting. 
                <ol>
                  <li>In the simple style, you can choose 
                    <ol>
                      <li>duple meter (C),</li>
                      <li>triple minor (C3, three minims/half notes per metrical
                        unit),</li>
                      <li>or triple major (cut C3, three semibreves/whole notes
                        per metrical unit).</li>
                    </ol>
                    <p>
                    Some duple-meter permutations in the ark have a minim pulse
                    (C) and others have a semibreve pulse (cut C).
                    </p>
                  </li>
                  <li>In florid style, everything is in duple meter (C).</li>
                </ol>
              </li>
            </ul>
          </li>
          <li>If you are operating the ark by hand, you use these input
            parameters to select the proper tables. 
            <ul> 
              <li><strong>Syntagma:</strong> There are three <em>syntagmata</em>
                or large divisions in the ark. For simple style, you select from
                Syntagma I; for florid, use Syntagma II.
                <p>
                Kircher provides a third syntagma as well, but because it would
                be much more difficult if not impossible to make completely
                automatic, we have omitted it from this implementation.
                (An exercise for the reader!)
                </p>
              </li>
              <li><strong>Pinax:</strong> Each syntagma containes a set of
                <q>rods</q> or <em>pinakes</em> (singular, <em>pinax</em>). You
                select the <em>pinax</em> based on the meter of the text.
              </li>
              <li><strong>Column:</strong> Each pinax contain
                several columns of data. The column is either a free choice, or
                is based on the order of lines in the poem.
              </li>
              <li><strong>Voice and rhythm permutations:</strong> Each column
                includes two parts: sets of numbers representing musical pitches
                (we call these <q>voice permutations</q> or vperms), and sets of
                musical notes representing rhythmic durations (<q>rhythm
                  permutations</q> or rperms).
                <ul>
                  <li>In syntagma I (simple counterpoint), the user is supposed
                    to freely choose one set of vperms and one set of
                    rperms. All the musical voices use the same rhythms.
                    <ul>
                      <li>In syntagma I, there are (generally) three sets of
                        rhythm permutation, one for each type of musical meter
                        you can use.</li>
                    </ul>
                    <li>In syntagma II (florid counterpoint), there is a set of
                      rperms that matches up with each vperm, so that there is a
                      specified rhythm for each of the SATB voices. This makes
                      independent contrapuntal voices possible.
                    </li>
                </ul>
                  </li>
            </ul>
              </li>
              <li><strong>Writing the  music down:</strong> Next you lay out what
                Kircher calls the <em>palimpsest phontacticum</em>, or what the rest
                of us call <q>music paper</q>.
                You draw out four staves and put an appropriate combination of clefs
                for the four voices. These determine the octave and range of the
                musical output for each voice. You also add a flat in the key
                signature if your mode is in <em>cantus mollis</em> according to the
                table, and add the appropriate mensuration sign.
              </li>
              <li><strong>Matching pitches, rhythms, and syllables:</strong> For
                each phrase of text, you take the pitch numbers and look them up in
                the table for the given mode in order to get note names. You pair
                these note names with the rhythmic values, or just put rests when
                those are given. You write these values on the staff,
                making certain adjustments as needed.
              </li>
              <li>Kircher describes a variety of <strong>adjustments</strong>, some
                of which are easier to automate (that is, are more completely
                prescribed) than
                others: 
                <ol>
                  <li>If the notes go out of range for that voice (too far above or
                    below the staff), you may shift them up or down by octave as
                    needed.</li>
                  <li>The mode tables specify that you may add sharps or flats on
                    certain notes according to <em>musica ficta</em> rules.</li>
                  <li>You may also do more complicated things like swapping the
                    notes for adjacent voices, which require your own judgment.</li>
                </ol>
              </li>
        </ol>
      </section>
      <section id="implementation">
        <h1>Digital Implementation</h1>
        <p>
        In this software we implement only those parts of the ark which are
        completely specified as automatic algorithms. We have tried to follow
        Kircher’s own ways of structuring the data as closely as possible, as
        may be clear from looking at the 
        <a href="doc/index.html"><code>Arca</code> module</a>.
        </p>
        <p>
        Instead of the user’s choice of vperms and rperms we choose to tempt
        fate (from a seventeenth-century Catholic perspective and roll the dice,
        a literally aleatoric method, by using computer-generated pseudo-random
        numbers.  Other elements that depend on the user’s taste and judgment,
        or elements under-specified by Kircher (like text underlay in
        the melismatic Syntagma II) we leave up to our own users’ discretion.
        </p>
        <p>
        I have tried to write the program in a <q>literate programming</q>
        style, and the full documentation and code are available 
        <a href="doc/index.html">on this site</a>.
        </p>
        <section>
          <h2>Parts of the software</h2>
          <p>
          The program uses the following modules.
          </p>
          <dl>
            <dt>Aedifico (<q>I build</q>)</dt>
            <dd>
              This module defines the software versions of these structures
              and the basic methods for accessing them.
            </dd>
            <dt>Arca musarithmica (<q>Box of Musical Numbers,</q> more or less)</dt>
            <dd>
              This module stores the original data of Kircher’s ark in nested
              vectors and lists of integer values and enumeration values
              corresponding to the rhythmic durations, plus the lists of mode
              scales and other information.
            </dd>
            <dt>Lectio (<q>I read</q>)</dt>
            <dd>
              This module creates the system for reading the input texts, which
              are to be written in a custom XML format.
              We extract the parameters like text meter, music meter, and mode;
              and parse the text into sections, sentences, phrases, words, and
              syllables.
            </dd>
            <dt>Fortuna (<q>Chance</q>)</dt>
            <dd>
              This module generates the pseudo-random numbers used to select
              vperms and rperms.
            </dd>
            <dt>Cogito (<q>I think</q>)</dt>
            <dd>
              This module is where the actual <q>musarithmetic</q> occurs, where
              vperm numbers are converted into pitches with accidentals, rperms
              are converted into durations, and octaves are set and adjusted
              according to Kircher’s rules.
              The module stores all this data in internal data structures
              that encode music sections, phrases, and pitches (with pitch
              class, octave, accidental, duration, and syllables). 
            </dd>
            <dt>Scribo (<q>I write</q>)</dt>
            <dd>
              This module writes the data generated by the
              <code>Cogito</code>module to a music-notation language that other
              software can use to put the actual notes on the screen or paper.
              The submodules output to either Lilypond or MEI, the XML format 
              of the <a href="https://www.music-encoding.org/">Music Encoding
                Initiative</a>. 
              The Lilypond module is still available for testing, but I
              stopped developing it some time ago when I shifted focus to MEI.
            </dd>
          </dl>
        </section>
        <section>
          <h2>A tour through the Haskell code</h2>
          <p>
          Let’s get a taste for the Haskell code by following the process from
          building the ark data through reading the input text, setting it to
          music, and writing the output.
          </p>
          <section>
            <h3>Building data structures for a pinax and the whole ark</h3>
            <p>
            This is how we define the data types for the <code>Pinax</code>
            and the <code>Arca</code> itself, in the <code>Aedifico</code>
            module.
            </p>
            <pre>
            <code class="language-haskell">
-- | The ark is a box containing rods (/pinakes/), each of which includes
-- columns with voice and rhythm permutations. The rods are grouped according
-- to style into /syntagmata/, where /syntagma/ 1 is simple homorhythmic
-- counterpoint.
--
-- We implement the 'Column' as a structure with one 'VpermTable' and one
-- 'RpermTable'. 
data Column     = Column {
    colVpermTable :: VpermTable, 
    colRpermTable :: RpermTable
}

-- | A vector of 'Column' instances is a 'Pinax'.
type Pinax      = Vector (Column)

-- | A vector of 'Pinax' instances is a 'Syntagma'.
type Syntagma   = Vector (Pinax)

-- | A vector of 'Syntagma' instances makes up the full 'Arca'.
data Arca = Arca {
    perms      :: Vector (Syntagma),
    modes      :: ModeList,
    systems    :: ModeSystem,
    pinaxModes :: PinaxModeList,
    ranges     :: VoiceRanges
}
</code>
            </pre>

            <p>
            This is how the first column of syntagma 1, pinax 4 (shown above) is
            represented in the submodule
            <code>Arca_musarithmica.Syntagma1.Pinax04</code>.
            </p>
            <pre>
          <code class="language-haskell">
module Arca_musarithmica.Syntagma1.Pinax04 (s1p4) where

import Aedifico
    ( Dur    (..)
    , buildPinax
    )

-- | Pinax 4
s1p4 = buildPinax [c0, c1, c2, c3]

c0 = (c0v, c0r)

c0v =     [
        [ -- 0
            [5, 5, 3, 2, 3, 3],
            [8, 7, 5, 7, 7, 7],
            [3, 2, 3, 4, 5, 5],
            [8, 5, 8, 7, 3, 3]
        ],
        [ -- 1
            [5, 5, 5, 5, 5, 5],
            [8, 8, 8, 7, 8, 8],
            [3, 3, 3, 2, 3, 3],
            [1, 1, 1, 5, 1, 1]
        ],
        [ -- 2
            [8, 2, 3, 6, 5, 5],
            [5, 7, 8, 8, 7, 8],
            [3, 4, 8, 4, 3, 2],
            [8, 7, 6, 4, 5, 1]
        ],
        [ -- 3
            [3, 2, 3, 2, 1, 7],
            [8, 7, 7, 7, 5, 5],
            [5, 5, 5, 4, 3, 2],
            [1, 5, 3, 4, 8, 5]
        ],
        [ -- 4
            [3, 2, 3, 4, 5, 5],
            [8, 7, 8, 2, 7, 7],
            [5, 5, 5, 2, 3, 3],
            [8, 5, 1, 7, 3, 3]
        ],
        [ -- 5
            [5, 5, 5, 4, 5, 5],
            [8, 8, 7, 8, 7, 8],
            [3, 3, 2, 1, 2, 3],
            [1, 1, 5, 6, 5, 1]
        ],
        [ -- 6
            [5, 5, 5, 5, 5, 5],
            [8, 8, 8, 7, 8, 8],
            [3, 3, 3, 2, 3, 3],
            [8, 8, 8, 5, 8, 8]
        ],
        [ -- 7
            [5, 5, 5, 5, 4, 4],
            [7, 7, 7, 7, 7, 7],
            [3, 3, 3, 3, 2, 2],
            [3, 3, 3, 3, 7, 7]
        ],
        [ -- 8
            [5, 5, 4, 4, 5, 5],
            [7, 7, 6, 8, 7, 8],
            [3, 3, 1, 1, 2, 3],
            [3, 3, 4, 6, 5, 1]
        ],
        [ -- 9
            [3, 4, 5, 4, 2, 3],
            [8, 7, 7, 6, 5, 5],
            [5, 4, 3, 8, 7, 8],
            [1, 2, 3, 4, 5, 1]
        ]
    ]

c0r = [
        [ -- Duple
            [[SbD, Mn, Mn, Mn, Sb, Sb]],
            [[MnD, Sm, Mn, Mn, Sb, Sb]],
            [[Mn, Mn, Mn, Mn, Sb, Sb]],
            [[Sm, Sm, Sm, Sm, Sb, Sb]],
            [[SmD, Fs, Sm, Sm, Mn, Mn]],
            [[MnR, Sb, Mn, Mn, Mn, Sb, Sb]],
            [[SmR, Mn, Sm, Sm, Sm, Mn, Sb]],
            [[Sb, Mn, Sb, Mn, Sb, Sb]]
        ],
        [ -- TripleMajor
            [[Br, Sb, Br, Sb, BrD, BrD]], -- assuming penultimate Br is perfect
            [[SbR, Sb, Sb, Br, Sb, BrD, BrD]],
            [[Sb, Sb, Sb, Sb, Br, BrD]]
        ],
        [ -- TripleMinor
            [[Sb, Mn, Sb, Mn, SbD, SbD]], -- likewise for Sb
            [[Mn, Mn, Mn, Mn, Sb, SbD]],
            [[MnR, Mn, Mn, Sb, Mn, SbD, SbD]]
        ]
    ]
</code>
            </pre>
            <p>
            This is the code where we actually build the ark as an internal data
            structure, using pinax data like that shown above along with the
            list of modes, vocal ranges, and other information.
            The values <code>s1</code> and <code>s2</code> contain the data for
            syntagma I and II.
            </p>
            <pre>
          <code class="language-haskell">
arca :: Arca
arca = Arca {
    perms      = fromList [s1, s2],
    modes      = _modeList,
    systems    = _modeSystems,
    pinaxModes = _pinaxModes,
    ranges     = _vocalRanges
}
</code>
            </pre>
          </section>
          <section>
            <h3>Reading a phrase of input text</h3>
            <p>
            In the <code>Lectio</code> module, these are the functions that read
            a string of input text and create a data structure to pass on to the
            <code>Cogito</code> module for setting to music.
            </p>
            <pre>
<code class="language-haskell">
-- | Take a 'String' and create a 'Verbum' structure:
--
--  - strip the text of diacritics by removing 'hyphenChar' and 'accentChar' characters
--  - extract syllables by stripping accents and splitting at hyphens
--  - get syllable count from list created in previous step
--  - get penultimate syllable length from list of syllables /including/
--  accents, using 'penultValue'
newVerbum :: String -&gt; Verbum
newVerbum s = Verbum {
    verbumText   = plaintext, 
    verbumSyl    = plainSyllables,
    sylCount     = length plainSyllables,
    penultLength = penultValue accentSyllables
} where 
    plaintext = filter (flip notElem [hyphenChar, accentChar]) s -- no accents or hyphens
    noAccents = filter (/= accentChar) s
    accentSyllables = wordsBy (== hyphenChar) s          -- list of syllables including accents
    plainSyllables  = wordsBy (== hyphenChar) noAccents  -- list of syllables without accents

-- | Take a simple list of 'Verbum' items and make a 'LyricPhrase' structure from
-- it: the original list is stored as 'phraseText', and the 'phraseSylCount'
-- and 'phrasePenultLength' are calculated from that list.
-- The 'phraseSylCount' is the sum of all the 'sylCount's of the words in the
-- list. The 'phrasePenultLength' is the 'penultLength' of the last list item.
newLyricPhrase :: [Verbum] -&gt; LyricPhrase
newLyricPhrase ls = LyricPhrase {
    phraseText = ls,
    phraseSylCount = sum $ map sylCount ls,
    phrasePenultLength = penultLength $ last ls,
    phrasePosition = 0
}
</code>
            </pre>
          </section>
          <section>
            <h3>Setting that phrase to music</h3>
            <p>
            In the <code>Cogito</code> module, this is the function we use to
            compose the music for single phrase of text.
            </p>
            <pre>
<code class="language-haskell">
-- | Compose the music for a whole 'LyricPhrase' with one permutation from the
-- ark, and package it into a 'MusicPhrase'. Note that this is for a single
-- voice only, not the four SATB voices. 
-- Line up pitches and syllables, skipping rests. In Syntagma I, line up text
-- and notes syllabically (one syllable per note); in syntagma II (florid),
-- lump the text into a single syllable and put it as an incipit text at the
-- beginning of the phrase. (See module description for why Kircher's
-- specification makes this is necessary.)
makeMusicPhrase :: Arca 
                    -&gt; ArkConfig 
                    -&gt; VoiceName
                    -&gt; LyricPhrase 
                    -&gt; Perm 
                    -&gt; MusicPhrase
makeMusicPhrase arca config voiceID phrase perm = MusicPhrase {
        phraseVoiceID = voiceID,
        notes = theseNotes
    } where

        -- Match up pitches and syllables, skipping rests
        theseNotes = map (\(pitch, syllable) -&gt; Note pitch syllable)
            $ zipFill (music voice) syllables isPitchRest blankSyllable

        voice       = stepwiseVoiceInRange (ranges arca) voiceRaw :: Voice
        voiceRaw    = ark2voice arca config penult sylCount lineCount voiceID perm

        range       = ranges arca
        penult      = phrasePenultLength phrase
        sylCount    = phraseSylCount phrase
        lineCount   = phrasePosition phrase

        words = phraseText phrase

        -- In Syntagma II, put the whole phrase of lyrics as a single
        -- syllable under the first note
        syllables = case arkStyle config of
            Simple -&gt; concat $ map makeSyllables words
            Florid -&gt; [Syllable {
                        sylText = unwords $ map verbumText $ phraseText phrase,
                        sylPosition = Only
                       }]
</code>
            </pre>
          </section>
          <section>
            <h3>Encoding the music output in MEI format</h3>
            <p>
            In the <code>Scribo.MEI</code> module, this is how we convert a single
            <code>Note</code> structure to an MEI <code>note</code> element.
            </p>
            <pre>
<code class="language-haskell">
-- ** 'Note' becomes @note@ (pitch with syllable, or rest)

-- | Create an MEI @note@ element from our @Note@ datatype, converting the
-- attributes as needed. If the @Note@ actually contains a rest ('Pitch' with
-- only a 'Dur' in the rest range), then produce a @rest@ element.
note2mei :: Note -&gt; String
note2mei note | isPitchRest pitch = meiRest
              | otherwise         = meiNote 
    where 
        pitch    = notePitch note
        syllable = noteSyllable note

        meiRest  = elementAttr "rest" [meiDur pitch] []

        meiNote  = elementAttr "note"
                    [ fn pitch | fn &lt;- [meiPname, meiOct, meiDur] ]
                    [ meiAccid pitch
                    , element "verse" [meiSyllable syllable]
                    ]
</code>
            </pre>
            <p>
            This, then, is how we render the whole <code>Phrase</code> (one line of
            input text, set to music by the ark) into MEI.
            </p>
            <pre>
<code class="language-haskell">
 -- | Make an XML string containing a list of @note@ elements out of a
-- 'MusicPhrase'; end each phrase with @barline@, except for last in the list.
--
-- Leave the barline of the last phrase up to the next-higher function (end of
-- sentence gets regular bar; end of sentence, double bar; end of
-- section, final bar).
phrase2mei :: (ListPosition, MusicPhrase) -&gt; String
phrase2mei (position, phrase) | position `elem` [ListEnd, ListOnly] 
                                    = meiNotes
                              | otherwise
                                    = meiNotes ++ meiBarline ""
    where meiNotes = concat $ map note2mei $ notes phrase
</code>
            </pre>
          </section>
          <section>
            <h3>Running the ark</h3>
            <p>
            Here is the key part of the application’s main function
            <code>Main.hs</code> (not included in the 
            <a href="doc/index.html">library documentation</a>).
            After importing all the modules and the <code>arca</code>
            structure, the main function processes the command-line arguments
            to get the input and output sources, then it parses and prepares
            the input text (<code>readInput</code> and
            <code>prepareInput</code>), and generates a list of random numbers
            to select permutations for each phrase (<code>inputPerms</code>).
            The key functions are <code>makeMusicScore</code> to generate the
            music and then <code>score2mei</code> to produce the MEI output.
            </p>
            <pre>
            <code class="language-haskell">
let 
    input       = readInput rawInput
    sections    = prepareInput input 
    lengths     = inputPhraseLengths sections
    metadata    = arkMetadata input

perms &lt;- inputPerms lengths

let 
    score = makeMusicScore arca sections perms 
    mei   = score2mei arca metadata score
              </code>
            </pre>
          </section>
        </section>
        <section>
          <h2>Input format</h2>
          <p>
          The ark program accepts input files in a special XML format, using
          certain elements of the Text Encoding Initiative format.
          The file must have a <code>head</code> element with the title and
          author of the words, followed by a <code>text</code> element that
          includes the words to be set to music.
          </p>
          <p>Here is an input text for <cite>Ave Regina angelorum</cite>:</p>
          <pre>
<code class="language-xml">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!DOCTYPE arkText SYSTEM "arkText.dtd"&gt;
&lt;arkText&gt;
  &lt;head&gt;
    &lt;title&gt;Ave Regina Angelorum&lt;/title&gt;
    &lt;wordsAuthor&gt;Kircher?&lt;/wordsAuthor&gt;
  &lt;/head&gt;
  &lt;text&gt;
    &lt;section textMeter="IambicumEnneasyllabicum"
      musicMeter="Duple" style="Simple" mode="Mode8"&gt;
    &lt;lg&gt;
      &lt;l&gt;`A-ve Re-`gi-na An-ge-`lo-rum,&lt;/l&gt;
      &lt;l&gt;`A-ve me-`de-la po-pu-`lo-rum,&lt;/l&gt;
      &lt;l&gt;`Sal-ve fons `vi-ta, `sal-ve `por-ta,&lt;/l&gt;
      &lt;l&gt;Ex qua lux `mun-di `no-bis `or-ta.&lt;/l&gt;
    &lt;/lg&gt;
  &lt;/section&gt;
&lt;/text&gt;
&lt;/arkText&gt;
</code>
          </pre>
          <p>
          The text should be divided into one or more sections, and
          subsequently into one or more line groups (<code>lg</code> elements
          for stanzas or paragraphs) and lines (<code>l</code> elements).
          </p>
          <p>
          The following attributes are required at the start of each section:
          </p>
          <dl>
            <dt>style</dt>
            <dd>Simple or Florid</dd>
            <dt>textMeter</dt>
            <dd>One of the following values:
              <dl>
                <dt>Prose</dt>
                <dd>No meter, free, or irregular</dd>

                <dt>Adonium</dt>
                <dd>5  syllables (<code>`--`-</code>)</dd>

                <dt>Dactylicum</dt>
                <dd>6  syllables (<code>`--`--</code>)</dd>

                <dt>IambicumEuripidaeum</dt>
                <dd>6  syllables (<code>`-`-`-</code>)</dd>

                <dt>Anacreonticum</dt>
                <dd>7  syllables, penultimate long</dd>

                <dt>IambicumArchilochicum</dt>
                <dd>8  syllables, penultimate short</dd>

                <dt>IambicumEnneasyllabicum</dt>
                <dd>9  syllables, penultimate long</dd>

                <dt>Enneasyllabicum</dt>
                <dd>9  syllables (generic)</dd>

                <dt>Decasyllabicum</dt>
                <dd>10 syllables, penultimate short</dd>

                <dt>PhaleuciumHendecasyllabicum</dt>
                <dd>11 syllables</dd>

                <dt>Hendecasyllabicum</dt>
                <dd>11 syllables (generic)</dd>

                <dt>Sapphicum</dt>
                <dd>11 syllables, three lines + 5-syllable tag</dd>

                <dt>Dodecasyllabicum</dt>
                <dd>12 syllables, penultimate short</dd>
              </dl>
            </dd>
            <dt>mode</dt>
            <dd>One of the twelve modes as Mode1, Mode2, ... Mode12</dd>
          </dl>
        </section>
        <section>
          <section>
            <h2>Web app</h2>
            <p>
            In the web app, we use Javascript to generate appropriate lists of
            options to select permissible combinations of texts and parameters
            (not every text can be set in every mode, for instance).
            </p>
            <p>
            These selections are passed to a PHP file that selects the
            appropriate pre-written input text. In <q>DIY</q> mode, where you
            select all the parameters yourself, we also use PHP to insert those
            values into the input file. Then we pass the input file to the ark
            and save the MEI-XML output in a variable. 
            </p>
            <p>
            Via Javascript we pass this data to the third-party 
            <a href="https://www.verovio.org/">Verovio</a> app to render the
            musical data to notation, and to the Verovio toolkit to render it
            to MIDI. The Verovio MIDI player allows to make the music audible.
            </p>
          </section>
        </section>
      </section>
      <section id="reflections">
        <h1>What does this project tell us about computing and
          composition?</h1>
        <ol>
          <li>Computing concepts at work in the ark
            <ol>
              <li>Turning things into numbers in order to manipulate them at a
              more abstract level</li>
              <li>Tables = data structures = algorithms = functions</li>
              <li>Music encoding</li>
            </ol>
          </li>
          <li>Concepts of composition in the ark
            <ol>
              <li>Composers as craftsmen not artists</li>
              <li>Composers as assemblers of pre-existing conventional
                structures (cf. schemata theory)</li>
              <li>Music as combinatorics</li>
              <li>Relevance to missionary field and colonialism: supposed
                universality of European polyphony; determinism of music vs.
                non-determinism of language</li>
            </ol>
          </li>
          <li>Reception and use of Kircher's work</li>
          <li>Comparison to today's machine-composition projects</li>
          <li>Kircher, Knuth, and the cranks</li>
        </ol>
        <!-- TODO -->
      </section>
      <section id="biblio">
        <h1>Bibliography and related projects</h1>
        <section>
        <p>
        Carlo Maria Chierotti’s dissertation and articles 
        (<a href="#Chierotti:KircherDiss">n.d.</a>, 
        <a href="#Chierotti:KircherMirifica">1992</a>, and 
        <a href="#Chierotti:KircherComporre">1994</a>) 
        on the same subject provide a good overview of Kircher’s work and the
        structure and operation of the ark, with some detailed analysis of the
        types of harmonies and cadences in the voice permutations.
        Chierotti views the ark as one the one hand trying to encyclopedically
        capture all musical knowledge and reduce it to simple rules, while on
        the other hand trying to provide users with a tool to <em>expand</em>
        their possibilities for musical creativity and rhetorical expression.
        He does not view the <em>Arca musarithmica</em> as a machine or
        consider its potential as an automatic system, emphasizing instead how
        much interaction is actually demanded from the user in order to
        produce good results.</p>
        <p>
        Like so much else about Kircher, the ark is indeed a contradictory
        blend of nascent empirical/scientific and traditional faith-based ways
        of viewing the world. 
        The goal of my project was to test the extent to which the ark could
        operate as a fully automated system, and therefore whether it could be
        considered a computer. While certain aspects of Kircher’s
        specification must be ignored (or await more advanced programming) to
        eliminate human interventions after the initial inputs, this research
        does demonstrate that it is possible to generate reasonably coherent
        music using only the strict rule-based algorithms and data structures
        of the ark.
        A more discerning user could certainly take the music generated by
        this implementation and apply the kinds of adjustments Kircher himself
        suggests to improve the end product.
        </p>
        <p>
        I view Kircher’s system as an incomplete specification for a fully
        automated system: most of the parts that appear to require human
        intervention are simply under-specified, and rules could be devised to
        automate them.
        Of course Kircher had no way of actually automating the system
        mechanically, any more than Turing did in his initial mathematical
        description of Turing machines.
        The question of whether the device is a computer is not dependent on
        whether there exists a working physical implementation.
        In any case, such an implementation does now exist, in the present
        software.
        </p>
        </section>
        <section>
        <p>
        Jim Bumgardner (<a href="#Bumgardner:Kircher">2009</a>) 
        implemented a different music-computing device by Kircher, the
        <em>Organum mathematicum</em>.
        That device was much simpler musically but had the virtue of also
        being able to calculate the date of Easter and lots of other useful
        functions.
        That implementation in Perl allowed a user to set a very small set of
        short texts in simple or florid style.
        It could generate MIDI output, even using vocal synthesis to render
        the actual syllable sounds.
        </p>
        <p>
        Bumgardner highlights both Kircher’s clear intent to build an
        automatic, algorithmic system for composition, and the inconsistencies
        and underspecified elements that undermine that goal. He also
        recognizes Kircher’s ambivalence about the need for random choices in
        order to automate the system fully.
        Both Bumgardner and Chierotti approach Kircher's mode table
        anachronistically rather than in light of newer research in
        seventeenth-century tonal organization 
        (<a href="#Barnett:TonalOrganization17C">Barnett 2002</a>).
        </p>
        </section>
        <section>
        <p>
        Agnes Cäcilie Bohnert’s dissertation 
        (<a href="#Bohnert:Kircher">YEAR</a>) covers Book VIII of the
        <cite>Musurgia</cite> in detail, focusing especially on the
        mathematical treatment of combinatorics at the beginning.  It
        identifies numerous errors in Kircher’s calculations.  Bohnert
        implemented a portion of the ark in Java, but could only
        set short texts in simple style.
        <!-- etc -->
        </p>
        </section>
       
        <section>
          <h2>References</h2>

          <ul class="bibliography">
            <li id="Barnett:TonalOrganization17C">Barnett, Gregory. 2002.
                <q>Tonal Organization in Seventeenth-Century Music Theory.</q>
                In <a href="#Cambridge:HistoryofTheory">Christensen, <cite>The
                        Cambridge History of Western Music Theory</cite></a>,
                407–455.
            </li>

            <li id="Bohnert:Kircher">Bohnert, Agnes Cäcilie. </li>

            <li id="Bumgardner:Kircher">Bumgardner, Jim. 2009. 
              <a href="https://jbum.com/papers/kircher_paper.pdf">
              <q>Kircher’s Mechanical Composer: A Software
                Implementation.</q></a>
              Paper presented at the Bridges Conference, Banff.
            </li>

            <li id="Chierotti:KircherDiss">Chierotti, Carlo Mario. n.d. 
                <a href="http://www.kircher.chierotti.it/tesi">[Tesi di laurea
                    sulla <cite>Musurgia Universalis</cite> di Athanasius
                    Kircher]</a>.
                Laureate thesis, University of Turin.
            </li>

            <li id="Chierotti:KircherMirifica">Chierotti, Carlo Mario. 1992.
              <q>La musurgia mirifica di Athanasius Kircher: la composizione
                musicale alla portata di tutti nell’età barocca.</q>
              <cite>Musica/realtà</cite> 13, no. 37: 107–127.
            </li>

            <li id="Chierotti:KircherComporre">Chierotti, Carlo Mario. 1994.
              <q>Comporre senza conoscere la musica: Athanasius Kircher e le
                ‘Musica mirifica’: un singolare esempio di scienza musicale
                nell’età barocca.</q>
              <cite>Nuova rivista musicale italiana</cite> 28, no. 3: 382–410.
            </li>

            <li id="Cambridge:HistoryofTheory">Christensen, Thomas, ed. 2002.
                <cite>The Cambridge History of Western Music Theory</cite>.
                Cambridge: Cambridge University Press, 2002.
            </li>

            <li id="Findlen:Kircher">Findlen, Paula, ed. 2004.
                <cite>Athanasius Kircher: The Last Man Who Knew
                    Everything</cite>.
                New York: Routledge.
            </li>

            <li id="Godwin:KircherTheater">Godwin, Joscelyn. 2009.
                <cite>Athanasius Kircher’s Theater of the World: The Life and
                    Work of the Last Man to Search for Universal
                    Knowledge</cite>.
                Rochester, VT: Inner Traditions.
            </li>

            <li id="Judd:RenaissanceModalTheory">Judd, Cristle Collins. 2002.
                <q>Renaissance Modal Theory: Theoretical, Compositional, and
                    Editorial Perspectives.</q>
                In <a href="#Cambridge:HistoryofTheory">Christensen, <cite>The
                        Cambridge History of Western Music Theory</cite></a>,
                364–406.
            <li id="Kircher:Musurgia">Kircher, Athanasius. 1650.
                <cite>Musurgia universalis, sive Ars magna consoni et dissoni
                    in X. libros digesta</cite>.
                Rome.
            </li>

          </ul>
        </section>
      </section>
    </main>
    <footer>
      Copyright © 2021 Andrew A. Cashner. All rights reserved.
    </footer>
  </body>
</html>
